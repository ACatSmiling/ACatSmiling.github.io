<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
<meta property="og:type" content="website">
<meta property="og:title" content="XiSun的博客">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="XiSun的博客">
<meta property="og:description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="XiSun">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>XiSun的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">XiSun的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Learning is endless</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/01/java-string/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/01/java-string/" class="post-title-link" itemprop="url">Java String 类</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-01 19:31:54" itemprop="dateCreated datePublished" datetime="2021-01-01T19:31:54+08:00">2021-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-09 16:01:30" itemprop="dateModified" datetime="2021-04-09T16:01:30+08:00">2021-04-09</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>25 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="String-的特性"><a href="#String-的特性" class="headerlink" title="String 的特性"></a>String 的特性</h2><p>String：字符串，使用双引号引起来表示。</p>
<ul>
<li><p>String 是一个 final 类，不可被继承。</p>
</li>
<li><p>String 继承了 Serializable、Comparable 和 CharSequence 接口。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>实现 Serializable 接口：表示字符串是支持可序列化的。</li>
<li>实现 Comparable 接口  ：表示 String 可以比较大小。</li>
</ul>
</li>
<li><p><strong>String 内部定义了 <code>final char value[]</code> 用于存储字符串数据。</strong></p>
</li>
<li><p>String 代表不可变的字符序列 — 不可变性。 体现在：</p>
<ul>
<li><strong>当对字符串重新赋值时，需要重新指定内存区域赋值，不能使用原有的 value 进行赋值。</strong></li>
<li><strong>当对现有的字符串进行连接操作时，也需要重新指定内存区域赋值。</strong></li>
<li><strong>当调用 String 的 <code>replace()</code> 修改原字符串中指定的字符或字符串时，也需要重新指定内存区域赋值。</strong></li>
</ul>
</li>
<li><p><strong>通过字面量的定义 (区别于 new) 方式给一个字符串赋值，此时的字符串值声明在字符串常量池中。</strong></p>
</li>
<li><p><strong>字符串常量池中不会存储相同内容的字符串。</strong></p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;abc&quot;</span>;<span class="comment">// 字面量的定义方式</span></span><br><span class="line">        String s2 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        System.out.println(s1 == s2);<span class="comment">// true</span></span><br><span class="line">        s1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">        System.out.println(s1 == s2);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s1);<span class="comment">// hello</span></span><br><span class="line">        System.out.println(s2);<span class="comment">// abc</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;**************************&quot;</span>);</span><br><span class="line">        String s3 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        s3 += <span class="string">&quot;def&quot;</span>;</span><br><span class="line">        System.out.println(s3);<span class="comment">// abcdef</span></span><br><span class="line">        System.out.println(s2);<span class="comment">// abc ---&gt; 原abc没变</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;**************************&quot;</span>);</span><br><span class="line">        String s4 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        String s5 = s4.replace(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;m&quot;</span>);</span><br><span class="line">        System.out.println(s4);<span class="comment">// abc ---&gt; 原abc没变</span></span><br><span class="line">        System.out.println(s5);<span class="comment">// mbc</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<img src="/2021/01/01/java-string/image-20210311165147346.png" alt="image-20210311165147346" style="zoom:80%;">

<h2 id="String-对象的创建"><a href="#String-对象的创建" class="headerlink" title="String 对象的创建"></a>String 对象的创建</h2><ul>
<li><p><strong>方式一：通过字面量定义的方式，此时的字符串数据声明在方法区中的字符串常量池中。</strong></p>
</li>
<li><p><strong>方式二：通过 “new + 构造器” 的方式，此时变量保存的地址值，是字符串数据在堆空间中开辟空间以后所对应的地址值。</strong></p>
</li>
<li><p>常用的几种创建方式：</p>
<img src="/2021/01/01/java-string/image-20210311172851224.png" alt="image-20210311172851224" style="zoom:67%;">
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 通过字面量定义的方式：此时的s1和s2的数据javaEE，声明在方法区中的字符串常量池中</span></span><br><span class="line">        String s1 = <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">        String s2 = <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过&quot;new+构造器&quot;的方式：此时的s3和s4保存的地址值，是数据在堆空间中开辟空间以后所对应的地址值</span></span><br><span class="line">        String s3 = <span class="keyword">new</span> String(<span class="string">&quot;javaEE&quot;</span>);</span><br><span class="line">        String s4 = <span class="keyword">new</span> String(<span class="string">&quot;javaEE&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(s1 == s2);<span class="comment">// true</span></span><br><span class="line">        System.out.println(s1 == s3);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s1 == s4);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">// false</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;*************************&quot;</span>);</span><br><span class="line">        Person p1 = <span class="keyword">new</span> Person(<span class="string">&quot;Tom&quot;</span>, <span class="number">12</span>);<span class="comment">// 通过字面量定义的方式定义的name</span></span><br><span class="line">        Person p2 = <span class="keyword">new</span> Person(<span class="string">&quot;Tom&quot;</span>, <span class="number">12</span>);</span><br><span class="line">        System.out.println(p1.name.equals(p2.name));<span class="comment">// true</span></span><br><span class="line">        System.out.println(p1.name == p2.name);<span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">        p1.name = <span class="string">&quot;Jerry&quot;</span>;</span><br><span class="line">        System.out.println(p2.name);<span class="comment">// Tom</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;*************************&quot;</span>);</span><br><span class="line">        Person p3 = <span class="keyword">new</span> Person(<span class="keyword">new</span> String(<span class="string">&quot;Tom&quot;</span>), <span class="number">12</span>);<span class="comment">// 通过&quot;new+构造器&quot;的方式定义的name</span></span><br><span class="line">        Person p4 = <span class="keyword">new</span> Person(<span class="keyword">new</span> String(<span class="string">&quot;Tom&quot;</span>), <span class="number">12</span>);</span><br><span class="line">        System.out.println(p3.name.equals(p4.name));<span class="comment">// true</span></span><br><span class="line">        System.out.println(p3.name == p4.name);<span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内存解析说明：</p>
<img src="/2021/01/01/java-string/image-20210311173259265.png" alt="image-20210311173259265" style="zoom:67%;">
</li>
<li><p>字符串初始化的过程：</p>
<img src="/2021/01/01/java-string/image-20210311194020782.png" alt="image-20210311194020782" style="zoom:67%;">

<img src="/2021/01/01/java-string/image-20210311194118841.png" alt="image-20210311194118841" style="zoom:80%;">
</li>
<li><p><strong>字符串拼接：</strong></p>
<ul>
<li><strong>如果是常量与常量的拼接，则结果在常量池，且常量池中不会存在相同内容的常量。</strong></li>
<li><strong>如果其中有一个是变量，则结果在堆中。</strong></li>
<li><strong>如果拼接的结果调用 <code>intern()</code> 方法，则返回值在常量池中。</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">        String s2 = <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">        String s3 = <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">        String s4 = <span class="string">&quot;javaEE&quot;</span> + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">        String s5 = s1 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">        String s6 = <span class="string">&quot;javaEE&quot;</span> + s2;</span><br><span class="line">        String s7 = s1 + s2;</span><br><span class="line">        String s8 = (s1 + s2).intern();</span><br><span class="line"></span><br><span class="line">        System.out.println(s3 == s4);<span class="comment">// true</span></span><br><span class="line">        System.out.println(s3 == s5);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s3 == s6);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s3 == s7);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s3 == s8);<span class="comment">// true</span></span><br><span class="line">        System.out.println(s5 == s6);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s5 == s7);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s5 == s8);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s6 == s7);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s6 == s8);<span class="comment">// false</span></span><br><span class="line">        System.out.println(s7 == s8);<span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内存解析说明：</p>
<img src="/2021/01/01/java-string/image-20210311212720801.png" alt="image-20210311212720801" style="zoom: 80%;">

<p>特殊的情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;javaEEhadoop&quot;</span>;</span><br><span class="line">        String s2 = <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">        String s3 = s2 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">        System.out.println(s1 == s3);<span class="comment">// false</span></span><br><span class="line">        <span class="keyword">final</span> String s4 = <span class="string">&quot;javaEE&quot;</span>;</span><br><span class="line">        String s5 = s4 + <span class="string">&quot;hadoop&quot;</span>;</span><br><span class="line">        System.out.println(s1 == s5);<span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        System.out.println(s2 == s4);<span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>s4 变量被 final 修饰，实际上也就是常量，等同于 s2。</p>
</blockquote>
</li>
<li><p>面试题</p>
<ul>
<li><p><code>String s = new String(&quot;abc&quot;);</code> 方式创建对象，在内存中创建了几个对象？</p>
<ul>
<li>两个：一个是堆空间中 new 的结构，另一个是 char[] 对应的常量池中的数据 “abc”。</li>
</ul>
</li>
<li><p><code>String str1 = &quot;abc&quot;;</code> 与 <code>String str2 = new String(&quot;abc&quot;);</code> 的区别？</p>
<ul>
<li><strong>字符串常量存储在字符串常量池，目的是共享。</strong></li>
<li><strong>字符串非常量对象存储在堆中。</strong></li>
</ul>
<img src="/2021/01/01/java-string/image-20210311194809127.png" alt="image-20210311194809127" style="zoom:67%;">
</li>
<li><p>下面程序的运行结果是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    String str = <span class="keyword">new</span> String(<span class="string">&quot;good&quot;</span>);</span><br><span class="line">    <span class="keyword">char</span>[] ch = &#123;<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(String str, <span class="keyword">char</span> ch[])</span> </span>&#123;</span><br><span class="line">        str = <span class="string">&quot;test ok&quot;</span>;</span><br><span class="line">        ch[<span class="number">0</span>] = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringTest ex = <span class="keyword">new</span> StringTest();</span><br><span class="line">        ex.change(ex.str, ex.ch);</span><br><span class="line">        System.out.println(ex.str);<span class="comment">// good</span></span><br><span class="line">        System.out.println(ex.ch);<span class="comment">// best</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>值传递机制和 String 的不可变性。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="String-的常用方法"><a href="#String-的常用方法" class="headerlink" title="String 的常用方法"></a>String 的常用方法</h2><ul>
<li><p><code>int length()</code>：返回字符串的长度，<code>return value.length</code>。</p>
</li>
<li><p><code>char charAt(int index)</code>：返回某索引处的字符，<code>return value[index]</code>。</p>
</li>
<li><p><code>boolean isEmpty()</code>：判断是否是空字符串，<code>return value.length == 0</code>。</p>
</li>
<li><p><code>String toLowerCase()</code>：使用默认语言环境，将 String 中的所有字符转换为小写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        String s2 = s1.toLowerCase();<span class="comment">// s1不可变，仍未原来的字符串</span></span><br><span class="line">        System.out.println(s2);<span class="comment">// helloworld</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String toUpperCase()</code>：使用默认语言环境，将 String 中的所有字符转换为大写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        String s2 = s1.toUpperCase();<span class="comment">// s1不可变，仍未原来的字符串</span></span><br><span class="line">        System.out.println(s2);<span class="comment">// HELLOWORLD</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String trim()</code>：返回字符串的副本，忽略前导空白和尾部空白。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;  he  llo    world    &quot;</span>;</span><br><span class="line">        String s2 = s1.trim();</span><br><span class="line">        System.out.println(<span class="string">&quot;---&quot;</span> + s1 + <span class="string">&quot;---&quot;</span>);<span class="comment">// ---  he  llo    world    ---</span></span><br><span class="line">        System.out.println(<span class="string">&quot;---&quot;</span> + s2 + <span class="string">&quot;---&quot;</span>);<span class="comment">// ---he  llo    world---</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>boolean equals(Object obj)</code>：比较字符串的内容是否相同。</p>
</li>
<li><p><code>boolean equalsIgnoreCase(String anotherString)</code>：比较字符串的内容是否相同，忽略大小写。</p>
</li>
<li><p><code>String concat(String str)</code>：将指定字符串连接到此字符串的结尾，等价于用 “+”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        String s2 = s1.concat(<span class="string">&quot;def&quot;</span>);</span><br><span class="line">        System.out.println(s2);<span class="comment">// abcdef</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int compareTo(String anotherString)</code>：比较两个字符串的大小。</p>
</li>
<li><p><code>String substring(int beginIndex)</code>：返回一个新的字符串，截取当前字符串从 beginIndex 开始到最后的一个子字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        String s2 = s1.substring(<span class="number">2</span>);</span><br><span class="line">        System.out.println(s2);<span class="comment">// lloWorld</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String substring(int beginIndex, int endIndex)</code>：返回一个新字符串，截取当前字符串从 beginIndex 开始到 endIndex (不包含) 结束的一个子字符串 — 左闭右开，<code>[beginIndex, endIndex)</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        String s2 = s1.substring(<span class="number">2</span>, <span class="number">6</span>);</span><br><span class="line">        System.out.println(s2);<span class="comment">// lloW</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>boolean endsWith(String suffix)</code>：测试此字符串是否以指定的后缀结束。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        System.out.println(s1.endsWith(<span class="string">&quot;ld&quot;</span>));<span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>boolean startsWith(String prefix)</code>：测试此字符串是否以指定的前缀开始。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        System.out.println(s1.startsWith(<span class="string">&quot;ll&quot;</span>));<span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>boolean startsWith(String prefix, int toffset)</code>：测试此字符串从指定索引开始的子字符串是否以指定前缀开始。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        System.out.println(s1.startsWith(<span class="string">&quot;ll&quot;</span>, <span class="number">2</span>));<span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>boolean contains(CharSequence s)</code>：当且仅当此字符串包含指定的 char 值序列时，返回 true。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        System.out.println(s1.contains(<span class="string">&quot;wo&quot;</span>));<span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int indexOf(String str)</code>：返回指定子字符串在此字符串中第一次出现处的索引，未找到返回 -1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        System.out.println(s1.indexOf(<span class="string">&quot;lo&quot;</span>));<span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int indexOf(String str, int fromIndex)</code>：返回指定子字符串在此字符串中第一次出现处的索引，从指定的索引开始，未找到返回 -1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;HelloWorld&quot;</span>;</span><br><span class="line">        System.out.println(s1.indexOf(<span class="string">&quot;lo&quot;</span>, <span class="number">5</span>));<span class="comment">// -1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int lastIndexOf(String str)</code>：返回指定子字符串在此字符串中最右边出现处的索引，未找到返回 -1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;hellorworld&quot;</span>;</span><br><span class="line">        System.out.println(s1.lastIndexOf(<span class="string">&quot;or&quot;</span>));<span class="comment">// 7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>面试题：什么情况下，<code>indexOf(str)</code> 和 <code>lastIndexOf(str)</code> 返回值相同？</strong></p>
<p><strong>情况一：存在唯一的一个 str。情况二：不存在 str。</strong></p>
</li>
<li><p><code>int lastIndexOf(String str, int fromIndex)</code>：返回指定子字符串在此字符串中最后一次出现处的索引，从指定的索引开始反向搜索，未找到返回 -1。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;hellorworld&quot;</span>;</span><br><span class="line">        System.out.println(s1.lastIndexOf(<span class="string">&quot;or&quot;</span>, <span class="number">6</span>));<span class="comment">// 4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String replace(char oldChar, char newChar)</code>：返回一个新的字符串，它是通过用 newChar 替换此字符串中出现的所有 oldChar 得到的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;hellorworld&quot;</span>;</span><br><span class="line">        String s2 = s1.replace(<span class="string">&quot;o&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">        System.out.println(s2);<span class="comment">// hellDrwDrld</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String replace(CharSequence target, CharSequence replacement)</code>：使用指定的字面值替换序列替换此字符串所有匹配字面值目标序列的子字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s1 = <span class="string">&quot;hellorworld&quot;</span>;</span><br><span class="line">        String s2 = s1.replace(<span class="string">&quot;or&quot;</span>, <span class="string">&quot;DE&quot;</span>);</span><br><span class="line">        System.out.println(s2);<span class="comment">// hellDEwDEld</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String replaceAll(String regex, String replacement)</code>：使用给定的 replacement 替换此字符串所有匹配给定的正则表达式的子字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;12hello34world5java7891mysql456&quot;</span>;</span><br><span class="line">        <span class="comment">// 把字符串中的数字替换成,，如果结果中开头和结尾有,的话去掉</span></span><br><span class="line">        String s1 = str.replaceAll(<span class="string">&quot;\\d+&quot;</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">        System.out.println(s1);<span class="comment">// ,hello,world,java,mysql,</span></span><br><span class="line">        String s2 = s1.replaceAll(<span class="string">&quot;^,|,$&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(s2);<span class="comment">// hello,world,java,mysql</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String replaceFirst(String regex, String replacement)</code>：使用给定的 replacement 替换此字符串匹配给定的正则表达式的第一个子字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;12hello34world5java7891mysql456&quot;</span>;</span><br><span class="line">        <span class="comment">// 把字符串中的数字替换成,，如果结果中开头和结尾有，的话去掉</span></span><br><span class="line">        String s1 = str.replaceFirst(<span class="string">&quot;\\d+&quot;</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">        System.out.println(s1);<span class="comment">// ,hello34world5java7891mysql456</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>boolean matches(String regex)</code>：告知此字符串是否匹配给定的正则表达式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;1234d5&quot;</span>;</span><br><span class="line">        <span class="comment">// 判断str字符串中是否全部由数字组成，即有1-n个数字组成</span></span><br><span class="line">        <span class="keyword">boolean</span> matches = str.matches(<span class="string">&quot;\\d+&quot;</span>);</span><br><span class="line">        System.out.println(matches);<span class="comment">// false</span></span><br><span class="line">        String tel = <span class="string">&quot;0571-4534289&quot;</span>;</span><br><span class="line">        <span class="comment">// 判断这是否是一个杭州的固定电话</span></span><br><span class="line">        <span class="keyword">boolean</span> result = tel.matches(<span class="string">&quot;0571-\\d&#123;7,8&#125;&quot;</span>);</span><br><span class="line">        System.out.println(result);<span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String[] split(String regex)</code>：根据匹配给定的正则表达式来拆分此字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;hello|world|java&quot;</span>;</span><br><span class="line">        String[] strs = str.split(<span class="string">&quot;\\|&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String value : strs) &#123;</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        String str2 = <span class="string">&quot;hello.world.java&quot;</span>;</span><br><span class="line">        String[] strs2 = str2.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : strs2) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        String str3 = <span class="string">&quot;hello-world-java&quot;</span>;</span><br><span class="line">        String[] strs3 = str3.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : strs3) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">java</span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">java</span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">world</span><br><span class="line">java</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>String[] split(String regex, int limit)</code>：根据匹配给定的正则表达式来拆分此字符串，最多不超过 limit 个，如果超过了，剩下的全部都放到最后一个元素中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;hello|world|java&quot;</span>;</span><br><span class="line">        String[] strs = str.split(<span class="string">&quot;\\|&quot;</span>,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (String value : strs) &#123;</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">hello</span><br><span class="line">world|java</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>substring()</code> 与 <code>indexOf()</code> 结合使用：</p>
<ul>
<li><p>截取第二个 “-“ 之前的字符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;application-2005-US20050154023A1-20050714&quot;</span>;</span><br><span class="line">        String r = s.substring(<span class="number">0</span>, s.indexOf(<span class="string">&quot;-&quot;</span>, s.indexOf(<span class="string">&quot;-&quot;</span>) + <span class="number">1</span>));</span><br><span class="line">        System.out.println(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">application-<span class="number">2005</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>截取第二个 “-“ 之后的字符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;application-2005-US20050154023A1-20050714&quot;</span>;</span><br><span class="line">        String r = s.substring(s.indexOf(<span class="string">&quot;-&quot;</span>, s.indexOf(<span class="string">&quot;-&quot;</span>) + <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">        System.out.println(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">US20050154023A1-<span class="number">20050714</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>截取倒数第二个 “-“ 之前的字符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;application-2005-US20050154023A1-20050714&quot;</span>;</span><br><span class="line">        String r = s.substring(<span class="number">0</span>, s.lastIndexOf(<span class="string">&quot;-&quot;</span>, s.lastIndexOf(<span class="string">&quot;-&quot;</span>) - <span class="number">1</span>));</span><br><span class="line">        System.out.println(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">application-<span class="number">2005</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>截取倒数第二个 “-“ 之后的字符：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = <span class="string">&quot;application-2005-US20050154023A1-20050714&quot;</span>;</span><br><span class="line">        String r = s.substring(s.lastIndexOf(<span class="string">&quot;-&quot;</span>, s.lastIndexOf(<span class="string">&quot;-&quot;</span>) - <span class="number">1</span>) + <span class="number">1</span>);</span><br><span class="line">        System.out.println(r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">US20050154023A1-<span class="number">20050714</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="String-与其他结构之间的转换"><a href="#String-与其他结构之间的转换" class="headerlink" title="String 与其他结构之间的转换"></a>String 与其他结构之间的转换</h2><h3 id="String-与基本数据类型-包装类之间的转换"><a href="#String-与基本数据类型-包装类之间的转换" class="headerlink" title="String 与基本数据类型/包装类之间的转换"></a>String 与基本数据类型/包装类之间的转换</h3><ul>
<li>字符串转换为基本数据类型/包装类<ul>
<li>Integer 包装类的 <code>public static int parseInt(String s)</code>：可以将由 “数字” 字符组成的字符串，转换为整型。</li>
<li>类似地，使用 java.lang 包中的 Byte、Short、Long、Float、Double 类调相应的类方法可以将由 “数字” 字符组成的字符串，转换为相应的基本数据类型。</li>
</ul>
</li>
<li>基本数据类型/包装类转换为字符串<ul>
<li>调用 String 类的 <code>public String valueOf(int n)</code> 可将 int 型转换为字符串。</li>
<li>相应的 <code>valueOf(byte b)</code>、<code>valueOf(long l)</code>、<code>valueOf(float f)</code>、<code>valueOf(doubled)</code>、<code>valueOf(boolean b)</code> 可将参数的相应类型转换为字符串。</li>
</ul>
</li>
</ul>
<h3 id="String-与字符数组-char-之间的转换"><a href="#String-与字符数组-char-之间的转换" class="headerlink" title="String 与字符数组 (char[]) 之间的转换"></a>String 与字符数组 (char[]) 之间的转换</h3><ul>
<li><p>字符串转换为字符数组</p>
<ul>
<li><p><code>public char[] toCharArray()</code>：将字符串中的全部字符存放在一个字符数组中的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;hello|world|java&quot;</span>;</span><br><span class="line">        <span class="keyword">char</span>[] chars = str.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : chars) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>public void getChars(int srcBegin, int srcEnd, char[] dst, int dstBegin)</code>：提供了将指定索引范围内的字符串存放到数组中的方法。</p>
</li>
</ul>
</li>
<li><p>字符数组转换为字符串</p>
<ul>
<li><p>String 类的构造器：<code>String(char[])</code> 和 <code>String(char[], int offset, intlength)</code> 分别用字符数组中的全部字符和部分字符创建字符串对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] arr = <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line">        String str = <span class="keyword">new</span> String(arr);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="String-与字节数组-byte-之间的转换"><a href="#String-与字节数组-byte-之间的转换" class="headerlink" title="String 与字节数组 (byte[]) 之间的转换"></a>String 与字节数组 (byte[]) 之间的转换</h3><ul>
<li><p>字符串转换为字节数组</p>
<ul>
<li><strong>编码：String —&gt; byte[]，字符串 —&gt; 字节，看得懂的 —&gt; 看不懂的二进制数据。</strong></li>
<li><code>public byte[] getBytes()</code>：使用平台的默认字符集将此 String 编码为 byte 序列，并将结果存储到新的 byte 数组中。</li>
<li><code>public byte[] getBytes(String charsetName)</code>：使用指定的字符集将此 String 编码为 byte 序列，并将结果存储到新的 byte 数组中。</li>
</ul>
</li>
<li><p>字节数组转换为字符串</p>
<ul>
<li><strong>解码：byte[] —&gt; String，字节 —&gt; 字符串，看不懂的二进制数据 —&gt; 看得懂的。编码的逆过程。</strong></li>
<li><code>String(byte[])</code>：通过使用平台的默认字符集解码指定的 byte 数组，构造一个新的 String。</li>
<li><code>String(byte[] ，int offset ，int length)</code>： ：用指定的字节数组的一部分，即从数组起始位置 offset 开始，取 length 个字节构造一个字符串对象。</li>
</ul>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="string">&quot;abc123ABC中国&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = str1.getBytes();<span class="comment">// 使用默认的字符集进行编码，此处是UTF-8</span></span><br><span class="line">        System.out.println(Arrays.toString(bytes));<span class="comment">// [97, 98, 99, 49, 50, 51, 65, 66, 67, -28, -72, -83, -27, -101, -67]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] gbks = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            gbks = str1.getBytes(<span class="string">&quot;GBK&quot;</span>);<span class="comment">// 使用GBK进行编码</span></span><br><span class="line">            System.out.println(Arrays.toString(gbks));<span class="comment">// [97, 98, 99, 49, 50, 51, 65, 66, 67, -42, -48, -71, -6]</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;*********************************&quot;</span>);</span><br><span class="line">        String str2 = <span class="keyword">new</span> String(bytes);<span class="comment">// 使用默认的字符集进行解码，此处是UTF-8</span></span><br><span class="line">        System.out.println(str2);<span class="comment">// abc123ABC中国</span></span><br><span class="line"></span><br><span class="line">        String str4 = <span class="keyword">new</span> String(gbks);</span><br><span class="line">        System.out.println(str4);<span class="comment">// abc123ABC�й�，出现乱码，原因：编码集和解码集不一致</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String gbk = <span class="keyword">new</span> String(gbks, <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">            System.out.println(gbk);<span class="comment">// abc123ABC中国，因为编码集和解码集一致，所以不会出现乱码</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>解码时，要求解码使用的字符集必须与编码时使用的字符集一致，否则会出现乱码。</strong></p>
</blockquote>
</li>
</ul>
<h2 id="String-相关的算法题目"><a href="#String-相关的算法题目" class="headerlink" title="String 相关的算法题目"></a>String 相关的算法题目</h2><ul>
<li><p>模拟一个 trim 方法，去除字符串两端的空格。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">myTrim</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 用于记录从前往后首次索引位置不是空格的位置的索引</span></span><br><span class="line">            <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 用于记录从后往前首次索引位置不是空格的位置的索引</span></span><br><span class="line">            <span class="keyword">int</span> end = str.length() - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (start &lt; end &amp;&amp; str.charAt(start) == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                start++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (start &lt; end &amp;&amp; str.charAt(end) == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                end--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (str.charAt(start) == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> str.substring(start, end + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String s = myTrim(<span class="string">&quot;  abc 123   d &quot;</span>);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将一个字符串中指定部分进行反转。比如 “abcdefg” 反转为 “abfedcg”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 方式一：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverse1</span><span class="params">(String str, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">char</span>[] charArray = str.toCharArray();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = start, j = end; i &lt; j; i++, j--) &#123;</span><br><span class="line">                <span class="keyword">char</span> temp = charArray[i];</span><br><span class="line">                charArray[i] = charArray[j];</span><br><span class="line">                charArray[j] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(charArray);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式二：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverse2</span><span class="params">(String str, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        String newStr = str.substring(<span class="number">0</span>, start);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = end; i &gt;= start; i--) &#123;</span><br><span class="line">            newStr += str.charAt(i);</span><br><span class="line">        &#125;</span><br><span class="line">        newStr += str.substring(end + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> newStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式三：推荐(相较于方式二做的改进)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">reverse3</span><span class="params">(String str, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        StringBuilder newStr = <span class="keyword">new</span> StringBuilder(str.length());</span><br><span class="line">        newStr.append(str, <span class="number">0</span>, start);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = end; i &gt;= start; i--) &#123;</span><br><span class="line">            newStr.append(str.charAt(i));</span><br><span class="line">        &#125;</span><br><span class="line">        newStr.append(str.substring(end + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> newStr.toString();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;abcdefg&quot;</span>;</span><br><span class="line">        String str1 = reverse3(str, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(str1);<span class="comment">// abfedcg</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取一个字符串在另一个字符串中出现的次数。比如：获取 “ab” 在 “abkkcadkabkebfkabkskab” 中出现的次数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">(String mainStr, String subStr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mainStr.length() &gt;= subStr.length()) &#123;</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">/*// 方式一：</span></span><br><span class="line"><span class="comment">            while ((index = mainStr.indexOf(subStr)) != -1) &#123;</span></span><br><span class="line"><span class="comment">                count++;</span></span><br><span class="line"><span class="comment">                mainStr = mainStr.substring(index + subStr.length());</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            <span class="comment">// 改进：</span></span><br><span class="line">            <span class="keyword">while</span> ((index = mainStr.indexOf(subStr, index)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                index += subStr.length();</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="string">&quot;cdabkkcadkabkebfkabkskab&quot;</span>;</span><br><span class="line">        String str2 = <span class="string">&quot;ab&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> count = getCount(str1, str2);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取两个字符串中最大相同子串。比如：<code>str1 = &quot;abcwerthelloyuiodef&quot;; str2 = &quot;cvhellobnm&quot;;</code>。提示：将短的那个串进行长度依次递减的子串与较长的串比较。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果只存在一个最大长度的相同子串</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMaxSameSubString</span><span class="params">(String str1, String str2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str1 != <span class="keyword">null</span> &amp;&amp; str2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String maxStr = (str1.length() &gt; str2.length()) ? str1 : str2;</span><br><span class="line">            String minStr = (str1.length() &gt; str2.length()) ? str2 : str1;</span><br><span class="line">            <span class="keyword">int</span> len = minStr.length();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;<span class="comment">// 此层循环决定要去几个字符</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>, y = len - i; y &lt;= len; x++, y++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (maxStr.contains(minStr.substring(x, y))) &#123;</span><br><span class="line">                        <span class="keyword">return</span> minStr.substring(x, y);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果存在多个长度相同的最大相同子串</span></span><br><span class="line">    <span class="comment">// 此时先返回String[]，后面可以用集合中的ArrayList替换，较方便</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] getMaxSameSubString1(String str1, String str2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (str1 != <span class="keyword">null</span> &amp;&amp; str2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            StringBuilder strs = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            String maxString = (str1.length() &gt; str2.length()) ? str1 : str2;</span><br><span class="line">            String minString = (str1.length() &gt; str2.length()) ? str2 : str1;</span><br><span class="line">            <span class="keyword">int</span> len = minString.length();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>, y = len - i; y &lt;= len; x++, y++) &#123;</span><br><span class="line">                    String subString = minString.substring(x, y);</span><br><span class="line">                    <span class="keyword">if</span> (maxString.contains(subString)) &#123;</span><br><span class="line">                        strs.append(subString).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (strs.length() != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> strs.toString().replaceAll(<span class="string">&quot;,$&quot;</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果存在多个长度相同的最大相同子串：使用ArrayList</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getMaxSameSubString2</span><span class="params">(String str1, String str2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str1 != <span class="keyword">null</span> &amp;&amp; str2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            String maxString = (str1.length() &gt; str2.length()) ? str1 : str2;</span><br><span class="line">            String minString = (str1.length() &gt; str2.length()) ? str2 : str1;</span><br><span class="line">            <span class="keyword">int</span> len = minString.length();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>, y = len - i; y &lt;= len; x++, y++) &#123;</span><br><span class="line">                    String subString = minString.substring(x, y);</span><br><span class="line">                    <span class="keyword">if</span> (maxString.contains(subString)) &#123;</span><br><span class="line">                        list.add(subString);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (list.size() != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="string">&quot;abcwerthelloyuiodef&quot;</span>;</span><br><span class="line">        String str2 = <span class="string">&quot;cvhellobnmiodef&quot;</span>;</span><br><span class="line">        String[] strs = getMaxSameSubString1(str1, str2);</span><br><span class="line">        System.out.println(Arrays.toString(strs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对字符串中的字符进行自然顺序排序。提示：① 字符串变成字符数组；② 对数组排序，选择，冒泡，<code>Arrays.sort();</code>；③ 将排序后的数组变成字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;abcwerthelloyuiodef&quot;</span>;</span><br><span class="line">        <span class="keyword">char</span>[] arr = str.toCharArray();</span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">        String newStr = <span class="keyword">new</span> String(arr);</span><br><span class="line">        System.out.println(newStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="String、StringBuffer-和-StringBuilder"><a href="#String、StringBuffer-和-StringBuilder" class="headerlink" title="String、StringBuffer 和 StringBuilder"></a>String、StringBuffer 和 StringBuilder</h2><ul>
<li><p><code>java.lang.StringBuffer</code> 代表可变的字符序列，jdk 1.0 中声明，可以对字符串内容进行增删，此时不会产生新的对象。作为参数传递时，方法内部可以改变值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuffer</span> <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>java.lang.StringBuilder</code> 和 <code>java.lang.StringBuffer</code> 非常类似，也代表可变的字符序列，二者提供相关功能的方法也比较类似。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilder</span> <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2021/01/01/java-string/image-20210313133051803.png" alt="image-20210313133051803" style="zoom:67%;">
</li>
<li><p>StringBuffer 类和 StringBuilder 类不同于 String，其对象必须使用构造器生成。常用以下三个构造器：</p>
<ul>
<li><p><code>StringBuffer()</code>/<code>StringBuilder()</code>：初始容量为 16 的字符串缓冲区。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string buffer with no characters in it and an</span></span><br><span class="line"><span class="comment"> * initial capacity of 16 characters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string builder with no characters in it and an</span></span><br><span class="line"><span class="comment"> * initial capacity of 16 characters.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>StringBuffer(int capacity)</code>/<code>StringBuilder(int capacity)</code>：构造指定容量的字符串缓冲区。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string buffer with no characters in it and</span></span><br><span class="line"><span class="comment"> * the specified initial capacity.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>      capacity  the initial capacity.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@exception</span>  NegativeArraySizeException  if the &#123;<span class="doctag">@code</span> capacity&#125;</span></span><br><span class="line"><span class="comment"> *               argument is less than &#123;<span class="doctag">@code</span> 0&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(capacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string builder with no characters in it and an</span></span><br><span class="line"><span class="comment"> * initial capacity specified by the &#123;<span class="doctag">@code</span> capacity&#125; argument.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>      capacity  the initial capacity.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span>     NegativeArraySizeException  if the &#123;<span class="doctag">@code</span> capacity&#125;</span></span><br><span class="line"><span class="comment"> *               argument is less than &#123;<span class="doctag">@code</span> 0&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(capacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>StringBuffer(String str)</code>/<code>StringBuilder(String str)</code>：将内容初始化为指定字符串内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string buffer initialized to the contents of the</span></span><br><span class="line"><span class="comment"> * specified string. The initial capacity of the string buffer is</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> 16&#125; plus the length of the string argument.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   str   the initial contents of the buffer.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(str.length() + <span class="number">16</span>);</span><br><span class="line">    append(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a string builder initialized to the contents of the</span></span><br><span class="line"><span class="comment"> * specified string. The initial capacity of the string builder is</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> 16&#125; plus the length of the string argument.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>   str   the initial contents of the buffer.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(str.length() + <span class="number">16</span>);</span><br><span class="line">    append(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>StringBuffer 类的常用方法，很多方法与 String 相同，StringBuilder 类的常用方法参考 StringBuffer。</p>
<ul>
<li><p>StringBuffer 类和 StringBuilder 类的方法的主要区别，举例如下：</p>
<ul>
<li><p><strong>StringBuffer 类 — 同步方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> StringBuffer <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    toStringCache = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>StringBuilder 类 — 非同步方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.append(str);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>StringBuffer append(xxx)</code>：提供了参数可为多种类型的 <code>append()</code> 方法，用于进行字符串拼接。</p>
<p><img src="/2021/01/01/java-string/image-20210313150854764.png" alt="image-20210313150854764"></p>
<p>面试题，输出结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="keyword">null</span>;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        System.out.println(sb);</span><br><span class="line">        sb.append(str);</span><br><span class="line">        System.out.println(sb.length());</span><br><span class="line">        System.out.println(sb);</span><br><span class="line">        StringBuilder sb1 = <span class="keyword">new</span> StringBuilder(str);</span><br><span class="line">        System.out.println(sb1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line"></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="keyword">null</span></span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.NullPointerException</span><br><span class="line">	at java.lang.StringBuilder.&lt;init&gt;(StringBuilder.java:<span class="number">112</span>)</span><br><span class="line">	at cn.xisun.java.base.ExceptionTest.main(ExceptionTest.java:<span class="number">17</span>)</span><br></pre></td></tr></table></figure>

<p>原因：</p>
<p><strong>① java 里面，null 不占字节。如果一个引用指向 null，该应用就不再指向堆内存中的任何对象。并且，这个对象引用的大小是 4 个字节。</strong></p>
<p>② <code>append()</code> 方法如果传入 null 参数，最终执行以下方法，因此上面第 7 行和第 8 行输出结果为 4 和 null (字符串 null)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> AbstractStringBuilder <span class="title">appendNull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = count;</span><br><span class="line">    ensureCapacityInternal(c + <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</span><br><span class="line">    value[c++] = <span class="string">&#x27;n&#x27;</span>;</span><br><span class="line">    value[c++] = <span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">    value[c++] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">    value[c++] = <span class="string">&#x27;l&#x27;</span>;</span><br><span class="line">    count = c;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>③ <code>new StringBuilder(str)</code> 的代码中：<code>super(str.length() + 16);</code>，调用 null 的 <code>length()</code> 方法，会发生空指针异常。</p>
</li>
<li><p><code>StringBuffer delete(int start,int end)</code>：删除指定位置的内容。</p>
</li>
<li><p><code>StringBuffer replace(int start, int end, String str)</code>：把 [start,end) 位置替换为 str。</p>
</li>
<li><p><code>StringBuffer insert(int offset, xxx)</code>：在指定位置插入多种类型的参数。</p>
<p><img src="/2021/01/01/java-string/image-20210313151452492.png" alt="image-20210313151452492"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line">        sb.insert(<span class="number">3</span>, <span class="string">&quot;ABC&quot;</span>);</span><br><span class="line">        System.out.println(sb);<span class="comment">// abcABC123</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>StringBuffer reverse()</code>：把当前字符序列逆转。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;abc123&quot;</span>);</span><br><span class="line">        sb.reverse();</span><br><span class="line">        System.out.println(sb);<span class="comment">// 321cba</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int indexOf(String str)</code>：返回指定子字符串在此字符串中第一次出现处的索引，未找到返回 -1。</p>
</li>
<li><p><code>String substring(int start)</code>：返回一个新的字符串，截取当前字符串从 start 开始到最后的一个子字符串。</p>
</li>
<li><p><code>String substring(int start,int end)</code>：返回一个新字符串，截取当前字符串从 start 开始到 end (不包含) 结束的一个子字符串 — 左闭右开，<code>[start, end)</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;abc123abc&quot;</span>);</span><br><span class="line">        String sb2 = sb.substring(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        System.out.println(sb2);<span class="comment">// bc12</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>int length()</code>：返回字符串的长度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>char charAt(int n )</code>：返回某索引处的字符。</p>
</li>
<li><p><code>void setCharAt(int n ,char ch)</code>：在指定索引处插入字符。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;abc123abc&quot;</span>);</span><br><span class="line">        sb.setCharAt(<span class="number">1</span>, <span class="string">&#x27;中&#x27;</span>);</span><br><span class="line">        System.out.println(sb);<span class="comment">// a中c123abc</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法总结：</p>
<ul>
<li><p>增：append，删：delete，改：setCharAt/replace，查：charAt，插：insert，长度：length，遍历：for + charAt/toString。</p>
</li>
<li><p>append、delete、replace、insert 和 reverse 这些方法，支持方法链操作，方法链的原理为：</p>
<img src="/2021/01/01/java-string/1615717860(1).png" alt="1615717860(1)" style="zoom:80%;">
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>String、StringBuffer 和 StringBuilder 的异同？</strong></p>
<ul>
<li><strong>String：Since jdk 1.0，不可变的字符序列；底层使用 <code>final char[]</code> 存储。</strong></li>
<li><strong>StringBuffer：Since jdk 1.0，可变的字符序列；线程安全的，效率低；底层使用 <code>char[]</code> 存储。</strong></li>
<li><strong>StringBuilder：Since jdk 1.5，可变的字符序列；线程不安全的，效率高；底层使用 <code>char[]</code> 存储。</strong></li>
</ul>
</li>
<li><p><strong>StringBuffer 和 StringBuilder 的扩容问题：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="keyword">new</span> String();<span class="comment">// final char[] value = new char[0];</span></span><br><span class="line"></span><br><span class="line">        String str1 = <span class="keyword">new</span> String(<span class="string">&quot;abc&quot;</span>);<span class="comment">// final char[] value = new char[]&#123;&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;&#125;;</span></span><br><span class="line"></span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();<span class="comment">// char[] value = new char[16]; 底层创建了一个长度是16的char数组</span></span><br><span class="line">        System.out.println(sb.length());<span class="comment">// 0</span></span><br><span class="line">        sb.append(<span class="string">&#x27;a&#x27;</span>);<span class="comment">// value[0] = &#x27;a&#x27;;</span></span><br><span class="line">        sb.append(<span class="string">&#x27;b&#x27;</span>);<span class="comment">// value[1] = &#x27;b&#x27;;</span></span><br><span class="line">        sb.append(<span class="string">&#x27;c&#x27;</span>);<span class="comment">// value[1] = &#x27;c&#x27;;</span></span><br><span class="line">        System.out.println(sb.length());<span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">        StringBuffer sb1 = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;abc&quot;</span>);<span class="comment">// char[] value = new char[&quot;abc&quot;.length() + 16];</span></span><br><span class="line">        System.out.println(sb1.length());<span class="comment">// 3</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扩容问题：如果要添加的数据底层数组盛不下了，那就需要扩容底层的数组。</p>
<p>扩容方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minimumCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minimumCapacity - value.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        value = Arrays.copyOf(value,</span><br><span class="line">                newCapacity(minimumCapacity));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a capacity at least as large as the given minimum capacity.</span></span><br><span class="line"><span class="comment"> * Returns the current capacity increased by the same amount + 2 if</span></span><br><span class="line"><span class="comment"> * that suffices.</span></span><br><span class="line"><span class="comment"> * Will not return a capacity greater than &#123;<span class="doctag">@code</span> MAX_ARRAY_SIZE&#125;</span></span><br><span class="line"><span class="comment"> * unless the given minimum capacity is greater than that.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  minCapacity the desired minimum capacity</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> OutOfMemoryError if minCapacity is less than zero or</span></span><br><span class="line"><span class="comment"> *         greater than Integer.MAX_VALUE</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">newCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = (value.length &lt;&lt; <span class="number">1</span>) + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (newCapacity &lt;= <span class="number">0</span> || MAX_ARRAY_SIZE - newCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        ? hugeCapacity(minCapacity)</span><br><span class="line">        : newCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>默认情况下，扩容为原来容量的 2 倍 + 2，同时将原来数组中的元素复制到新的数组中。</strong></p>
<p><strong>指导意义：开发中，如果知道创建的字符串的长度，建议使用 <code>StringBuffer(int capacity)</code> 或 <code>StringBuilder(int capacity)</code>，即可能得避免扩容的发生，这样可以提高效率。</strong></p>
</li>
<li><p>String、StringBuffer 和 StringBuilder 三者的效率测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始设置</span></span><br><span class="line">        String text = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        StringBuffer buffer = <span class="keyword">new</span> StringBuffer(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> startTime = <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">long</span> endTime = <span class="number">0L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始对比</span></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20000</span>; i++) &#123;</span><br><span class="line">            text = text + i;</span><br><span class="line">        &#125;</span><br><span class="line">        endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;String的执行时间：&quot;</span> + (endTime - startTime));</span><br><span class="line"></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20000</span>; i++) &#123;</span><br><span class="line">            buffer.append(String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">        endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;StringBuffer的执行时间：&quot;</span> + (endTime - startTime));</span><br><span class="line"></span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20000</span>; i++) &#123;</span><br><span class="line">            builder.append(String.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">        endTime = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;StringBuilder的执行时间：&quot;</span> + (endTime - startTime));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">StringBuffer的执行时间：<span class="number">6</span></span><br><span class="line">StringBuilder的执行时间：<span class="number">3</span></span><br><span class="line">String的执行时间：<span class="number">1713</span></span><br></pre></td></tr></table></figure>

<p><strong>效率从高到低排列：StringBuilder &gt; StringBuffer &gt; String。</strong></p>
</li>
</ul>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://www.gulixueyuan.com/goods/show/203?targetId=309&amp;preview=0">https://www.gulixueyuan.com/goods/show/203?targetId=309&amp;preview=0</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/31/redis-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/31/redis-command/" class="post-title-link" itemprop="url">redis 命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-31 17:10:36" itemprop="dateCreated datePublished" datetime="2020-12-31T17:10:36+08:00">2020-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-07 14:58:42" itemprop="dateModified" datetime="2021-07-07T14:58:42+08:00">2021-07-07</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>182</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="查询当前库-key-的个数"><a href="#查询当前库-key-的个数" class="headerlink" title="查询当前库 key 的个数"></a>查询当前库 key 的个数</h2><p>info可以看到所有库的key数量</p>
<p>dbsize则是当前库key的数量</p>
<p>keys *这种数据量小还可以，大的时候可以直接搞死生产环境。</p>
<p>dbsize和keys *统计的key数可能是不一样的，如果没记错的话，keys *统计的是当前db有效的key，而dbsize统计的是所有未被销毁的key（有效和未被销毁是不一样的，具体可以了解redis的过期策略）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/30/kafka-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/30/kafka-command/" class="post-title-link" itemprop="url">Kafka 命令行工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-30 10:19:35" itemprop="dateCreated datePublished" datetime="2020-12-30T10:19:35+08:00">2020-12-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-02-26 10:17:31" itemprop="dateModified" datetime="2021-02-26T10:17:31+08:00">2021-02-26</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>查看 Kafka topic 列表命令，返回 topic 名字列表</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-topics.sh --zookeeper hadoopdatanode1:2181 --list</span><br></pre></td></tr></table></figure>

<ul>
<li>创建 Kafka topic 命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-topics.sh --zookeeper hadoopdatanode1:2181,hadoopdatanode2:2181,hadoopdatanode3:2181 --create --partitions 6 --replication-factor 2 --topic patent-grant</span><br></pre></td></tr></table></figure>

<ul>
<li> 查看 Kafka 指定 topic 的详情命令，返回该 topic 的 parition 数量、replica 因子以及每个 partition 的 leader、replica 信息</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-topics.sh --zookeeper hadoopdatanode1:2181 --describe --topic patent-grant</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 Kafka 指定 topic 各 partition 的 offset 信息命令，–time 参数为 -1 时，表示各分区最大的 offset，为 -2 时，表示各分区最小的 offset</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list hadoopdatanode1:9092 --time -1 --topic patent-grant</span><br></pre></td></tr></table></figure>

<ul>
<li>删除 Kafka topic 命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-topics.sh --zookeeper hadoopdatanode1:2181 --delete -topic patent-grant</span><br></pre></td></tr></table></figure>

<blockquote>
<p>只有 topic 不再被使用时，才能被删除。</p>
</blockquote>
<ul>
<li>修改 kafka topic 的数据保存时间：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-configs.sh --bootstrap-server hadoopdatanode1:9092 --alter --entity-type topics --entity-name extractor-patent --add-config retention.ms=2592000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>kafka 中默认消息的保留时间是 7 天，若想更改，需在配置文件 server.properties 里更改选项：log.retention.hours=168。</p>
<p>如果需要对某一个主题的消息存留的时间进行变更，但不影响其他主题，并且 kafka 集群不用重启，则使用上面的命令修改，该命令设置的是 30 天。</p>
</blockquote>
<ul>
<li>查看 kafka topic 配置信息：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-configs.sh --bootstrap-server hadoopdatanode1:9092 --describe --entity-type topics --entity-name extractor-patent</span><br></pre></td></tr></table></figure>

<p>如果使用的是默认配置，显示：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dynamic configs <span class="keyword">for</span> topic extractor-patent are:</span><br></pre></td></tr></table></figure>

<p>如果更改了配置，显示：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Dynamic configs <span class="keyword">for</span> topic extractor-patent are:</span><br><span class="line">  retention.ms=2592000000 sensitive=<span class="literal">false</span> synonyms=&#123;DYNAMIC_TOPIC_CONFIG:retention.ms=2592000000&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 kafka consumer group 命令，返回 consumer group 名字列表 (新版信息保存在 broker 中，老版信息保存在 zookeeper 中，二者命令不同)</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-consumer-groups.sh --bootstrap-server hadoopdatanode1:9092 --list</span><br></pre></td></tr></table></figure>

<blockquote>
<p>老版命令：<code>~/kafka_2.12-2.6.0/bin/kafka-consumer-groups.sh --zookeeper hadoopdatanode1:2181 --list</code></p>
</blockquote>
<ul>
<li>查看 Kafka 指定 consumer group 的详情命令，返回 consumer group 对应的 topic 信息、当前消费的 offset、总 offset、剩余待消费 offset 等信息</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-consumer-groups.sh --bootstrap-server hadoopdatanode1:9092 --describe --group log-consumer</span><br></pre></td></tr></table></figure>

<ul>
<li>重置 Kafka 指定 consumer group 消费的 topic 的 offset 命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-consumer-groups.sh --bootstrap-server hadoopdatanode1:9092 --reset-offsets -to-offset 0 --execute --topic patent-app --group log-consumer</span><br></pre></td></tr></table></figure>

<ul>
<li>删除 Kafka 指定 consumer group 命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-consumer-groups.sh --bootstrap-server hadoopdatanode1:9092 --delete --group log-consumer</span><br></pre></td></tr></table></figure>

<ul>
<li>消费 Kafka 指定 topic 的内容命令</li>
</ul>
<p>kafka-console-consumer.sh 脚本是一个简易的消费者控制台。该 shell 脚本的功能通过调用 kafka.tools 包下的 ConsoleConsumer 类，并将提供的命令行参数全部传给该类实现。</p>
<p>参数说明：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-console-consumer.sh</span><br><span class="line">This tool helps to <span class="built_in">read</span> data from Kafka topics and outputs it to standard output.</span><br><span class="line">Option                                   Description                            </span><br><span class="line">------                                   -----------                            </span><br><span class="line">--bootstrap-server &lt;String: server to    REQUIRED: The server(s) to connect to. </span><br><span class="line">  connect to&gt;                                                                   </span><br><span class="line">--consumer-property &lt;String:             A mechanism to pass user-defined       </span><br><span class="line">  consumer_prop&gt;                           properties <span class="keyword">in</span> the form key=value to  </span><br><span class="line">                                           the consumer.                        </span><br><span class="line">--consumer.config &lt;String: config file&gt;  Consumer config properties file. Note  </span><br><span class="line">                                           that [consumer-property] takes       </span><br><span class="line">                                           precedence over this config.         </span><br><span class="line">--enable-systest-events                  Log lifecycle events of the consumer   </span><br><span class="line">                                           <span class="keyword">in</span> addition to logging consumed      </span><br><span class="line">                                           messages. (This is specific <span class="keyword">for</span>      </span><br><span class="line">                                           system tests.)                       </span><br><span class="line">--formatter &lt;String: class&gt;              The name of a class to use <span class="keyword">for</span>         </span><br><span class="line">                                           formatting kafka messages <span class="keyword">for</span>        </span><br><span class="line">                                           display. (default: kafka.tools.      </span><br><span class="line">                                           DefaultMessageFormatter)             </span><br><span class="line">--from-beginning                         If the consumer does not already have  </span><br><span class="line">                                           an established offset to consume     </span><br><span class="line">                                           from, start with the earliest        </span><br><span class="line">                                           message present <span class="keyword">in</span> the <span class="built_in">log</span> rather    </span><br><span class="line">                                           than the latest message.             </span><br><span class="line">--group &lt;String: consumer group id&gt;      The consumer group id of the consumer. </span><br><span class="line">--<span class="built_in">help</span>                                   Print usage information.               </span><br><span class="line">--isolation-level &lt;String&gt;               Set to read_committed <span class="keyword">in</span> order to      </span><br><span class="line">                                           filter out transactional messages    </span><br><span class="line">                                           <span class="built_in">which</span> are not committed. Set to      </span><br><span class="line">                                           read_uncommitted to <span class="built_in">read</span> all         </span><br><span class="line">                                           messages. (default: read_uncommitted)</span><br><span class="line">--key-deserializer &lt;String:                                                     </span><br><span class="line">  deserializer <span class="keyword">for</span> key&gt;                                                         </span><br><span class="line">--max-messages &lt;Integer: num_messages&gt;   The maximum number of messages to      </span><br><span class="line">                                           consume before exiting. If not <span class="built_in">set</span>,  </span><br><span class="line">                                           consumption is continual.            </span><br><span class="line">--offset &lt;String: consume offset&gt;        The offset id to consume from (a non-  </span><br><span class="line">                                           negative number), or <span class="string">&#x27;earliest&#x27;</span>      </span><br><span class="line">                                           <span class="built_in">which</span> means from beginning, or       </span><br><span class="line">                                           <span class="string">&#x27;latest&#x27;</span> <span class="built_in">which</span> means from end        </span><br><span class="line">                                           (default: latest)                    </span><br><span class="line">--partition &lt;Integer: partition&gt;         The partition to consume from.         </span><br><span class="line">                                           Consumption starts from the end of   </span><br><span class="line">                                           the partition unless <span class="string">&#x27;--offset&#x27;</span> is   </span><br><span class="line">                                           specified.                           </span><br><span class="line">--property &lt;String: prop&gt;                The properties to initialize the       </span><br><span class="line">                                           message formatter. Default           </span><br><span class="line">                                           properties include:                  </span><br><span class="line">                                         	print.timestamp=<span class="literal">true</span>|<span class="literal">false</span>            </span><br><span class="line">                                         	print.key=<span class="literal">true</span>|<span class="literal">false</span>                  </span><br><span class="line">                                         	print.value=<span class="literal">true</span>|<span class="literal">false</span>                </span><br><span class="line">                                         	key.separator=&lt;key.separator&gt;         </span><br><span class="line">                                         	line.separator=&lt;line.separator&gt;       </span><br><span class="line">                                         	key.deserializer=&lt;key.deserializer&gt;   </span><br><span class="line">                                         	value.deserializer=&lt;value.            </span><br><span class="line">                                           deserializer&gt;                        </span><br><span class="line">                                         Users can also pass <span class="keyword">in</span> customized      </span><br><span class="line">                                           properties <span class="keyword">for</span> their formatter; more </span><br><span class="line">                                           specifically, users can pass <span class="keyword">in</span>      </span><br><span class="line">                                           properties keyed with <span class="string">&#x27;key.          </span></span><br><span class="line"><span class="string">                                           deserializer.&#x27;</span> and <span class="string">&#x27;value.           </span></span><br><span class="line"><span class="string">                                           deserializer.&#x27;</span> prefixes to configure </span><br><span class="line">                                           their deserializers.                 </span><br><span class="line">--skip-message-on-error                  If there is an error when processing a </span><br><span class="line">                                           message, skip it instead of halt.    </span><br><span class="line">--timeout-ms &lt;Integer: timeout_ms&gt;       If specified, <span class="built_in">exit</span> <span class="keyword">if</span> no message is    </span><br><span class="line">                                           available <span class="keyword">for</span> consumption <span class="keyword">for</span> the    </span><br><span class="line">                                           specified interval.                  </span><br><span class="line">--topic &lt;String: topic&gt;                  The topic id to consume on.            </span><br><span class="line">--value-deserializer &lt;String:                                                   </span><br><span class="line">  deserializer <span class="keyword">for</span> values&gt;                                                      </span><br><span class="line">--version                                Display Kafka version.                 </span><br><span class="line">--whitelist &lt;String: whitelist&gt;          Regular expression specifying          </span><br><span class="line">                                           whitelist of topics to include <span class="keyword">for</span>   </span><br><span class="line">                                           consumption.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参数说明参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29116427/article/details/80206125">https://blog.csdn.net/qq_29116427/article/details/80206125</a></p>
</blockquote>
<p>从头开始消费：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-console-consumer.sh --bootstrap-server hadoopdatanode1:9092 --from-beginning --topic log-collect</span><br></pre></td></tr></table></figure>

<p>从头开始消费前 10 条消息，并显示 key：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-console-consumer.sh --bootstrap-server hadoopdatanode1:9092 --from-beginning --max-messages 10 --property print.key=<span class="literal">true</span> --topic log-collect</span><br></pre></td></tr></table></figure>

<p>从指定分区、指定 offset 开始消费：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-console-consumer.sh --bootstrap-server hadoopdatanode1:9092 --partition 0 --offset 219000 --topic log-collect</span><br></pre></td></tr></table></figure>

<p>从尾开始消费，必须指定分区：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ~/kafka_2.12-2.6.0/bin/kafka-console-consumer.sh --bootstrap-server hadoopdatanode1:9092 --partition 0 --offset latest --topic log-collect</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/22/shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/22/shell/" class="post-title-link" itemprop="url">shell 脚本中的一些方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-22 17:16:35" itemprop="dateCreated datePublished" datetime="2020-12-22T17:16:35+08:00">2020-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-01 16:13:35" itemprop="dateModified" datetime="2021-01-01T16:13:35+08:00">2021-01-01</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="字符串截取"><a href="#字符串截取" class="headerlink" title="字符串截取"></a>字符串截取</h2><p>shell 截取字符串通常有两种方式：从指定位置开始截取和从指定字符 (子字符串) 开始截取。</p>
<h3 id="从指定位置开始截取"><a href="#从指定位置开始截取" class="headerlink" title="从指定位置开始截取"></a>从指定位置开始截取</h3><p>两个参数：起始位置，截取长度。</p>
<h4 id="从字符串左边开始计数"><a href="#从字符串左边开始计数" class="headerlink" title="从字符串左边开始计数"></a>从字符串左边开始计数</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;string: start :length&#125;</span></span><br></pre></td></tr></table></figure>

<p>其中，string 是要截取的字符串，start 是起始位置 (从左边开始，从 0 开始计数)，length 是要截取的长度 (如果省略表示直到字符串的末尾)。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;c.biancheng.net&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url: 2: 9&#125;</span></span><br><span class="line"></span><br><span class="line">biancheng</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;c.biancheng.net&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url: 2&#125;</span></span><br><span class="line"></span><br><span class="line">biancheng.net</span><br></pre></td></tr></table></figure>

<h4 id="从字符串右边开始计数"><a href="#从字符串右边开始计数" class="headerlink" title="从字符串右边开始计数"></a>从字符串右边开始计数</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;string: 0-start :length&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>0-</code> 是固定的写法，专门用来表示从字符串右边开始计数。</p>
<blockquote>
<p>从左边开始计数时，起始数字是 0；从右边开始计数时，起始数字是 1。计数方向不同，起始数字也不同。</p>
<p>不管从哪边开始计数，截取方向都是从左到右。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;c.biancheng.net&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url: 0-13: 9&#125;</span></span><br><span class="line"></span><br><span class="line">biancheng</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;c.biancheng.net&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url: 0-13&#125;</span></span><br><span class="line"></span><br><span class="line">biancheng.net</span><br></pre></td></tr></table></figure>

<blockquote>
<p>从右边数，b 是第 13 个字符。</p>
</blockquote>
<h3 id="从指定字符-子字符串-开始截取"><a href="#从指定字符-子字符串-开始截取" class="headerlink" title="从指定字符 (子字符串) 开始截取"></a>从指定字符 (子字符串) 开始截取</h3><p>这种截取方式无法指定字符串长度，只能从指定字符 (子字符串) 截取到字符串末尾。shell 可以截取指定字符 (子字符串) 右边的所有字符，也可以截取左边的所有字符。</p>
<h4 id="使用-截取指定字符-子字符串-右边字符"><a href="#使用-截取指定字符-子字符串-右边字符" class="headerlink" title="使用 # 截取指定字符 (子字符串)右边字符"></a>使用 # 截取指定字符 (子字符串)右边字符</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;string#*chars&#125;</span></span><br></pre></td></tr></table></figure>

<p>其中，string 表示要截取的字符，chars 是指定的字符 (子字符串)，<code>*</code> 是通配符的一种，表示任意长度的字符串。<code>*chars</code> 连起来使用的意思是：忽略左边的所有字符，直到遇见 chars (chars 不会被截取)。</p>
<blockquote>
<p>从左往右看。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;http://c.biancheng.net/index.html&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*:&#125;</span></span><br><span class="line"></span><br><span class="line">//c.biancheng.net/index.html</span><br></pre></td></tr></table></figure>

<p>以下写法也可以得到同样的结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*p:&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*ttp:&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果不需要忽略 chars 左边的字符，那么也可以不写 <code>*</code>，例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;http://c.biancheng.net/index.html&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#http://&#125;</span></span><br><span class="line"></span><br><span class="line">c.biancheng.net/index.html</span><br></pre></td></tr></table></figure>

<p>注意，以上写法遇到第一个匹配的字符 (子字符串) 就结束了。例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&quot;http://c.biancheng.net/index.html&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*/&#125;</span></span><br><span class="line"></span><br><span class="line">/c.biancheng.net/index.html</span><br></pre></td></tr></table></figure>

<blockquote>
<p>url 字符串中有三个 <code>/</code>，输出结果表明，shell 遇到第一个 <code>/</code> 就匹配结束了。</p>
</blockquote>
<p>如果希望直到最后一个指定字符 (子字符串) 再匹配结束，那么可以使用 <code>##</code>，具体格式为：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;string##*chars&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://c.biancheng.net/index.html&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url#*/&#125;</span>    <span class="comment"># 结果为 /c.biancheng.net/index.html</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url##*/&#125;</span>   <span class="comment"># 结果为 index.html</span></span><br><span class="line"></span><br><span class="line">str=<span class="string">&quot;---aa+++aa@@@&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str#*aa&#125;</span>   <span class="comment"># 结果为 +++aa@@@</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str##*aa&#125;</span>  <span class="comment"># 结果为 @@@</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-截取指定字符-子字符串-左边字符"><a href="#使用-截取指定字符-子字符串-左边字符" class="headerlink" title="使用 % 截取指定字符 (子字符串)左边字符"></a>使用 % 截取指定字符 (子字符串)左边字符</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;string%chars*&#125;</span></span><br></pre></td></tr></table></figure>

<p>注意 <code>*</code> 的位置，因为要截取 chars 左边的字符，而忽略 chars 右边的字符，所以 <code>*</code> 应该位于 chars 的右侧。其他方面 <code>%</code> 和 <code>#</code> 的用法相同。</p>
<blockquote>
<p>从右往左看。</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://c.biancheng.net/index.html&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%/*&#125;</span>  <span class="comment"># 结果为 http://c.biancheng.net</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;url%%/*&#125;</span>  <span class="comment"># 结果为 http:</span></span><br><span class="line"></span><br><span class="line">str=<span class="string">&quot;---aa+++aa@@@&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str%aa*&#125;</span>  <span class="comment"># 结果为 ---aa+++</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;str%%aa*&#125;</span>  <span class="comment"># 结果为 ---</span></span><br></pre></td></tr></table></figure>

<h3 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h3><table>
<thead>
<tr>
<th>格式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>${string: start :length}</td>
<td>从 string 字符串的左边第 start 个字符开始，向右截取 length 个字符。</td>
</tr>
<tr>
<td>${string: start}</td>
<td>从 string 字符串的左边第 start 个字符开始截取，直到最后。</td>
</tr>
<tr>
<td>${string: 0-start :length}</td>
<td>从 string 字符串的右边第 start 个字符开始，向右截取 length 个字符。</td>
</tr>
<tr>
<td>${string: 0-start}</td>
<td>从 string 字符串的右边第 start 个字符开始截取，直到最后。</td>
</tr>
<tr>
<td>${string#*chars}</td>
<td>从 string 字符串第一次出现 *chars 的位置开始，截取 *chars 右边的所有字符。</td>
</tr>
<tr>
<td>${string##*chars}</td>
<td>从 string 字符串最后一次出现 *chars 的位置开始，截取 *chars 右边的所有字符。</td>
</tr>
<tr>
<td>${string%*chars}</td>
<td>从 string 字符串第一次出现 *chars 的位置开始，截取 *chars 左边的所有字符。</td>
</tr>
<tr>
<td>${string%%*chars}</td>
<td>从 string 字符串最后一次出现 *chars 的位置开始，截取 *chars 左边的所有字符。</td>
</tr>
</tbody></table>
<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/1120.html">http://c.biancheng.net/view/1120.html</a></p>
<h2 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">name=<span class="string">&quot;Shell&quot;</span></span><br><span class="line">url=<span class="string">&quot;http://c.biancheng.net/shell/&quot;</span></span><br><span class="line"></span><br><span class="line">str1=<span class="variable">$name</span><span class="variable">$url</span>  <span class="comment"># 中间不能有空格</span></span><br><span class="line">str2=<span class="string">&quot;<span class="variable">$name</span> <span class="variable">$url</span>&quot;</span>  <span class="comment"># 如果被双引号包围，那么中间可以有空格</span></span><br><span class="line">str3=<span class="variable">$name</span><span class="string">&quot;: &quot;</span><span class="variable">$url</span>  <span class="comment"># 中间可以出现别的字符串</span></span><br><span class="line">str4=<span class="string">&quot;<span class="variable">$name</span>: <span class="variable">$url</span>&quot;</span>  <span class="comment"># 这样写也可以</span></span><br><span class="line">str5=<span class="string">&quot;<span class="variable">$&#123;name&#125;</span>Script: <span class="variable">$&#123;url&#125;</span>index.html&quot;</span>  <span class="comment"># 这个时候需要给变量名加上大括号</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str2</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str3</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str4</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$str5</span></span><br><span class="line"></span><br><span class="line">Shellhttp://c.biancheng.net/shell/</span><br><span class="line">Shell http://c.biancheng.net/shell/</span><br><span class="line">Shell: http://c.biancheng.net/shell/</span><br><span class="line">Shell: http://c.biancheng.net/shell/</span><br><span class="line">ShellScript: http://c.biancheng.net/shell/index.html</span><br></pre></td></tr></table></figure>

<p>对于第 7 行代码，$name 和 $url 之间之所以不能出现空格，是因为当字符串不被任何一种引号包围时，遇到空格就认为字符串结束了，空格后边的内容会作为其他变量或者命令解析。</p>
<p>对于第 10 行代码，加 { } 是为了帮助解释器识别变量的边界。</p>
<h2 id="字符串分割"><a href="#字符串分割" class="headerlink" title="字符串分割"></a>字符串分割</h2><h3 id="以空格为分隔符"><a href="#以空格为分隔符" class="headerlink" title="以空格为分隔符"></a>以空格为分隔符</h3><p>比如有一个变量 “123 456 789”，要求以空格为分隔符把这个变量分隔，并把分隔后的字段分别赋值给变量，即 a=123；b=456；c=789。<br>共有3中方法：<br>方法一：先定义一个数组，然后把分隔出来的字段赋值给数组中的每一个元素<br>方法二：通过 eval+ 赋值的方式<br>方法三：通过多次 awk 把每个字段赋值</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=<span class="string">&quot;123 456 789&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一：通过数组的方式</span></span><br><span class="line"><span class="built_in">declare</span> -a arr</span><br><span class="line">index=0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(<span class="built_in">echo</span> <span class="variable">$a</span> | awk <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    arr[<span class="variable">$index</span>]=<span class="variable">$i</span></span><br><span class="line">    <span class="built_in">let</span> <span class="string">&quot;index+=1&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[0]&#125;</span> <span class="comment"># 结果为 123</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[1]&#125;</span> <span class="comment"># 结果为 789</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二：通过eval+赋值的方式</span></span><br><span class="line">b=<span class="string">&quot;&quot;</span></span><br><span class="line">c=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">eval</span> $(<span class="built_in">echo</span> <span class="variable">$a</span> | awk <span class="string">&#x27;&#123; printf(&quot;b=%s;c=%s&quot;,$2,$1)&#125;&#x27;</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$b</span> <span class="comment"># 结果为 456</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$c</span> <span class="comment"># 结果为 123</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法三：通过多次awk赋值的方式</span></span><br><span class="line">m=<span class="string">&quot;&quot;</span></span><br><span class="line">n=<span class="string">&quot;&quot;</span></span><br><span class="line">m=`<span class="built_in">echo</span> <span class="variable">$a</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>`</span><br><span class="line">n=`<span class="built_in">echo</span> <span class="variable">$a</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$m</span> <span class="comment"># 结果为 123</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$n</span> <span class="comment"># 结果为 456</span></span><br></pre></td></tr></table></figure>

<h3 id="指定分隔符"><a href="#指定分隔符" class="headerlink" title="指定分隔符"></a>指定分隔符</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">string=<span class="string">&quot;hello,shell,haha&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法一  </span></span><br><span class="line">array=(<span class="variable">$&#123;string//,/ &#125;</span>)  </span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="variable">$&#123;array[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">IFS=<span class="string">&quot;,&quot;</span></span><br><span class="line">OLD_IFS=<span class="string">&quot;<span class="variable">$IFS</span>&quot;</span></span><br><span class="line">IFS=<span class="string">&quot;<span class="variable">$OLD_IFS</span>&quot;</span></span><br><span class="line">array2=(<span class="variable">$string</span>)</span><br><span class="line"><span class="keyword">for</span> var2 <span class="keyword">in</span> <span class="variable">$&#123;array2[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="variable">$var2</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">hello</span><br><span class="line">shell</span><br><span class="line">haha</span><br><span class="line">hello</span><br><span class="line">shell</span><br><span class="line">haha</span><br></pre></td></tr></table></figure>

<h2 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h2><p>反引号：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var=`<span class="built_in">command</span>`</span><br></pre></td></tr></table></figure>

<p><code>$()</code>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var=$(<span class="built_in">command</span>)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ A=`date`</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$A</span></span><br><span class="line">Fri Dec 25 20:02:30 CST 2020 <span class="comment"># 变量A存放了date命令的执行结果</span></span><br><span class="line"></span><br><span class="line">$ B=$(date)</span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$B</span></span><br><span class="line">Fri Dec 25 20:03:12 CST 2020 <span class="comment"># 变量B存放了date命令的执行结果</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：= 号前后不要有空格。</p>
</blockquote>
<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="https://book.51cto.com/art/201411/457601.htm">https://book.51cto.com/art/201411/457601.htm</a></p>
<h2 id="判断文件夹是否存在"><a href="#判断文件夹是否存在" class="headerlink" title="判断文件夹是否存在"></a>判断文件夹是否存在</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d testgrid  ];<span class="keyword">then</span></span><br><span class="line">  mkdir testgrid</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> dir exist</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>外部传参：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断传入的参数的个数是不是一个</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="variable">$#</span> -eq 1  ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> param error!</span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断目录是不是已经存在，如果不存在则创建，存在则输出&quot;dir exist&quot; </span></span><br><span class="line">dirname=<span class="variable">$1</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;the dir name is <span class="variable">$dirname</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$dirname</span>  ];<span class="keyword">then</span></span><br><span class="line">  mkdir <span class="variable">$dirname</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> dir exist</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><p>类 C 语言：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=1; i&lt;=100; i ++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>in 使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>seq 使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 1 100`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="发送微信消息"><a href="#发送微信消息" class="headerlink" title="发送微信消息"></a>发送微信消息</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/105781861">https://blog.csdn.net/whatday/article/details/105781861</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/15/linux-command/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/15/linux-command/" class="post-title-link" itemprop="url">linux 命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-15 17:31:47" itemprop="dateCreated datePublished" datetime="2020-12-15T17:31:47+08:00">2020-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-13 14:53:34" itemprop="dateModified" datetime="2021-08-13T14:53:34+08:00">2021-08-13</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>用于在指定目录下查找文件。默认列出当前目录及子目录下所有的文件和文件夹。</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find   path   -option   [   -<span class="built_in">print</span> ]   [ -<span class="built_in">exec</span>   -ok   <span class="built_in">command</span> ]   &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p><strong>-print</strong>： find 命令将匹配到的文件输出到标准输出。</p>
<p><strong>-exec</strong>： find 命令对匹配的文件执行该参数所给出的 Shell 命令。</p>
<p><strong>-ok</strong>： 和 -exec 的作用相同，只是更安全，在执行每个命令之前，都会给出提示，让用户来确定是否执行。</p>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">-mount, -xdev</span><br><span class="line">		只检查和指定目录在同一个文件系统下的文件，避免列出其它文件系统中的文件。</span><br><span class="line"></span><br><span class="line">-amin n</span><br><span class="line">		在过去n分钟内被读取过。</span><br><span class="line"></span><br><span class="line">-anewer file</span><br><span class="line">		比文件file更晚被读取过的文件。</span><br><span class="line"></span><br><span class="line">-atime n</span><br><span class="line">		在过去n天内被读取过的文件。</span><br><span class="line">		</span><br><span class="line">-cmin n</span><br><span class="line">		在过去n分钟内被修改过。</span><br><span class="line">		</span><br><span class="line">-cnewer file</span><br><span class="line">		比文件file更新的文件。</span><br><span class="line">		</span><br><span class="line">-ctime n</span><br><span class="line">		在过去n天内被修改过的文件。</span><br><span class="line">		</span><br><span class="line">-empty</span><br><span class="line">		空的文件。</span><br><span class="line">		</span><br><span class="line">-gid n</span><br><span class="line">		gid是n。</span><br><span class="line">		</span><br><span class="line">-group name</span><br><span class="line">		group名称是name。</span><br><span class="line">		</span><br><span class="line">-path p | -ipath p</span><br><span class="line">		路径名称符合p的文件。ipath忽略大小写。</span><br><span class="line">		</span><br><span class="line">-name name | -iname name</span><br><span class="line">		文件名称符合name的文件。iname忽略大小写。</span><br><span class="line">		</span><br><span class="line">-size n</span><br><span class="line">		文件大小是n单位，b代表512位元组的区块，c表示字元数，k表示kilo bytes，w是二个位元组。</span><br><span class="line">		</span><br><span class="line">-<span class="built_in">type</span> d|f</span><br><span class="line">		文件类型是d|f的文件。</span><br><span class="line">		</span><br><span class="line">-pid n</span><br><span class="line">		process id是n的文件。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>文件类型：d — 目录，f — 一般文件，c — 字型装置文件，b — 区块装置文件，p — 具名贮列，l — 符号连结，s — socket。</p>
</blockquote>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><ul>
<li>查询当前路径下的所有目录|普通文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -<span class="built_in">type</span> d</span><br><span class="line">$ find ./ -<span class="built_in">type</span> f</span><br></pre></td></tr></table></figure>

<ul>
<li>查询权限为 777 的普通文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -<span class="built_in">type</span> f -perm 777</span><br></pre></td></tr></table></figure>

<ul>
<li>查询 .XML 文件，且权限不为 777</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -<span class="built_in">type</span> f -name <span class="string">&quot;*.XML&quot;</span> ! -perm 777</span><br></pre></td></tr></table></figure>

<ul>
<li>查询 .XML 文件，并统计查询结果的条数</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> | wc -l</span><br></pre></td></tr></table></figure>

<ul>
<li>查询 .XML 文件，并复制查询结果到指定路径</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> | xargs -i cp &#123;&#125; ../111</span><br><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> -<span class="built_in">exec</span> cp &#123;&#125; ../111 \;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此命令不同于 cp，<code>cp *.XML ../111</code> 命令复制的是当前路径下符合条件的所有文件，子路径的不会被复制。</p>
</blockquote>
<ul>
<li>查询 .XML 文件，并删除</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> | xargs -i rm &#123;&#125;</span><br><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此命令不同于 rm，<code>rm *.XML</code> 命令删除的是当前路径下符合条件的所有文件，子路径的不会被删除。</p>
</blockquote>
<ul>
<li>查询 .XML 文件，并将查询结果以 “File: 文件名” 的形式打印出来</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> | xargs -i <span class="built_in">printf</span> <span class="string">&quot;File: %s\n&quot;</span> &#123;&#125;</span><br><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> -<span class="built_in">exec</span> <span class="built_in">printf</span> <span class="string">&quot;File: %s\n&quot;</span> &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<ul>
<li>将当前路径及子路径下所有 3 天前的 .XML 格式的文件复制一份到指定路径</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -name <span class="string">&quot;*.XML&quot;</span> -mtime +3 -<span class="built_in">exec</span> cp &#123;&#125; ../111 \;</span><br></pre></td></tr></table></figure>

<ul>
<li>查询多个文件后缀类型的文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -regextype posix-extended -regex <span class="string">&quot;.*\.(java|xml|XML)&quot;</span>	 <span class="comment"># 查找所有的.java、.xml和.XML文件</span></span><br><span class="line">$ find ./ -name <span class="string">&quot;*.java&quot;</span> -o -name <span class="string">&quot;*.xml&quot;</span> -o -name <span class="string">&quot;*.XML&quot;</span>		 <span class="comment"># -o选项，适用于查询少量文件后缀类型</span></span><br></pre></td></tr></table></figure>

<ul>
<li>组合查询，可以多次拼接查询条件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -name <span class="string">&quot;file1*&quot;</span> -a -name <span class="string">&quot;*.xml&quot;</span>	<span class="comment"># -a：与，查找以file1开头，且以.xml 结尾的文件</span></span><br><span class="line">$ find ./ -name <span class="string">&quot;file1*&quot;</span> -o -name <span class="string">&quot;*.xml&quot;</span>	<span class="comment"># -o：或，查找以file1开头，或以.xml 结尾的文件</span></span><br><span class="line">$ find ./ -name <span class="string">&quot;file1*&quot;</span> -not -name <span class="string">&quot;*.xml&quot;</span>	<span class="comment"># -not：非，查找以file1开头，且不以.xml 结尾的文件</span></span><br><span class="line">$ find ./ -name <span class="string">&quot;file1*&quot;</span> ! -name <span class="string">&quot;file2*&quot;</span>	<span class="comment"># !：同-not</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查询当前目录下文件类型为 d 的文件，不包含子目录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ -maxdepth 1 -<span class="built_in">type</span> d</span><br></pre></td></tr></table></figure>

<ul>
<li>和正则表达式的结合使用</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./ –name <span class="string">&quot;[^abc]*&quot;</span>	<span class="comment"># 在当前路径中搜索不以a、b、c开头的所有文件</span></span><br><span class="line">$ find ./ -name <span class="string">&quot;[A-Z0-9]*&quot;</span>	<span class="comment"># 在当前路径中搜索以大写字母或数字开头的所有文件</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>正则表达式符号含义：</p>
<p>*          代表任意字符 (可以没有字符)</p>
<p>?          代表任意单个字符</p>
<p>[]         代表括号内的任意字符，如 [abc] 可以匹配 a\b\c 某个字符</p>
<p>[a-z]    可以匹配 a-z 的某个字母</p>
<p>[A-Z]    可以匹配 A-Z 的某个字符</p>
<p>[0-9]    可以匹配 0-9 的某个数字</p>
<p>^          用在 [] 内的前缀表示不匹配 [] 中的字符</p>
<p>[^a-z]  表示不匹配a-z的某个字符</p>
</blockquote>
<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b30a8aa4d1f1">https://www.jianshu.com/p/b30a8aa4d1f1</a></p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/cn/technical-resources/articles/linux-calish-find.html">https://www.oracle.com/cn/technical-resources/articles/linux-calish-find.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qmfsun/p/3811142.html">https://www.cnblogs.com/qmfsun/p/3811142.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ay-a/p/8017419.html">https://www.cnblogs.com/ay-a/p/8017419.html</a></p>
<h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><p>用于连接文件或标准输入并打印。这个命令常用来显示文件内容，或者将几个文件连接起来显示，或者从标准输入读取内容并显示，它常与重定向符号配合使用。 </p>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat [-AbeEnstTuv] [--<span class="built_in">help</span>] [--version] fileName</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">-n | --number</span><br><span class="line">		由1开始对所有输出的行数编号。</span><br><span class="line"></span><br><span class="line">-b | --number-nonblank</span><br><span class="line">		和-n相似，只不过对于空白行不编号。</span><br><span class="line"></span><br><span class="line">-s | --squeeze-blank</span><br><span class="line">		当遇到有连续两行以上的空白行，就代换为一行的空白行。</span><br><span class="line"></span><br><span class="line">-v | --show-nonprinting</span><br><span class="line">		使用^和M-符号，除了LFD和TAB之外。</span><br><span class="line"></span><br><span class="line">-E | --show-ends</span><br><span class="line">		在每行结束处显示$。</span><br><span class="line">		</span><br><span class="line">-T | --show-tabs</span><br><span class="line">		将TAB字符显示为^I。</span><br><span class="line">		</span><br><span class="line">-A | --show-all</span><br><span class="line">		等价于<span class="string">&quot;-vET&quot;</span>。</span><br><span class="line">		</span><br><span class="line">-e</span><br><span class="line">		等价于<span class="string">&quot;-vE&quot;</span>。</span><br><span class="line">		</span><br><span class="line">-t</span><br><span class="line">		等价于<span class="string">&quot;-vT&quot;</span>。</span><br></pre></td></tr></table></figure>

<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><ul>
<li>把 textfile1 的文档内容加上行号后输入 textfile2 这个文档里</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat -n textfile1 &gt; textfile2</span><br></pre></td></tr></table></figure>

<ul>
<li>清空 /etc/test.txt 文档内容</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat /dev/null &gt; /etc/test.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>/dev/null</strong>：在类 Unix 系统中，/dev/null 称空设备，是一个特殊的设备文件，它丢弃一切写入其中的数据 (但报告写入操作成功)，读取它则会立即得到一个 EOF。</p>
<p>而使用 <code>cat $filename &gt; /dev/null</code> 则不会得到任何信息，因为我们将本来该通过标准输出显示的文件信息重定向到了 /dev/null 中。</p>
<p>使用 <code>cat $filename 1 &gt; /dev/null</code> 也会得到同样的效果，因为默认重定向的 1 就是标准输出。 如果你对 shell 脚本或者重定向比较熟悉的话，应该会联想到 2 ，也即标准错误输出。</p>
<p>如果我们不想看到错误输出呢？我们可以禁止标准错误 <code>cat $badname 2 &gt; /dev/null</code>。</p>
</blockquote>
<ul>
<li>合并多个文件内容</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat b1.sql b2.sql b3.sql &gt; b_all.sql</span><br><span class="line">$ cat *.sql &gt; merge.sql</span><br></pre></td></tr></table></figure>

<h2 id="head"><a href="#head" class="headerlink" title="head"></a>head</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zmx19951103/article/details/78575265">https://blog.csdn.net/zmx19951103/article/details/78575265</a></p>
<h2 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luo200618/article/details/52510638">https://blog.csdn.net/luo200618/article/details/52510638</a></p>
<h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qmfsun/p/6626361.html">https://www.cnblogs.com/qmfsun/p/6626361.html</a></p>
<h2 id="jq"><a href="#jq" class="headerlink" title="jq"></a>jq</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dde911234761">https://www.jianshu.com/p/dde911234761</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/105781861">https://blog.csdn.net/whatday/article/details/105781861</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_26502245/article/details/100191694">https://blog.csdn.net/qq_26502245/article/details/100191694</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011641885/article/details/45559031">https://blog.csdn.net/u011641885/article/details/45559031</a></p>
<h2 id="basename"><a href="#basename" class="headerlink" title="basename"></a>basename</h2><p>用于去掉文件名的目录和后缀。</p>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	basename NAME [SUFFIX]</span><br><span class="line">or:	basename OPTION... NAME...</span><br></pre></td></tr></table></figure>

<p>去掉 NAME 中的目录部分和后缀 SUFFIX，如果输出结果没有，则输出 SUFFIX。</p>
<h3 id="参数说明-2"><a href="#参数说明-2" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-a | --multiple</span><br><span class="line">			support multiple arguments and treat each as a NAME</span><br><span class="line">			</span><br><span class="line">-s | --suffix=SUFFIX</span><br><span class="line">			remove a trailing SUFFIX; implies -a</span><br><span class="line">			</span><br><span class="line">-z | --zero</span><br><span class="line">			end each output line with NUL, not newline(默认情况下，每条输出行以换行符结尾)</span><br><span class="line">			</span><br><span class="line">--<span class="built_in">help</span></span><br><span class="line">			display this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line">			</span><br><span class="line">--version</span><br><span class="line">			output version information and <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h3><ul>
<li>去除目录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$basename</span> /usr/bin/sort</span><br><span class="line">sort</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ basename /usr/include/stdio.h    </span><br><span class="line">stdio.h</span><br></pre></td></tr></table></figure>

<ul>
<li>去除目录和后缀</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ basename /usr/include/stdio.h .h</span><br><span class="line">stdio</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ basename -s .h /usr/include/stdio.h</span><br><span class="line">stdio</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ basename /usr/include/stdio.h stdio.h </span><br><span class="line">stdio.h</span><br></pre></td></tr></table></figure>

<ul>
<li>去除多个目录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ basename -a any1/str1 any2/str2 any3/str3</span><br><span class="line">str1</span><br><span class="line">str2</span><br><span class="line">str3</span><br></pre></td></tr></table></figure>

<h2 id="dirname"><a href="#dirname" class="headerlink" title="dirname"></a>dirname</h2><p>用于去除文件名中的非目录部分，删除最后一个 “\“ 后面的路径，显示父目录。</p>
<h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirname [OPTION] NAME...</span><br></pre></td></tr></table></figure>

<p>如果 NAME 中不包含 /，则输出 .，即当前目录。</p>
<h3 id="参数说明-3"><a href="#参数说明-3" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-z | --zero</span><br><span class="line">		end each output line with NUL, not newline</span><br><span class="line">		</span><br><span class="line">--<span class="built_in">help</span></span><br><span class="line">		display this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line">		</span><br><span class="line">--version</span><br><span class="line">		output version information and <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ dirname /usr/bin/</span><br><span class="line">/usr</span><br><span class="line"></span><br><span class="line">$ dirname /usr/bin</span><br><span class="line">/usr</span><br><span class="line"></span><br><span class="line">$ dirname /etc/</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">$ dirname /etc/httpd/conf/httpd.conf</span><br><span class="line">/etc/httpd/conf</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ dirname dir1/str dir2/str</span><br><span class="line">dir1</span><br><span class="line">dir2</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ dirname stdio.h</span><br><span class="line">.</span><br></pre></td></tr></table></figure>

<h2 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a>xargs</h2><p>xargs 是给命令传递参数的一个过滤器，也是组合多个命令的一个工具。</p>
<p>xargs 可以将管道或标准输入 (stdin) 数据转换成命令行参数，也能够从文件的输出中读取数据。</p>
<p>xargs 也可以将单行或多行文本输入转换为其他格式，例如多行变单行，单行变多行。</p>
<p>xargs 默认的命令是 echo，这意味着通过管道传递给 xargs 的输入将会包含换行和空白，不过通过 xargs 的处理，换行和空白将被空格取代。</p>
<p>xargs 是一个强有力的命令，它能够捕获一个命令的输出，然后传递给另外一个命令。</p>
<p>之所以能用到这个命令，关键是由于很多命令不支持管道来传递参数，而日常工作中有有这个必要，所以就有了 xargs 命令，例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /sbin -perm +700 | ls -l       <span class="comment">#这个命令是错误的</span></span><br><span class="line">find /sbin -perm +700 | xargs ls -l   <span class="comment">#这样才是正确的</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>xargs 一般是和管道一起使用。</p>
</blockquote>
<h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">some <span class="built_in">command</span> | xargs -item <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

<h3 id="参数说明-4"><a href="#参数说明-4" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">-a file</span><br><span class="line">	从文件中读入作为sdtin</span><br><span class="line">		</span><br><span class="line">-e flag</span><br><span class="line">	注意有的时候可能会是-E，flag必须是一个以空格分隔的标志，当xargs分析到含有flag这个标志的时候就停止。</span><br><span class="line">		</span><br><span class="line">-p</span><br><span class="line">	当每次执行一个argument的时候询问一次用户。</span><br><span class="line">	</span><br><span class="line">-n num</span><br><span class="line">	后面加次数，表示命令在执行的时候一次用的argument的个数，默认是用所有的。</span><br><span class="line"></span><br><span class="line">-t</span><br><span class="line">	表示先打印命令，然后再执行。</span><br><span class="line"></span><br><span class="line">-i</span><br><span class="line">	或者是-I，这得看linux支持了，将xargs的每项名称，一般是一行一行赋值给&#123;&#125;，可以用&#123;&#125;代替。</span><br><span class="line"></span><br><span class="line">-r</span><br><span class="line">	no-run-if-empty，当xargs的输入为空的时候则停止xargs，不用再去执行了。</span><br><span class="line"></span><br><span class="line">-s</span><br><span class="line">	num命令行的最大字符数，指的是xargs后面那个命令的最大命令行字符数。</span><br><span class="line"></span><br><span class="line">-L num</span><br><span class="line">	从标准输入一次读取num行送给<span class="built_in">command</span>命令。</span><br><span class="line"></span><br><span class="line">-l</span><br><span class="line">	同 -L。</span><br><span class="line"></span><br><span class="line">-d delim</span><br><span class="line">	分隔符，默认的xargs分隔符是回车，argument的分隔符是空格，这里修改的是xargs的分隔符。</span><br><span class="line"></span><br><span class="line">-x</span><br><span class="line">	<span class="built_in">exit</span>的意思，主要是配合-s使用。</span><br><span class="line"></span><br><span class="line">-P</span><br><span class="line">	修改最大的进程数，默认是1，为0时候为as many as it can ，这个例子我没有想到，应该平时都用不到的吧。</span><br></pre></td></tr></table></figure>

<h3 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h3><ul>
<li>读取输入数据重新格式化后输出</li>
</ul>
<p>定义一个测试文件，内有多行文本数据：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.txt</span><br><span class="line">a b c d e f g</span><br><span class="line">h i j k l m n</span><br><span class="line">o p q</span><br><span class="line">r s t</span><br><span class="line">u v w x y z</span><br></pre></td></tr></table></figure>

<p>单行输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.txt | xargs</span><br><span class="line">a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br></pre></td></tr></table></figure>

<p>-n 选项自定义多行输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.txt | xargs -n3</span><br><span class="line">a b c</span><br><span class="line">d e f</span><br><span class="line">g h i</span><br><span class="line">j k l</span><br><span class="line">m n o</span><br><span class="line">p q r</span><br><span class="line">s t u</span><br><span class="line">v w x</span><br><span class="line">y z</span><br></pre></td></tr></table></figure>

<p>-d 选项自定义一个定界符：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;nameXnameXnameXname&quot;</span> | xargs -dX</span><br><span class="line">name name name name</span><br></pre></td></tr></table></figure>

<p>结合 -n 选项使用：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;nameXnameXnameXname&quot;</span> | xargs -dX -n2</span><br><span class="line">name name</span><br><span class="line">name name</span><br></pre></td></tr></table></figure>

<ul>
<li>读取 stdin，将格式化后的参数传递给命令</li>
</ul>
<p>假设一个命令为 sk.sh 和一个保存参数的文件 arg.txt：</p>
<p>sk.sh 命令内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印出所有参数。</span></span><br><span class="line"><span class="built_in">echo</span> $*</span><br></pre></td></tr></table></figure>

<p>arg.txt 文件内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat arg.txt</span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">ccc</span><br></pre></td></tr></table></figure>

<p>xargs 的一个选项 -I，使用 -I 指定一个替换字符串 {}，这个字符串在 xargs 扩展时会被替换掉，当 -I 与 xargs 结合使用，每一个参数命令都会被执行一次：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat arg.txt | xargs -I &#123;&#125; ./sk.sh -p &#123;&#125; -l</span><br><span class="line">-p aaa -l</span><br><span class="line">-p bbb -l</span><br><span class="line">-p ccc -l</span><br></pre></td></tr></table></figure>

<p>复制所有图片文件到 /data/images 目录下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls *.jpg | xargs -n1 -I &#123;&#125; cp &#123;&#125; /data/images</span><br></pre></td></tr></table></figure>

<ul>
<li>结合 find 使用</li>
</ul>
<p>用 rm 删除太多的文件时候，可能得到一个错误信息：**/bin/rm Argument list too long.**， 用 xargs 去避免这个问题：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.log&quot;</span> -print0 | xargs -0 rm -f</span><br></pre></td></tr></table></figure>

<blockquote>
<p>xargs -0 将 \0 作为定界符。</p>
</blockquote>
<p>统计一个源代码目录中所有 php 文件的行数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.php&quot;</span> -print0 | xargs -0 wc -l</span><br></pre></td></tr></table></figure>

<p>查找所有的 jpg 文件，并且压缩它们：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ find . -<span class="built_in">type</span> f -name <span class="string">&quot;*.jpg&quot;</span> -<span class="built_in">print</span> | xargs tar -zcvf images.tar.gz</span><br></pre></td></tr></table></figure>

<ul>
<li>xargs 其他应用</li>
</ul>
<p>假如你有一个文件包含了很多你希望下载的 URL，你能够使用 xargs 下载所有链接：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat url-list.txt | xargs wget -c</span><br></pre></td></tr></table></figure>

<p>参考：？？？</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangqiguo/p/6464234.html">https://www.cnblogs.com/wangqiguo/p/6464234.html</a></p>
<h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p>linux 内置的 cron 进程能实现定时任务需求。</p>
<p>crontab 命令是 cron table 的简写，它是 cron 的配置文件，也可以叫它作业列表。我们可以在以下文件夹内找到相关配置文件：</p>
<ul>
<li>**/var/spool/cron/**：该目录下存放的是每个用户包括 root 的 crontab 任务，每个任务以创建者的名字命名。</li>
<li><strong>/etc/crontab</strong>：该文件负责调度各种管理和维护任务。</li>
<li>**/etc/cron.d/**：该目录用来存放任何要执行的crontab文件或脚本。</li>
<li>另外，还可以把脚本放在 <strong>/etc/cron.hourly、/etc/cron.daily、/etc/cron.weekly、/etc/cron.monthly</strong> 目录中，让它<strong>每小时/天/星期/月</strong>执行一次。</li>
</ul>
<h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab [-u user] [ -e | -l | -r ]</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-5"><a href="#参数说明-5" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-u user</span><br><span class="line">	用来设定某个用户的crontab服务，省略此参数表示操作当前用户的crontab。</span><br><span class="line"></span><br><span class="line">file</span><br><span class="line">	file是命令文件的名字，表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入(键盘)上键入的命令，并将它们载入crontab。</span><br><span class="line"></span><br><span class="line">-e</span><br><span class="line">	编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。</span><br><span class="line"></span><br><span class="line">-l</span><br><span class="line">	显示某个用户的crontab文件内容。如果不指定用户，则表示显示当前用户的crontab文件内容。</span><br><span class="line"></span><br><span class="line">-r</span><br><span class="line">	从/var/spool/cron目录中删除某个用户的crontab文件。如果不指定用户，则默认删除当前用户的crontab文件。</span><br><span class="line"></span><br><span class="line">-i</span><br><span class="line">	在删除用户的crontab文件时给确认提示。</span><br></pre></td></tr></table></figure>

<h3 id="实例-5"><a href="#实例-5" class="headerlink" title="实例"></a>实例</h3><p>设置定时任务时，输入 <code>crontab -e</code> 命令，进入当前用户的工作表编辑，是常见的 vim 界面。每行是一条命令。</p>
<p><strong>crontab 的命令格式：</strong></p>
<p><img src="/2020/12/15/linux-command/45b1947d455a43e71d169dba7ca042fea49b6968c1697f3433a1a92e12c5786c.png" alt="Thumbnail"></p>
<p><strong>crontab 的命令构成：</strong></p>
<p><code>时间 + 命令</code>，其时间有<strong>分、时、日、月、周</strong>五种，时间的操作符有：</p>
<ul>
<li><span style="color:red;">*****</span>：取值范围内的所有数字</li>
<li><span style="color:red;"><strong>/</strong></span>：每过多少个数字，间隔频率，例如：用在小时段的”*/2”表示每隔两小时</li>
<li><span style="color:red;"><strong>-</strong></span>：从X到Z，例如：”2-6”表示”2,3,4,5,6”</li>
<li><span style="color:red;"><strong>,</strong></span>：散列数字，例如：”1,2,5,7”</li>
</ul>
<p><strong>crontab 的命令实例：</strong></p>
<ul>
<li>每 2 小时执行一次：<code>0 */2 * * * command</code></li>
</ul>
<blockquote>
<p>上述命令的含义：能被2整除的整点的0分，执行命令，即 0、2、4、6、…、20、22、24。</p>
</blockquote>
<p><strong>crontab 的日志查看：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f /var/<span class="built_in">log</span>/cron.log</span><br><span class="line">$ tail -f /var/spool/mail/[username]</span><br></pre></td></tr></table></figure>

<p><strong>注意事项：</strong></p>
<ol>
<li><strong>环境变量问题</strong></li>
</ol>
<p>有时我们创建了一个 crontab，但是这个任务却无法自动执行，而手动执行这个任务却没有问题，这种情况一般是由于在 crontab 文件中没有配置环境变量引起的。</p>
<p>在 crontab 文件中定义多个调度任务时，需要特别注环境变量的设置，因为我们手动执行某个任务时，是在当前 shell 环境下进行的，程序当然能找到环境变量，而系统自动执行任务调度时，是不会加载任何环境变量的，因此，就需要在 crontab 文件中指定任务运行所需的所有环境变量，这样，系统执行任务调度时就没有问题了。</p>
<p>不要假定 cron 知道所需要的特殊环境，它其实并不知道。所以你要保证在 shell 脚本中提供所有必要的路径和环境变量，除了一些自动设置的全局变量。所以注意如下 3 点：</p>
<ul>
<li><p>脚本中涉及文件路径时写全局路径；</p>
</li>
<li><p>脚本执行要用到 java 或其他环境变量时，通过 source 命令引入环境变量，如：</p>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat start_cbp.sh</span><br><span class="line">!/bin/sh</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"><span class="built_in">export</span> RUN_CONF=/home/d139/conf/platform/cbp/cbp_jboss.conf</span><br><span class="line">/usr/<span class="built_in">local</span>/jboss-4.0.5/bin/run.sh -c mev &amp;</span><br></pre></td></tr></table></figure>

<ul>
<li>或者通过在 crontab 中直接引入环境变量解决问题。如：</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 * * * * . /etc/profile;/bin/sh /var/www/java/audit_no_count/bin/restart_audit.sh</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>及时清理系统用户的邮件日志</strong></li>
</ol>
<p>每条任务调度执行完毕，系统都会将任务输出信息通过电子邮件的形式发送给当前系统用户，这样日积月累，日志信息会非常大，可能会影响系统的正常运行，因此，将每条任务进行重定向处理非常重要。 例如，可以在 crontab 文件中设置如下形式，忽略日志输出：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 */3 * * * /usr/<span class="built_in">local</span>/apache2/apachectl restart &gt;/dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>“&gt;/dev/null 2&gt;&amp;1” 表示先将标准输出重定向到 /dev/null，然后将标准错误重定向到标准输出，由于标准输出已经重定向到了 /dev/null，因此标准错误也会重定向到 /dev/null，这样日志输出问题就解决了。</p>
<ol start="3">
<li><strong>其他注意事项</strong></li>
</ol>
<p>新创建的 cron job，不会马上执行，至少要过 2 分钟才执行。如果重启 cron 则马上执行。</p>
<p>当 crontab 失效时，可以尝试 <code>/etc/init.d/crond restart</code> 解决问题。或者查看日志看某个 job 有没有执行/报错 <code>tail -f /var/log/cron</code>。</p>
<p>**千万别乱运行 <code>crontab -r</code>**。它从 crontab 目录 (/var/spool/cron) 中删除用户的 crontab 文件，删除了该文件，则用户的所有 crontab 都没了。</p>
<p>在 crontab 中 % 是有特殊含义的，表示换行的意思。如果要用的话必须进行转义 %，如经常用的 date ‘+%Y%m%d’ 在 crontab 里是不会执行的，应该换成 date ‘+%Y%m%d’。</p>
<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html">https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/crontab.html</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021815907">https://segmentfault.com/a/1190000021815907</a></p>
<h2 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h2><p>用于为文件或目录改名、或将文件或目录移入其它位置。</p>
<h3 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	mv [OPTION]... [-T] SOURCE DEST</span><br><span class="line">or: mv [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">or: mv [OPTION]... -t DIRECTORY SOURCE...</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-6"><a href="#参数说明-6" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-b</span><br><span class="line">	当目标文件或目录sh存在时，在执行覆盖前，会为其创建一个备份。</span><br><span class="line"></span><br><span class="line">-i</span><br><span class="line">	如果指定移动的源目录或文件与目标的目录或文件同名，则会先询问是否覆盖旧文件，输入y表示直接覆盖，输入n表示取消该操作。</span><br><span class="line"></span><br><span class="line">-f</span><br><span class="line">	如果指定移动的源目录或文件与目标的目录或文件同名，不会询问，直接覆盖旧文件。</span><br><span class="line"></span><br><span class="line">-n</span><br><span class="line">	不要覆盖任何已存在的文件或目录。</span><br><span class="line"></span><br><span class="line">-u</span><br><span class="line">	当源文件比目标文件新或者目标文件不存在时，才执行移动操作。</span><br></pre></td></tr></table></figure>

<h3 id="实例-6"><a href="#实例-6" class="headerlink" title="实例"></a>实例</h3><ul>
<li>将源文件名 source_file 改为目标文件名 dest_file</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv source_file(文件) dest_file(文件)</span><br></pre></td></tr></table></figure>

<ul>
<li>将文件 source_file 移动到目标目录 dest_directory 中</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv source_file(文件) dest_directory(目录)</span><br></pre></td></tr></table></figure>

<ul>
<li>将源目录 source_directory 移动到 目标目录 dest_directory中</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv source_directory(目录) dest_directory(目录)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>若目录名 dest_directory 已存在，则 source_directory 移动到目录名 dest_directory 中；</p>
<p>若目录名 dest_directory 不存在，则 source_directory 改名为目录名 dest_directory。</p>
</blockquote>
<h2 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h2><p>用于实现文件或批量文件重命名。在不同的 linux 版本，命令的语法格式可能不同。</p>
<h3 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename [ -h|-m|-V ] [ -v ] [ -n ] [ -f ] [ -e|-E *perlexpr*]*|*perlexpr* [ *files* ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>linux 版本：</p>
<p>Linux version 4.4.0-116-generic (buildd@lgw01-amd64-021) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9) ) #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018</p>
</blockquote>
<p>或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename [options] expression replacement file...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>linux 版本：</p>
<p>Linux version 3.10.0-1062.el7.x86_64 (<a href="mailto:&#x6d;&#x6f;&#99;&#107;&#98;&#x75;&#x69;&#x6c;&#100;&#64;&#107;&#x62;&#117;&#x69;&#x6c;&#x64;&#x65;&#114;&#x2e;&#x62;&#x73;&#x79;&#x73;&#x2e;&#x63;&#101;&#x6e;&#116;&#x6f;&#x73;&#x2e;&#x6f;&#x72;&#103;">&#x6d;&#x6f;&#99;&#107;&#98;&#x75;&#x69;&#x6c;&#100;&#64;&#107;&#x62;&#117;&#x69;&#x6c;&#x64;&#x65;&#114;&#x2e;&#x62;&#x73;&#x79;&#x73;&#x2e;&#x63;&#101;&#x6e;&#116;&#x6f;&#x73;&#x2e;&#x6f;&#x72;&#103;</a>) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC) ) #1 SMP Wed Aug 7 18:08:02 UTC 2019</p>
</blockquote>
<h3 id="参数说明-7"><a href="#参数说明-7" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-v, -verbose</span><br><span class="line">        Verbose: <span class="built_in">print</span> names of files successfully renamed.</span><br><span class="line">-n, -nono</span><br><span class="line">        No action: <span class="built_in">print</span> names of files to be renamed, but don<span class="string">&#x27;t rename.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-f, -force</span></span><br><span class="line"><span class="string">        Over write: allow existing files to be over-written.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-h, -help</span></span><br><span class="line"><span class="string">        Help: print SYNOPSIS and OPTIONS.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-m, -man</span></span><br><span class="line"><span class="string">        Manual: print manual page.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-V, -version</span></span><br><span class="line"><span class="string">        Version: show version number.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-e      Expression: code to act on files name.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        May be repeated to build up code (like &quot;perl -e&quot;). If no -e, the</span></span><br><span class="line"><span class="string">        first argument is used as code.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-E      Statement: code to act on files name, as -e but terminated by</span></span><br><span class="line"><span class="string">        &#x27;</span>;<span class="string">&#x27;.</span></span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-v, --verbose  explain what is being <span class="keyword">done</span></span><br><span class="line">-s, --symlink  act on symlink target</span><br><span class="line"></span><br><span class="line">-h, --<span class="built_in">help</span>     display this <span class="built_in">help</span> and <span class="built_in">exit</span></span><br><span class="line">-V, --version  output version information and <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="实例-7"><a href="#实例-7" class="headerlink" title="实例"></a>实例</h3><ul>
<li>替换文件名中特定字段</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rename -v <span class="string">&quot;s/20/patent-application/&quot;</span> *.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lin @ lin in ~/share/storage_server_3/Download/test [14:52:08] </span></span><br><span class="line">$ ll</span><br><span class="line">total 76G</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.3G Dec  4 16:54 2005.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.3G Dec  5 21:50 2006.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.4G Dec  5 21:52 2007.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.7G Dec  5 21:53 2008.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 5.0G Dec  7 22:10 2009.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># lin @ lin in ~/share/storage_server_3/Download/test [14:52:08] </span></span><br><span class="line">$ rename -v <span class="string">&quot;s/20/patent-application/&quot;</span> *.tar.gz</span><br><span class="line">2005.tar.gz renamed as patent-application05.tar.gz</span><br><span class="line">2006.tar.gz renamed as patent-application06.tar.gz</span><br><span class="line">2007.tar.gz renamed as patent-application07.tar.gz</span><br><span class="line">2008.tar.gz renamed as patent-application08.tar.gz</span><br><span class="line">2009.tar.gz renamed as patent-application09.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># lin @ lin in ~/share/storage_server_3/Download/test [14:53:55] </span></span><br><span class="line">$ ll</span><br><span class="line">total 76G</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.3G Dec  4 16:54 patent-application05.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.3G Dec  5 21:50 patent-application06.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.4G Dec  5 21:52 patent-application07.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 4.7G Dec  5 21:53 patent-application08.tar.gz</span><br><span class="line">-rw-rw-r-- 1 lin lin 5.0G Dec  7 22:10 patent-application09.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rename 20 patent-application-20 *.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(base) [hadoop@client version-1.0]$ ll</span><br><span class="line">total 79555796</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4527645498 Dec  4 16:54 2005.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4550889304 Dec  5 21:50 2006.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4712276001 Dec  5 21:52 2007.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4986740725 Dec  5 21:53 2008.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 5311490484 Dec  7 22:10 2009.tar.gz</span><br><span class="line">(base) [hadoop@client version-1.0]$ rename 20 patent-application-20 *.tar.gz</span><br><span class="line">(base) [hadoop@client version-1.0]$ ll</span><br><span class="line">total 79555796</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop       1372 Dec 16 09:15 hash_calculate.txt</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4527645498 Dec  4 16:54 patent-application-2005.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4550889304 Dec  5 21:50 patent-application-2006.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4712276001 Dec  5 21:52 patent-application-2007.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 4986740725 Dec  5 21:53 patent-application-2008.tar.gz</span><br><span class="line">-rw-rw-r-- 1 hadoop hadoop 5311490484 Dec  7 22:10 patent-application-2009.tar.gz</span><br></pre></td></tr></table></figure>

<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="http://einverne.github.io/post/2018/01/rename-files-batch.html">http://einverne.github.io/post/2018/01/rename-files-batch.html</a></p>
<h2 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h2><p>用于解压缩 .zip 文件。</p>
<h3 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">	unzip [-cflptuvz][-agCjLMnoqsVX][-P &lt;密码&gt;][.zip文件][文件][-d &lt;目录&gt;][-x &lt;文件&gt;]</span><br><span class="line">or: unzip [-Z]</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-8"><a href="#参数说明-8" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">-c</span><br><span class="line">	将解压缩的结果显示到屏幕上，并对字符做适当的转换。</span><br><span class="line"></span><br><span class="line">-f</span><br><span class="line">	更新现有的文件。</span><br><span class="line"></span><br><span class="line">-l</span><br><span class="line">	显示压缩文件内所包含的文件。</span><br><span class="line"></span><br><span class="line">-p</span><br><span class="line">	与-c参数类似，会将解压缩的结果显示到屏幕上，但不会执行任何的转换。</span><br><span class="line"></span><br><span class="line">-t</span><br><span class="line">	检查压缩文件是否正确。</span><br><span class="line"></span><br><span class="line">-u</span><br><span class="line">	与-f参数类似，但是除了更新现有的文件外，也会将压缩文件中的其他文件解压缩到目录中。</span><br><span class="line"></span><br><span class="line">-v</span><br><span class="line">	查看压缩文件目录信息，但是不解压该文件。</span><br><span class="line"></span><br><span class="line">-z</span><br><span class="line">	仅显示压缩文件的备注文字。</span><br><span class="line"></span><br><span class="line">-a</span><br><span class="line">	对文本文件进行必要的字符转换。</span><br><span class="line"></span><br><span class="line">-b</span><br><span class="line">	不要对文本文件进行字符转换。</span><br><span class="line"></span><br><span class="line">-C</span><br><span class="line">	压缩文件中的文件名称区分大小写。</span><br><span class="line"></span><br><span class="line">-j</span><br><span class="line">	不处理压缩文件中原有的目录路径。</span><br><span class="line"></span><br><span class="line">-L</span><br><span class="line">	将压缩文件中的全部文件名改为小写。</span><br><span class="line"></span><br><span class="line">-M</span><br><span class="line">	将输出结果送到more程序处理。</span><br><span class="line"></span><br><span class="line">-n</span><br><span class="line">	解压缩时不要覆盖原有的文件。</span><br><span class="line"></span><br><span class="line">-o</span><br><span class="line">	不必先询问用户，unzip执行后覆盖原有文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-q</span><br><span class="line">	执行时不显示任何信息。</span><br><span class="line"></span><br><span class="line">-s</span><br><span class="line">	将文件名中的空白字符转换为底线字符。</span><br><span class="line"></span><br><span class="line">-V</span><br><span class="line">	保留VMS的文件版本信息。</span><br><span class="line"></span><br><span class="line">-X</span><br><span class="line">	解压缩时同时回存文件原来的UID/GID。</span><br><span class="line"></span><br><span class="line">-P &lt;密码&gt;</span><br><span class="line">	使用zip的密码选项。</span><br><span class="line"></span><br><span class="line">[.zip文件]</span><br><span class="line">	指定.zip压缩文件。</span><br><span class="line"></span><br><span class="line">[文件]</span><br><span class="line">	指定要处理.zip压缩文件中的哪些文件。</span><br><span class="line"></span><br><span class="line">-d &lt;目录&gt;</span><br><span class="line">	指定文件解压缩后所要存储的目录。</span><br><span class="line"></span><br><span class="line">-x &lt;文件&gt;</span><br><span class="line">	指定不要处理.zip压缩文件中的哪些文件。</span><br><span class="line"></span><br><span class="line">-Z</span><br><span class="line">    <span class="string">&#x27;unzip -Z&#x27;</span>等于执行zipinfo指令。</span><br></pre></td></tr></table></figure>

<h3 id="实例-8"><a href="#实例-8" class="headerlink" title="实例"></a>实例</h3><ul>
<li>查看压缩文件目录信息，但不解压</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -v I20090212-SUPP.ZIP </span><br><span class="line">Archive:  I20090212-SUPP.ZIP</span><br><span class="line"> Length   Method    Size  Cmpr    Date    Time   CRC-32   Name</span><br><span class="line">--------  ------  ------- ---- ---------- ----- --------  ----</span><br><span class="line">       0  Stored        0   0% 2009-01-31 04:56 00000000  project/pdds/ICEApplication/I20090212-SUPP/</span><br><span class="line">       0  Stored        0   0% 2009-01-31 04:56 00000000  project/pdds/ICEApplication/I20090212-SUPP/DTDS/</span><br><span class="line">   88199  Stored    88199   0% 2007-01-22 00:07 d5e3060f  project/pdds/ICEApplication/I20090212-SUPP/DTDS/DTDS.zip</span><br><span class="line">       0  Stored        0   0% 2009-01-31 04:56 00000000  project/pdds/ICEApplication/I20090212-SUPP/UTIL0041/</span><br><span class="line">   15664  Stored    15664   0% 2009-01-28 22:45 3dfa6c1c  project/pdds/ICEApplication/I20090212-SUPP/UTIL0041/US20090041797A1-20090212-SUPP.ZIP</span><br><span class="line">       0  Stored        0   0% 2009-01-31 04:56 00000000  project/pdds/ICEApplication/I20090212-SUPP/UTIL0044/</span><br><span class="line">  901714  Stored   901714   0% 2009-01-28 22:45 75ce3ca6  project/pdds/ICEApplication/I20090212-SUPP/UTIL0044/US20090044288A1-20090212-SUPP.ZIP</span><br><span class="line"> 1911858  Stored  1911858   0% 2009-01-28 22:45 cbc1d0bd  project/pdds/ICEApplication/I20090212-SUPP/UTIL0044/US20090044297A1-20090212-SUPP.ZIP</span><br><span class="line">--------          -------  ---                            -------</span><br><span class="line"> 2917435          2917435   0%                            8 files</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>解压 .zip 文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ unzip I20090212-SUPP.ZIP </span><br><span class="line">Archive:  I20090212-SUPP.ZIP</span><br><span class="line">   creating: project/pdds/ICEApplication/I20090212-SUPP/</span><br><span class="line">   creating: project/pdds/ICEApplication/I20090212-SUPP/DTDS/</span><br><span class="line"> extracting: project/pdds/ICEApplication/I20090212-SUPP/DTDS/DTDS.zip  </span><br><span class="line">   creating: project/pdds/ICEApplication/I20090212-SUPP/UTIL0041/</span><br><span class="line"> extracting: project/pdds/ICEApplication/I20090212-SUPP/UTIL0041/US20090041797A1-20090212-SUPP.ZIP  </span><br><span class="line">   creating: project/pdds/ICEApplication/I20090212-SUPP/UTIL0044/</span><br><span class="line"> extracting: project/pdds/ICEApplication/I20090212-SUPP/UTIL0044/US20090044288A1-20090212-SUPP.ZIP  </span><br><span class="line"> extracting: project/pdds/ICEApplication/I20090212-SUPP/UTIL0044/US20090044297A1-20090212-SUPP.ZIP </span><br></pre></td></tr></table></figure>

<ul>
<li>解压 .zip 文件，但不显示信息</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unzip -q I20090212-SUPP.ZIP</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果压缩文件 .zip 是大于 2G 的，那 unzip 就无法使用，此时可以使用 7zip 解压。</p>
</blockquote>
<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.bbsmax.com/A/lk5aMEAP51/">https://www.bbsmax.com/A/lk5aMEAP51/</a></p>
<h2 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h2><p>用于压缩文件，压缩后的文件后缀名为 .zip。</p>
<h3 id="语法-9"><a href="#语法-9" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip [-AcdDfFghjJKlLmoqrSTuvVwXyz$] [-b &lt;工作目录&gt;] [-ll] [-n &lt;字尾字符串&gt;] [-t &lt;日期时间&gt;] [-&lt;压缩效率&gt;] [压缩文件] [文件...] [-i &lt;范本样式&gt;] [-x &lt;范本样式&gt;]</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-9"><a href="#参数说明-9" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">-A</span><br><span class="line">	调整可执行的自动解压缩文件。</span><br><span class="line">	</span><br><span class="line">-c</span><br><span class="line">	替每个被压缩的文件加上注释。</span><br><span class="line"></span><br><span class="line">-d</span><br><span class="line">	从压缩文件内删除指定的文件。</span><br><span class="line"></span><br><span class="line">-D</span><br><span class="line">	压缩文件内不建立目录名称。</span><br><span class="line"></span><br><span class="line">-f</span><br><span class="line">	更新现有的文件。</span><br><span class="line"></span><br><span class="line">-F</span><br><span class="line">	尝试修复已损坏的压缩文件。</span><br><span class="line"></span><br><span class="line">-g</span><br><span class="line">	将文件压缩后附加在既有的压缩文件之后，而非另行建立新的压缩文件。</span><br><span class="line"></span><br><span class="line">-h</span><br><span class="line">	在线帮助。</span><br><span class="line"></span><br><span class="line">-j</span><br><span class="line">	只保存文件名称及其内容，而不存放任何目录名称。</span><br><span class="line"></span><br><span class="line">-J</span><br><span class="line">	删除压缩文件前面不必要的数据。</span><br><span class="line">	</span><br><span class="line">-k</span><br><span class="line">	使用MS-DOS兼容格式的文件名称。</span><br><span class="line">	</span><br><span class="line">-l</span><br><span class="line">	压缩文件时，把LF字符置换成LF+CR字符。</span><br><span class="line"></span><br><span class="line">-L</span><br><span class="line">	显示版权信息。</span><br><span class="line"></span><br><span class="line">-m</span><br><span class="line">	将文件压缩并加入压缩文件后，删除原始文件，即把文件移到压缩文件中。</span><br><span class="line"></span><br><span class="line">-o</span><br><span class="line">	以压缩文件内拥有最新更改时间的文件为准，将压缩文件的更改时间设成和该文件相同。</span><br><span class="line"></span><br><span class="line">-q</span><br><span class="line">	不显示指令执行过程。</span><br><span class="line"></span><br><span class="line">-r</span><br><span class="line">	递归处理，将指定目录下的所有文件和子目录一并处理。</span><br><span class="line"></span><br><span class="line">-S</span><br><span class="line">	包含系统和隐藏文件。</span><br><span class="line"></span><br><span class="line">-T</span><br><span class="line">	检查备份文件内的每个文件是否正确无误。</span><br><span class="line"></span><br><span class="line">-u</span><br><span class="line">	与-f参数类似，但是除了更新现有的文件外，也会将压缩文件中的其他文件解压缩到目录中。</span><br><span class="line"></span><br><span class="line">-v</span><br><span class="line">	显示指令执行过程或显示版本信息。</span><br><span class="line"></span><br><span class="line">-V</span><br><span class="line">	保存VMS操作系统的文件属性。</span><br><span class="line"></span><br><span class="line">-w</span><br><span class="line">	在文件名称里假如版本编号，本参数仅在VMS操作系统下有效。</span><br><span class="line"></span><br><span class="line">-X</span><br><span class="line">	不保存额外的文件属性。</span><br><span class="line"></span><br><span class="line">-y</span><br><span class="line">	直接保存符号连接，而非该连接所指向的文件，本参数仅在UNIX之类的系统下有效。</span><br><span class="line"></span><br><span class="line">-z</span><br><span class="line">	替压缩文件加上注释。</span><br><span class="line"></span><br><span class="line">-$</span><br><span class="line">	保存第一个被压缩文件所在磁盘的卷册名称。</span><br><span class="line">	</span><br><span class="line">-b &lt;工作目录&gt;</span><br><span class="line">	指定暂时存放文件的目录。</span><br><span class="line">	</span><br><span class="line">-ll</span><br><span class="line">	压缩文件时，把LF+CR字符置换成LF字符。</span><br><span class="line"></span><br><span class="line">-n &lt;字尾字符串&gt;</span><br><span class="line">	不压缩具有特定字尾字符串的文件。</span><br><span class="line"></span><br><span class="line">-t &lt;日期时间&gt;</span><br><span class="line">	把压缩文件的日期设成指定的日期。</span><br><span class="line"></span><br><span class="line">-&lt;压缩效率&gt;</span><br><span class="line">	压缩效率是一个介于1-9的数值。</span><br><span class="line"></span><br><span class="line">-i &lt;范本样式&gt;</span><br><span class="line">	只压缩符合条件的文件。</span><br><span class="line"></span><br><span class="line">-x &lt;范本样式&gt;</span><br><span class="line">	压缩时排除符合条件的文件。</span><br></pre></td></tr></table></figure>

<h3 id="实例-9"><a href="#实例-9" class="headerlink" title="实例"></a>实例</h3><ul>
<li>将 /home/html/ 目录下所有文件和文件夹打包为当前目录下的 html.zip</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ zip -q -r html.zip /home/html</span><br></pre></td></tr></table></figure>

<ul>
<li>如果当前在 /home/html 目录下，可以执行以下命令</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ zip -q -r html.zip *</span><br></pre></td></tr></table></figure>

<ul>
<li>从压缩文件 cp.zip 中删除文件 a.c</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -dv cp.zip a.c</span><br></pre></td></tr></table></figure>

<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><p>用于打包、解包文件。</p>
<blockquote>
<p>tar 本身不具有压缩功能，可以通过参数调用其他压缩工具实现压缩功能。 </p>
</blockquote>
<h3 id="语法-10"><a href="#语法-10" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar [-ABcdgGhiklmMoOpPrRsStuUvwWxzZ] [-b &lt;区块数目&gt;] [-C &lt;目的目录&gt;] [-f &lt;备份文件&gt;] [-F &lt;Script文件&gt;] [-K &lt;文件&gt;] [-L &lt;媒体容量&gt;] [-N &lt;日期时间&gt;] [-T &lt;范本文件&gt;] [-V &lt;卷册名称&gt;] [-X &lt;范本文件&gt;] [-&lt;设备编号&gt;&lt;存储密度&gt;] [--after-date=&lt;日期时间&gt;] [--atime-preserve] [--backuup=&lt;备份方式&gt;] [--checkpoint] [--concatenate] [--confirmation] [--delete] [--exclude=&lt;范本样式&gt;] [--force-local] [--group=&lt;群组名称&gt;] [--<span class="built_in">help</span>] [--ignore-failed-read] [--new-volume-script=&lt;Script文件&gt;] [--newer-mtime] [--no-recursion] [--null] [--numeric-owner] [--owner=&lt;用户名称&gt;] [--posix] [--erve] [--preserve-order] [--preserve-permissions] [--record-size=&lt;区块数目&gt;] [--recursive-unlink] [--remove-files] [--rsh-command=&lt;执行指令&gt;] [--same-owner] [--suffix=&lt;备份字尾字符串&gt;] [--totals] [--use-compress-program=&lt;执行指令&gt;] [--version] [--volno-file=&lt;编号文件&gt;] [文件或目录...]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>语法结构：<code>tar [必要参数] [可选参数] [文件]</code></p>
</blockquote>
<h3 id="参数说明-10"><a href="#参数说明-10" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">-A | --catenate</span><br><span class="line">		新增文件到已存在的备份文件。</span><br><span class="line">		</span><br><span class="line">-B | --read-full-records</span><br><span class="line">		读取数据时重设区块大小。</span><br><span class="line">		</span><br><span class="line">-c | --create</span><br><span class="line">		建立新的备份文件。</span><br><span class="line">		</span><br><span class="line">-d | --diff | --compare</span><br><span class="line">		对比备份文件内和文件系统上的文件的差异。</span><br><span class="line">		</span><br><span class="line">-g | --listed-incremental</span><br><span class="line">		处理GNU格式的大量备份。</span><br><span class="line">		</span><br><span class="line">-G | --incremental</span><br><span class="line">		处理旧的GNU格式的大量备份。</span><br><span class="line">		</span><br><span class="line">-h | --dereference</span><br><span class="line">		不建立符号连接，直接复制该连接所指向的原始文件。</span><br><span class="line">		</span><br><span class="line">-i | --ignore-zeros</span><br><span class="line">		忽略备份文件中的0 Byte区块，也就是EOF。</span><br><span class="line">		</span><br><span class="line">-k | --keep-old-files</span><br><span class="line">		解开备份文件时，不覆盖已有的文件。</span><br><span class="line">		</span><br><span class="line">-l | --one-file-system</span><br><span class="line">		复制的文件或目录存放的文件系统，必须与tar指令执行时所处的文件系统相同，否则不予复制。</span><br><span class="line">		</span><br><span class="line">-m | --modification-time</span><br><span class="line">		还原文件时，不变更文件的更改时间。</span><br><span class="line">		</span><br><span class="line">-M | --multi-volume</span><br><span class="line">		在建立，还原备份文件或列出其中的内容时，采用多卷册模式。</span><br><span class="line">		</span><br><span class="line">-o | --old-archive | --portability</span><br><span class="line">		将资料写入备份文件时使用V7格式。</span><br><span class="line">		</span><br><span class="line">-O | --stdout</span><br><span class="line">		把从备份文件里还原的文件输出到标准输出设备。</span><br><span class="line">		</span><br><span class="line">-p | --same-permissions</span><br><span class="line">		用原来的文件权限还原文件。</span><br><span class="line">		</span><br><span class="line">-P | --absolute-names</span><br><span class="line">		文件名使用绝对名称，不移除文件名称前的<span class="string">&quot;/&quot;</span>号。</span><br><span class="line">		</span><br><span class="line">-r | --append</span><br><span class="line">		新增文件到已存在的备份文件的结尾部分。</span><br><span class="line">		</span><br><span class="line">-R | --block-number</span><br><span class="line">		列出每个信息在备份文件中的区块编号。</span><br><span class="line">		</span><br><span class="line">-s | --same-order</span><br><span class="line">		还原文件的顺序和备份文件内的存放顺序相同。</span><br><span class="line">		</span><br><span class="line">-S | --sparse</span><br><span class="line">		倘若一个文件内含大量的连续0字节，则将此文件存成稀疏文件。</span><br><span class="line">		</span><br><span class="line">-t | --list</span><br><span class="line">		列出备份文件的内容。</span><br><span class="line">		</span><br><span class="line">-u | --update</span><br><span class="line">		仅置换较备份文件内的文件更新的文件。</span><br><span class="line">		</span><br><span class="line">-U | --unlink-first</span><br><span class="line">		解开压缩文件还原文件之前，先解除文件的连接。</span><br><span class="line">		</span><br><span class="line">-v | --verbose</span><br><span class="line">		显示指令执行过程。</span><br><span class="line">		</span><br><span class="line">-w | --interactive</span><br><span class="line">		遭遇问题时先询问用户。</span><br><span class="line">		</span><br><span class="line">-W | --verify</span><br><span class="line">		写入备份文件后，确认文件正确无误。</span><br><span class="line">		</span><br><span class="line">-x | --extract | --get</span><br><span class="line">		从备份文件中还原文件。</span><br><span class="line">		</span><br><span class="line">-z | --gzip | --ungzip</span><br><span class="line">		通过gzip指令处理备份文件。</span><br><span class="line">		</span><br><span class="line">-Z | --compress | --uncompress</span><br><span class="line">		通过compress指令处理备份文件。</span><br><span class="line"></span><br><span class="line">-b &lt;区块数目&gt; | --blocking-factor=&lt;区块数目&gt;</span><br><span class="line">		设置每笔记录的区块数目，每个区块大小为12Bytes。</span><br><span class="line"></span><br><span class="line">-C &lt;目的目录&gt; | --directory=&lt;目的目录&gt;</span><br><span class="line">		切换到指定的目录。</span><br><span class="line"></span><br><span class="line">-f &lt;备份文件&gt; | --file=&lt;备份文件&gt;</span><br><span class="line">		指定备份文件。多个命令时需要放在最后面。</span><br><span class="line">		</span><br><span class="line">-F &lt;Script文件&gt; | --info-script=&lt;Script文件&gt;</span><br><span class="line">		每次更换磁带时，就执行指定的Script文件。</span><br><span class="line"></span><br><span class="line">-K &lt;文件&gt; | --starting-file=&lt;文件&gt;</span><br><span class="line">		从指定的文件开始还原。</span><br><span class="line"></span><br><span class="line">-L &lt;媒体容量&gt; | -tape-length=&lt;媒体容量&gt;</span><br><span class="line">		设置存放每体的容量，单位以1024Bytes计算。</span><br><span class="line"></span><br><span class="line">-N &lt;日期格式&gt; | --newer=&lt;日期时间&gt;</span><br><span class="line">		只将较指定日期更新的文件保存到备份文件里。</span><br><span class="line"></span><br><span class="line">-T &lt;范本文件&gt; | --files-from=&lt;范本文件&gt;</span><br><span class="line">		指定范本文件，其内含有一个或多个范本样式，让tar解开或建立符合设置条件的文件。</span><br><span class="line"></span><br><span class="line">-V&lt;卷册名称&gt; | --label=&lt;卷册名称&gt;</span><br><span class="line">		建立使用指定的卷册名称的备份文件。</span><br><span class="line"></span><br><span class="line">-X &lt;范本文件&gt; | --exclude-from=&lt;范本文件&gt;</span><br><span class="line">		指定范本文件，其内含有一个或多个范本样式，让tar排除符合设置条件的文件。</span><br><span class="line"></span><br><span class="line">-&lt;设备编号&gt;&lt;存储密度&gt;</span><br><span class="line">		设置备份用的外围设备编号及存放数据的密度。</span><br><span class="line">		</span><br><span class="line">--after-date=&lt;日期时间&gt;</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-N&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--atime-preserve</span><br><span class="line">		不变更文件的存取时间。</span><br><span class="line"></span><br><span class="line">--backup=&lt;备份方式&gt; | --backup</span><br><span class="line">		移除文件前先进行备份。</span><br><span class="line"></span><br><span class="line">--checkpoint</span><br><span class="line">		读取备份文件时列出目录名称。</span><br><span class="line"></span><br><span class="line">--concatenate</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-A&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--confirmation</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-w&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--delete</span><br><span class="line">		从备份文件中删除指定的文件。</span><br><span class="line"></span><br><span class="line">--exclude=&lt;范本样式&gt;</span><br><span class="line">		排除符合范本样式的文件。</span><br><span class="line"></span><br><span class="line">--group=&lt;群组名称&gt;</span><br><span class="line">		把加入设备文件中的文件的所属群组设成指定的群组。</span><br><span class="line"></span><br><span class="line">--<span class="built_in">help</span></span><br><span class="line">		在线帮助。</span><br><span class="line"></span><br><span class="line">--ignore-failed-read</span><br><span class="line">		忽略数据读取错误，不中断程序的执行。</span><br><span class="line"></span><br><span class="line">--new-volume-script=&lt;Script文件&gt;</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-F&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--newer-mtime</span><br><span class="line">		只保存更改过的文件。</span><br><span class="line"></span><br><span class="line">--no-recursion</span><br><span class="line">		不做递归处理，也就是指定目录下的所有文件及子目录不予处理。</span><br><span class="line"></span><br><span class="line">--null</span><br><span class="line">		从null设备读取文件名称。</span><br><span class="line"></span><br><span class="line">--numeric-owner</span><br><span class="line">		以用户识别码及群组识别码取代用户名称和群组名称。</span><br><span class="line"></span><br><span class="line">--owner=&lt;用户名称&gt;</span><br><span class="line">		把加入备份文件中的文件的拥有者设成指定的用户。</span><br><span class="line"></span><br><span class="line">--posix</span><br><span class="line">		将数据写入备份文件时使用POSIX格式。</span><br><span class="line"></span><br><span class="line">--preserve</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-ps&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--preserve-order</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-A&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--preserve-permissions</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-p&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--record-size=&lt;区块数目&gt;</span><br><span class="line">		此参数的效果和指定<span class="string">&quot;-b&quot;</span>参数相同。</span><br><span class="line"></span><br><span class="line">--recursive-unlink</span><br><span class="line">		解开压缩文件还原目录之前，先解除整个目录下所有文件的连接。</span><br><span class="line"></span><br><span class="line">--remove-files</span><br><span class="line">		文件加入备份文件后，就将其删除。</span><br><span class="line"></span><br><span class="line">--rsh-command=&lt;执行指令&gt;</span><br><span class="line">		设置要在远端主机上执行的指令，以取代rsh指令。</span><br><span class="line"></span><br><span class="line">--same-owner</span><br><span class="line">		尝试以相同的文件拥有者还原文件。</span><br><span class="line"></span><br><span class="line">--suffix=&lt;备份字尾字符串&gt;</span><br><span class="line">		移除文件前先行备份。</span><br><span class="line"></span><br><span class="line">--totals</span><br><span class="line">		备份文件建立后，列出文件大小。</span><br><span class="line"></span><br><span class="line">--use-compress-program=&lt;执行指令&gt;</span><br><span class="line">		通过指定的指令处理备份文件。</span><br><span class="line"></span><br><span class="line">--version</span><br><span class="line">		显示版本信息。</span><br><span class="line"></span><br><span class="line">--volno-file=&lt;编号文件&gt;</span><br><span class="line">		使用指定文件内的编号取代预设的卷册编号。</span><br></pre></td></tr></table></figure>

<h3 id="实例-10"><a href="#实例-10" class="headerlink" title="实例"></a>实例</h3><ul>
<li>打包，不压缩</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -cvf test.tar <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>解包</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvf test.tar </span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>打包，并以 <strong>gzip</strong> 压缩</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zcvf test.tar.gz <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在参数 f 之后的文件档名是自己取的，我们习惯上都用 .tar 来作为辨识。 如果加 z 参数，则以 .tar.gz 或 .tgz 来代表 gzip 压缩过的 tar 包。</p>
</blockquote>
<ul>
<li>解压 .tar.gz</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf test.tar.gz </span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>打包，以 <strong>bzip2</strong> 压缩</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zcvf test.tar.bz2 <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>解压 .tar.bz2</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf test.tar.bz2 </span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 .tar.gz 或 .tar.bz2 压缩包内的文件，但不解压</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ tar -ztvf test.tar.gz </span><br><span class="line">drwxrwxr-x lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/3</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/1</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/2</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/5</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/4</span><br><span class="line"></span><br><span class="line">$ tar -ztvf test.tar.bz2 </span><br><span class="line">drwxrwxr-x lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/3</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/1</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/2</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/5</span><br><span class="line">-rw-rw-r-- lin/lin           0 2020-12-21 11:38 <span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>解压 .tar.gz 压缩包内的部分文件</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf test.tar.gz <span class="built_in">test</span>/2 <span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/2</span><br></pre></td></tr></table></figure>

<ul>
<li>解压 .tar.gz 到指定目录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tar -zxvf test.tar.gz -C ../Download </span><br><span class="line"><span class="built_in">test</span>/</span><br><span class="line"><span class="built_in">test</span>/3</span><br><span class="line"><span class="built_in">test</span>/1</span><br><span class="line"><span class="built_in">test</span>/2</span><br><span class="line"><span class="built_in">test</span>/5</span><br><span class="line"><span class="built_in">test</span>/4</span><br></pre></td></tr></table></figure>

<ul>
<li>使用绝对路径打包压缩和解压</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 压缩</span></span><br><span class="line">$ tar -zcPf /home/lin/share/storage_server_3/patent/grant-patent/patent_version-1.0/patent-grant-2019.tar.gz /home/lin/share/storage_server_3/patent/grant-patent/patent_version-1.0/2019</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">$ tar -zxPf patent-grant-2019.tar.gz</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>tar 对文件打包时，一般不建议使用绝对路径。</strong></p>
<p>如果使用绝对路径，需要加 -P 参数。如果不添加，会发出警告：<code>tar: Removing leading &#39;/&#39; from member names</code>。</p>
<p>对于使用绝对路径打包压缩的文件，解压时 tar 会在当前目录下创建压缩时的绝对路径所对应的目录，在上面例子中，即为在当前目录下创建一个子目录 <code>home/lin/share/storage_server_3/patent/grant-patent/patent_version-1.0</code>。</p>
<p>如果在解压时使用 -P 参数，需要保证系统存在压缩时的绝对路径。</p>
</blockquote>
<ul>
<li>使用 <strong>pigz</strong> 并发压缩和解压</li>
</ul>
<p>安装 pigz：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install pigz</span><br></pre></td></tr></table></figure>

<p>打包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar --use-compress-program=pigz -cvpf package.tgz ./package</span><br></pre></td></tr></table></figure>

<p>解包：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tar --use-compress-program=pigz -xvpf package.tgz -C ./package</span><br></pre></td></tr></table></figure>

<blockquote>
<p>pigz 是支持并行的 gzip，默认用当前逻辑 cpu 个数来并发压缩，无法检测个数的话，则并发 8 个线程。</p>
</blockquote>
<p>另一种方式：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 语法</span></span><br><span class="line">$ tar -cvpf - <span class="variable">$Dir</span> | pigz -9 -p 6 <span class="variable">$target</span>-name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例</span></span><br><span class="line">$ tar -cvpf - /usr/bin | pigz -9 -p 6 bin.tgz</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-9：代表压缩率<br>-p ：代表 cpu 数量</p>
</blockquote>
<h2 id="time"><a href="#time" class="headerlink" title="time"></a>time</h2><p>用于检测特定指令执行时所需消耗的时间及系统资源 (内存和 I/O) 等资讯。</p>
<h3 id="语法-11"><a href="#语法-11" class="headerlink" title="语法"></a>语法</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time [options] COMMAND [arguments]</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-11"><a href="#参数说明-11" class="headerlink" title="参数说明"></a>参数说明</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-o | --output=FILE</span><br><span class="line">			设定结果输出档。这个选项会将time的输出写入所指定的档案中。如果档案已经存在，系统将覆写其内容。</span><br><span class="line">		</span><br><span class="line">-a | --append</span><br><span class="line">			配合-o使用，会将结果写到档案的末端，而不会覆盖掉原来的内容。</span><br><span class="line">			</span><br><span class="line">-f FORMAT | --format=FORMAT</span><br><span class="line">			以FORMAT字串设定显示方式。当这个选项没有被设定的时候，会用系统预设的格式。不过你可以用环境变数time来设定这个格式，如此一来就不必每次登入系统都要设定一次。</span><br></pre></td></tr></table></figure>

<h3 id="实例-11"><a href="#实例-11" class="headerlink" title="实例"></a>实例</h3><ul>
<li>date 命令的运行时间</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ time date</span><br><span class="line">Tue Dec 22 12:01:50 CST 2020</span><br><span class="line">date  0.00s user 0.01s system 8% cpu 0.092 total</span><br></pre></td></tr></table></figure>

<ul>
<li>查找文件并复制的运行时间</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ time find /home/lin/share/storage_server_3/patent/application/unzip_version-1.0/2019 -iname <span class="string">&quot;*.xml&quot;</span> | xargs -P 6 -i cp &#123;&#125; /home/lin/share/storage_server_3/patent/application-patent/patent_version-1.0/2019 </span><br><span class="line">find  -iname <span class="string">&quot;*.xml&quot;</span>  24.00s user 114.39s system 1% cpu 2:08:02.95 total</span><br><span class="line">xargs -P 6 -i cp &#123;&#125;   4.35s user 28.35s system 0% cpu 2:08:02.99 total</span><br></pre></td></tr></table></figure>

<p><strong>参考：</strong></p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/linux/time.html">http://c.biancheng.net/linux/time.html</a></p>
<h2 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h2><h3 id="语法-12"><a href="#语法-12" class="headerlink" title="语法"></a>语法</h3><h3 id="参数说明-12"><a href="#参数说明-12" class="headerlink" title="参数说明"></a>参数说明</h3><h3 id="实例-12"><a href="#实例-12" class="headerlink" title="实例"></a>实例</h3><ul>
<li>创建多级目录</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p Project/a/src</span><br></pre></td></tr></table></figure>

<ul>
<li>创建多层次、多维度的目录树</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p Project/&#123;a,b,c,d&#125;/src</span><br></pre></td></tr></table></figure>

<h2 id="sh-c"><a href="#sh-c" class="headerlink" title="sh -c"></a>sh -c</h2><p>sh -c 命令，可以让 bash 将一个字串作为完整的命令来执行。</p>
<p>比如，向 test.asc 文件中随便写入点内容，可以：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;信息&quot;</span> &gt; test.asc</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;信息&quot;</span> &gt;&gt; test.asc</span><br></pre></td></tr></table></figure>

<p>下面，如果将 test.asc 权限设置为只有 root 用户才有权限进行写操作：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo chown root.root test.asc</span><br></pre></td></tr></table></figure>

<p>然后，我们使用 sudo 并配合 echo 命令再次向修改权限之后的 test.asc 文件中写入信息：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">echo</span> <span class="string">&quot;又一行信息&quot;</span> &gt;&gt; test.asc</span><br><span class="line">-bash: test.asc: Permission denied</span><br></pre></td></tr></table></figure>

<p>这时，可以看到 bash 拒绝这么做，说是权限不够。这是因为重定向符号 &gt; 和 &gt;&gt; 也是 bash 的命令。我们使用 sudo 只是让 echo 命令具有了 root 权限，但是没有让 &gt; 和 &gt;&gt; 命令也具有 root 权限，所以 bash 会认为这两个命令都没有向 test.asc 文件写入信息的权限。解决这一问题的途径有两种。</p>
<p>第一种是利用 sh -c 命令，它可以让 bash 将一个字串作为完整的命令来执行，这样就可以将 sudo 的影响范围扩展到整条命令。具体用法如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">&#x27;echo &quot;又一行信息&quot; &gt;&gt; test.asc&#x27;</span></span><br></pre></td></tr></table></figure>

<p>另一种方法是利用管道和 tee 命令，该命令可以从标准输入中读入信息并将其写入标准输出或文件中，具体用法如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;第三条信息&quot;</span> | sudo tee -a test.asc</span><br></pre></td></tr></table></figure>

<p>注意，tee 命令的 -a 选项的作用等同于 &gt;&gt; 命令，如果去除该选项，那么 tee 命令的作用就等同于 &gt; 命令。 </p>
<h2 id="1-gt-dev-null-2-gt-amp-1"><a href="#1-gt-dev-null-2-gt-amp-1" class="headerlink" title="1&gt;/dev/null 2&gt;&amp;1"></a>1&gt;/dev/null 2&gt;&amp;1</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ithomer/article/details/9288353">https://blog.csdn.net/ithomer/article/details/9288353</a></p>
<h2 id="top"><a href="#top" class="headerlink" title="top"></a>top</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e9e0ce23a152">https://www.jianshu.com/p/e9e0ce23a152</a></p>
<p>PID：进程的ID</p>
<p>   USER：进程所有者</p>
<p>​    PR：进程的优先级别，越小越优先被执行</p>
<p>​    NI：进程Nice值，代表这个进程的优先值</p>
<p>​    VIRT：进程占用的虚拟内存</p>
<p>​    RES：进程占用的物理内存</p>
<p>​    SHR：进程使用的共享内存</p>
<p>   S：进程的状态。S表示休眠，R表示正在运行，Z表示僵死状态</p>
<p>​    %CPU：进程占用CPU的使用</p>
<p>​    %MEM：进程使用的物理内存和总内存的百分</p>
<p>​    TIME+：该进程启动后占用的总的CPU时间，即占用CPU使用时间的累加值</p>
<p>​    COMMAND：启动该进程的命令名称</p>
<h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>free   用KB为单位展示数据</p>
<p>free -m   用MB为单位展示数据</p>
<p>free -h   用GB为单位展示数据</p>
<p>total : 总计屋里内存的大小</p>
<p>used : 已使用内存的大小</p>
<p>free : 可用内存的大小</p>
<p>shared : 多个进程共享的内存总额</p>
<p>buff/cache : 磁盘缓存大小</p>
<p>available : 可用内存大小 ， 从应用程序的角度来说：available = free + buff/cache .</p>
<h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><h2 id="md5sum"><a href="#md5sum" class="headerlink" title="md5sum"></a>md5sum</h2><h2 id="sha1sum"><a href="#sha1sum" class="headerlink" title="sha1sum"></a>sha1sum</h2><p>用来为给定的文件或文件夹计算单个哈希，以校验文件或文件夹的完整性。</p>
<p>给文件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sha1sum patent-grant-2005.tar.gz </span><br><span class="line">77b6416501d34b904bd25f9aa32ca60d3e14659a  patent-grant-2005.tar.gz</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://www.itranslater.com/qa/details/2326085750774825984">https://www.itranslater.com/qa/details/2326085750774825984</a></p>
<h2 id="parallel"><a href="#parallel" class="headerlink" title="parallel"></a>parallel</h2><p><a target="_blank" rel="noopener" href="https://linux.cn/article-9718-1.html">https://linux.cn/article-9718-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.myfreax.com/gnu-parallel/">https://www.myfreax.com/gnu-parallel/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.hi-linux.com/posts/32794.html">https://www.hi-linux.com/posts/32794.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c5a2369fa613">https://www.jianshu.com/p/c5a2369fa613</a></p>
<p><a target="_blank" rel="noopener" href="https://www.aqee.net/post/use-multiple-cpu-cores-with-your-linux-commands.html">https://www.aqee.net/post/use-multiple-cpu-cores-with-your-linux-commands.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/orangefly0214/article/details/103701600">https://blog.csdn.net/orangefly0214/article/details/103701600</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/14/java-io-close/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/14/java-io-close/" class="post-title-link" itemprop="url">Java 关闭 IO 流</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-14 21:54:17" itemprop="dateCreated datePublished" datetime="2020-12-14T21:54:17+08:00">2020-12-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-09 16:00:50" itemprop="dateModified" datetime="2021-04-09T16:00:50+08:00">2021-04-09</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在操作 java 流对象后要将流关闭，但实际编写代码时，可能会出现一些误区，导致不能正确关闭流。</p>
<h2 id="在-try-中关流，而没在-finally-中关流"><a href="#在-try-中关流，而没在-finally-中关流" class="headerlink" title="在 try 中关流，而没在 finally 中关流"></a>在 try 中关流，而没在 finally 中关流</h2><p>错误：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	OutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="comment">// ...操作流代码</span></span><br><span class="line">	out.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修正：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">OutputStream out = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="comment">// ...操作流代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">			out.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在一个-try-中关闭多个流"><a href="#在一个-try-中关闭多个流" class="headerlink" title="在一个 try 中关闭多个流"></a>在一个 try 中关闭多个流</h2><p>错误：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">OutputStream out = <span class="keyword">null</span>;</span><br><span class="line">OutputStream out2 = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	out2 = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="comment">// ...操作流代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">			out.close();<span class="comment">// 如果此处出现异常，则out2流没有被关闭</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (out2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">			out2.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修正：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">OutputStream out = <span class="keyword">null</span>;</span><br><span class="line">OutputStream out2 = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	out2 = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="comment">// ...操作流代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">			out.close();<span class="comment">// 如果此处出现异常，则out2流也会被关闭</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (out2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">			out2.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在循环中创建流，在循环外关闭，导致关闭的是最后一个流"><a href="#在循环中创建流，在循环外关闭，导致关闭的是最后一个流" class="headerlink" title="在循环中创建流，在循环外关闭，导致关闭的是最后一个流"></a>在循环中创建流，在循环外关闭，导致关闭的是最后一个流</h2><p>错误：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">OutputStream out = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">		out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		<span class="comment">// ...操作流代码</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">			out.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修正：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">	OutputStream out = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		<span class="comment">// ...操作流代码</span></span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">				out.close();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在-java-7-中，关闭流的方式得到很大的简化"><a href="#在-java-7-中，关闭流的方式得到很大的简化" class="headerlink" title="在 java 7 中，关闭流的方式得到很大的简化"></a>在 java 7 中，关闭流的方式得到很大的简化</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (OutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">	<span class="comment">// ...操作流代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要实现的自动关闭接口 (Closeable) 的类都可以在 try 结构体上定义，java 会自动帮我们关闭，即使在发生异常的情况下也会。</p>
<p>可以在 try 结构体上定义多个，用分号隔开即可，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (OutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">     OutputStream out2 = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">	<span class="comment">// ...操作流代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">	<span class="keyword">throw</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Android SDK 20 版本对应 java 7，低于 20 版本无法使用 <code>try-catch-resources</code> 自动关流。</p>
</blockquote>
<h2 id="内存流的关闭"><a href="#内存流的关闭" class="headerlink" title="内存流的关闭"></a>内存流的关闭</h2><p>内存流可以不用关闭。</p>
<p>ByteArrayOutputStream 和 ByteArrayInputStream 其实是伪装成流的字节数组 (把它们当成字节数据来看就好了)，他们不会锁定任何文件句柄和端口，如果不再被使用，字节数组会被垃圾回收掉，所以不需要关闭。</p>
<h2 id="装饰流的关闭"><a href="#装饰流的关闭" class="headerlink" title="装饰流的关闭"></a>装饰流的关闭</h2><p>装饰流是指通过装饰模式实现的 java 流，又称为包装流，装饰流只是为原生流附加额外的功能或效果，java 中的缓冲流、桥接流也是属于装饰流。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;C:\\Users\\tang\\Desktop\\test.txt&quot;</span>);</span><br><span class="line">InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(is);</span><br><span class="line">BufferedReader br = <span class="keyword">new</span> BufferedReader(isr);</span><br><span class="line">String string = br.readLine();</span><br><span class="line">System.out.println(string);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只需要关闭最后的br即可</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    br.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>装饰流关闭时会调用原生流关闭。</p>
<p>BufferedReader.java 源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (in == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 这里的in就是原生流</span></span><br><span class="line">            in.close();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            in = <span class="keyword">null</span>;</span><br><span class="line">            cb = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>InputStreamReader.java 源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 这里的sd就是原生流的解码器(StreamDecoder)，解码器的close会调用原生流的close</span></span><br><span class="line">    sd.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上所示，有这样层层关闭的机制，我们就只需要关闭最外层的流就行了。</p>
<h2 id="关闭流的顺序问题"><a href="#关闭流的顺序问题" class="headerlink" title="关闭流的顺序问题"></a>关闭流的顺序问题</h2><p>两个不相干的流的关闭顺序没有任何影响，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的out1和out2谁先关谁后关都一样，没有任何影响</span></span><br><span class="line">out1 = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br><span class="line">out2 = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>如果两个流有依赖关系，那么可以像上面说的，只关闭最外层的即可。</p>
<p>如果不嫌麻烦，非得一个个关闭，那么需要先关闭最里层，从里往外一层层进行关闭。</p>
<p>为什么不能从外层往里层逐步关闭？原因上面讲装饰流已经讲的很清楚了，关闭外层时，内层的流其实已经同时关闭了，你再去关内层的流，就会报错。</p>
<p>至于网上说的先声明先关闭，就是这个道理，先声明的是内层，最先申明的是最内层，最后声明的是最外层。</p>
<h2 id="一定要关闭流的原因"><a href="#一定要关闭流的原因" class="headerlink" title="一定要关闭流的原因"></a>一定要关闭流的原因</h2><p>一个流绑定了一个文件句柄 (或网络端口)，如果流不关闭，该文件 (或端口) 将始终处于被锁定 (不能读取、写入、删除和重命名) 状态，占用大量系统资源却没有释放。</p>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012643122/article/details/38540721">https://blog.csdn.net/u012643122/article/details/38540721</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/27/java-io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/27/java-io/" class="post-title-link" itemprop="url">Java 的 IO 流</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-27 11:33:09" itemprop="dateCreated datePublished" datetime="2020-11-27T11:33:09+08:00">2020-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-13 15:21:31" itemprop="dateModified" datetime="2021-04-13T15:21:31+08:00">2021-04-13</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>61k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>55 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="File-类"><a href="#File-类" class="headerlink" title="File 类"></a>File 类</h2><ul>
<li><p><code>java.io.File</code> 类：文件和文件目录路径的抽象表示形式，与平台无关。</p>
<ul>
<li> File 主要表示类似 <code>D:\\文件目录1</code> 与 <code>D:\\文件目录1\\文件.txt</code>，前者是文件夹 (directory)，后者则是文件 (file)，而 File 类就是操作这两者的类。</li>
</ul>
</li>
<li><p><strong>File 能新建、删除、重命名文件和目录，但 File 不能访问文件内容本身。如果需要访问文件内容本身，则需要使用输入/输出流。</strong></p>
<ul>
<li>File 跟流无关，File 类不能对文件进行读和写也就是输入和输出。</li>
</ul>
</li>
<li><p>想要在 Java 程序中表示一个真实存在的文件或目录，那么必须有一个 File 对象，但是 <strong>Java 程序中的一个 File 对象，可能不对应一个真实存在的文件或目录。</strong></p>
<img src="/2020/11/27/java-io/image-20210330104549637.png" alt="image-20210330104549637" style="zoom:67%;">
</li>
<li><p> File 对象可以作为参数传递给流的构造器，指明读取或写入的 “终点”。</p>
</li>
<li><p>在 Java 中，一切皆是对象，File 类也不例外，不论是哪个对象都应该从该对象的构造方法说起：</p>
<p><img src="/2020/11/27/java-io/image-20210409152135199.png" alt="image-20210409152135199"></p>
</li>
<li><p><code>public File(String pathname)</code> ：以 pathname 为路径创建 File 对象，可以是绝对路径或者相对路径，如果 pathname 是相对路径，则默认的当前路径在系统属性 user.dir 中存储。</p>
<ul>
<li><p>绝对路径：是一个固定的路径，从盘符开始。</p>
</li>
<li><p>相对路径：是相对于某个位置开始。</p>
</li>
<li><p>IDEA 中的路径说明，<code>main()</code> 和 Test 中，相对路径不一样：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);<span class="comment">// 相较于当前工程</span></span><br><span class="line">        System.out.println(file.getAbsolutePath());<span class="comment">// D:\JetBrainsWorkSpace\IDEAProjects\xisun-projects\hello.txt</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);<span class="comment">// 相较于当前Module</span></span><br><span class="line">        System.out.println(file.getAbsolutePath());<span class="comment">// D:\JetBrainsWorkSpace\IDEAProjects\xisun-projects\xisun-java_base\hello.txt</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>public File(String parent, String child)</code> ：以 parent 为父路径，child 为子路径创建 File 对象。</p>
</li>
<li><p><code>public File(File parent, String child)</code> ：根据一个父 File 对象和子文件路径创建 File 对象。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过文件路径名 </span></span><br><span class="line">String path1 = <span class="string">&quot;D:\\123.txt&quot;</span>;</span><br><span class="line">File file1 = <span class="keyword">new</span> File(path1); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过文件路径名</span></span><br><span class="line">String path2 = <span class="string">&quot;D:\\1\\2.txt&quot;</span>;</span><br><span class="line">File file2 = <span class="keyword">new</span> File(path2);     -------------相当于d:\\<span class="number">1</span>\\<span class="number">2.</span>txt</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过父路径和子路径字符串</span></span><br><span class="line"> String parent = <span class="string">&quot;F:\\aaa&quot;</span>;</span><br><span class="line"> String child = <span class="string">&quot;bbb.txt&quot;</span>;</span><br><span class="line"> File file3 = <span class="keyword">new</span> File(parent, child);  --------相当于f:\\aaa\\bbb.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过父级File对象和子路径字符串</span></span><br><span class="line">File parentDir = <span class="keyword">new</span> File(<span class="string">&quot;F:\\aaa&quot;</span>);</span><br><span class="line">String child = <span class="string">&quot;bbb.txt&quot;</span>;</span><br><span class="line">File file4 = <span class="keyword">new</span> File(parentDir, child); --------相当于f:\\aaa\\bbb.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>路径分隔符：</strong></p>
<ul>
<li><p>路径中的每级目录之间用一个路径分隔符隔开。</p>
</li>
<li><p>路径分隔符和系统有关：</p>
<ul>
<li>windows 和 DOS 系统默认使用 “\“ 来表示。</li>
<li>UNIX 和 URL 使用 “/“ 来表示。</li>
</ul>
</li>
<li><p>Java 程序支持跨平台运行，因此路径分隔符要慎用。为了解决这个隐患，File 类提供了一个常量 <code>public static final String separator</code>，能够根据操作系统，动态的提供分隔符。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">File file1 = <span class="keyword">new</span> File(<span class="string">&quot;d:\\test\\info.txt&quot;</span>);</span><br><span class="line">File file2 = <span class="keyword">new</span> File(<span class="string">&quot;d:/test/info.txt&quot;</span>);</span><br><span class="line">File file3 = <span class="keyword">new</span> File(<span class="string">&quot;d:&quot;</span> + File.separator + <span class="string">&quot;test&quot;</span> + File.separator + <span class="string">&quot;info.txt&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>获取功能的方法：</p>
<ul>
<li><p><strong><code>public String getAbsolutePath()</code>：获取绝对路径。</strong></p>
</li>
<li><p><code>public String getPath()</code>：获取路径。</p>
</li>
<li><p><code>public String getName()</code>：获取名称。</p>
</li>
<li><p><code>public String getParent()</code>：获取上层文件目录路径。若无，返回 null。</p>
</li>
<li><p><code>public long length()</code>：获取文件长度，即：字节数。不能获取目录的长度。</p>
</li>
<li><p><code>public long lastModified()</code>：获取最后一次的修改时间，毫秒值。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        File file2 = <span class="keyword">new</span> File(<span class="string">&quot;d:\\io\\hi.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(file1.getAbsolutePath());</span><br><span class="line">        System.out.println(file1.getPath());</span><br><span class="line">        System.out.println(file1.getName());</span><br><span class="line">        System.out.println(file1.getParent());</span><br><span class="line">        System.out.println(file1.length());</span><br><span class="line">        System.out.println(<span class="keyword">new</span> Date(file1.lastModified()));</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        System.out.println(file2.getAbsolutePath());</span><br><span class="line">        System.out.println(file2.getPath());</span><br><span class="line">        System.out.println(file2.getName());</span><br><span class="line">        System.out.println(file2.getParent());</span><br><span class="line">        System.out.println(file2.length());</span><br><span class="line">        System.out.println(file2.lastModified());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>public String[] list()</code>：获取指定目录下的所有文件或者文件目录的名称数组，如果指定目录不存在，返回 null。</strong></p>
</li>
<li><p><strong><code>public File[] listFiles()</code>：获取指定目录下的所有文件或者文件目录的 File 数组，如果指定目录不存在，返回 null。</strong></p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;D:\\workspace_idea1\\JavaSenior&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String[] list = file.list();</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="keyword">if</span> (list != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        File[] files = file.listFiles();</span><br><span class="line">        System.out.println(files);</span><br><span class="line">        <span class="keyword">if</span> (files != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                System.out.println(f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>public String[] list(FilenameFilter filter)</code>：指定文件过滤器。</p>
</li>
<li><p><code>public File[] listFiles(FilenameFilter filter)</code>：指定文件过滤器。</p>
</li>
<li><p><code>public File[] listFiles(FileFilter filter)</code>：指定文件过滤器。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File srcFile = <span class="keyword">new</span> File(<span class="string">&quot;d:\\code&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String[] subFiles1 = srcFile.list(<span class="keyword">new</span> FilenameFilter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> name.endsWith(<span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (subFiles1 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String fileName : subFiles1) &#123;</span><br><span class="line">                System.out.println(fileName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File[] subFiles2 = srcFile.listFiles(<span class="keyword">new</span> FilenameFilter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> name.endsWith(<span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (subFiles2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File file : subFiles2) &#123;</span><br><span class="line">                System.out.println(file.getAbsolutePath());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File[] subFiles3 = srcFile.listFiles(<span class="keyword">new</span> FileFilter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File pathname)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> pathname.getName().endsWith(<span class="string">&quot;.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (subFiles3 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File file : subFiles3) &#123;</span><br><span class="line">                System.out.println(file.getAbsolutePath());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>重命名功能的方法</p>
<ul>
<li><p><code>public boolean renameTo(File dest)</code>：把文件重命名为指定的文件路径。以 <code>file1.renameTo(file2)</code> 为例：要想保证返回 true，需要 file1 在硬盘中是存在的，且 file2 在硬盘中不能存在。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        File file2 = <span class="keyword">new</span> File(<span class="string">&quot;D:\\io\\hi.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> renameTo = file2.renameTo(file1);</span><br><span class="line">        System.out.println(renameTo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>判断功能的方法</p>
<ul>
<li><p><strong><code>public boolean exists()</code>：判断是否存在。</strong></p>
</li>
<li><p><strong><code>public boolean isDirectory()</code>：判断是否是文件目录。</strong> </p>
</li>
<li><p><strong><code>public boolean isFile()</code>：判断是否是文件。</strong></p>
</li>
<li><p><code>public boolean canRead()</code>：判断是否可读。</p>
</li>
<li><p><code>public boolean canWrite()</code>：判断是否可写。</p>
</li>
<li><p><code>public boolean isHidden()</code>：判断是否隐藏。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        file1 = <span class="keyword">new</span> File(<span class="string">&quot;hello1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(file1.isDirectory());</span><br><span class="line">        System.out.println(file1.isFile());</span><br><span class="line">        System.out.println(file1.exists());</span><br><span class="line">        System.out.println(file1.canRead());</span><br><span class="line">        System.out.println(file1.canWrite());</span><br><span class="line">        System.out.println(file1.isHidden());</span><br><span class="line"></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        File file2 = <span class="keyword">new</span> File(<span class="string">&quot;d:\\io&quot;</span>);</span><br><span class="line">        file2 = <span class="keyword">new</span> File(<span class="string">&quot;d:\\io1&quot;</span>);</span><br><span class="line">        System.out.println(file2.isDirectory());</span><br><span class="line">        System.out.println(file2.isFile());</span><br><span class="line">        System.out.println(file2.exists());</span><br><span class="line">        System.out.println(file2.canRead());</span><br><span class="line">        System.out.println(file2.canWrite());</span><br><span class="line">        System.out.println(file2.isHidden());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>创建功能的方法</p>
<ul>
<li><p><strong><code>public boolean createNewFile()</code>：创建文件。若文件不存在，则创建一个新的空文件并返回 true；若文件存在，则不创建文件并返回 false。</strong></p>
</li>
<li><p><code>public boolean mkdir()</code>：创建文件目录。如果此文件目录存在，则不创建；如果此文件目录的上层目录不存在，也不创建。</p>
</li>
<li><p><code>public boolean mkdirs()</code>：创建文件目录。如果上层文件目录不存在，也一并创建。</p>
</li>
<li><p><strong>如果创建文件或者文件目录时，没有写盘符路径，那么，默认在项目路径下。</strong></p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File file1 = <span class="keyword">new</span> File(<span class="string">&quot;hi.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!file1.exists()) &#123;</span><br><span class="line">            <span class="comment">// 文件不存在</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">boolean</span> newFile = file1.createNewFile();</span><br><span class="line">                System.out.println(<span class="string">&quot;创建成功？&quot;</span> + newFile);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                exception.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 文件存在</span></span><br><span class="line">            <span class="keyword">boolean</span> delete = file1.delete();</span><br><span class="line">            System.out.println(<span class="string">&quot;删除成功？&quot;</span> + delete);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>删除功能的方法</p>
<ul>
<li><p><strong><code>public boolean delete()</code>：删除文件或者文件夹。</strong></p>
</li>
<li><p><strong>Java 中的删除不走回收站。要删除一个文件目录，请注意该文件目录内不能包含文件或者文件目录，即只能删除空的文件目录。</strong></p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 文件目录的创建</span></span><br><span class="line">        File file1 = <span class="keyword">new</span> File(<span class="string">&quot;d:\\io\\io1\\io3&quot;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> mkdir = file1.mkdir();</span><br><span class="line">        <span class="keyword">if</span> (mkdir) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;创建成功1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File file2 = <span class="keyword">new</span> File(<span class="string">&quot;d:\\io\\io1\\io4&quot;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> mkdir1 = file2.mkdirs();</span><br><span class="line">        <span class="keyword">if</span> (mkdir1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;创建成功2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 要想删除成功，io4文件目录下不能有子目录或文件</span></span><br><span class="line">        File file3 = <span class="keyword">new</span> File(<span class="string">&quot;D:\\io\\io1\\io4&quot;</span>);</span><br><span class="line">        file3 = <span class="keyword">new</span> File(<span class="string">&quot;D:\\io\\io1&quot;</span>);</span><br><span class="line">        System.out.println(file3.delete());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>递归遍历文件夹下所有文件以及子文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 递归:文件目录</span></span><br><span class="line">        <span class="comment">/** 打印出指定目录所有文件名称，包括子文件目录中的文件 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建目录对象</span></span><br><span class="line">        File dir = <span class="keyword">new</span> File(<span class="string">&quot;E:\\teach\\01_javaSE\\_尚硅谷Java编程语言\\3_软件&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.打印目录的子文件</span></span><br><span class="line">        printSubFile(dir);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式一：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printSubFile</span><span class="params">(File dir)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断传入的是否是目录</span></span><br><span class="line">        <span class="keyword">if</span> (!dir.isDirectory()) &#123;</span><br><span class="line">            <span class="comment">// 不是目录直接退出</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印目录的子文件</span></span><br><span class="line">        File[] subfiles = dir.listFiles();</span><br><span class="line">        <span class="keyword">if</span> (subfiles != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (File f : subfiles) &#123;</span><br><span class="line">                <span class="keyword">if</span> (f.isDirectory()) &#123;</span><br><span class="line">                    <span class="comment">// 文件目录</span></span><br><span class="line">                    printSubFile(f);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 文件</span></span><br><span class="line">                    System.out.println(f.getAbsolutePath());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式二：循环实现</span></span><br><span class="line">    <span class="comment">// 列出file目录的下级内容，仅列出一级的话，使用File类的String[] list()比较简单</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listSubFiles</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">            String[] all = file.list();</span><br><span class="line">            <span class="keyword">if</span> (all != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (String s : all) &#123;</span><br><span class="line">                    System.out.println(s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(file + <span class="string">&quot;是文件！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式三：列出file目录的下级，如果它的下级还是目录，接着列出下级的下级，依次类推</span></span><br><span class="line">    <span class="comment">// 建议使用File类的File[] listFiles()</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listAllSubFiles</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">            System.out.println(file);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            File[] all = file.listFiles();</span><br><span class="line">            <span class="comment">// 如果all[i]是文件，直接打印</span></span><br><span class="line">            <span class="comment">// 如果all[i]是目录，接着再获取它的下一级</span></span><br><span class="line">            <span class="keyword">if</span> (all != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (File f : all) &#123;</span><br><span class="line">                    <span class="comment">// 递归调用：自己调用自己就叫递归</span></span><br><span class="line">                    listAllSubFiles(f);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拓展1：计算指定目录所在空间的大小</span></span><br><span class="line">    <span class="comment">// 求任意一个目录的总大小</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDirectorySize</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// file是文件，那么直接返回file.length()</span></span><br><span class="line">        <span class="comment">// file是目录，把它的下一级的所有大小加起来就是它的总大小</span></span><br><span class="line">        <span class="keyword">long</span> size = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">            size += file.length();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 获取file的下一级</span></span><br><span class="line">            File[] all = file.listFiles();</span><br><span class="line">            <span class="keyword">if</span> (all != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 累加all[i]的大小</span></span><br><span class="line">                <span class="keyword">for</span> (File f : all) &#123;</span><br><span class="line">                    <span class="comment">// f的大小</span></span><br><span class="line">                    size += getDirectorySize(f);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拓展2：删除指定文件目录及其下的所有文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteDirectory</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果file是文件，直接delete</span></span><br><span class="line">        <span class="comment">// 如果file是目录，先把它的下一级干掉，然后删除自己</span></span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">            File[] all = file.listFiles();</span><br><span class="line">            <span class="comment">// 循环删除的是file的下一级</span></span><br><span class="line">            <span class="keyword">if</span> (all != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// f代表file的每一个下级</span></span><br><span class="line">                <span class="keyword">for</span> (File f : all) &#123;</span><br><span class="line">                    deleteDirectory(f);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 删除自己</span></span><br><span class="line">        file.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h2><ul>
<li><p><strong>字符集</strong> <code>Charset</code>：也叫<strong>编码表</strong>。是一个系统支持的所有字符的集合，包括各国家文字、标点符号、图形符号、数字等。</p>
</li>
<li><p>编码表的由来：计算机只能识别二进制数据，早期由来是电信号。为了方便应用计算机，让它可以识别各个国家的文字。就将各个国家的文字用数字来表示，并一一对应，形成一张表。这就是编码表。</p>
<img src="/2020/11/27/java-io/image-20210401173432112.png" alt="image-20210401173432112" style="zoom:67%;">
</li>
<li><p>常见的编码表：</p>
<ul>
<li><p>ASCII：美国标准信息交换码。用一个字节的 7 位可以表示。</p>
</li>
<li><p>ISO8859-1：拉丁码表，欧洲码表。用一个字节的 8 位表示。</p>
</li>
<li><p>GB2312：中国的中文编码表。最多两个字节编码所有字符。</p>
</li>
<li><p>GBK：中国的中文编码表升级，融合了更多的中文文字符号。最多两个字节编码。</p>
</li>
<li><p>Unicode：国际标准码，融合了目前人类使用的所有字符。为每个字符分配唯一的字符码。所有的文字都用两个字节来表示。</p>
</li>
<li><p>UTF-8：变长的编码方式，可用 1 ~ 4 个字节来表示一个字符。</p>
<img src="/2020/11/27/java-io/image-20210404191338053.png" alt="image-20210404191338053" style="zoom:67%;">
</li>
</ul>
</li>
<li><p>在 Unicode 出现之前，所有的字符集都是和具体编码方案绑定在一起的，即字符集 ≈ 编码方式，都是直接将字符和最终字节流绑定死了。</p>
</li>
<li><p>GBK 等双字节编码方式，用最高位是 1 或 0 表示两个字节和一个字节。</p>
</li>
<li><p>Unicode 不完美，这里就有三个问题，一个是，我们已经知道，英文字母只用一个字节表示就够了，第二个问题是如何才能区别 Unicode 和 ASCII，计算机怎么知道是两个字节表示一个符号，而不是分别表示两个符号呢？第三个，如果和 GBK 等双字节编码方式一样，用最高位是 1 或 0 表示两个字节和一个字节，就少了很多值无法用于表示字符，不够表示所有字符。Unicode 在很长一段时间内无法推广，直到互联网的出现。</p>
</li>
<li><p>面向传输的众多 UTF (UCS Transfer Format) 标准出现了，顾名思义，UTF-8 就是每次 8 个位传输数据，而 UTF-16 就是每次 16 个位。这是为传输而设计的编码，并使编码无国界，这样就可以显示全世界上所有文化的字符了。</p>
</li>
<li><p>Unicode 只是定义了一个庞大的、全球通用的字符集，并为每个字符规定了唯一确定的编号，具体存储成什么样的字节流，取决于字符编码方案。推荐的 Unicode 编码是 UTF-8 和 UTF-16。</p>
<img src="/2020/11/27/java-io/image-20210401205524825.png" alt="image-20210401205524825" style="zoom: 67%;">

<img src="/2020/11/27/java-io/image-20210401210058680.png" alt="image-20210401210058680" style="zoom:67%;">
</li>
<li><p>计算机中储存的信息都是用二进制数表示的，而能在屏幕上看到的数字、英文、标点符号、汉字等字符是二进制数转换之后的结果。按照某种规则，将字符存储到计算机中，称为<strong>编码</strong> 。反之，将存储在计算机中的二进制数按照某种规则解析显示出来，称为<strong>解码</strong> 。</p>
<ul>
<li><strong>编码规则和解码规则要对应，否则会导致乱码。</strong>比如说，按照 A 规则存储，同样按照 A 规则解析，那么就能显示正确的文本符号。反之，按照 A 规则存储，再按照 B 规则解析，就会导致乱码现象。</li>
</ul>
</li>
<li><p>编码： 字符串 —&gt; 字节数组。(能看懂的 —&gt; 看不懂的)</p>
</li>
<li><p>解码： 字节数组 —&gt; 字符串。(看不懂的 —&gt; 能看懂的)</p>
</li>
<li><p>启示：客户端/浏览器端   &lt;——&gt;   后台 (Java，GO，Python，Node.js，php…)   &lt;——&gt;   数据库，<strong>要求前前后后使用的字符集要统一，都使用 UTF-8</strong>，这样才不会乱码。</p>
</li>
</ul>
<h2 id="IO-流原理"><a href="#IO-流原理" class="headerlink" title="IO 流原理"></a>IO 流原理</h2><ul>
<li><p>I/O 是 Input/Output 的缩写， I/O 技术是非常实用的技术，<strong>用于处理设备之间的数据传输。</strong>如读/写文件，网络通讯等。</p>
</li>
<li><p>Java 程序中，对于数据的输入/输出操作<strong>以 “流 (stream)” 的方式进行。</strong></p>
</li>
<li><p><code>java.io</code> 包下提供了各种 “流” 类和接口，用以获取不同种类的数据，并<strong>通过标准的方法输入或输出数据。</strong></p>
</li>
<li><p>输入 input：读取外部数据 (磁盘、光盘等存储设备的数据) 到程序 (内存) 中。</p>
</li>
<li><p>输出 output：将程序 (内存) 数据输出到磁盘、光盘等外部存储设备中。</p>
<img src="/2020/11/27/java-io/image-20210330203154529.png" alt="image-20210330203154529" style="zoom:67%;">

</li>
</ul>
<h2 id="IO-流的分类"><a href="#IO-流的分类" class="headerlink" title="IO 流的分类"></a>IO 流的分类</h2><img src="/2020/11/27/java-io/image-20210330213653653.png" alt="image-20210330213653653" style="zoom:67%;">

<ul>
<li><p>按操作<strong>数据单位</strong>不同分为：字节流 (8 bit)，字符流 (16 bit)。</p>
<ul>
<li>字节流：以字节为单位，读写数据的流。</li>
<li>字符流：以字符为单位，读写数据的流。</li>
</ul>
</li>
<li><p>按数据流的<strong>流向</strong>不同分为：输入流，输出流。</p>
<ul>
<li>输入流：把数据从其他设备上读取到内存中的流。</li>
<li>输出流：把数据从内存中写出到其他设备上的流。</li>
</ul>
</li>
<li><p>按流的<strong>角色</strong>的不同分为：节点流，处理流。</p>
<ul>
<li><p>节点流：直接从数据源或目的地读写数据。也叫文件流。</p>
<img src="/2020/11/27/java-io/image-20210330215602183.png" alt="image-20210330215602183" style="zoom:67%;">
</li>
<li><p>处理流：不直接连接到数据源或目的地，而是连接在已存在的流 (节点流或处理流) 之上，通过对数据的处理为程序提供更为强大的读写功能。</p>
<img src="/2020/11/27/java-io/image-20210330220211998.png" alt="image-20210330220211998" style="zoom: 67%;">
</li>
</ul>
</li>
<li><p>Java 的 IO 流共涉及 40 多个类，实际上非常规则，都是从如下四个抽象基类派生的。同时，由这四个类派生出来的子类名称都是以其父类名作为子类名后缀：</p>
<img src="/2020/11/27/java-io/image-20210330213507408.png" alt="image-20210330213507408" style="zoom:67%;">
</li>
<li><p>IO 流体系：</p>
<img src="/2020/11/27/java-io/image-20210330214731163.png" alt="image-20210330214731163" style="zoom: 80%;">

</li>
</ul>
<h2 id="四个抽象基类"><a href="#四个抽象基类" class="headerlink" title="四个抽象基类"></a>四个抽象基类</h2><p><strong>InputStream &amp; Reader：</strong></p>
<ul>
<li>InputStream 和 Reader 是所有输入流的基类。</li>
<li>InputStream 的典型实现：FileInputStream。<ul>
<li><code>int read()</code></li>
<li><code>int read(byte[] b)</code></li>
<li><code>int read(byte[] b, int off, int len)</code></li>
</ul>
</li>
<li>Reader 的典型实现：FileReader。<ul>
<li><code>int read()</code></li>
<li><code>int read(char [] c)</code></li>
<li><code>int read(char [] c, int off, int len)</code></li>
</ul>
</li>
<li>程序中打开的文件 IO 资源不属于内存里的资源，垃圾回收机制无法回收该资源，所以应该显式关闭文件 IO 资源。</li>
<li>FileInputStream 从文件系统中的某个文件中获得输入字节。FileInputStream 用于读取非文本数据之类的原始字节流。如果要读取文本数据的字符流，需要使用 FileReader。</li>
</ul>
<p><strong>InputStream：</strong></p>
<ul>
<li><code>int read()</code>：从输入流中读取数据的下一个字节。返回 0 到 255 范围内的 int 字节值。如果因为已经到达流末尾而没有可用的字节，则返回值 -1。</li>
<li><code>int read(byte[] b)</code>：从输入流中将最多 <code>b.length()</code> 个字节的数据读入一个 byte 数组中。以整数形式返回实际读取的字节数。如果因为已经到达流末尾而没有可用的字节，则返回值 -1。</li>
<li><code>int read(byte[] b, int off,int len)</code>：将输入流中最多 len 个数据字节读入 byte 数组。尝试读取 len 个字节，但读取的字节也可能小于该值。以整数形式返回实际读取的字节数。如果因为已经到达流末尾而没有可用的字节，则返回值 -1。</li>
<li><code>public void close() throws IOException</code>：关闭输入流并释放与该流关联的所有系统资源。</li>
</ul>
<p><strong>Reader：</strong></p>
<ul>
<li><code>int read()</code>：读取单个字符。作为整数读取的字符，范围在 0 到 65535 之间 (0x00-0xffff) (2 个字节的 Unicode 码)，如果已到达流的末尾，则返回 -1。</li>
<li><code>int read(char[] cbuf)</code>：将字符读入数组。如果已到达流的末尾，则返回 -1。否则返回本次读取的字符数。</li>
<li><code>int read(char[] cbuf,int off,int len)</code>：将字符读入数组的某一部分。存到数组 cbuf 中，从 off 处开始存储，最多读 len 个字符。如果已到达流的末尾，则返回 -1。否则返回本次读取的字符数。</li>
<li><code>public void close() throws IOException</code>：关闭此输入流并释放与该流关联的所有系统资源。</li>
</ul>
<p><strong>OutputStream &amp; Writer：</strong></p>
<ul>
<li>OutputStream 和 Writer 是所有输入流的基类。</li>
<li>OutputStream 的典型实现：FileOutStream。<ul>
<li><code>void write(int b)</code></li>
<li><code>void write(byte[] b)</code></li>
<li><code>void write(byte[] b, int off, int len)</code></li>
<li><code>public void flush() throws IOException</code></li>
<li><code>public void close() throws IOException</code></li>
</ul>
</li>
<li>Writer 的典型实现：FileWriter。<ul>
<li><code>void write(int c)</code></li>
<li><code>void write(char[] cbuf)</code></li>
<li><code>void write(char[] buff, int off, int len)</code></li>
<li><code>public void flush() throws IOException</code></li>
<li><code>public void close() throws IOException</code></li>
</ul>
</li>
<li>因为字符流直接以字符作为操作单位，所以 Writer 还可以用字符串来替换字符数组，即以 String 对象作为参数。<ul>
<li><code>void write(String str)</code></li>
<li><code>void write(String str, int off, int len)</code></li>
</ul>
</li>
<li>FileOutputStream 从文件系统中的某个文件中获得输出字节。FileOutputStream 用于写出非文本数据之类的原始字节流。如果要要写出文本数据的字符流，需要使用 FileWriter。</li>
</ul>
<p><strong>OutputStream：</strong></p>
<ul>
<li><code>void write(int b)</code>：将指定的字节写入此输出流。write 的常规协定是：向输出流写入一个字节。要写入的字节是参数 b 的八个低位。b 的 24 个高位将被忽略，即写入 0 ~ 255 范围的。</li>
<li><code>void write(byte[] b)</code>：将 <code>b.length()</code> 个字节从指定的 byte 数组写入此输出流。<code>write(b)</code> 的常规协定是：应该与调用 <code>write(b, 0, b.length)</code> 的效果完全相同。</li>
<li><code>void write(byte[] b,int off,int len)</code>：将指定 byte 数组中从偏移量 off 开始的 len 个字节写入此输出流。</li>
<li><code>public void flush() throws IOException</code>：刷新此输出流并强制写出所有缓冲的输出字节，调用此方法指示应将这些字节立即写入它们预期的目标。</li>
<li><code>public void close() throws IOException</code>：关闭此输出流并释放与该流关联的所有系统资源。</li>
</ul>
<p><strong>Writer：</strong></p>
<ul>
<li><code>void write(int c)</code>：写入单个字符。要写入的字符包含在给定整数值的 16 个低位中，16 高位被忽略。 即写入0 到 65535 之间的 Unicode 码。</li>
<li><code>void write(char[] cbuf)</code>：写入字符数组。</li>
<li><code>void write(char[] cbuf,int off,int len)</code>：写入字符数组的某一部分。从 off 开始，写入 len 个字符。</li>
<li><code>void write(String str)</code>：写入字符串。</li>
<li><code>void write(String str,int off,int len)</code>：写入字符串的某一部分。</li>
<li><code>public void flush() throws IOException</code>：刷新该流的缓冲，则立即将它们写入预期目标。</li>
<li><code>public void close() throws IOException</code>：关闭此输出流并释放与该流关联的所有系统资源。</li>
</ul>
<h2 id="节点流-或文件流"><a href="#节点流-或文件流" class="headerlink" title="节点流 (或文件流)"></a>节点流 (或文件流)</h2><ul>
<li><p>读取文件流程：</p>
<ul>
<li>实例化 File 类的对象，指明要操作的文件。</li>
<li>提供具体的流对象。</li>
<li>数据的读入。</li>
<li>流的关闭操作。</li>
</ul>
</li>
<li><p>写入文件流程：</p>
<ul>
<li>实例化 File 类的对象，指明写出到的文件。</li>
<li>提供具体的流对象。</li>
<li>数据的写入。</li>
<li>流的关闭操作。</li>
</ul>
</li>
<li><p>定义文件路径时，可以用 / 或者 \。</p>
</li>
<li><p>在写入一个文件时，如果使用构造器 <code>FileOutputStream(file)</code>，则目录下有同名文件将被覆盖。</p>
</li>
<li><p>如果使用构造器 <code>FileOutputStream(file,true)</code>，则目录下的同名文件不会被覆盖，而是在文件内容末尾追加内容。</p>
</li>
<li><p><strong>在读取文件时，必须保证该文件已存在，否则报异常。</strong></p>
</li>
<li><p><strong>对于非文本文件 (.jpg，.mp3，.mp4，.avi，.rmvb，.doc，.ppt 等)，使用字节流处理。如果使用字节流操作文本文件，在输出到控制台时，可能会出现乱码。</strong></p>
<ul>
<li>如果只是将文本文件复制到其他地方，也可以使用字节流。</li>
</ul>
</li>
<li><p><strong>对于文本文件 (.txt，.java，.c，.cpp 等)，使用字符流处理。</strong></p>
</li>
<li><p><strong>FileReader 和 FileWriter 操作的实例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一、流的分类：</span></span><br><span class="line"><span class="comment"> * 1.操作数据单位：字节流、字符流</span></span><br><span class="line"><span class="comment"> * 2.数据的流向：输入流、输出流</span></span><br><span class="line"><span class="comment"> * 3.流的角色：节点流、处理流</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 二、流的体系结构</span></span><br><span class="line"><span class="comment"> * 抽象基类       节点流（或文件流）                                缓冲流（处理流的一种）</span></span><br><span class="line"><span class="comment"> * InputStream   FileInputStream   (read(byte[] buffer))        BufferedInputStream (read(byte[] buffer))</span></span><br><span class="line"><span class="comment"> * OutputStream  FileOutputStream  (write(byte[] buffer,0,len)  BufferedOutputStream (write(byte[] buffer,0,len)/flush()</span></span><br><span class="line"><span class="comment"> * Reader        FileReader (read(char[] cbuf))                 BufferedReader (read(char[] cbuf)/readLine())</span></span><br><span class="line"><span class="comment"> * Writer        FileWriter (write(char[] cbuf,0,len)           BufferedWriter (write(char[] cbuf,0,len)/flush()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileReaderWriterTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    将当前Module下的hello.txt文件内容读入程序中，并输出到控制台</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    说明点：</span></span><br><span class="line"><span class="comment">    1. read()的理解：返回读入的一个字符。如果达到文件末尾，返回-1</span></span><br><span class="line"><span class="comment">    2. 异常的处理：为了保证流资源一定可以执行关闭操作。需要使用try-catch-finally处理</span></span><br><span class="line"><span class="comment">    3. 读入的文件一定要存在，否则就会报FileNotFoundException。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// read(): 返回读入的一个字符。如果达到文件末尾，返回-1</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileReader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileReader fr = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.实例化File类的对象，指明要操作的文件</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);<span class="comment">// 相较于当前Module</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.提供具体的流</span></span><br><span class="line">            fr = <span class="keyword">new</span> FileReader(file);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.数据的读入</span></span><br><span class="line">            <span class="comment">// 方式一：</span></span><br><span class="line">            <span class="comment">/*int data = fr.read();</span></span><br><span class="line"><span class="comment">            while (data != -1) &#123;</span></span><br><span class="line"><span class="comment">                System.out.print((char) data);</span></span><br><span class="line"><span class="comment">                data = fr.read();</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            <span class="comment">// 方式二：语法上针对于方式一的修改</span></span><br><span class="line">            <span class="keyword">int</span> data;</span><br><span class="line">            <span class="keyword">while</span> ((data = fr.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.print((<span class="keyword">char</span>) data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.流的关闭操作</span></span><br><span class="line">            <span class="comment">// 方式一：</span></span><br><span class="line">            <span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">                if (fr != null)</span></span><br><span class="line"><span class="comment">                    fr.close();</span></span><br><span class="line"><span class="comment">            &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            <span class="comment">// 方式二：</span></span><br><span class="line">            <span class="keyword">if</span> (fr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fr.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对read()操作升级：使用read的重载方法read(char[] cbuf)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileReader1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileReader fr = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.File类的实例化</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.FileReader流的实例化</span></span><br><span class="line">            fr = <span class="keyword">new</span> FileReader(file);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.读入的操作</span></span><br><span class="line">            <span class="comment">// read(char[] cbuf)：返回每次读入cbuf数组中的字符的个数。如果达到文件末尾，返回-1</span></span><br><span class="line">            <span class="keyword">char</span>[] cbuf = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">5</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fr.read(cbuf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 方式一：</span></span><br><span class="line">                <span class="comment">// 错误的写法，如果以cubf的length为基准，可能会造成多输出内容</span></span><br><span class="line">                <span class="comment">/*for (int i = 0; i &lt; cbuf.length; i++) &#123;</span></span><br><span class="line"><span class="comment">                    System.out.print(cbuf[i]);</span></span><br><span class="line"><span class="comment">                &#125;*/</span></span><br><span class="line">                <span class="comment">// 正确的写法</span></span><br><span class="line">                <span class="comment">/*for (int i = 0; i &lt; len; i++) &#123;</span></span><br><span class="line"><span class="comment">                    System.out.print(cbuf[i]);</span></span><br><span class="line"><span class="comment">                &#125;*/</span></span><br><span class="line">                <span class="comment">//方式二：</span></span><br><span class="line">                <span class="comment">// 错误的写法，对应着方式一的错误的写法</span></span><br><span class="line">                <span class="comment">/*String str = new String(cbuf);</span></span><br><span class="line"><span class="comment">                System.out.print(str);*/</span></span><br><span class="line">                <span class="comment">// 正确的写法，对应着方式一的正确的写法</span></span><br><span class="line">                String str = <span class="keyword">new</span> String(cbuf, <span class="number">0</span>, len);</span><br><span class="line">                System.out.print(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 4.资源的关闭</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fr.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    从内存中写出数据到硬盘的文件里。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    说明：</span></span><br><span class="line"><span class="comment">    1. 输出操作，对应的File可以不存在的。并不会报异常</span></span><br><span class="line"><span class="comment">    2.</span></span><br><span class="line"><span class="comment">         File对应的硬盘中的文件如果不存在，在输出的过程中，会自动创建此文件。</span></span><br><span class="line"><span class="comment">         File对应的硬盘中的文件如果存在：</span></span><br><span class="line"><span class="comment">                如果流使用的构造器是：FileWriter(file,false) / FileWriter(file)---&gt;对原有文件的覆盖</span></span><br><span class="line"><span class="comment">                如果流使用的构造器是：FileWriter(file,true)---&gt;不会对原有文件覆盖，而是在原有文件基础上追加内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileWriter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileWriter fw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.提供File类的对象，指明写出到的文件</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;hello1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.提供FileWriter的对象，用于数据的写出</span></span><br><span class="line">            fw = <span class="keyword">new</span> FileWriter(file, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.写出的操作</span></span><br><span class="line">            fw.write(<span class="string">&quot;I have a dream!\n&quot;</span>);</span><br><span class="line">            fw.write(<span class="string">&quot;you need to have a dream!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.流资源的关闭</span></span><br><span class="line">            <span class="keyword">if</span> (fw != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fw.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    实现对已存在文件的复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileReaderFileWriter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileReader fr = <span class="keyword">null</span>;</span><br><span class="line">        FileWriter fw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.创建File类的对象，指明读入和写出的文件</span></span><br><span class="line">            File srcFile = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">            File destFile = <span class="keyword">new</span> File(<span class="string">&quot;hello2.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 不能使用字符流来处理图片等字节数据</span></span><br><span class="line">            <span class="comment">/*File srcFile = new File(&quot;爱情与友情.jpg&quot;);</span></span><br><span class="line"><span class="comment">            File destFile = new File(&quot;爱情与友情1.jpg&quot;);*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.创建输入流和输出流的对象</span></span><br><span class="line">            fr = <span class="keyword">new</span> FileReader(srcFile);</span><br><span class="line">            fw = <span class="keyword">new</span> FileWriter(destFile);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.数据的读入和写出操作</span></span><br><span class="line">            <span class="keyword">char</span>[] cbuf = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">5</span>];</span><br><span class="line">            <span class="comment">// 记录每次读入到cbuf数组中的字符的个数</span></span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fr.read(cbuf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 每次写出len个字符</span></span><br><span class="line">                fw.write(cbuf, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.关闭流资源</span></span><br><span class="line">            <span class="comment">// 方式一：</span></span><br><span class="line">            <span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">                if (fw != null)</span></span><br><span class="line"><span class="comment">                    fw.close();</span></span><br><span class="line"><span class="comment">            &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="comment">                e.printStackTrace();</span></span><br><span class="line"><span class="comment">            &#125; finally &#123;</span></span><br><span class="line"><span class="comment">                try &#123;</span></span><br><span class="line"><span class="comment">                    if (fr != null)</span></span><br><span class="line"><span class="comment">                        fr.close();</span></span><br><span class="line"><span class="comment">                &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="comment">                    e.printStackTrace();</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line">            <span class="comment">// 方式二：</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fw != <span class="keyword">null</span>)</span><br><span class="line">                    fw.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fr != <span class="keyword">null</span>)</span><br><span class="line">                    fr.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>FileInputStream 和 FileOutputStream 操作的实例：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试FileInputStream和FileOutputStream的使用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 结论：</span></span><br><span class="line"><span class="comment"> * 1. 对于文本文件(.txt,.java,.c,.cpp)，使用字符流处理</span></span><br><span class="line"><span class="comment"> * 2. 对于非文本文件(.jpg,.mp3,.mp4,.avi,.doc,.ppt,...)，使用字节流处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInputOutputStreamTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用字节流FileInputStream处理文本文件，可能出现乱码。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileInputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 造文件</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.造流</span></span><br><span class="line">            fis = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.读数据</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">5</span>];</span><br><span class="line">            <span class="comment">// 记录每次读取的字节的个数</span></span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                String str = <span class="keyword">new</span> String(buffer, <span class="number">0</span>, len);</span><br><span class="line">                System.out.print(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 4.关闭资源</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    实现对图片的复制操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileInputOutputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.获取文件</span></span><br><span class="line">            File srcFile = <span class="keyword">new</span> File(<span class="string">&quot;爱情与友情.jpg&quot;</span>);</span><br><span class="line">            File destFile = <span class="keyword">new</span> File(<span class="string">&quot;爱情与友情2.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.获取流</span></span><br><span class="line">            fis = <span class="keyword">new</span> FileInputStream(srcFile);</span><br><span class="line">            fos = <span class="keyword">new</span> FileOutputStream(destFile);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.复制的过程</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">5</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    指定路径下文件的复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyFile</span><span class="params">(String srcPath, String destPath)</span> </span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.获取文件</span></span><br><span class="line">            File srcFile = <span class="keyword">new</span> File(srcPath);</span><br><span class="line">            File destFile = <span class="keyword">new</span> File(destPath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.获取流</span></span><br><span class="line">            fis = <span class="keyword">new</span> FileInputStream(srcFile);</span><br><span class="line">            fos = <span class="keyword">new</span> FileOutputStream(destFile);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.复制的过程</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCopyFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        String srcPath = <span class="string">&quot;C:\\Users\\Administrator\\Desktop\\01-视频.avi&quot;</span>;</span><br><span class="line">        String destPath = <span class="string">&quot;C:\\Users\\Administrator\\Desktop\\02-视频.avi&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*String srcPath = &quot;hello.txt&quot;;</span></span><br><span class="line"><span class="comment">        String destPath = &quot;hello3.txt&quot;;*/</span></span><br><span class="line"></span><br><span class="line">        copyFile(srcPath, destPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;复制操作花费的时间为：&quot;</span> + (end - start));<span class="comment">// 618</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="处理流之一：缓冲流"><a href="#处理流之一：缓冲流" class="headerlink" title="处理流之一：缓冲流"></a>处理流之一：缓冲流</h2><ul>
<li><p>为了提高数据读写的速度，Java API 提供了带缓冲功能的流类，在使用这些流类时，会创建一个内部缓冲区数组，缺省使用 8192 个字节 (8Kb) 的缓冲区。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedInputStream</span> <span class="keyword">extends</span> <span class="title">FilterInputStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> DEFAULT_BUFFER_SIZE = <span class="number">8192</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedReader</span> <span class="keyword">extends</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> defaultCharBufferSize = <span class="number">8192</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedWriter</span> <span class="keyword">extends</span> <span class="title">Writer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> defaultCharBufferSize = <span class="number">8192</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>缓冲流要 “套接” 在相应的节点流之上，根据数据操作单位可以把缓冲流分为：</strong></p>
<ul>
<li><strong>BufferedInputStream 和 和 BufferedOutputStream</strong><ul>
<li><code>public BufferedInputStream(InputStream in)</code> ：创建一个新的缓冲输入流，注意参数类型为 <strong>InputStream</strong>。</li>
<li><code>public BufferedOutputStream(OutputStream out)</code>： 创建一个新的缓冲输出流，注意参数类型为 <strong>OutputStream</strong>。</li>
</ul>
</li>
<li><strong>BufferedReader 和 BufferedWriter</strong><ul>
<li><code>public BufferedReader(Reader in)</code> ：创建一个新的缓冲输入流，注意参数类型为 <strong>Reader</strong>。</li>
<li><code>public BufferedWriter(Writer out)</code>： 创建一个新的缓冲输出流，注意参数类型为 <strong>Writer</strong>。</li>
</ul>
</li>
</ul>
</li>
<li><p>当读取数据时，数据按块读入缓冲区，其后的读操作则直接访问缓冲区。</p>
</li>
<li><p>当使用 BufferedInputStream 读取字节文件时，BufferedInputStream 会一次性从文件中读取 8192 个字节 (8Kb) 存在缓冲区中，直到缓冲区装满了，才重新从文件中读取下一个 8192 个字节数组。</p>
</li>
<li><p>向流中写入字节时，不会直接写到文件，先写到缓冲区中直到缓冲区写满，BufferedOutputStream 才会把缓冲区中的数据一次性写到文件里。使用 <code>flush()</code> 可以强制将缓冲区的内容全部写入输出流。</p>
<ul>
<li><code>flush()</code> 的使用：手动将 buffer 中内容写入文件。</li>
<li>如果使用带缓冲区的流对象的 <code>close()</code>，不但会关闭流，还会在关闭流之前刷新缓冲区，但关闭流后不能再写出。</li>
</ul>
</li>
<li><p><strong>关闭流的顺序和打开流的顺序相反。一般只需关闭最外层流即可，关闭最外层流也会相应关闭内层节点流。</strong></p>
</li>
<li><p>流程示意图：</p>
<img src="/2020/11/27/java-io/image-20210401141017522.png" alt="image-20210401141017522" style="zoom:67%;">
</li>
<li><p>实现非文本文件及文本文件的复制：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理流之一：缓冲流的使用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1.缓冲流：</span></span><br><span class="line"><span class="comment"> * BufferedInputStream</span></span><br><span class="line"><span class="comment"> * BufferedOutputStream</span></span><br><span class="line"><span class="comment"> * BufferedReader</span></span><br><span class="line"><span class="comment"> * BufferedWriter</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2.作用：提高流的读取、写入的速度</span></span><br><span class="line"><span class="comment"> *   提高读写速度的原因：内部提供了一个缓冲区</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3. 处理流，就是&quot;套接&quot;在已有的流的基础上。(不一定必须是套接在节点流之上)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedStreamTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用BufferedInputStream和BufferedOutputStream实现非文本文件的复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BufferedStreamTest</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">        BufferedInputStream bis = <span class="keyword">null</span>;</span><br><span class="line">        BufferedOutputStream bos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造文件</span></span><br><span class="line">            File srcFile = <span class="keyword">new</span> File(<span class="string">&quot;爱情与友情.jpg&quot;</span>);</span><br><span class="line">            File destFile = <span class="keyword">new</span> File(<span class="string">&quot;爱情与友情3.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.造流</span></span><br><span class="line">            <span class="comment">// 2.1 造节点流</span></span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream((srcFile));</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(destFile);</span><br><span class="line">            <span class="comment">// 2.2 造缓冲流</span></span><br><span class="line">            bis = <span class="keyword">new</span> BufferedInputStream(fis);</span><br><span class="line">            bos = <span class="keyword">new</span> BufferedOutputStream(fos);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.复制的细节：读取、写入</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = bis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">                <span class="comment">// bos.flush();// 显示的刷新缓冲区，一般不需要</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.资源关闭</span></span><br><span class="line">            <span class="comment">// 要求：先关闭外层的流，再关闭内层的流</span></span><br><span class="line">            <span class="keyword">if</span> (bos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (bis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 说明：关闭外层流的同时，内层流也会自动的进行关闭。关于内层流的关闭，我们可以省略.</span></span><br><span class="line">            <span class="comment">// fos.close();</span></span><br><span class="line">            <span class="comment">// fis.close();</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用BufferedInputStream和BufferedOutputStream实现文件复制的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyFileWithBuffered</span><span class="params">(String srcPath, String destPath)</span> </span>&#123;</span><br><span class="line">        BufferedInputStream bis = <span class="keyword">null</span>;</span><br><span class="line">        BufferedOutputStream bos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造文件</span></span><br><span class="line">            File srcFile = <span class="keyword">new</span> File(srcPath);</span><br><span class="line">            File destFile = <span class="keyword">new</span> File(destPath);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.造流</span></span><br><span class="line">            <span class="comment">// 2.1 造节点流</span></span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream((srcFile));</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(destFile);</span><br><span class="line">            <span class="comment">// 2.2 造缓冲流</span></span><br><span class="line">            bis = <span class="keyword">new</span> BufferedInputStream(fis);</span><br><span class="line">            bos = <span class="keyword">new</span> BufferedOutputStream(fos);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.复制的细节：读取、写入</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = bis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.资源关闭</span></span><br><span class="line">            <span class="comment">// 要求：先关闭外层的流，再关闭内层的流</span></span><br><span class="line">            <span class="keyword">if</span> (bos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (bis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 说明：关闭外层流的同时，内层流也会自动的进行关闭。关于内层流的关闭，我们可以省略.</span></span><br><span class="line">            <span class="comment">// fos.close();</span></span><br><span class="line">            <span class="comment">// fis.close();</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCopyFileWithBuffered</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        String srcPath = <span class="string">&quot;C:\\Users\\Administrator\\Desktop\\01-视频.avi&quot;</span>;</span><br><span class="line">        String destPath = <span class="string">&quot;C:\\Users\\Administrator\\Desktop\\03-视频.avi&quot;</span>;</span><br><span class="line"></span><br><span class="line">        copyFileWithBuffered(srcPath, destPath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;复制操作花费的时间为：&quot;</span> + (end - start));<span class="comment">//618 - 176</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用BufferedReader和BufferedWriter实现文本文件的复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBufferedReaderBufferedWriter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">        BufferedWriter bw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.创建文件和相应的流</span></span><br><span class="line">            br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="keyword">new</span> File(<span class="string">&quot;dbcp.txt&quot;</span>)));</span><br><span class="line">            bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">&quot;dbcp1.txt&quot;</span>)));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.读写操作</span></span><br><span class="line">            <span class="comment">// 方式一：使用char[]数组</span></span><br><span class="line">            <span class="comment">/*char[] cbuf = new char[1024];</span></span><br><span class="line"><span class="comment">            int len;</span></span><br><span class="line"><span class="comment">            while ((len = br.read(cbuf)) != -1) &#123;// 读到文件末尾时返回-1</span></span><br><span class="line"><span class="comment">                bw.write(cbuf, 0, len);</span></span><br><span class="line"><span class="comment">                // bw.flush();</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 方式二：使用String</span></span><br><span class="line">            String data;</span><br><span class="line">            <span class="keyword">while</span> ((data = br.readLine()) != <span class="keyword">null</span>) &#123;<span class="comment">// 读到文件末尾时返回null</span></span><br><span class="line">                <span class="comment">// 方法一：</span></span><br><span class="line">                <span class="comment">// bw.write(data + &quot;\n&quot;);// data中不包含换行符</span></span><br><span class="line">                <span class="comment">// 方法二：</span></span><br><span class="line">                bw.write(data);<span class="comment">// data中不包含换行符</span></span><br><span class="line">                bw.newLine();<span class="comment">// 提供换行的操作</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 3.关闭资源</span></span><br><span class="line">            <span class="keyword">if</span> (bw != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bw.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (br != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    br.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现图片加密：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageEncryption</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    图片的加密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;爱情与友情.jpg&quot;</span>);</span><br><span class="line">            fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;爱情与友情secret.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 加密：对字节数组进行修改，异或操作</span></span><br><span class="line">                <span class="comment">// 错误的写法，buffer数组中的数据没有改变，只是重新复制给了变量b</span></span><br><span class="line">                <span class="comment">/*for (byte b : buffer) &#123;</span></span><br><span class="line"><span class="comment">                    b = (byte) (b ^ 5);</span></span><br><span class="line"><span class="comment">                &#125;*/</span></span><br><span class="line">                <span class="comment">// 正确的写法</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                    buffer[i] = (<span class="keyword">byte</span>) (buffer[i] ^ <span class="number">5</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    图片的解密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line">        FileOutputStream fos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;爱情与友情secret.jpg&quot;</span>);</span><br><span class="line">            fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;爱情与友情4.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 解密：对字节数组进行修改，异或操作之后再异或，返回的是自己本身</span></span><br><span class="line">                <span class="comment">// 错误的写法</span></span><br><span class="line">                <span class="comment">/*for (byte b : buffer) &#123;</span></span><br><span class="line"><span class="comment">                    b = (byte) (b ^ 5);</span></span><br><span class="line"><span class="comment">                &#125;*/</span></span><br><span class="line">                <span class="comment">// 正确的写法</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">                    buffer[i] = (<span class="keyword">byte</span>) (buffer[i] ^ <span class="number">5</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                fos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取文本上每个字符出现的次数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    说明：如果使用单元测试，文件相对路径为当前module</span></span><br><span class="line"><span class="comment">          如果使用main()测试，文件相对路径为当前工程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWordCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileReader fr = <span class="keyword">null</span>;</span><br><span class="line">        BufferedWriter bw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.创建Map集合</span></span><br><span class="line">            Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;Character, Integer&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.遍历每一个字符，每一个字符出现的次数放到map中</span></span><br><span class="line">            fr = <span class="keyword">new</span> FileReader(<span class="string">&quot;dbcp.txt&quot;</span>);</span><br><span class="line">            <span class="keyword">int</span> c;</span><br><span class="line">            <span class="keyword">while</span> ((c = fr.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// int 还原 char</span></span><br><span class="line">                <span class="keyword">char</span> ch = (<span class="keyword">char</span>) c;</span><br><span class="line">                <span class="comment">// 判断char是否在map中第一次出现</span></span><br><span class="line">                <span class="keyword">if</span> (map.get(ch) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    map.put(ch, <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    map.put(ch, map.get(ch) + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.把map中数据存在文件count.txt</span></span><br><span class="line">            <span class="comment">// 3.1 创建Writer</span></span><br><span class="line">            bw = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> FileWriter(<span class="string">&quot;wordcount.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.2 遍历map，再写入数据</span></span><br><span class="line">            Set&lt;Map.Entry&lt;Character, Integer&gt;&gt; entrySet = map.entrySet();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;Character, Integer&gt; entry : entrySet) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (entry.getKey()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">                        bw.write(<span class="string">&quot;空格 = &quot;</span> + entry.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;\t&#x27;</span>:<span class="comment">//\t表示tab 键字符</span></span><br><span class="line">                        bw.write(<span class="string">&quot;tab键 = &quot;</span> + entry.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;\r&#x27;</span>:<span class="comment">//</span></span><br><span class="line">                        bw.write(<span class="string">&quot;回车 = &quot;</span> + entry.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&#x27;\n&#x27;</span>:<span class="comment">//</span></span><br><span class="line">                        bw.write(<span class="string">&quot;换行 = &quot;</span> + entry.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        bw.write(entry.getKey() + <span class="string">&quot; = &quot;</span> + entry.getValue());</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                bw.newLine();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 4.关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (fr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fr.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (bw != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    bw.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="处理流之二：转换流"><a href="#处理流之二：转换流" class="headerlink" title="处理流之二：转换流"></a>处理流之二：转换流</h2><ul>
<li><p>转换流提供了在字节流和字符流之间的转换。</p>
</li>
<li><p><strong>Java API 提供了两个转换流：</strong></p>
<ul>
<li><strong>InputStreamReader：将 InputStream 转换为 Reader。</strong><ul>
<li><code>InputStreamReader(InputStream in)</code>：创建一个使用默认字符集的字符流。</li>
<li><code>InputStreamReader(InputStream in, String charsetName)</code>：创建一个指定字符集的字符流。</li>
</ul>
</li>
<li><strong>OutputStreamWriter：将 Writer 转换为 OutputStream。</strong><ul>
<li><code>OutputStreamWriter(OutputStream in)</code>：创建一个使用默认字符集的字符流。</li>
<li><code>OutputStreamWriter(OutputStream in, String charsetName)</code>：创建一个指定字符集的字符流。</li>
</ul>
</li>
</ul>
</li>
<li><p>字节流中的数据都是字符时，转成字符流操作更高效。</p>
</li>
<li><p>很多时候我们使用转换流来处理文件乱码问题，实现编码和解码的功能。</p>
</li>
<li><p>InputStreamReader：</p>
<ul>
<li>实现将字节的输入流按指定字符集转换为字符的输入流。</li>
<li>需要和 InputStream 套接。</li>
<li>构造器<ul>
<li><code>public InputStreamReader(InputStream in)</code></li>
<li><code>public InputSreamReader(InputStream in,String charsetName)</code><ul>
<li>比如：<code>Reader isr = new InputStreamReader(System.in,&quot;gbk&quot;);</code>，指定字符集为 gbk。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>OutputStreamWriter：</p>
<ul>
<li>实现将字符的输出流按指定字符集转换为字节的输出流。</li>
<li>需要和 OutputStream 套接。</li>
<li>构造器<ul>
<li><code>public OutputStreamWriter(OutputStream out)</code></li>
<li><code>public OutputSreamWriter(OutputStream out,String charsetName)</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>使用 InputStreamReader 解码时，使用的字符集取决于 OutputStreamWriter 编码时使用的字符集。</strong></p>
</li>
<li><p>流程示意图：</p>
<img src="/2020/11/27/java-io/image-20210401155051887.png" alt="image-20210401155051887" style="zoom:67%;">

<img src="/2020/11/27/java-io/image-20210403214550709.png" alt="image-20210403214550709" style="zoom:67%;">
</li>
<li><p>转换流的编码应用：</p>
<ul>
<li>可以将字符按指定编码格式存储。</li>
<li>可以对文本数据按指定编码格式来解读。</li>
<li>指定编码表的动作由构造器完成。</li>
</ul>
</li>
<li><p>为了达到<strong>最高效率</strong>，可以考虑在 BufferedReader 内包装 InputStreamReader：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in))；</span><br></pre></td></tr></table></figure>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理流之二：转换流的使用</span></span><br><span class="line"><span class="comment"> * 1.转换流：属于字符流</span></span><br><span class="line"><span class="comment"> *   InputStreamReader：将一个字节的输入流转换为字符的输入流</span></span><br><span class="line"><span class="comment"> *   OutputStreamWriter：将一个字符的输出流转换为字节的输出流</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2.作用：提供字节流与字符流之间的转换</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3. 解码：字节、字节数组  ---&gt;字符数组、字符串</span></span><br><span class="line"><span class="comment"> *    编码：字符数组、字符串 ---&gt; 字节、字节数组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4.字符集</span></span><br><span class="line"><span class="comment"> * ASCII：美国标准信息交换码。</span></span><br><span class="line"><span class="comment"> *   用一个字节的7位可以表示。</span></span><br><span class="line"><span class="comment"> * ISO8859-1：拉丁码表。欧洲码表</span></span><br><span class="line"><span class="comment"> *   用一个字节的8位表示。</span></span><br><span class="line"><span class="comment"> * GB2312：中国的中文编码表。最多两个字节编码所有字符</span></span><br><span class="line"><span class="comment"> * GBK：中国的中文编码表升级，融合了更多的中文文字符号。最多两个字节编码</span></span><br><span class="line"><span class="comment"> * Unicode：国际标准码，融合了目前人类使用的所有字符。为每个字符分配唯一的字符码。所有的文字都用两个字节来表示。</span></span><br><span class="line"><span class="comment"> * UTF-8：变长的编码方式，可用1-4个字节来表示一个字符。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InputStreamReaderTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    此时处理异常的话，仍然应该使用try-catch-finally</span></span><br><span class="line"><span class="comment">    InputStreamReader的使用，实现字节的输入流到字符的输入流的转换</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        InputStreamReader isr = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;dbcp.txt&quot;</span>);</span><br><span class="line">            <span class="comment">// InputStreamReader isr = new InputStreamReader(fis);// 使用系统默认的字符集，如果在IDEA中，就是看IDEA设置的默认字符集</span></span><br><span class="line">            <span class="comment">// 参数2指明了字符集，具体使用哪个字符集，取决于文件dbcp.txt保存时使用的字符集</span></span><br><span class="line">            isr = <span class="keyword">new</span> InputStreamReader(fis, StandardCharsets.UTF_8);<span class="comment">// 指定字符集</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">char</span>[] cbuf = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = isr.read(cbuf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                String str = <span class="keyword">new</span> String(cbuf, <span class="number">0</span>, len);</span><br><span class="line">                System.out.print(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    isr.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    此时处理异常的话，仍然应该使用try-catch-finally</span></span><br><span class="line"><span class="comment">    综合使用InputStreamReader和OutputStreamWriter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        InputStreamReader isr = <span class="keyword">null</span>;</span><br><span class="line">        OutputStreamWriter osw = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造文件、造流</span></span><br><span class="line">            File file1 = <span class="keyword">new</span> File(<span class="string">&quot;dbcp.txt&quot;</span>);</span><br><span class="line">            File file2 = <span class="keyword">new</span> File(<span class="string">&quot;dbcp_gbk.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(file1);</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(file2);</span><br><span class="line"></span><br><span class="line">            isr = <span class="keyword">new</span> InputStreamReader(fis, StandardCharsets.UTF_8);</span><br><span class="line">            osw = <span class="keyword">new</span> OutputStreamWriter(fos, <span class="string">&quot;gbk&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.读写过程</span></span><br><span class="line">            <span class="keyword">char</span>[] cbuf = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">20</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = isr.read(cbuf)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                osw.write(cbuf, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 3.关闭资源</span></span><br><span class="line">            <span class="keyword">if</span> (isr != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    isr.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (osw != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    osw.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="处理流之三：标准输入、输出流"><a href="#处理流之三：标准输入、输出流" class="headerlink" title="处理流之三：标准输入、输出流"></a>处理流之三：标准输入、输出流</h2><ul>
<li><p><code>System.in</code> 和 <code>System.out</code> 分别代表了系统标准的输入和输出设备。</p>
</li>
<li><p>默认输入设备是：键盘，输出设备是：显示器。</p>
</li>
<li><p><code>System.in</code> 的类型是 InputStream。</p>
</li>
<li><p><code>System.out</code> 的类型是 PrintStream，其是 OutputStream 的子类 FilterOutputStream 的子类。</p>
</li>
<li><p>重定向：通过 System 类的 <code>setIn()</code> 和 <code>setOut()</code> 对默认设备进行改变。</p>
<ul>
<li><code>public static void setIn(InputStream in)</code></li>
<li><code>public static void setOut(PrintStream out)</code></li>
</ul>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherStreamTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     1.标准的输入、输出流</span></span><br><span class="line"><span class="comment">     1.1</span></span><br><span class="line"><span class="comment">     System.in: 标准的输入流，默认从键盘输入</span></span><br><span class="line"><span class="comment">     System.out: 标准的输出流，默认从控制台输出</span></span><br><span class="line"><span class="comment">     1.2</span></span><br><span class="line"><span class="comment">     System类的setIn(InputStream is) / setOut(PrintStream ps)方式重新指定输入和输出的流。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     1.3练习：</span></span><br><span class="line"><span class="comment">     从键盘输入字符串，要求将读取到的整行字符串转成大写输出。然后继续进行输入操作，</span></span><br><span class="line"><span class="comment">     直至当输入“e”或者“exit”时，退出程序。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     方法一：使用Scanner实现，调用next()返回一个字符串</span></span><br><span class="line"><span class="comment">     方法二：使用System.in实现。System.in  ---&gt;  转换流 ---&gt; BufferedReader的readLine()</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="comment">// IDEA的单元测试不支持从键盘输入，更改为main()</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStreamReader isr = <span class="keyword">new</span> InputStreamReader(System.in);</span><br><span class="line">            br = <span class="keyword">new</span> BufferedReader(isr);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;请输入字符串：&quot;</span>);</span><br><span class="line">                String data = br.readLine();</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;e&quot;</span>.equalsIgnoreCase(data) || <span class="string">&quot;exit&quot;</span>.equalsIgnoreCase(data)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;程序结束&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String upperCase = data.toUpperCase();</span><br><span class="line">                System.out.println(upperCase);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (br != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    br.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>模拟 Scanner：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyInput.java: Contain the methods for reading int, double, float, boolean, short, byte and</span></span><br><span class="line"><span class="comment"> * string values from the keyboard</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInput</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Read a string from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">readString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(System.in));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Declare and initialize the string</span></span><br><span class="line">        String string = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the string from the keyboard</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            string = br.readLine();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            System.out.println(ex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Return the string obtained from the keyboard</span></span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read an int value from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">readInt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.parseInt(readString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read a double value from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">readDouble</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Double.parseDouble(readString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read a byte value from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">readByte</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Byte.parseByte(readString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read a short value from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">readShort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Short.parseShort(readString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read a long value from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">readLong</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Long.parseLong(readString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Read a float value from the keyboard</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">readFloat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Float.parseFloat(readString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = readInt();</span><br><span class="line">        System.out.println(<span class="string">&quot;输出的数为：&quot;</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="处理流之四：打印流"><a href="#处理流之四：打印流" class="headerlink" title="处理流之四：打印流"></a>处理流之四：打印流</h2><ul>
<li><p><strong>实现将基本数据类型的数据格式转化为字符串输出。</strong></p>
</li>
<li><p><strong>打印流：PrintStream 和 PrintWriter。</strong></p>
<ul>
<li>提供了一系列重载的 <code>print()</code> 和 <code>println()</code>，用于多种数据类型的输出。</li>
<li>PrintStream 和 PrintWriter 的输出不会抛出 IOException 异常。</li>
<li>PrintStream 和 PrintWriter 有自动 flush 功能。</li>
<li>PrintStream 打印的所有字符都使用平台的默认字符编码转换为字节。在需要写入字符而不是写入字节的情况下，应该使用 PrintWriter 类。</li>
<li>System.out 返回的是 PrintStream 的实例。</li>
</ul>
</li>
<li><p>把标准输出流 (控制台输出) 改成文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherStreamTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    2. 打印流：PrintStream 和PrintWriter</span></span><br><span class="line"><span class="comment">    2.1 提供了一系列重载的print()和println()</span></span><br><span class="line"><span class="comment">    2.2 练习：将ASCII字符输出到自定义的外部文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        PrintStream ps = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">&quot;D:\\text.txt&quot;</span>));</span><br><span class="line">            <span class="comment">// 创建打印输出流，设置为自动刷新模式(写入换行符或字节 &#x27;\n&#x27; 时都会刷新输出缓冲区)</span></span><br><span class="line">            ps = <span class="keyword">new</span> PrintStream(fos, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">// 把标准输出流(控制台输出)改成输出到本地文件</span></span><br><span class="line">            <span class="keyword">if</span> (ps != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 如果不设置，下面的循环输出是在控制台</span></span><br><span class="line">                <span class="comment">// 设置之后，控制台不再输出，而是输出到D:\text.txt</span></span><br><span class="line">                System.setOut(ps);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 开始输出ASCII字符</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; i++) &#123;</span><br><span class="line">                System.out.print((<span class="keyword">char</span>) i);</span><br><span class="line">                <span class="keyword">if</span> (i % <span class="number">50</span> == <span class="number">0</span>) &#123;<span class="comment">// 每50个数据一行</span></span><br><span class="line">                    System.out.println();<span class="comment">// 换行</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ps != <span class="keyword">null</span>) &#123;</span><br><span class="line">                ps.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="处理流之五：数据流"><a href="#处理流之五：数据流" class="headerlink" title="处理流之五：数据流"></a>处理流之五：数据流</h2><ul>
<li><p><strong>为了方便地操作 Java 语言的基本数据类型和 String 类型的数据，可以使用数据流。(不能操作内存中的对象)</strong></p>
</li>
<li><p>数据流有两个类：分别用于读取和写出基本数据类型、String类的数据。</p>
<ul>
<li><strong>DataInputStream 和 DataOutputStream。</strong></li>
<li>分别套接在 InputStream 和 和 OutputStream 子类的流上。</li>
<li><strong>用 DataOutputStream 输出的文件需要用 DataInputStream 来读取。</strong></li>
<li><strong>DataInputStream 读取不同类型的数据的顺序，要与当初 DataOutputStream 写入文件时，保存的数据的顺序一致。</strong></li>
</ul>
</li>
<li><p>DataInputStream 中的方法：</p>
<ul>
<li><code>boolean readBoolean()</code>，<code>byte readByte()</code></li>
<li><code>char readChar()</code>，<code>float readFloat()</code></li>
<li><code>double readDouble()</code>，<code>short readShort()</code></li>
<li><code>long readLong()</code>，<code>int readInt()</code></li>
<li><code>String readUTF()</code>，<code>void readFully(byte[] b)</code></li>
</ul>
</li>
<li><p>DataOutputStream 中的方法：</p>
<ul>
<li>将上述的方法的 read 改为相应的 write 即可。</li>
</ul>
</li>
<li><p>将内存中的字符串、基本数据类型的变量写出到文件中，再读取到内存中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OtherStreamTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    3. 数据流</span></span><br><span class="line"><span class="comment">    3.1 DataInputStream 和 DataOutputStream</span></span><br><span class="line"><span class="comment">    3.2 作用：用于读取或写出基本数据类型的变量或字符串</span></span><br><span class="line"><span class="comment">    练习：将内存中的字符串、基本数据类型的变量写出到文件中。</span></span><br><span class="line"><span class="comment">    注意：处理异常的话，仍然应该使用try-catch-finally。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataOutputStream dos = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造流</span></span><br><span class="line">            dos = <span class="keyword">new</span> DataOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;data.txt&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2.写入操作</span></span><br><span class="line">            dos.writeUTF(<span class="string">&quot;刘建辰&quot;</span>);<span class="comment">// 写入String</span></span><br><span class="line">            dos.flush();<span class="comment">// 刷新操作，将内存中的数据立即写入文件，也可以在关闭流时自动刷新</span></span><br><span class="line">            dos.writeInt(<span class="number">23</span>);<span class="comment">// 写入int</span></span><br><span class="line">            dos.flush();</span><br><span class="line">            dos.writeBoolean(<span class="keyword">true</span>);<span class="comment">// 写入boolean</span></span><br><span class="line">            dos.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 3.关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (dos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    dos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    将文件中存储的基本数据类型变量和字符串读取到内存中，保存在变量中。</span></span><br><span class="line"><span class="comment">    注意点：读取不同类型的数据的顺序要与当初写入文件时，保存的数据的顺序一致！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DataInputStream dis = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造流</span></span><br><span class="line">            dis = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;data.txt&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2.读取操作</span></span><br><span class="line">            String name = dis.readUTF();<span class="comment">// 读取String</span></span><br><span class="line">            <span class="keyword">int</span> age = dis.readInt();<span class="comment">// 读取int</span></span><br><span class="line">            <span class="keyword">boolean</span> isMale = dis.readBoolean();<span class="comment">// 读取boolean</span></span><br><span class="line">            System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">            System.out.println(<span class="string">&quot;age = &quot;</span> + age);</span><br><span class="line">            System.out.println(<span class="string">&quot;isMale = &quot;</span> + isMale);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 3.关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (dis!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    dis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="处理流之六：对象流"><a href="#处理流之六：对象流" class="headerlink" title="处理流之六：对象流"></a>处理流之六：对象流</h2><ul>
<li><p><strong>ObjectInputStream 和 OjbectOutputSteam：用于存储和读取基本数据类型数据或对象的处理流。它的强大之处就是可以把 Java 中的对象写入到数据源中，也能把对象从数据源中还原回来。</strong></p>
<ul>
<li>一般情况下，会把对象转换为 Json 字符串，然后进行序列化和反序列化操作，而不是直接操作对象。</li>
</ul>
</li>
<li><p><strong>序列化：用 ObjectOutputStream 类保存基本类型数据或对象的机制。</strong></p>
</li>
<li><p><strong>反序列化：用 ObjectInputStream 类读取基本类型数据或对象的机制。</strong></p>
</li>
<li><p>ObjectOutputStream 和 ObjectInputStream <strong>不能序列化 static 和 transient 修饰的成员变量</strong>。</p>
<ul>
<li><p>在序列化一个类的对象时，如果类中含有 static 和 transient 修饰的成员变量，则在反序列化时，这些成员变量的值会变成默认值，而不是序列化时这个对象赋予的值。比如，Person 类含有一个 static 修饰的 String name 属性，序列化时，对象把 name 赋值为张三，在反序列化时，name 会变为 null</p>
<img src="/2020/11/27/java-io/image-20210402151454756.png" alt="image-20210402151454756" style="zoom:80%;">
</li>
</ul>
</li>
<li><p>对象序列化机制允许把内存中的 Java 对象转换成平台无关的二进制流 (序列化操作)，从而允许把这种二进制流持久地保存在磁盘上，或通过网络将这种二进制流传输到另一个网络节点。当其它程序获取了这种二进制流，就可以恢复成原来的 Java 对象 (反序列化操作)。</p>
</li>
<li><p>序列化的好处在于可将任何实现了 Serializable 接口的对象转化为<strong>字节数据</strong>，使其在保存和传输时可被还原。</p>
</li>
<li><p>序列化是 RMI (Remote Method Invoke – 远程方法调用) 过程的参数和返回值都必须实现的机制，而 RMI 是 JavaEE 的基础，因此序列化机制是 JavaEE 平台的基础。</p>
</li>
<li><p>如果需要让某个对象支持序列化机制，则必须让对象所属的类及其属性是可序列化的，为了让某个类是可序列化的，该类必须实现如下两个接口之一。否则，会抛出 NotSerializableException 异常。</p>
<ul>
<li><strong>Serializable</strong></li>
<li>Externalizable</li>
</ul>
</li>
<li><p>凡是实现 Serializable 接口的类都有一个表示序列化版本标识符的静态变量：</p>
<ul>
<li><strong><code>private static final long serialVersionUID;</code></strong></li>
<li>serialVersionUID 用来表明类的不同版本间的兼容性。 简言之，其目的是以序列化对象进行版本控制，有关各版本反序列化时是否兼容。</li>
<li>如果类没有显示定义这个静态常量，它的值是 Java 运行时环境根据类的内部细节自动生成的。此时，若类的实例变量做了修改，serialVersionUID 可能发生变化，则再对修改之前被序列化的类进行反序列化操作时，会操作失败。因此，<strong>建议显式声明 serialVersionUID。</strong><ul>
<li>在某些场合，希望类的不同版本对序列化兼容，因此需要确保类的不同版本具有相同的 serialVersionUID；在某些场合，不希望类的不同版本对序列化兼容，因此需要确保类的不同版本具有不同的 serialVersionUID。 </li>
<li>当序列化了一个类实例后，后续可能更改一个字段或添加一个字段。如果不设置 serialVersionUID，所做的任何更改都将导致无法反序化旧有实例，并在反序列化时抛出一个异常；如果你添加了 serialVersionUID，在反序列旧有实例时，新添加或更改的字段值将设为初始化值 (对象为 null，基本类型为相应的初始默认值)，字段被删除将不设置。 </li>
</ul>
</li>
</ul>
</li>
<li><p>简单来说，Java 的序列化机制是通过在运行时判断类的 serialVersionUID 来验证版本一致性的。在进行反序列化时，JVM 会把传来的字节流中的 serialVersionUID 与本地相应实体类的 serialVersionUID 进行比较，如果相同就认为是一致的，可以进行反序列化，否则就会出现序列化版本不一致的异常，即 InvalidCastException。</p>
</li>
<li><p><strong>若某个类实现了 Serializable 接口，该类的对象就是可序列化的：</strong></p>
<ul>
<li><strong>创建一个 ObjectOutputStream。</strong><ul>
<li><code>public ObjectOutputStream(OutputStream out)</code>： 创建一个指定 OutputStream 的 ObjectOutputStream。</li>
</ul>
</li>
<li><strong>调用 ObjectOutputStream 对象的 <code>writeObject(Object obj)</code> 输出可序列化对象。</strong></li>
<li><strong>注意写出一次，操作 <code>flush()</code> 一次。</strong></li>
</ul>
</li>
<li><p><strong>反序列化：</strong></p>
<ul>
<li><strong>创建一个 ObjectInputStream。</strong><ul>
<li><code>public ObjectInputStream(InputStream in)</code>： 创建一个指定 InputStream 的 ObjectInputStream。</li>
</ul>
</li>
<li><strong>调用 <code>readObject()</code> 读取流中的对象。</strong></li>
</ul>
</li>
<li><p><strong>强调：如果某个类的属性不是基本数据类型或 String 类型，而是另一个引用类型，那么这个引用类型必须是可序列化的，否则拥有该类型的 Field 的类也不能序列化。</strong></p>
<ul>
<li><strong>默认情况下，基本数据类型是可序列化的。String 实现了 Serializable 接口。</strong></li>
</ul>
</li>
<li><p>流程示意图：</p>
<img src="/2020/11/27/java-io/image-20210403215448069.png" alt="image-20210403215448069" style="zoom:67%;">
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Person需要满足如下的要求，方可序列化</span></span><br><span class="line"><span class="comment"> * 1.需要实现接口：Serializable</span></span><br><span class="line"><span class="comment"> * 2.当前类提供一个全局常量：serialVersionUID</span></span><br><span class="line"><span class="comment"> * 3.除了当前Person类需要实现Serializable接口之外，还必须保证其内部所有属性</span></span><br><span class="line"><span class="comment"> *   也必须是可序列化的。（默认情况下，基本数据类型可序列化）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 补充：ObjectOutputStream和ObjectInputStream不能序列化static和transient修饰的成员变量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">475463534532L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> Account acct;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">int</span> id, Account acct)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.acct = acct;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, acct=&quot;</span> + acct +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">4754534532L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Account&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;balance=&quot;</span> + balance +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getBalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBalance</span><span class="params">(<span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象流的使用</span></span><br><span class="line"><span class="comment"> * 1.ObjectInputStream 和 ObjectOutputStream</span></span><br><span class="line"><span class="comment"> * 2.作用：用于存储和读取基本数据类型数据或对象的处理流。它的强大之处就是可以把Java中的对象写入到数据源中，也能把对象从数据源中还原回来。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3.要想一个java对象是可序列化的，需要满足相应的要求。见Person.java</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4.序列化机制：</span></span><br><span class="line"><span class="comment"> * 对象序列化机制允许把内存中的Java对象转换成平台无关的二进制流，从而允许把这种</span></span><br><span class="line"><span class="comment"> * 二进制流持久地保存在磁盘上，或通过网络将这种二进制流传输到另一个网络节点。</span></span><br><span class="line"><span class="comment"> * 当其它程序获取了这种二进制流，就可以恢复成原来的Java对象。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObjectInputOutputStreamTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    序列化过程：将内存中的java对象保存到磁盘中或通过网络传输出去</span></span><br><span class="line"><span class="comment">    使用ObjectOutputStream实现</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testObjectOutputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造流</span></span><br><span class="line">            oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;object.dat&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.序列化：写操作</span></span><br><span class="line">            oos.writeObject(<span class="keyword">new</span> String(<span class="string">&quot;我爱北京天安门&quot;</span>));</span><br><span class="line">            oos.flush();<span class="comment">// 刷新操作</span></span><br><span class="line"></span><br><span class="line">            oos.writeObject(<span class="keyword">new</span> Person(<span class="string">&quot;王铭&quot;</span>, <span class="number">23</span>));</span><br><span class="line">            oos.flush();</span><br><span class="line"></span><br><span class="line">            oos.writeObject(<span class="keyword">new</span> Person(<span class="string">&quot;张学&quot;</span>, <span class="number">23</span>, <span class="number">1001</span>, <span class="keyword">new</span> Account(<span class="number">5000</span>)));</span><br><span class="line">            oos.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (oos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 3.关闭流</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    oos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    反序列化：将磁盘文件中的对象还原为内存中的一个java对象</span></span><br><span class="line"><span class="comment">    使用ObjectInputStream来实现</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testObjectInputStream</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ObjectInputStream ois = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造流</span></span><br><span class="line">            ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;object.dat&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.反序列化：读操作</span></span><br><span class="line">            <span class="comment">// 文件中保存的是不同类型的对象，反序列化时，需要与序列化时的顺序一致</span></span><br><span class="line">            Object obj = ois.readObject();</span><br><span class="line">            String str = (String) obj;</span><br><span class="line">            System.out.println(str);</span><br><span class="line"></span><br><span class="line">            Person p = (Person) ois.readObject();</span><br><span class="line">            System.out.println(p);</span><br><span class="line"></span><br><span class="line">            Person p1 = (Person) ois.readObject();</span><br><span class="line">            System.out.println(p1);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ois != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ois.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>面试题：谈谈你对 <code>java.io.Serializable</code> 接口的理解，我们知道它用于序列化，是空方法接口，还有其它认识吗？</p>
<ul>
<li><strong>实现了 Serializable 接口的对象，可将它们转换成一系列字节，并可在以后完全恢复回原来的样子。 这一过程亦可通过网络进行。这意味着序列化机制能自动补偿操作系统间的差异。</strong>换句话说，可以先在 Windows 机器上创台 建一个对象，对其序列化，然后通过网络发给一台 Unix 机器，然后在那里准确无误地重新“装配”。不必关心数据在不同机器上如何表示，也不必关心字节的顺序或者其他任何细节。</li>
<li>由于大部分作为参数的类如 String 、Integer 等都实现了 <code>java.io.Serializable</code> 接口，也可以利用多态的性质，作为参数使接口更灵活。</li>
</ul>
</li>
</ul>
<h2 id="随机存取文件流"><a href="#随机存取文件流" class="headerlink" title="随机存取文件流"></a>随机存取文件流</h2><ul>
<li><p>RandomAccessFile 声明在 <code>java.io</code> 包下，但直接继承于 <code>java.lang.Object</code> 类。并且它实现了 DataInput、DataOutput 这两个接口，也就意味着这个类既可以读也可以写。</p>
</li>
<li><p>RandomAccessFile 类支持 “随机访问” 的方式，程序可以直接跳到文件的任意地方来读、写文件。</p>
<ul>
<li>支持只访问文件的部分内容。</li>
<li>可以向已存在的文件后追加内容。</li>
</ul>
</li>
<li><p>RandomAccessFile 对象包含一个记录指针，用以标示当前读写处的位置。RandomAccessFile 类对象可以自由移动记录指针：</p>
<ul>
<li><code>long getFilePointer()</code>：获取文件记录指针的当前位置。</li>
<li><code>void seek(long pos)</code>：将文件记录指针定位到 pos 位置。</li>
</ul>
</li>
<li><p>构造器</p>
<ul>
<li><code>public RandomAccessFile(File file, String mode)</code></li>
<li><code>public RandomAccessFile(String name, String mode)</code></li>
</ul>
</li>
<li><p>创建 RandomAccessFile 类实例需要指定一个 mode 参数，该参数指定 RandomAccessFile 的访问模式：</p>
<ul>
<li>r：以只读方式打开。</li>
<li>rw：打开以便读取和写入。</li>
<li>rwd：打开以便读取和写入；同步文件内容的更新。</li>
<li>rws：打开以便读取和写入；同步文件内容和元数据的更新。</li>
<li>JDK 1.6 上面写的每次 write 数据时，rw 模式，数据不会立即写到硬盘中，而 rwd 模式，数据会被立即写入硬盘。如果写数据过程发生异常，rwd 模式中已被 write 的数据会被保存到硬盘，而 rw 模式的数据会全部丢失。</li>
</ul>
</li>
<li><p>如果模式为只读 r，则不会创建文件，而是会去读取一个已经存在的文件，如果读取的文件不存在则会出现异常。 如果模式为读写 rw，如果文件不存在则会去创建文件，如果存在则不会创建。</p>
</li>
<li><p>RandomAccessFile 的应用：我们可以用 RandomAccessFile 这个类，来实现一个多线程断点下载的功能，用过下载工具的朋友们都知道，下载前都会建立两个临时文件，一个是与被下载文件大小相同的空文件，另一个是记录文件指针的位置文件，每次暂停的时候，都会保存上一次的指针，然后断点下载的时候，会继续从上一次的地方下载，从而实现断点下载或上传的功能，有兴趣的朋友们可以自己实现下。</p>
</li>
<li><p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RandomAccessFile的使用</span></span><br><span class="line"><span class="comment"> * 1.RandomAccessFile直接继承于java.lang.Object类，实现了DataInput和DataOutput接口</span></span><br><span class="line"><span class="comment"> * 2.RandomAccessFile既可以作为一个输入流，又可以作为一个输出流</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3.如果RandomAccessFile作为输出流时，写出到的文件如果不存在，则在执行过程中自动创建。</span></span><br><span class="line"><span class="comment"> *   如果写出到的文件存在，则会对原有文件内容进行覆盖。（默认情况下，从头覆盖）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4. 可以通过相关的操作，实现RandomAccessFile“插入”数据的效果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RandomAccessFileTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用RandomAccessFile实现文件的复制</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RandomAccessFile raf1 = <span class="keyword">null</span>;</span><br><span class="line">        RandomAccessFile raf2 = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.造流</span></span><br><span class="line">            raf1 = <span class="keyword">new</span> RandomAccessFile(<span class="keyword">new</span> File(<span class="string">&quot;爱情与友情.jpg&quot;</span>), <span class="string">&quot;r&quot;</span>);</span><br><span class="line">            raf2 = <span class="keyword">new</span> RandomAccessFile(<span class="keyword">new</span> File(<span class="string">&quot;爱情与友情1.jpg&quot;</span>), <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2.读写操作</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = raf1.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                raf2.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 3.关闭流</span></span><br><span class="line">            <span class="keyword">if</span> (raf1 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    raf1.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (raf2 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    raf2.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用RandomAccessFile实现文件内容的覆盖和追加</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RandomAccessFile raf1 = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// hello.txt内容为：abcdefghijklmn</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">            raf1 = <span class="keyword">new</span> RandomAccessFile(file, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"></span><br><span class="line">            raf1.write(<span class="string">&quot;123&quot;</span>.getBytes());<span class="comment">// 从头开始覆盖：123defghijklmn</span></span><br><span class="line">            raf1.seek(<span class="number">5</span>);<span class="comment">// 将指针调到角标为5的位置，角标从0开始</span></span><br><span class="line">            raf1.write(<span class="string">&quot;456&quot;</span>.getBytes());<span class="comment">// 从角标为5处开始覆盖：123de456ijklmn</span></span><br><span class="line">            raf1.seek(file.length());<span class="comment">// 将指针调到文件末尾</span></span><br><span class="line">            raf1.write(<span class="string">&quot;789&quot;</span>.getBytes());<span class="comment">// 在文件末尾追加：123de456ijklmn789</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (raf1 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    raf1.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    使用RandomAccessFile实现数据的插入效果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RandomAccessFile raf1 = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// hello.txt内容为：abcdefghijklmn</span></span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">            raf1 = <span class="keyword">new</span> RandomAccessFile(file, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将指针调到角标为3的位置，从此处开始读入文件的数据</span></span><br><span class="line">            raf1.seek(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 方法一：保存指针3后面的所有数据到StringBuilder中</span></span><br><span class="line">            <span class="comment">/*StringBuilder builder = new StringBuilder((int) file.length());</span></span><br><span class="line"><span class="comment">            byte[] buffer = new byte[20];</span></span><br><span class="line"><span class="comment">            int len;</span></span><br><span class="line"><span class="comment">            while ((len = raf1.read(buffer)) != -1) &#123;</span></span><br><span class="line"><span class="comment">                builder.append(new String(buffer, 0, len));</span></span><br><span class="line"><span class="comment">            &#125;*/</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 方法二：保存指针3后面的所有数据到ByteArrayOutputStream中</span></span><br><span class="line">            ByteArrayOutputStream baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">10</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = raf1.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                baos.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 经过上面的读操作后，指针位置移到了文件的末尾处</span></span><br><span class="line">            <span class="comment">// 调回指针，写入&quot;123&quot;，实际上是覆盖原文件内容</span></span><br><span class="line">            raf1.seek(<span class="number">3</span>);</span><br><span class="line">            raf1.write(<span class="string">&quot;123&quot;</span>.getBytes());<span class="comment">// abc123ghijklmn</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 经过上面的写入操作，指针位置已到了123后，紧接着：</span></span><br><span class="line">            <span class="comment">// 方法一：将StringBuilder中的数据写入到文件中，实际上是覆盖123后的内容</span></span><br><span class="line">            <span class="comment">// raf1.write(builder.toString().getBytes());// abc123defghijklmn</span></span><br><span class="line">            <span class="comment">// 方法二：将ByteArrayOutputStream中的数据写入到文件中</span></span><br><span class="line">            raf1.write(baos.toString().getBytes());<span class="comment">// abc123defghijklmn</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">            exception.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (raf1 != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    raf1.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException exception) &#123;</span><br><span class="line">                    exception.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="流的基本应用小结"><a href="#流的基本应用小结" class="headerlink" title="流的基本应用小结"></a>流的基本应用小结</h2><ul>
<li>流是用来处理数据的。</li>
<li>处理数据时，一定要先明确数据源，与数据目的地：<ul>
<li>数据源可以是文件，可以是键盘。</li>
<li>数据目的地可以是文件、显示器或者其他设备。</li>
</ul>
</li>
<li>流只是在帮助数据进行传输，并对传输的数据进行处理，比如过滤处理、转换处理等。</li>
</ul>
<h2 id="NIO-2-中-Path-、Paths-、Files"><a href="#NIO-2-中-Path-、Paths-、Files" class="headerlink" title="NIO.2 中 Path 、Paths 、Files"></a>NIO.2 中 Path 、Paths 、Files</h2><ul>
<li><p>Java NIO (New IO 或 Non-Blocking IO) 是从 Java 1.4 版本开始引入的一套新的 IO API，可以替代标准的 Java IO API。NIO 与原来的 IO 有同样的作用和目的，但是使用的方式完全不同，NIO 支持面向缓冲区的 (IO是面向流的)、基于通道的 IO 操作，NIO 也会以更加高效的方式进行文件的读写操作。</p>
</li>
<li><p>Java API 中提供了两套 NIO，一套是针对标准输入输出 NIO，另一套就是网络编程 NIO。</p>
<ul>
<li>|—– <code>java.nio.channels.Channel</code><ul>
<li>|—– <code>FileChannel</code>：处理本地文件。<ul>
<li>|—– <code>SocketChannel</code>：TCP 网络编程的客户端的 Channel。</li>
<li>|—– <code>ServerSocketChannel</code>：TCP 网络编程的服务器端的 Channel。</li>
<li>|—– <code>DatagramChannel</code>：UDP 网络编程中发送端和接收端的 Channel。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>随着 JDK 7 的发布，Java 对 NIO 进行了极大的扩展，增强了对文件处理和文件系统特性的支持，以至于我们称他们为 NIO.2。因为 NIO 提供的一些功能，NIO 已经成为文件处理中越来越重要的部分。</p>
</li>
<li><p>早期的 Java 只提供了一个 File 类来访问文件系统，但 File 类的功能比较有限，所提供的方法性能也不高。而且，大多数方法在出错时仅返回失败，并不会提供异常信息。</p>
</li>
<li><p>NIO. 2 为了弥补这种不足，引入了 Path 接口，代表一个平台无关的平台路径，描述了目录结构中文件的位置。Path 可以看成是 File 类的升级版本，实际引用的资源也可以不存在。</p>
</li>
<li><p>在以前 IO 操作是类似如下写法的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;index.html&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>但在 Java 7 中，我们可以这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line">Path path = Paths.get(<span class="string">&quot;index.html&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>同时，NIO.2 在 <code>java.nio.file</code> 包下还提供了 Files、Paths 工具类，Files 包含了大量静态的工具方法来操作文件；Paths 则包含了两个返回 Path 的静态工厂方法。</p>
</li>
<li><p>Paths 类提供的获取 Path 对象的方法：</p>
<ul>
<li><p><code>static Path get(String first, String … more)</code>：用于将多个字符串串连成路径。</p>
</li>
<li><p><code>static Path get(URI uri)</code>：返回指定 uri 对应的 Path 路径。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    如何使用Paths实例化Path</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Path path1 = Paths.get(<span class="string">&quot;d:\\nio\\hello.txt&quot;</span>);<span class="comment">// = new File(String filepath)</span></span><br><span class="line">        System.out.println(path1);</span><br><span class="line"></span><br><span class="line">        Path path2 = Paths.get(<span class="string">&quot;d:\\&quot;</span>, <span class="string">&quot;nio\\hello.txt&quot;</span>);<span class="comment">// = new File(String parent,String filename);</span></span><br><span class="line">        System.out.println(path2);</span><br><span class="line"></span><br><span class="line">        Path path3 = Paths.get(<span class="string">&quot;d:\\&quot;</span>, <span class="string">&quot;nio&quot;</span>);</span><br><span class="line">        System.out.println(path3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Path 类常用方法：</p>
<ul>
<li><p><code>String toString()</code>：返回调用 Path 对象的字符串表示形式。</p>
</li>
<li><p><code>boolean startsWith(String path)</code>：判断是否以 path 路径开始。</p>
</li>
<li><p><code>boolean endsWith(String path)</code>：判断是否以 path 路径结束。</p>
</li>
<li><p><code>boolean isAbsolute()</code>：判断是否是绝对路径。</p>
</li>
<li><p><code>Path getParent()</code>：返回 Path 对象包含整个路径，不包含 Path 对象指定的文件路径。</p>
</li>
<li><p><code>Path getRoot()</code>：返回调用 Path 对象的根路径。</p>
</li>
<li><p><code>Path getFileName()</code>：返回与调用 Path 对象关联的文件名。</p>
</li>
<li><p><code>int getNameCount()</code>：返回 Path 根目录后面元素的数量。</p>
</li>
<li><p><code>Path getName(int idx)</code>：返回指定索引位置 idx 的路径名称。</p>
</li>
<li><p><code>Path toAbsolutePath()</code>：作为绝对路径返回调用 Path 对象。</p>
</li>
<li><p><code>Path resolve(Path p)</code>：合并两个路径，返回合并后的路径对应的 Path 对象。</p>
</li>
<li><p><code>File toFile()</code>：将 Path 转化为 File 类的对象。File 类转化为 Path 对象的方法是：<code>Path toPath()</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Path中的常用方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Path path1 = Paths.get(<span class="string">&quot;d:\\&quot;</span>, <span class="string">&quot;nio\\nio1\\nio2\\hello.txt&quot;</span>);</span><br><span class="line">        Path path2 = Paths.get(<span class="string">&quot;hello1.txt&quot;</span>);<span class="comment">// 相对当前Module的路径</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// String toString()：返回调用Path对象的字符串表示形式</span></span><br><span class="line">        System.out.println(path1);<span class="comment">// d:\nio\nio1\nio2\hello.txt</span></span><br><span class="line">        <span class="comment">// boolean startsWith(String path): 判断是否以path路径开始</span></span><br><span class="line">        System.out.println(path1.startsWith(<span class="string">&quot;d:\\nio&quot;</span>));<span class="comment">// true</span></span><br><span class="line">        <span class="comment">// boolean endsWith(String path): 判断是否以path路径结束</span></span><br><span class="line">        System.out.println(path1.endsWith(<span class="string">&quot;hello.txt&quot;</span>));<span class="comment">// true</span></span><br><span class="line">        <span class="comment">// boolean isAbsolute(): 判断是否是绝对路径</span></span><br><span class="line">        System.out.println(path1.isAbsolute() + <span class="string">&quot;~&quot;</span>);<span class="comment">// true~</span></span><br><span class="line">        System.out.println(path2.isAbsolute() + <span class="string">&quot;~&quot;</span>);<span class="comment">// false~</span></span><br><span class="line">        <span class="comment">// Path getParent()：返回Path对象包含整个路径，不包含Path对象指定的文件路径</span></span><br><span class="line">        System.out.println(path1.getParent());<span class="comment">// d:\nio\nio1\nio2</span></span><br><span class="line">        System.out.println(path2.getParent());<span class="comment">// null</span></span><br><span class="line">        <span class="comment">// Path getRoot()：返回调用Path对象的根路径</span></span><br><span class="line">        System.out.println(path1.getRoot());<span class="comment">// d:\</span></span><br><span class="line">        System.out.println(path2.getRoot());<span class="comment">// null</span></span><br><span class="line">        <span class="comment">// Path getFileName(): 返回与调用Path对象关联的文件名</span></span><br><span class="line">        System.out.println(path1.getFileName() + <span class="string">&quot;~&quot;</span>);<span class="comment">// hello.txt~</span></span><br><span class="line">        System.out.println(path2.getFileName() + <span class="string">&quot;~&quot;</span>);<span class="comment">// hello1.txt~</span></span><br><span class="line">        <span class="comment">// int getNameCount(): 返回Path根目录后面元素的数量</span></span><br><span class="line">        <span class="comment">// Path getName(int idx): 返回指定索引位置idx的路径名称</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; path1.getNameCount(); i++) &#123;</span><br><span class="line">            <span class="comment">// nio*****nio1*****nio2*****hello.txt*****</span></span><br><span class="line">            System.out.print(path1.getName(i) + <span class="string">&quot;*****&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Path toAbsolutePath(): 作为绝对路径返回调用Path对象</span></span><br><span class="line">        System.out.println(path1.toAbsolutePath());<span class="comment">// d:\nio\nio1\nio2\hello.txt</span></span><br><span class="line">        System.out.println(path2.toAbsolutePath());<span class="comment">// D:\xisun-projects\java_base\hello1.txt</span></span><br><span class="line">        <span class="comment">// Path resolve(Path p): 合并两个路径，返回合并后的路径对应的Path对象</span></span><br><span class="line">        Path path3 = Paths.get(<span class="string">&quot;d:\\&quot;</span>, <span class="string">&quot;nio&quot;</span>);</span><br><span class="line">        Path path4 = Paths.get(<span class="string">&quot;nioo\\hi.txt&quot;</span>);</span><br><span class="line">        path3 = path3.resolve(path4);</span><br><span class="line">        System.out.println(path3);<span class="comment">// d:\nio\nioo\hi.txt</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// File toFile(): 将Path转化为File类的对象</span></span><br><span class="line">        File file = path1.toFile();<span class="comment">// Path---&gt;File的转换</span></span><br><span class="line">        <span class="comment">// Path toPath(): 将File转化为Path类的对象</span></span><br><span class="line">        Path newPath = file.toPath();<span class="comment">// File---&gt;Path的转换</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>java.nio.file.Files</code>：用于操作文件或目录的工具类。</p>
</li>
<li><p>Files 常用方法：</p>
<ul>
<li><p><code>Path copy(Path src, Path dest, CopyOption … how)</code>：文件的复制。</p>
</li>
<li><p><code>Path createDirectory(Path path, FileAttribute&lt;?&gt; … attr)</code>：创建一个目录。</p>
</li>
<li><p><code>Path createFile(Path path, FileAttribute&lt;?&gt; … arr)</code>：创建一个文件。</p>
</li>
<li><p><code>void delete(Path path)</code>：删除一个文件/目录，如果不存在，执行报错。</p>
</li>
<li><p><code>void deleteIfExists(Path path)</code>：Path 对应的文件/目录如果存在，执行删除。</p>
</li>
<li><p><code>Path move(Path src, Path dest, CopyOption…how)</code>：将 src 移动到 dest 位置。</p>
</li>
<li><p><code>long size(Path path)</code>：返回 path 指定文件的大小。</p>
</li>
<li><p><code>boolean exists(Path path, LinkOption … opts)</code>：判断文件是否存在。</p>
</li>
<li><p><code>boolean isDirectory(Path path, LinkOption … opts)</code>：判断是否是目录。</p>
</li>
<li><p><code>boolean isRegularFile(Path path, LinkOption … opts)</code>：判断是否是文件。</p>
</li>
<li><p><code>boolean isHidden(Path path)</code>：判断是否是隐藏文件。</p>
</li>
<li><p><code>boolean isReadable(Path path)</code>：判断文件是否可读。</p>
</li>
<li><p><code>boolean isWritable(Path path)</code>：判断文件是否可写。</p>
</li>
<li><p><code>boolean notExists(Path path, LinkOption … opts)</code>：判断文件是否不存在。</p>
</li>
<li><p><code>SeekableByteChannel newByteChannel(Path path, OpenOption…how)</code>：获取与指定文件的连接，how 指定打开方式。</p>
</li>
<li><p><code>DirectoryStream\&lt;Path&gt; newDirectoryStream(Path path)</code>：打开 path 指定的目录。</p>
</li>
<li><p><code>InputStream newInputStream(Path path, OpenOption…how)</code>：获取 InputStream 对象。</p>
</li>
<li><p><code>OutputStream newOutputStream(Path path, OpenOption…how)</code>：获取 OutputStream 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilesTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Path path1 = Paths.get(<span class="string">&quot;d:\\nio&quot;</span>, <span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        Path path2 = Paths.get(<span class="string">&quot;atguigu.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Path copy(Path src, Path dest, CopyOption … how): 文件的复制</span></span><br><span class="line">        <span class="comment">// 要想复制成功，要求path1对应的物理上的文件存在。path2 对应的文件没有要求。</span></span><br><span class="line">        <span class="comment">// Files.copy(path1, path2, StandardCopyOption.REPLACE_EXISTING);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Path createDirectory(Path path, FileAttribute&lt;?&gt; … attr): 创建一个目录</span></span><br><span class="line">        <span class="comment">// 要想执行成功，要求path对应的物理上的文件目录不存在。一旦存在，抛出异常。</span></span><br><span class="line">        Path path3 = Paths.get(<span class="string">&quot;d:\\nio\\nio1&quot;</span>);</span><br><span class="line">        <span class="comment">// Files.createDirectory(path3);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Path createFile(Path path, FileAttribute&lt;?&gt; … arr): 创建一个文件</span></span><br><span class="line">        <span class="comment">// 要想执行成功，要求path对应的物理上的文件不存在。一旦存在，抛出异常。</span></span><br><span class="line">        Path path4 = Paths.get(<span class="string">&quot;d:\\nio\\hi.txt&quot;</span>);</span><br><span class="line">        <span class="comment">// Files.createFile(path4);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// void delete(Path path): 删除一个文件/目录，如果不存在，执行报错</span></span><br><span class="line">        <span class="comment">// Files.delete(path4);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// void deleteIfExists(Path path): Path对应的文件/目录如果存在，执行删除。如果不存在，正常执行结束</span></span><br><span class="line">        Files.deleteIfExists(path3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Path move(Path src, Path dest, CopyOption…how): 将src移动到dest位置</span></span><br><span class="line">        <span class="comment">// 要想执行成功，src对应的物理上的文件需要存在，dest对应的文件没有要求。</span></span><br><span class="line">        <span class="comment">// Files.move(path1, path2, StandardCopyOption.ATOMIC_MOVE);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// long size(Path path): 返回path指定文件的大小</span></span><br><span class="line">        <span class="keyword">long</span> size = Files.size(path2);</span><br><span class="line">        System.out.println(size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Path path1 = Paths.get(<span class="string">&quot;d:\\nio&quot;</span>, <span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line">        Path path2 = Paths.get(<span class="string">&quot;atguigu.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// boolean exists(Path path, LinkOption … opts): 判断文件是否存在</span></span><br><span class="line">        System.out.println(Files.exists(path2, LinkOption.NOFOLLOW_LINKS));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// boolean isDirectory(Path path, LinkOption … opts): 判断是否是目录</span></span><br><span class="line">        <span class="comment">// 不要求此path对应的物理文件存在。</span></span><br><span class="line">        System.out.println(Files.isDirectory(path1, LinkOption.NOFOLLOW_LINKS));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// boolean isRegularFile(Path path, LinkOption … opts): 判断是否是文件</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// /boolean isHidden(Path path): 判断是否是隐藏文件</span></span><br><span class="line">        <span class="comment">// 要求此path对应的物理上的文件需要存在。才可判断是否隐藏。否则，抛异常。</span></span><br><span class="line">        System.out.println(Files.isHidden(path1));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// /boolean isReadable(Path path): 判断文件是否可读</span></span><br><span class="line">        System.out.println(Files.isReadable(path1));</span><br><span class="line">        <span class="comment">// boolean isWritable(Path path): 判断文件是否可写</span></span><br><span class="line">        System.out.println(Files.isWritable(path1));</span><br><span class="line">      <span class="comment">// boolean notExists(Path path, LinkOption … opts): 判断文件是否不存在</span></span><br><span class="line">        System.out.println(Files.notExists(path1, LinkOption.NOFOLLOW_LINKS));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * StandardOpenOption.READ: 表示对应的Channel是可读的。</span></span><br><span class="line"><span class="comment">     * StandardOpenOption.WRITE：表示对应的Channel是可写的。</span></span><br><span class="line"><span class="comment">     * StandardOpenOption.CREATE：如果要写出的文件不存在，则创建。如果存在，忽略</span></span><br><span class="line"><span class="comment">     * StandardOpenOption.CREATE_NEW：如果要写出的文件不存在，则创建。如果存在，抛异常</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Path path1 = Paths.get(<span class="string">&quot;d:\\nio&quot;</span>, <span class="string">&quot;hello.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// InputStream newInputStream(Path path, OpenOption…how): 获取InputStream对象</span></span><br><span class="line">        InputStream inputStream = Files.newInputStream(path1, StandardOpenOption.READ);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// OutputStream newOutputStream(Path path, OpenOption…how): 获取OutputStream对象</span></span><br><span class="line">        OutputStream outputStream = Files.newOutputStream(path1, StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SeekableByteChannel newByteChannel(Path path, OpenOption…how): 获取与指定文件的连接，how指定打开方式</span></span><br><span class="line">        SeekableByteChannel channel = Files.newByteChannel(path1, StandardOpenOption.READ,</span><br><span class="line">                StandardOpenOption.WRITE, StandardOpenOption.CREATE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// DirectoryStream&lt;Path&gt;  newDirectoryStream(Path path): 打开path指定的目录</span></span><br><span class="line">        Path path2 = Paths.get(<span class="string">&quot;e:\\teach&quot;</span>);</span><br><span class="line">        DirectoryStream&lt;Path&gt; directoryStream = Files.newDirectoryStream(path2);</span><br><span class="line">        Iterator&lt;Path&gt; iterator = directoryStream.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h2 id="FileUtils-工具类"><a href="#FileUtils-工具类" class="headerlink" title="FileUtils 工具类"></a>FileUtils 工具类</h2><ul>
<li><p>Maven 引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>复制功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUtilsTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        File srcFile = <span class="keyword">new</span> File(<span class="string">&quot;day10\\爱情与友情.jpg&quot;</span>);</span><br><span class="line">        File destFile = <span class="keyword">new</span> File(<span class="string">&quot;day10\\爱情与友情2.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyFile(srcFile, destFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历文件夹和文件的每一行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUtilsMethod</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 常规方法：若文件路径内的文件比较少，可以采用此方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">common</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">        <span class="keyword">if</span> (file.exists()) &#123;</span><br><span class="line">            <span class="comment">// 获取子文件夹内所有文件，放到文件数组里，如果含有大量文件，会创建一个很大的数组，占用空间</span></span><br><span class="line">            File[] fileList = file.listFiles();</span><br><span class="line">            <span class="keyword">for</span> (File currentFile : fileList) &#123; </span><br><span class="line">                <span class="comment">// 当前文件是普通文件（排除文件夹），且不是隐藏文件</span></span><br><span class="line">                <span class="keyword">if</span> (currentFile.isFile() &amp;&amp; !currentFile.isHidden()) &#123;</span><br><span class="line">                    <span class="comment">// 当前文件的完整路径，含文件名</span></span><br><span class="line">                    String currentFilePath = currentFile.getPath();</span><br><span class="line">                    <span class="keyword">if</span> (currentFilePath.endsWith(<span class="string">&quot;xml&quot;</span>) || currentFilePath.endsWith(<span class="string">&quot;XML&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">// 当前文件的文件名，含后缀</span></span><br><span class="line">                        String fileName = currentFile.getName();</span><br><span class="line">                        System.out.println(<span class="string">&quot;文件名：&quot;</span> + fileName);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;=======================================&quot;</span>);</span><br><span class="line">            <span class="comment">// list方法返回的是文件名的String数组</span></span><br><span class="line">            String[] fileNameList = file.list();</span><br><span class="line">            <span class="keyword">for</span> (String fileName : fileNameList) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;文件名：&quot;</span> + fileName);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据文件路径，迭代获取该路径下指定文件后缀类型的文件：若文件路径内含有大量文件，建议采用此方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">iterateFiles</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        File file = FileUtils.getFile(filePath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">            Iterator&lt;File&gt; fileIterator = FileUtils.iterateFiles(file, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;xml&quot;</span>, <span class="string">&quot;XML&quot;</span>&#125;, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (fileIterator.hasNext()) &#123;</span><br><span class="line">                File currentFile = fileIterator.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (currentFile.isFile() &amp;&amp; !currentFile.isHidden()) &#123;</span><br><span class="line">                    <span class="comment">// 绝对路径</span></span><br><span class="line">                    String currentFilePath = currentFile.getAbsolutePath();</span><br><span class="line">                    System.out.println(<span class="string">&quot;绝对路径：&quot;</span> + currentFilePath);</span><br><span class="line">                    <span class="comment">// 文件名，含文件后缀</span></span><br><span class="line">                    String fileName = currentFilePath.substring(currentFilePath.lastIndexOf(<span class="string">&quot;\\&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;含后缀文件名：&quot;</span> + fileName);</span><br><span class="line">                    <span class="comment">// 文件名，不含文件后缀</span></span><br><span class="line">                    fileName = fileName.substring(<span class="number">0</span>, fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">                    System.out.println(<span class="string">&quot;不含后缀文件名：&quot;</span> + fileName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取目标文件每一行数据，返回List：若文件内容较少，可以采用此方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readLinesForList</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        List&lt;String&gt; linesList = FileUtils.readLines(<span class="keyword">new</span> File(filePath), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String line : linesList) &#123;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取目标文件每一行数据，返回迭代器：若文件内容较多，建议采用此方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readLinesForIterator</span><span class="params">(String filePath)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        LineIterator lineIterator = FileUtils.lineIterator(<span class="keyword">new</span> File(filePath), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (lineIterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(lineIterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://www.gulixueyuan.com/goods/show/203?targetId=309&amp;preview=0">https://www.gulixueyuan.com/goods/show/203?targetId=309&amp;preview=0</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903985078337550#heading-55">https://juejin.cn/post/6844903985078337550#heading-55</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/24/kafka-consumer-commitandpartition/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/24/kafka-consumer-commitandpartition/" class="post-title-link" itemprop="url">KafkaConsumer 源码之 consumer 的 offset commit 机制和 partition 分配机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-24 15:17:06" itemprop="dateCreated datePublished" datetime="2020-11-24T15:17:06+08:00">2020-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-05 15:32:30" itemprop="dateModified" datetime="2021-01-05T15:32:30+08:00">2021-01-05</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>16k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>14 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>紧接着上篇文章，这篇文章讲述 consumer 提供的 offset commit 机制和 partition 分配机制，具体如何使用是需要用户结合具体的场景进行选择，本文讲述一下其底层实现。</p>
<h2 id="自动-offset-commit-机制"><a href="#自动-offset-commit-机制" class="headerlink" title="自动 offset commit 机制"></a>自动 offset commit 机制</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动提交，默认true</span></span><br><span class="line">props.put(<span class="string">&quot;enable.auto.commit&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line"><span class="comment">// 设置自动每1s提交一次，默认为5s</span></span><br><span class="line">props.put(<span class="string">&quot;auto.commit.interval.ms&quot;</span>, <span class="string">&quot;1000&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>通过上面设置，启动自动提交 offset 以及设置自动提交间隔时间。</p>
<h2 id="手动-offset-commit-机制"><a href="#手动-offset-commit-机制" class="headerlink" title="手动 offset commit 机制"></a>手动 offset commit 机制</h2><p>先看下两种不同的手动 offset commit 机制，一种是同步 commit，一种是异步 commit，既然其作用都是 offset commit，应该不难猜到它们底层使用接口都是一样的，其调用流程如下图所示：</p>
<p><img src="/2020/11/24/kafka-consumer-commitandpartition/image-20201124154403249.png" alt="image-20201124154403249"></p>
<h3 id="同步-commit"><a href="#同步-commit" class="headerlink" title="同步 commit"></a>同步 commit</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对poll()中返回的所有topics和partition列表进行commit</span></span><br><span class="line"><span class="comment">// 这个方法只能将offset提交Kafka中，Kafka将会在每次rebalance之后的第一次拉取或启动时使用同步commit</span></span><br><span class="line"><span class="comment">// 这是同步commit，它将会阻塞进程，直到commit成功或者遇到一些错误</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commitSync</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 只对指定的topic-partition列表进行commit</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commitSync</span><span class="params">(<span class="keyword">final</span> Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>其实，从上图中，就已经可以看出，同步 commit 的实现方式，<code>client.poll ()</code> 方法会阻塞直到这个 request 完成或超时才会返回。</p>
<h3 id="异步-commit"><a href="#异步-commit" class="headerlink" title="异步 commit"></a>异步 commit</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commitAsync</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commitAsync</span><span class="params">(OffsetCommitCallback callback)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">commitAsync</span><span class="params">(<span class="keyword">final</span> Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets, OffsetCommitCallback callback)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>对于异步的 commit，最后调用的都是 <code>doCommitOffsetsAsync ()</code> 方法，其具体实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doCommitOffsetsAsync</span><span class="params">(<span class="keyword">final</span> Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets, <span class="keyword">final</span> OffsetCommitCallback callback)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 发送offset-commit请求</span></span><br><span class="line">    RequestFuture&lt;Void&gt; future = sendOffsetCommitRequest(offsets);</span><br><span class="line">    <span class="keyword">final</span> OffsetCommitCallback cb = callback == <span class="keyword">null</span> ? defaultOffsetCommitCallback : callback;</span><br><span class="line">    future.addListener(<span class="keyword">new</span> RequestFutureListener&lt;Void&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Void value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (interceptors != <span class="keyword">null</span>)</span><br><span class="line">                interceptors.onCommit(offsets);</span><br><span class="line">            <span class="comment">// 添加成功的请求，以唤醒相应的回调函数</span></span><br><span class="line">            completedOffsetCommits.add(<span class="keyword">new</span> OffsetCommitCompletion(cb, offsets, <span class="keyword">null</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(RuntimeException e)</span> </span>&#123;</span><br><span class="line">            Exception commitException = e;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> RetriableException) &#123;</span><br><span class="line">                commitException = <span class="keyword">new</span> RetriableCommitFailedException(e);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 添加失败的请求，以唤醒相应的回调函数</span></span><br><span class="line">            completedOffsetCommits.add(<span class="keyword">new</span> OffsetCommitCompletion(cb, offsets, commitException));</span><br><span class="line">            <span class="keyword">if</span> (commitException <span class="keyword">instanceof</span> FencedInstanceIdException) &#123;</span><br><span class="line">                asyncCommitFenced.set(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在异步 commit 中，可以添加相应的回调函数，如果 request 处理成功或处理失败，ConsumerCoordinator 会通过 <code>invokeCompletedOffsetCommitCallbacks ()</code> 方法唤醒相应的回调函数。</p>
<blockquote>
<p>上面简单的介绍了同步 commit 和异步 commit，更详细的分析参考：<a target="_blank" rel="noopener" href="http://generalthink.github.io/2019/06/04/kafka-consumer-offset-commit/">Kafka consumer 的 offset 的提交方式</a>。</p>
<p>注意：手动 commit 时，提交的是下一次要读取的 offset。举例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">while</span>(running) &#123;</span><br><span class="line">           <span class="comment">// 取得消息</span></span><br><span class="line">           ConsumerRecords&lt;String, String&gt; records = consumer.poll(Long.MAX_VALUE);</span><br><span class="line">           <span class="comment">// 根据分区来遍历数据</span></span><br><span class="line">           <span class="keyword">for</span> (TopicPartition partition : records.partitions()) &#123;</span><br><span class="line">               List&lt;ConsumerRecord&lt;String, String&gt;&gt; partitionRecords = records.records(partition);</span><br><span class="line">               <span class="comment">// 数据处理</span></span><br><span class="line">               <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; record : partitionRecords) &#123;</span><br><span class="line">                   System.out.println(record.offset() + <span class="string">&quot;: &quot;</span> + record.value());</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="comment">// 取得当前读取到的最后一条记录的offset</span></span><br><span class="line">               <span class="keyword">long</span> lastOffset = partitionRecords.get(partitionRecords.size() - <span class="number">1</span>).offset();</span><br><span class="line">               <span class="comment">// 提交offset，记得要 + 1</span></span><br><span class="line">               consumer.commitSync(Collections.singletonMap(partition, <span class="keyword">new</span> OffsetAndMetadata(lastOffset + <span class="number">1</span>)));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">   	consumer.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="commit-offset-请求的处理"><a href="#commit-offset-请求的处理" class="headerlink" title="commit offset 请求的处理"></a>commit offset 请求的处理</h3><p>当 Kafka Server 端接收到来自 client 端的 offset commit 请求时，对于提交的 offset，GroupCoordinator 会记录在 GroupMetadata 对象中，至于其实现的逻辑细节，此处不再赘述。</p>
<h2 id="partition-分配机制"><a href="#partition-分配机制" class="headerlink" title="partition 分配机制"></a>partition 分配机制</h2><p>consumer 提供了三种不同的 partition 分配策略，可以通过 <code>partition.assignment.strategy</code> 参数进行配置，默认情况下使用的是 <code>org.apache.kafka.clients.consumer.RangeAssignor</code>，Kafka 中提供了另外两种 partition 的分配策略 <code>org.apache.kafka.clients.consumer.RoundRobinAssignor</code> 和 <code>org.apache.kafka.clients.consumer.StickyAssignor</code>，它们关系如下图所示：</p>
<p><img src="/2020/11/24/kafka-consumer-commitandpartition/image-20201124162306959.png" alt="image-20201124162306959"></p>
<p>通过上图可以看出，用户可以自定义相应的 partition 分配机制，只需要继承这个 AbstractPartitionAssignor 抽象类即可。</p>
<blockquote>
<p>partition 分配策略，其实也就是 reblance 策略。</p>
</blockquote>
<h3 id="AbstractPartitionAssignor"><a href="#AbstractPartitionAssignor" class="headerlink" title="AbstractPartitionAssignor"></a>AbstractPartitionAssignor</h3><p>AbstractPartitionAssignor 有一个抽象方法，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Perform the group assignment given the partition counts and member subscriptions</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> partitionsPerTopic The number of partitions for each subscribed topic. Topics not in metadata will be excluded</span></span><br><span class="line"><span class="comment"> *                           from this map.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> subscriptions Map from the memberId to their respective topic subscription</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> Map from each member to the list of partitions assigned to them.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 根据partitionsPerTopic和subscriptions进行分配，具体的实现会在子类中实现(不同的子类，其实现方法不相同)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                         Map&lt;String, Subscription&gt; subscriptions);</span><br></pre></td></tr></table></figure>

<p><code>assign ()</code> 这个方法，有两个参数：</p>
<ul>
<li><code>partitionsPerTopic</code>：所订阅的每个 topic 与其 partition 数的对应关系，metadata 没有的 topic 将会被移除；</li>
<li><code>subscriptions</code>：每个 consumerId 与其所订阅的 topic 列表的关系。</li>
</ul>
<p>继承 AbstractPartitionAssignor 的子类，通过实现 <code>assign ()</code> 方法，来进行相应的 partition 分配。</p>
<h3 id="RangeAssignor-分配模式"><a href="#RangeAssignor-分配模式" class="headerlink" title="RangeAssignor 分配模式"></a>RangeAssignor 分配模式</h3><p><code>assign ()</code> 方法的实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                Map&lt;String, Subscription&gt; subscriptions) &#123;</span><br><span class="line">    <span class="comment">// 1.参数含义:(topic, List&lt;consumerId&gt;)，获取每个topic被多少个consumer订阅了</span></span><br><span class="line">    Map&lt;String, List&lt;String&gt;&gt; consumersPerTopic = consumersPerTopic(subscriptions);</span><br><span class="line">    <span class="comment">// 2.存储最终的分配方案</span></span><br><span class="line">    Map&lt;String, List&lt;TopicPartition&gt;&gt; assignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String memberId : subscriptions.keySet())</span><br><span class="line">        assignment.put(memberId, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;String&gt;&gt; topicEntry : consumersPerTopic.entrySet()) &#123;</span><br><span class="line">        String topic = topicEntry.getKey();</span><br><span class="line">        List&lt;String&gt; consumersForTopic = topicEntry.getValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.每个topic的partition数量</span></span><br><span class="line">        Integer numPartitionsForTopic = partitionsPerTopic.get(topic);</span><br><span class="line">        <span class="keyword">if</span> (numPartitionsForTopic == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        Collections.sort(consumersForTopic);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.取商，表示平均每个consumer会分配到多少个partition</span></span><br><span class="line">        <span class="keyword">int</span> numPartitionsPerConsumer = numPartitionsForTopic / consumersForTopic.size();</span><br><span class="line">        <span class="comment">// 5.取余，表示平均分配后还剩下多少个partition未被分配</span></span><br><span class="line">        <span class="keyword">int</span> consumersWithExtraPartition = numPartitionsForTopic % consumersForTopic.size();</span><br><span class="line"></span><br><span class="line">        List&lt;TopicPartition&gt; partitions = AbstractPartitionAssignor.partitions(topic, numPartitionsForTopic);</span><br><span class="line">        <span class="comment">// 6.这里是关键点，分配原则是将未能被平均分配的partition分配到前consumersWithExtraPartition个consumer</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, n = consumersForTopic.size(); i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// 假设partition有7个，consumer有5个，则numPartitionsPerConsumer=1，consumersWithExtraPartition=2</span></span><br><span class="line">            <span class="comment">// i=0, start: 0, length: 2, topic-partition: p0, p1</span></span><br><span class="line">            <span class="comment">// i=1, start: 2, length: 2, topic-partition: p2, p3</span></span><br><span class="line">            <span class="comment">// i=2, start: 4, length: 1, topic-partition: p4</span></span><br><span class="line">            <span class="comment">// i=3, start: 5, length: 1, topic-partition: p5</span></span><br><span class="line">            <span class="comment">// i=4, start: 6, length: 1, topic-partition: p6</span></span><br><span class="line">            <span class="keyword">int</span> start = numPartitionsPerConsumer * i + Math.min(i, consumersWithExtraPartition);</span><br><span class="line">            <span class="keyword">int</span> length = numPartitionsPerConsumer + (i + <span class="number">1</span> &gt; consumersWithExtraPartition ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">            assignment.get(consumersForTopic.get(i)).addAll(partitions.subList(start, start + length));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> assignment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设 topic 的 partition 数为 <code>numPartitionsForTopic</code>，group 中订阅这个 topic 的 member 数为 <code>consumersForTopic.size()</code>，首先需要算出两个值：</p>
<ul>
<li><code>numPartitionsPerConsumer = numPartitionsForTopic / consumersForTopic.size()</code>：表示平均每个 consumer 会分配到几个 partition；</li>
<li><code>consumersWithExtraPartition = numPartitionsForTopic % consumersForTopic.size()</code>：表示平均分配后还剩下多少个 partition 未分配。</li>
</ul>
<p>分配的规则是：对于剩下的那些 partition 分配到前 consumersWithExtraPartition 个 consumer 上，也就是前 consumersWithExtraPartition 个 consumer 获得 topic-partition 列表会比后面多一个。</p>
<p>在上述的程序中，举了一个例子，假设有一个 topic 有 7 个 partition，group 有5个 consumer，这个5个 consumer 都订阅这个 topic，那么 range 的分配方式如下：</p>
<table>
<thead>
<tr>
<th>消费者</th>
<th>分配方案</th>
</tr>
</thead>
<tbody><tr>
<td>consumer 0</td>
<td>start: 0, length: 2, topic-partition: p0, p1</td>
</tr>
<tr>
<td>consumer 1</td>
<td>start: 2, length: 2, topic-partition: p2, p3</td>
</tr>
<tr>
<td>consumer 2</td>
<td>start: 4, length: 1, topic-partition: p4</td>
</tr>
<tr>
<td>consumer 3</td>
<td>start: 5, length: 1, topic-partition: p5</td>
</tr>
<tr>
<td>consumer 4</td>
<td>start: 6, length: 1, topic-partition: p6</td>
</tr>
</tbody></table>
<p>而如果 group 中有 consumer 没有订阅这个 topic，那么这个 consumer 将不会参与分配。下面再举个例子，假设有 2 个 topic，一个有 5 个 partition，另一个有 7 个 partition，group 中有 5 个 consumer，但是只有前 3 个订阅第一个 topic，而另一个 topic 是所有 consumer 都订阅了，那么其分配结果如下：</p>
<table>
<thead>
<tr>
<th>consumer</th>
<th>订阅 topic1 的列表</th>
<th>订阅 topic2 的列表</th>
</tr>
</thead>
<tbody><tr>
<td>consumer 0</td>
<td>t1 p0, t1 p1</td>
<td>t2 p0, t2 p1</td>
</tr>
<tr>
<td>consumer 1</td>
<td>t1 p2, t1 p3</td>
<td>t2 p2, t2 p3</td>
</tr>
<tr>
<td>consumer 2</td>
<td>t1 p4</td>
<td>t2 p4</td>
</tr>
<tr>
<td>consumer 3</td>
<td></td>
<td>t2 p5</td>
</tr>
<tr>
<td>consumer 4</td>
<td></td>
<td>t2 p6</td>
</tr>
</tbody></table>
<h3 id="RoundRobinAssignor"><a href="#RoundRobinAssignor" class="headerlink" title="RoundRobinAssignor"></a>RoundRobinAssignor</h3><p><code>assign ()</code> 方法的实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                Map&lt;String, Subscription&gt; subscriptions) &#123;</span><br><span class="line">    Map&lt;String, List&lt;TopicPartition&gt;&gt; assignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String memberId : subscriptions.keySet())</span><br><span class="line">        assignment.put(memberId, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 环状链表，存储所有的consumer，一次迭代完之后又会回到原点</span></span><br><span class="line">    CircularIterator&lt;String&gt; assigner = <span class="keyword">new</span> CircularIterator&lt;&gt;(Utils.sorted(subscriptions.keySet()));</span><br><span class="line">    <span class="comment">// 获取所有订阅的topic的partition总数</span></span><br><span class="line">    <span class="keyword">for</span> (TopicPartition partition : allPartitionsSorted(partitionsPerTopic, subscriptions)) &#123;</span><br><span class="line">        <span class="keyword">final</span> String topic = partition.topic();</span><br><span class="line">        <span class="keyword">while</span> (!subscriptions.get(assigner.peek()).topics().contains(topic))</span><br><span class="line">            assigner.next();</span><br><span class="line">        assignment.get(assigner.next()).add(partition);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> assignment;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TopicPartition&gt; <span class="title">allPartitionsSorted</span><span class="params">(Map&lt;String, Integer&gt; partitionsPerTopic,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                Map&lt;String, Subscription&gt; subscriptions)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 所有的topics(有序)</span></span><br><span class="line">    SortedSet&lt;String&gt; topics = <span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Subscription subscription : subscriptions.values())</span><br><span class="line">        topics.addAll(subscription.topics());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订阅的Topic的所有的TopicPartition集合</span></span><br><span class="line">    List&lt;TopicPartition&gt; allPartitions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String topic : topics) &#123;</span><br><span class="line">        Integer numPartitionsForTopic = partitionsPerTopic.get(topic);</span><br><span class="line">        <span class="keyword">if</span> (numPartitionsForTopic != <span class="keyword">null</span>)</span><br><span class="line">            <span class="comment">// topic的所有partition都添加进去</span></span><br><span class="line">            allPartitions.addAll(AbstractPartitionAssignor.partitions(topic, numPartitionsForTopic));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> allPartitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Round Robin 的实现原则，简单来说就是：列出所有 topic-partition 和列出所有的 consumer member，然后开始分配，一轮之后继续下一轮，假设有一个 topic，它有7个 partition，group 中有 3 个 consumer 都订阅了这个 topic，那么其分配方式为：</p>
<table>
<thead>
<tr>
<th>消费者</th>
<th>分配列表</th>
</tr>
</thead>
<tbody><tr>
<td>consumer 0</td>
<td>p0, p3, p6</td>
</tr>
<tr>
<td>consumer 1</td>
<td>p1, p4</td>
</tr>
<tr>
<td>consumer 2</td>
<td>p2, p5</td>
</tr>
</tbody></table>
<p>对于多个 topic 的订阅，假设有 2 个 topic，一个有 5 个 partition，一个有 7 个 partition，group 中有 5 个 consumer，但是只有前 3 个订阅第一个 topic，而另一个 topic 是所有 consumer 都订阅了，那么其分配结果如下：</p>
<table>
<thead>
<tr>
<th>消费者</th>
<th>订阅 topic1 的列表</th>
<th>订阅的 topic2 的列表</th>
</tr>
</thead>
<tbody><tr>
<td>consumer 0</td>
<td>t1 p0, t1 p3</td>
<td>t2 p0, t2 p5</td>
</tr>
<tr>
<td>consumer 1</td>
<td>t1 p1, t1 p4</td>
<td>t2 p1, t2 p6</td>
</tr>
<tr>
<td>consumer 2</td>
<td>t1 p2</td>
<td>t2 p2</td>
</tr>
<tr>
<td>consumer 3</td>
<td></td>
<td>t2 p3</td>
</tr>
<tr>
<td>consumer 4</td>
<td></td>
<td>t2 p4</td>
</tr>
</tbody></table>
<h3 id="StickyAssignor"><a href="#StickyAssignor" class="headerlink" title="StickyAssignor"></a>StickyAssignor</h3><p><code>assign ()</code> 方法的实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                Map&lt;String, Subscription&gt; subscriptions) &#123;</span><br><span class="line">    Map&lt;String, List&lt;TopicPartition&gt;&gt; currentAssignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    Map&lt;TopicPartition, ConsumerGenerationPair&gt; prevAssignment = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    partitionMovements = <span class="keyword">new</span> PartitionMovements();</span><br><span class="line"></span><br><span class="line">    prepopulateCurrentAssignments(subscriptions, currentAssignment, prevAssignment);</span><br><span class="line">    <span class="keyword">boolean</span> isFreshAssignment = currentAssignment.isEmpty();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a mapping of all topic partitions to all consumers that can be assigned to them</span></span><br><span class="line">    <span class="keyword">final</span> Map&lt;TopicPartition, List&lt;String&gt;&gt; partition2AllPotentialConsumers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">// a mapping of all consumers to all potential topic partitions that can be assigned to them</span></span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; consumer2AllPotentialPartitions = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initialize partition2AllPotentialConsumers and consumer2AllPotentialPartitions in the following two for loops</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;String, Integer&gt; entry: partitionsPerTopic.entrySet()) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; entry.getValue(); ++i)</span><br><span class="line">            partition2AllPotentialConsumers.put(<span class="keyword">new</span> TopicPartition(entry.getKey(), i), <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;String, Subscription&gt; entry: subscriptions.entrySet()) &#123;</span><br><span class="line">        String consumer = entry.getKey();</span><br><span class="line">        consumer2AllPotentialPartitions.put(consumer, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        entry.getValue().topics().stream().filter(topic -&gt; partitionsPerTopic.get(topic) != <span class="keyword">null</span>).forEach(topic -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; partitionsPerTopic.get(topic); ++i) &#123;</span><br><span class="line">                TopicPartition topicPartition = <span class="keyword">new</span> TopicPartition(topic, i);</span><br><span class="line">                consumer2AllPotentialPartitions.get(consumer).add(topicPartition);</span><br><span class="line">                partition2AllPotentialConsumers.get(topicPartition).add(consumer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// add this consumer to currentAssignment (with an empty topic partition assignment) if it does not already exist</span></span><br><span class="line">        <span class="keyword">if</span> (!currentAssignment.containsKey(consumer))</span><br><span class="line">            currentAssignment.put(consumer, <span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a mapping of partition to current consumer</span></span><br><span class="line">    Map&lt;TopicPartition, String&gt; currentPartitionConsumer = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;TopicPartition&gt;&gt; entry: currentAssignment.entrySet())</span><br><span class="line">        <span class="keyword">for</span> (TopicPartition topicPartition: entry.getValue())</span><br><span class="line">            currentPartitionConsumer.put(topicPartition, entry.getKey());</span><br><span class="line"></span><br><span class="line">    List&lt;TopicPartition&gt; sortedPartitions = sortPartitions(</span><br><span class="line">            currentAssignment, prevAssignment.keySet(), isFreshAssignment, partition2AllPotentialConsumers, consumer2AllPotentialPartitions);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// all partitions that need to be assigned (initially set to all partitions but adjusted in the following loop)</span></span><br><span class="line">    List&lt;TopicPartition&gt; unassignedPartitions = <span class="keyword">new</span> ArrayList&lt;&gt;(sortedPartitions);</span><br><span class="line">    <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;String, List&lt;TopicPartition&gt;&gt;&gt; it = currentAssignment.entrySet().iterator(); it.hasNext();) &#123;</span><br><span class="line">        Map.Entry&lt;String, List&lt;TopicPartition&gt;&gt; entry = it.next();</span><br><span class="line">        <span class="keyword">if</span> (!subscriptions.containsKey(entry.getKey())) &#123;</span><br><span class="line">            <span class="comment">// if a consumer that existed before (and had some partition assignments) is now removed, remove it from currentAssignment</span></span><br><span class="line">            <span class="keyword">for</span> (TopicPartition topicPartition: entry.getValue())</span><br><span class="line">                currentPartitionConsumer.remove(topicPartition);</span><br><span class="line">            it.remove();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// otherwise (the consumer still exists)</span></span><br><span class="line">            <span class="keyword">for</span> (Iterator&lt;TopicPartition&gt; partitionIter = entry.getValue().iterator(); partitionIter.hasNext();) &#123;</span><br><span class="line">                TopicPartition partition = partitionIter.next();</span><br><span class="line">                <span class="keyword">if</span> (!partition2AllPotentialConsumers.containsKey(partition)) &#123;</span><br><span class="line">                    <span class="comment">// if this topic partition of this consumer no longer exists remove it from currentAssignment of the consumer</span></span><br><span class="line">                    partitionIter.remove();</span><br><span class="line">                    currentPartitionConsumer.remove(partition);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!subscriptions.get(entry.getKey()).topics().contains(partition.topic())) &#123;</span><br><span class="line">                    <span class="comment">// if this partition cannot remain assigned to its current consumer because the consumer</span></span><br><span class="line">                    <span class="comment">// is no longer subscribed to its topic remove it from currentAssignment of the consumer</span></span><br><span class="line">                    partitionIter.remove();</span><br><span class="line">                &#125; <span class="keyword">else</span></span><br><span class="line">                    <span class="comment">// otherwise, remove the topic partition from those that need to be assigned only if</span></span><br><span class="line">                    <span class="comment">// its current consumer is still subscribed to its topic (because it is already assigned</span></span><br><span class="line">                    <span class="comment">// and we would want to preserve that assignment as much as possible)</span></span><br><span class="line">                    unassignedPartitions.remove(partition);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// at this point we have preserved all valid topic partition to consumer assignments and removed</span></span><br><span class="line">    <span class="comment">// all invalid topic partitions and invalid consumers. Now we need to assign unassignedPartitions</span></span><br><span class="line">    <span class="comment">// to consumers so that the topic partition assignments are as balanced as possible.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// an ascending sorted set of consumers based on how many topic partitions are already assigned to them</span></span><br><span class="line">    TreeSet&lt;String&gt; sortedCurrentSubscriptions = <span class="keyword">new</span> TreeSet&lt;&gt;(<span class="keyword">new</span> SubscriptionComparator(currentAssignment));</span><br><span class="line">    sortedCurrentSubscriptions.addAll(currentAssignment.keySet());</span><br><span class="line"></span><br><span class="line">    balance(currentAssignment, prevAssignment, sortedPartitions, unassignedPartitions, sortedCurrentSubscriptions,</span><br><span class="line">            consumer2AllPotentialPartitions, partition2AllPotentialConsumers, currentPartitionConsumer);</span><br><span class="line">    <span class="keyword">return</span> currentAssignment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sticky 分区策略是从 0.11 版本才开始引入的，它主要有两个目的：</p>
<ol>
<li>分区的分配要尽可能均匀</li>
<li>分区的分配要尽可能与上次分配的保持相同</li>
</ol>
<p>当两者冲突的时候，第一个目标优先于第二个目标。</p>
<p>sticky 的分区方式作用发生分区重分配的时候，尽可能地让前后两次分配相同，进而减少系统资源的损耗及其他异常情况的发生。因为 sticky 分区策略的代码，要比 range 和 roundrobin 复杂很多，此处不做具体的细节分析，只简单举例如下：</p>
<p>假设有 3 个 topic，一个有 2 个 partition，一个有 3 个 partition，另外一个有 4 个 partition，group 中有 3 个 consumer，第一个 consumer 订阅了第一个 topic，第二个 consumer 订阅了前两个 topic，第三个 consumer 订阅了三个 topic，那么它们的分配方案如下：</p>
<table>
<thead>
<tr>
<th>消费者</th>
<th>订阅 topic1 的列表</th>
<th>订阅 topic2 的列表</th>
<th>订阅 topic3 的列表</th>
</tr>
</thead>
<tbody><tr>
<td>consumer1</td>
<td>t1 p0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>consumer2</td>
<td>t1 p1, t2 p1</td>
<td>t2 p0, t2 p3</td>
<td></td>
</tr>
<tr>
<td>consumer3</td>
<td></td>
<td></td>
<td>t3 p0, t3 p1, t3 p2, t3 p3</td>
</tr>
</tbody></table>
<p>上面三个分区策略有着不同的分配方式，在实际使用过程中，需要根据自己的需求选择合适的策略，但是如果你只有一个 consumer，那么选择哪个方式都是一样的，但是如果是多个 consumer 不在同一台设备上进行消费，那么 sticky 方式应该更加合适。</p>
<h3 id="自定义分区策略"><a href="#自定义分区策略" class="headerlink" title="自定义分区策略"></a>自定义分区策略</h3><p>如之前所说，只需要继承 AbstractPartitionAssignor 并复写其中方法即可 (当然也可以直接实现 PartitionAssignor 接口) 自定义分区策略，其中有两个方法需要复写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> Map&lt;String, List&lt;TopicPartition&gt;&gt; assign(Map&lt;String, Integer&gt; partitionsPerTopic,</span><br><span class="line">                                                             Map&lt;String, Subscription&gt; subscriptions);</span><br></pre></td></tr></table></figure>

<p>其中 <code>assign ()</code> 方法表示的是分区分配方案的实现，而 <code>name ()</code> 方法则表示了这个分配策略的唯一名称，比如之前提到的 range，roundrobin 和 sticky, 这个名字会在和 GroupCoordinator 的通信中返回，通过它 consumer leader 来确定整个 group 的分区方案 (分区策略是由 group 中的 consumer 共同投票决定的，谁使用的多，就使用哪个策略)。</p>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="http://generalthink.github.io/2019/06/06/kafka-consumer-partition-assign/">http://generalthink.github.io/2019/06/06/kafka-consumer-partition-assign/</a></p>
<p><a target="_blank" rel="noopener" href="https://matt33.com/2017/11/19/consumer-two-summary/">https://matt33.com/2017/11/19/consumer-two-summary/</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>
<p>至此，关于 Kafka 的学习暂时告一段落，未来有需要时，会继续学习。更多关于 Kafka 原理等知识的介绍，参考：</p>
<p><a target="_blank" rel="noopener" href="http://generalthink.github.io/tags/Kafka/">http://generalthink.github.io/tags/Kafka/</a></p>
<p><a target="_blank" rel="noopener" href="https://matt33.com/tags/kafka/">https://matt33.com/tags/kafka/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/24/kafka-consumer-subscribeandassign/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/24/kafka-consumer-subscribeandassign/" class="post-title-link" itemprop="url">KafkaConsumer 源码之 consumer 的两种订阅模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-24 10:18:47" itemprop="dateCreated datePublished" datetime="2020-11-24T10:18:47+08:00">2020-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-01-05 15:33:01" itemprop="dateModified" datetime="2021-01-05T15:33:01+08:00">2021-01-05</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在<a target="_blank" rel="noopener" href="https://acatsmiling.github.io/2020/10/29/kafka-consumer/">前面的文章</a>中，有简单的介绍了 KafkaConsumer 的两种订阅模式，本篇文章对此进行扩展说明一下。</p>
<p>KafkaConsumer 的两种订阅模式， <code>subscribe ()</code> 模式和 <code>assign ()</code> 模式，前者是 topic 粒度 (使用 group 管理)，后者是 topic-partition 粒度 (用户自己去管理)。</p>
<h2 id="订阅模式"><a href="#订阅模式" class="headerlink" title="订阅模式"></a>订阅模式</h2><p>KafkaConsumer 为订阅模式提供了 4 种 API，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅指定的topic列表，并且会自动进行动态partition订阅</span></span><br><span class="line"><span class="comment">// 当发生以下情况时，会进行rebalance:1.订阅的topic列表改变；2.topic被创建或删除；3.consumer线程die；4.加一个新的consumer线程</span></span><br><span class="line"><span class="comment">// 当发生rebalance时，会唤醒ConsumerRebalanceListener线程</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Collection&lt;String&gt; topics, ConsumerRebalanceListener listener)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同上，但是这里没有设置listener</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Collection&lt;String&gt; topics)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅那些满足一定规则(pattern)的topic</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Pattern pattern, ConsumerRebalanceListener listener)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同上，但是这里没有设置listener</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Pattern pattern)</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>以上 4 种 API 都是按照 topic 级别去订阅，可以动态地获取其分配的 topic-partition，这是使用 <strong>Group 动态管理</strong>，它不能与手动 partition 管理一起使用。当监控到发生下面的事件时，Group 将会触发 rebalance 操作：</p>
<ol>
<li>订阅的 topic 列表变化；</li>
<li>topic 被创建或删除；</li>
<li>consumer group 的某个 consumer 实例挂掉；</li>
<li>一个新的 consumer 实例通过 join 方法加入到一个 group 中。</li>
</ol>
<p>在这种模式下，当 KafkaConsumer 调用 <code>poll ()</code> 方法时，第一步会首先加入到一个 group 中，并获取其分配的 topic-partition 列表，具体细节在前面的文章中已经分析过了。</p>
<p>这里介绍一下当调用 <code>subscribe ()</code> 方法之后，consumer 所做的事情，分两种情况介绍，一种按 topic 列表订阅，一种是按 pattern 模式订阅：</p>
<ul>
<li>topic 列表订阅</li>
</ul>
<p>topic 列表订阅，最终调用如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Subscribe to the given list of topics to get dynamically</span></span><br><span class="line"><span class="comment"> * assigned partitions. &lt;b&gt;Topic subscriptions are not incremental. This list will replace the current</span></span><br><span class="line"><span class="comment"> * assignment (if there is one).&lt;/b&gt; Note that it is not possible to combine topic subscription with group management</span></span><br><span class="line"><span class="comment"> * with manual partition assignment through &#123;<span class="doctag">@link</span> #assign(Collection)&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * If the given list of topics is empty, it is treated the same as &#123;<span class="doctag">@link</span> #unsubscribe()&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * As part of group management, the consumer will keep track of the list of consumers that belong to a particular</span></span><br><span class="line"><span class="comment"> * group and will trigger a rebalance operation if any one of the following events are triggered:</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;Number of partitions change for any of the subscribed topics</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;A subscribed topic is created or deleted</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;An existing member of the consumer group is shutdown or fails</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;A new member is added to the consumer group</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * When any of these events are triggered, the provided listener will be invoked first to indicate that</span></span><br><span class="line"><span class="comment"> * the consumer&#x27;s assignment has been revoked, and then again when the new assignment has been received.</span></span><br><span class="line"><span class="comment"> * Note that rebalances will only occur during an active call to &#123;<span class="doctag">@link</span> #poll(Duration)&#125;, so callbacks will</span></span><br><span class="line"><span class="comment"> * also only be invoked during that time.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The provided listener will immediately override any listener set in a previous call to subscribe.</span></span><br><span class="line"><span class="comment"> * It is guaranteed, however, that the partitions revoked/assigned through this interface are from topics</span></span><br><span class="line"><span class="comment"> * subscribed in this call. See &#123;<span class="doctag">@link</span> ConsumerRebalanceListener&#125; for more details.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> topics The list of topics to subscribe to</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> listener Non-null listener instance to get notifications on partition assignment/revocation for the</span></span><br><span class="line"><span class="comment"> *                 subscribed topics</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException If topics is null or contains null or empty elements, or if listener is null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalStateException If &#123;<span class="doctag">@code</span> subscribe()&#125; is called previously with pattern, or assign is called</span></span><br><span class="line"><span class="comment"> *                               previously (without a subsequent call to &#123;<span class="doctag">@link</span> #unsubscribe()&#125;), or if not</span></span><br><span class="line"><span class="comment"> *                               configured at-least one partition assignment strategy</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Collection&lt;String&gt; topics, ConsumerRebalanceListener listener)</span> </span>&#123;</span><br><span class="line">    acquireAndEnsureOpen();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        maybeThrowInvalidGroupIdException();</span><br><span class="line">        <span class="keyword">if</span> (topics == <span class="keyword">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Topic collection to subscribe to cannot be null&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (topics.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// treat subscribing to empty topic list as the same as unsubscribing</span></span><br><span class="line">            <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (String topic : topics) &#123;</span><br><span class="line">                <span class="keyword">if</span> (topic == <span class="keyword">null</span> || topic.trim().isEmpty())</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Topic collection to subscribe to cannot contain null or empty topic&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            throwIfNoAssignorsConfigured();</span><br><span class="line">            fetcher.clearBufferedDataForUnassignedTopics(topics);</span><br><span class="line">            log.info(<span class="string">&quot;Subscribed to topic(s): &#123;&#125;&quot;</span>, Utils.join(topics, <span class="string">&quot;, &quot;</span>));</span><br><span class="line">            <span class="comment">// 核心步骤在此处执行</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.subscriptions.subscribe(<span class="keyword">new</span> HashSet&lt;&gt;(topics), listener))</span><br><span class="line">                metadata.requestUpdateForNewTopics();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>将 SubscriptionType 类型设置为 <strong>AUTO_TOPICS</strong>，并更新 SubscriptionState 中记录的 subscription 属性 (记录的是订阅的 topic 列表)；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">subscribe</span><span class="params">(Set&lt;String&gt; topics, ConsumerRebalanceListener listener)</span> </span>&#123;</span><br><span class="line">    registerRebalanceListener(listener);</span><br><span class="line">    setSubscriptionType(SubscriptionType.AUTO_TOPICS);</span><br><span class="line">    <span class="keyword">return</span> changeSubscription(topics);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">changeSubscription</span><span class="params">(Set&lt;String&gt; topicsToSubscribe)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (subscription.equals(topicsToSubscribe))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    subscription = topicsToSubscribe;</span><br><span class="line">    <span class="keyword">if</span> (subscriptionType != SubscriptionType.USER_ASSIGNED) &#123;</span><br><span class="line">        groupSubscription = <span class="keyword">new</span> HashSet&lt;&gt;(groupSubscription);</span><br><span class="line">        groupSubscription.addAll(topicsToSubscribe);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        groupSubscription = <span class="keyword">new</span> HashSet&lt;&gt;(topicsToSubscribe);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>请求更新 metadata。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">requestUpdateForNewTopics</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Override the timestamp of last refresh to let immediate update.</span></span><br><span class="line">    <span class="keyword">this</span>.lastRefreshMs = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.requestVersion++;</span><br><span class="line">    requestUpdate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Request an update of the current cluster metadata info, return the current updateVersion before the update</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">requestUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.needUpdate = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.updateVersion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>pattern 模式订阅</li>
</ul>
<p>pattern 模式订阅，最终调用如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Subscribe to all topics matching specified pattern to get dynamically assigned partitions.</span></span><br><span class="line"><span class="comment"> * The pattern matching will be done periodically against all topics existing at the time of check.</span></span><br><span class="line"><span class="comment"> * This can be controlled through the &#123;<span class="doctag">@code</span> metadata.max.age.ms&#125; configuration: by lowering</span></span><br><span class="line"><span class="comment"> * the max metadata age, the consumer will refresh metadata more often and check for matching topics.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * See &#123;<span class="doctag">@link</span> #subscribe(Collection, ConsumerRebalanceListener)&#125; for details on the</span></span><br><span class="line"><span class="comment"> * use of the &#123;<span class="doctag">@link</span> ConsumerRebalanceListener&#125;. Generally rebalances are triggered when there</span></span><br><span class="line"><span class="comment"> * is a change to the topics matching the provided pattern and when consumer group membership changes.</span></span><br><span class="line"><span class="comment"> * Group rebalances only take place during an active call to &#123;<span class="doctag">@link</span> #poll(Duration)&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pattern Pattern to subscribe to</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> listener Non-null listener instance to get notifications on partition assignment/revocation for the</span></span><br><span class="line"><span class="comment"> *                 subscribed topics</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException If pattern or listener is null</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalStateException If &#123;<span class="doctag">@code</span> subscribe()&#125; is called previously with topics, or assign is called</span></span><br><span class="line"><span class="comment"> *                               previously (without a subsequent call to &#123;<span class="doctag">@link</span> #unsubscribe()&#125;), or if not</span></span><br><span class="line"><span class="comment"> *                               configured at-least one partition assignment strategy</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Pattern pattern, ConsumerRebalanceListener listener)</span> </span>&#123;</span><br><span class="line">    maybeThrowInvalidGroupIdException();</span><br><span class="line">    <span class="keyword">if</span> (pattern == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Topic pattern to subscribe to cannot be null&quot;</span>);</span><br><span class="line"></span><br><span class="line">    acquireAndEnsureOpen();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        throwIfNoAssignorsConfigured();</span><br><span class="line">        log.info(<span class="string">&quot;Subscribed to pattern: &#x27;&#123;&#125;&#x27;&quot;</span>, pattern);</span><br><span class="line">        <span class="keyword">this</span>.subscriptions.subscribe(pattern, listener);</span><br><span class="line">        <span class="keyword">this</span>.coordinator.updatePatternSubscription(metadata.fetch());</span><br><span class="line">        <span class="keyword">this</span>.metadata.requestUpdateForNewTopics();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>将 SubscriptionType 类型设置为 <strong>AUTO_PATTERN</strong>，并更新 SubscriptionState 中记录的 subscribedPattern 属性，设置为 pattern；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Pattern pattern, ConsumerRebalanceListener listener)</span> </span>&#123;</span><br><span class="line">    registerRebalanceListener(listener);</span><br><span class="line">    setSubscriptionType(SubscriptionType.AUTO_PATTERN);</span><br><span class="line">    <span class="keyword">this</span>.subscribedPattern = pattern;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>调用 coordinator 的 <code>updatePatternSubscription ()</code> 方法，遍历所有 topic 的 metadata，找到所有满足 pattern 的 topic 列表，更新到 SubscriptionState 的 subscriptions 属性，并请求更新 Metadata；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePatternSubscription</span><span class="params">(Cluster cluster)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Set&lt;String&gt; topicsToSubscribe = cluster.topics().stream()</span><br><span class="line">            .filter(subscriptions::matchesSubscribedPattern)</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">    <span class="keyword">if</span> (subscriptions.subscribeFromPattern(topicsToSubscribe))</span><br><span class="line">        metadata.requestUpdateForNewTopics();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">subscribeFromPattern</span><span class="params">(Set&lt;String&gt; topics)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (subscriptionType != SubscriptionType.AUTO_PATTERN)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Attempt to subscribe from pattern while subscription type set to &quot;</span> +</span><br><span class="line">                                           subscriptionType);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> changeSubscription(topics);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">changeSubscription</span><span class="params">(Set&lt;String&gt; topicsToSubscribe)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (subscription.equals(topicsToSubscribe))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    subscription = topicsToSubscribe;</span><br><span class="line">    <span class="keyword">if</span> (subscriptionType != SubscriptionType.USER_ASSIGNED) &#123;</span><br><span class="line">        groupSubscription = <span class="keyword">new</span> HashSet&lt;&gt;(groupSubscription);</span><br><span class="line">        groupSubscription.addAll(topicsToSubscribe);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        groupSubscription = <span class="keyword">new</span> HashSet&lt;&gt;(topicsToSubscribe);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">requestUpdateForNewTopics</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Override the timestamp of last refresh to let immediate update.</span></span><br><span class="line">    <span class="keyword">this</span>.lastRefreshMs = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">this</span>.requestVersion++;</span><br><span class="line">    requestUpdate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Request an update of the current cluster metadata info, return the current updateVersion before the update</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">requestUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.needUpdate = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.updateVersion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他部分，两者基本一样，只是 pattern 模型在每次更新 topic-metadata 时，获取全局的 topic 列表，如果发现有新加入的符合条件的 topic，就立马去订阅，其他的地方，包括 group 管理、topic-partition 的分配都是一样的。</p>
<h2 id="分配模式"><a href="#分配模式" class="headerlink" title="分配模式"></a>分配模式</h2><p>当调用 <code>assign ()</code> 方法手动分配 topic-partition 列表时，不会使用 consumer 的 Group 管理机制，也即是当 consumer group member 变化或 topic 的 metadata 信息变化时，不会触发 rebalance 操作。比如：当 topic 的 partition 增加时，这里无法感知，需要用户进行相应的处理，Apache Flink 就是使用的这种方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Manually assign a list of partitions to this consumer. This interface does not allow for incremental assignment</span></span><br><span class="line"><span class="comment"> * and will replace the previous assignment (if there is one).</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * If the given list of topic partitions is empty, it is treated the same as &#123;<span class="doctag">@link</span> #unsubscribe()&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Manual topic assignment through this method does not use the consumer&#x27;s group management</span></span><br><span class="line"><span class="comment"> * functionality. As such, there will be no rebalance operation triggered when group membership or cluster and topic</span></span><br><span class="line"><span class="comment"> * metadata change. Note that it is not possible to use both manual partition assignment with &#123;<span class="doctag">@link</span> #assign(Collection)&#125;</span></span><br><span class="line"><span class="comment"> * and group assignment with &#123;<span class="doctag">@link</span> #subscribe(Collection, ConsumerRebalanceListener)&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * If auto-commit is enabled, an async commit (based on the old assignment) will be triggered before the new</span></span><br><span class="line"><span class="comment"> * assignment replaces the old one.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> partitions The list of partitions to assign this consumer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalArgumentException If partitions is null or contains null or empty topics</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalStateException If &#123;<span class="doctag">@code</span> subscribe()&#125; is called previously with topics or pattern</span></span><br><span class="line"><span class="comment"> *                               (without a subsequent call to &#123;<span class="doctag">@link</span> #unsubscribe()&#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">assign</span><span class="params">(Collection&lt;TopicPartition&gt; partitions)</span> </span>&#123;</span><br><span class="line">    acquireAndEnsureOpen();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (partitions == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Topic partition collection to assign to cannot be null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (partitions.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (TopicPartition tp : partitions) &#123;</span><br><span class="line">                String topic = (tp != <span class="keyword">null</span>) ? tp.topic() : <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (topic == <span class="keyword">null</span> || topic.trim().isEmpty())</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Topic partitions to assign to cannot have null or empty topic&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            fetcher.clearBufferedDataForUnassignedPartitions(partitions);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// make sure the offsets of topic partitions the consumer is unsubscribing from</span></span><br><span class="line">            <span class="comment">// are committed since there will be no following rebalance</span></span><br><span class="line">            <span class="keyword">if</span> (coordinator != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">this</span>.coordinator.maybeAutoCommitOffsetsAsync(time.milliseconds());</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;Subscribed to partition(s): &#123;&#125;&quot;</span>, Utils.join(partitions, <span class="string">&quot;, &quot;</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.subscriptions.assignFromUser(<span class="keyword">new</span> HashSet&lt;&gt;(partitions)))</span><br><span class="line">                metadata.requestUpdateForNewTopics();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>assign ()</code> 方法是手动向 consumer 分配一些 topic-partition 列表，并且这个接口不允许增加分配的 topic-partition 列表，将会覆盖之前分配的 topic-partition 列表，如果给定的 topic-partition 列表为空，它的作用将会与 <code>unsubscribe ()</code> 方法一样。</p>
<p>这种手动 topic 分配也不会使用 consumer 的 group 管理，当 group 的 member 变化或 topic 的 metadata 变化时，也不会触发 rebalance 操作。</p>
</blockquote>
<p>这里所说的 consumer 的 group 管理，就是前面所说的 consumer 如何加入 group 的管理过程。如果使用的是 assign 模式，也即是非 AUTO_TOPICS 或 AUTO_PATTERN 模式时，consumer 实例在调用 <code>poll ()</code> 方法时，不会向 GroupCoordinator 发送 join-group、sync-group、heartbeat 请求，也就是说 GroupCoordinator 拿不到这个 consumer 实例的相关信息，也不会去维护这个 member 是否存活，这种情况下就需要用户自己管理自己的处理程序。但是这种模式可以进行 offset commit，这将在下一篇文章进行分析。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>根据上面的讲述，这里做一下小结，两种模式对比如下图所示：</p>
<p><img src="/2020/11/24/kafka-consumer-subscribeandassign/image-20201124145646131.png" alt="image-20201124145646131"></p>
<p>简单说明如下：</p>
<table>
<thead>
<tr>
<th align="center">模式</th>
<th align="center">不同之处</th>
<th align="center">相同之处</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>subscribe ()</code></td>
<td align="center">使用 Kafka group 管理，自动进行 rebalance 操作</td>
<td align="center">可以在 Kafka 保存 offset</td>
</tr>
<tr>
<td align="center"><code>assign ()</code></td>
<td align="center">用户自己进行相关的处理</td>
<td align="center">也可以进行 offset commit，但是尽量保证 <code>group.id</code> 唯一性，如果使用一个与上面模式一样的 group，offset commit 请求将会被拒绝</td>
</tr>
</tbody></table>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://matt33.com/2017/11/18/consumer-subscribe/">https://matt33.com/2017/11/18/consumer-subscribe/</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/maven/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/18/maven/" class="post-title-link" itemprop="url">maven 的基础使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-18 15:18:48" itemprop="dateCreated datePublished" datetime="2020-11-18T15:18:48+08:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-09 15:50:19" itemprop="dateModified" datetime="2021-04-09T15:50:19+08:00">2021-04-09</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="maven-的功能"><a href="#maven-的功能" class="headerlink" title="maven 的功能"></a>maven 的功能</h2><p>maven 是一个项目管理工具，主要作用是在项目开发阶段对项目进行<strong>依赖管理</strong>和<strong>项目构建</strong>。</p>
<ul>
<li>依赖管理：仅仅通过 jar 包的几个属性，就能确定唯一的 jar 包，在指定的文件 pom.xml 中，只要写入这些依赖属性，就会自动下载并管理 jar 包。</li>
</ul>
<ul>
<li>项目构建：内置很多的插件与生命周期，支持多种任务，比如校验、编译、测试、打包、部署、发布…</li>
</ul>
<ul>
<li>项目的知识管理：管理项目相关的其他内容，比如开发者信息，版本等等。</li>
</ul>
<h2 id="maven-的安装与配置"><a href="#maven-的安装与配置" class="headerlink" title="maven 的安装与配置"></a>maven 的安装与配置</h2><ul>
<li>下载，地址：<a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi">http://maven.apache.org/download.cgi</a></li>
</ul>
<p><img src="/2020/11/18/maven/image-20201118160234868.png" alt="image-20201118160234868"></p>
<blockquote>
<p>注意：安装 maven 之前，必须先确保你的机器中已经安装了 jdk，如果是 maven 3 则必须 jdk 1.7 以上。</p>
</blockquote>
<ul>
<li>解压，添加环境变量 <strong>MAVEN_HOME</strong>，值为解压后的 maven 路径。</li>
</ul>
<p><img src="/2020/11/18/maven/1605703683(1).jpg" alt="1605703683(1)"></p>
<ul>
<li>在 <strong>Path</strong> 环境变量的变量值末尾添加 <strong>%MAVEN_HOME%\bin;</strong> 。</li>
</ul>
<p><img src="/2020/11/18/maven/1605703778(1).jpg" alt="1605703778(1)"></p>
<ul>
<li>在 cmd 窗口输入 <strong>mvn –version</strong>，显示 maven 版本信息，说明安装配置成功。</li>
</ul>
<p><img src="/2020/11/18/maven/1605704022(1).jpg" alt="1605704022(1)"></p>
<h2 id="在-IDEA-中使用-maven"><a href="#在-IDEA-中使用-maven" class="headerlink" title="在 IDEA 中使用 maven"></a>在 IDEA 中使用 maven</h2><p><img src="/2020/11/18/maven/image-20210120172317523.png" alt="image-20210120172317523"></p>
<h2 id="maven-的仓库"><a href="#maven-的仓库" class="headerlink" title="maven 的仓库"></a>maven 的仓库</h2><p>maven 仓库分为本地仓库和远程仓库，而远程仓库又分为 maven 中央仓库、其他远程仓库和私服 (私有服务器)。其中，中央仓库是由 maven 官方提供的，而私服就需要我们自己搭建。</p>
<p><img src="/2020/11/18/maven/image-20210409155011986.png" alt="image-20210409155011986"></p>
<h3 id="本地仓库"><a href="#本地仓库" class="headerlink" title="本地仓库"></a>本地仓库</h3><p>默认情况下，不管 linux 还是 windows，每个用户在自己的用户目录下都有一个路径名为 .m2\repository 的仓库目录，如：C:\Users\XiSun\.m2\repository。如果不自定义本地仓库的地址，则会将下载的构件放到该目录下。</p>
<p>修改 maven 根目录下的 conf 文件夹中的 setting.xml 文件，可以自定义本地仓库地址，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:\Program Files\Maven\apache-maven-3.6.3-maven-repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>运行 maven 的时候，maven 所需要的任何构件都是直接从本地仓库获取的。如果本地仓库没有，它会首先尝试从远程仓库下载构件至本地仓库，然后再使用本地仓库的构件。</strong></p>
<h3 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h3><h4 id="maven-中央仓库"><a href="#maven-中央仓库" class="headerlink" title="maven 中央仓库"></a>maven 中央仓库</h4><p>maven 中央仓库，是由 maven 社区提供的仓库，其中包含了大量常用的库。一般来说，简单的  java 项目依赖的构件都可以在这里下载到。</p>
<blockquote>
<p>在 maven 安装目录的 lib 目录下，有一个 maven-model-builder-3.6.1.jar，里面的 org/apache/maven/model/pom-4.0.0.xml 文件定义了 maven 默认中央仓库的地址：<a target="_blank" rel="noopener" href="https://repo.maven.apache.org/maven2">https://repo.maven.apache.org/maven2</a></p>
</blockquote>
<p>因为 maven 中央仓库默认在国外，国内使用难免很慢，推荐将其更换为阿里云的镜像。</p>
<p>全局配置：修改 maven 根目录下的 conf 文件夹中的 setting.xml 文件，在 mirrors 节点上，添加如下内容。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>局部配置：修改项目的 pom.xml 文件，在 repositories 上，添加如下内容。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">    	<span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>更多中央仓库地址参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/Hello_World_QWP/article/details/82463799%E3%80%82">https://blog.csdn.net/Hello_World_QWP/article/details/82463799。</a></p>
</blockquote>
<h4 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h4><p>maven 私服就是公司局域网内的 maven 远程仓库，每个员工的电脑上安装 maven 软件并且连接 maven 私服，程序员可以将自己开发的项目打成 jar 并发布到私服，其它项目组成员就可以从私服下载所依赖的 jar。</p>
<p>私服还充当一个代理服务器的角色，当私服上没有 jar 包时，会从 maven 中央仓库自动下载。</p>
<p>nexus 是一个 maven 仓库管理器 (其实就是一个软件)，nexus 可以充当 maven 私服，同时 nexus 还提供强大的仓库管理、构件搜索等功能。</p>
<p>如果 maven 在中央仓库中也找不到依赖的文件，它会停止构建过程并输出错误信息到控制台。为避免这种情况，maven 提供了远程仓库的概念，它是开发人员自己定制的仓库，包含了所需要的代码库或者其他工程中用到的 jar 文件。</p>
<h5 id="搭建-maven-私服"><a href="#搭建-maven-私服" class="headerlink" title="搭建 maven 私服"></a>搭建 maven 私服</h5><ol>
<li><p>下载 nexus，地址：<a target="_blank" rel="noopener" href="https://help.sonatype.com/repomanager2/download/download-archives---repository-manager-oss">https://help.sonatype.com/repomanager2/download/download-archives---repository-manager-oss</a></p>
</li>
<li><p>安装 nexus</p>
</li>
</ol>
<p>将下载的压缩包进行解压，进入 bin 目录：</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8717.png" alt="1559551510928"></p>
<p>打开 cmd 窗口并进入上面 bin 目录下，执行 <code>nexus.bat install</code> 命令安装服务 (注意需要以管理员身份运行 cmd 命令)：</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8718.png" alt="1559551531544"></p>
<ol start="3">
<li>启动 nexus</li>
</ol>
<p>经过前面命令已经完成 nexus 的安装，可以通过如下两种方式启动 nexus 服务。</p>
<ul>
<li>在 Windows 系统服务中启动 nexus</li>
</ul>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8719.png" alt="1559551564441"></p>
<ul>
<li>在命令行执行 <code>nexus.bat start</code> 命令启动 nexus</li>
</ul>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8720.png" alt="1559551591730"></p>
<ol start="4">
<li>访问 nexus</li>
</ol>
<p>启动 nexus 服务后，访问 <a target="_blank" rel="noopener" href="http://localhost:8081/nexus%EF%BC%8C%E7%82%B9%E5%87%BB%E5%8F%B3%E4%B8%8A%E8%A7%92">http://localhost:8081/nexus，点击右上角</a> LogIn 按钮，使用默认用户名 admin 和密码 admin123 登录系统。</p>
<p>登录成功后，点击左侧菜单 Repositories，可以看到 nexus 内置的仓库列表，如下图：</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%87.png" alt="1559551620133"></p>
<h5 id="nexus-仓库类型"><a href="#nexus-仓库类型" class="headerlink" title="nexus 仓库类型"></a>nexus 仓库类型</h5><p>通过前面的仓库列表可以看到，nexus 默认内置了很多仓库，这些仓库可以划分为 4 种类型，每种类型的仓库用于存放特定的 jar 包，具体说明如下。</p>
<ul>
<li>hosted：宿主仓库，部署自己的 jar 到这个类型的仓库，包括 Releases 和 Snapshots 两部分，Releases 为公司内部发布版本仓库，Snapshots 为公司内部测试版本仓库。</li>
</ul>
<ul>
<li><p>proxy：代理仓库，用于代理远程的公共仓库，如 maven 中央仓库，用户连接私服，私服自动去中央仓库下载 jar 包或者插件。</p>
</li>
<li><p>group：仓库组，用来合并多个 hosted 或 proxy 仓库，通常我们配置自己的 maven 连接仓库组。</p>
</li>
<li><p>virtual (虚拟)：兼容 Maven1 版本的 jar 或者插件。</p>
</li>
</ul>
<h5 id="nexus-仓库类型与安装目录对应关系"><a href="#nexus-仓库类型与安装目录对应关系" class="headerlink" title="nexus 仓库类型与安装目录对应关系"></a>nexus 仓库类型与安装目录对应关系</h5><p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8722.png" alt="1559551752012"></p>
<h5 id="将项目发布到-maven-私服"><a href="#将项目发布到-maven-私服" class="headerlink" title="将项目发布到 maven 私服"></a>将项目发布到 maven 私服</h5><p>maven 私服是搭建在公司局域网内的 maven 仓库，公司内的所有开发团队都可以使用。例如技术研发团队开发了一个基础组件，就可以将这个基础组件打成 jar 包发布到私服，其他团队成员就可以从私服下载这个 jar 包到本地仓库并在项目中使用。</p>
<p>具体操作步骤如下：</p>
<ol>
<li>配置 maven 的 settings.xml 文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：一定要在 idea 工具中引入的 maven 的 settings.xml 文件中配置。</p>
</blockquote>
<ol start="2">
<li>配置项目的 pom.xml 文件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">id</span>&gt;</span>releases<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/repositories/releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">   		<span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/repositories/snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>执行 <code>mvn clean deploy</code> 命令</li>
</ol>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8723.png" alt="1559551977984"></p>
<h5 id="从私服下载-jar-到本地仓库"><a href="#从私服下载-jar-到本地仓库" class="headerlink" title="从私服下载 jar 到本地仓库"></a>从私服下载 jar 到本地仓库</h5><p>前面我们已经完成了将本地项目打成 jar 包发布到 maven 私服，下面我们就需要从 maven 私服下载 jar 包到本地仓库。</p>
<p>具体操作步骤如下：</p>
<ol>
<li>在 maven 的 settings.xml 文件中配置下载模板</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--仓库地址，即nexus仓库组的地址--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--是否下载releases构件--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--是否下载snapshots构件--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 插件仓库，maven的运行依赖插件，也需要从私服下载插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>public<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Public Repositories<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 maven 的 settings.xml 文件中配置激活下载模板</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="将第三方-jar-安装到本地仓库和-maven-私服"><a href="#将第三方-jar-安装到本地仓库和-maven-私服" class="headerlink" title="将第三方 jar 安装到本地仓库和 maven 私服"></a>将第三方 jar 安装到本地仓库和 maven 私服</h3><p>在 maven 工程的 pom.xml 文件中配置某个 jar 包的坐标后，如果本地的 maven 仓库不存在这个 jar 包，maven 工具会自动到配置的 maven 私服下载，如果私服中也不存在，maven 私服就会从 maven 中央仓库进行下载。</p>
<p>但是并不是所有的 jar 包都可以从中央仓库下载到，比如常用的 Oracle 数据库驱动的 jar 包在中央仓库就不存在。此时需要到 Oracle 的官网下载驱动 jar 包，然后将此 jar 包通过 maven 命令安装到我们本地的 maven 仓库或者 maven 私服中，这样在 maven 项目中就可以使用 maven 坐标引用到此 jar 包了。</p>
<h4 id="将第三方-jar-安装到本地仓库"><a href="#将第三方-jar-安装到本地仓库" class="headerlink" title="将第三方 jar 安装到本地仓库"></a>将第三方 jar 安装到本地仓库</h4><ol>
<li><p>下载 Oracle 的 jar 包</p>
</li>
<li><p>mvn install 命令进行安装</p>
   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -Dfile=ojdbc14-10.2.0.4.0.jar -DgroupId=com.oracle -DartifactId=ojdbc14 –Dversion=10.2.0.4.0 -Dpackaging=jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看本地 maven 仓库，确认安装是否成功</p>
</li>
</ol>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%8724.png" alt="1559552325997"></p>
<p>再比如安装 Classifier4J-0.6.jar，打开 cmd 窗口，切换到 jar 包所在目录，输入 mvn 命令，命令格式如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -DgroupId=net.sf(自定义，需要与pom.xml文件中的groupId一致) -DartifactId=classifier4j(自定义，需要与pom.xml文件中的artifaceId一致) -Dversion=0.6(自定义，需要与pom.xml文件中的version一致) -Dpackaging=jar -Dfile=Classifier4J-0.6.jar(本地jar包)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-DgroupId、-DartifactId、-Dversion、-Dpackaging、-Dfile 前面均有一个空格。</p>
</blockquote>
<p>使用示例如下：</p>
<p><img src="/2020/11/18/maven/image-20201118153146623.png"></p>
<p>之后，在 maven 的本地仓库，根据 groupId —— artifactId —— version，即可找到打包进来的本地 jar 包，也可以在项目中的 pom.xml 文件引入：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>classifier4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="将第三方-jar-安装到-maven-私服"><a href="#将第三方-jar-安装到-maven-私服" class="headerlink" title="将第三方 jar 安装到 maven 私服"></a>将第三方 jar 安装到 maven 私服</h4><ol>
<li><p>下载 Oracle 的 jar 包</p>
</li>
<li><p>在 maven 的 settings.xml 配置文件中配置第三方仓库的 server 信息</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>thirdparty<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>执行 mvn deploy 命令进行安装</p>
   <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy:deploy-file -Dfile=ojdbc14-10.2.0.4.0.jar -DgroupId=com.oracle -DartifactId=ojdbc14 –Dversion=10.2.0.4.0 -Dpackaging=jar –Durl=http://localhost:8081/nexus/content/repositories/thirdparty/ -DrepositoryId=thirdparty</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="maven-的依赖搜索顺序"><a href="#maven-的依赖搜索顺序" class="headerlink" title="maven 的依赖搜索顺序"></a>maven 的依赖搜索顺序</h2><p>一般情况下，当执行 maven 构建命令时，maven 按照以下顺序查找依赖的库：</p>
<ul>
<li><strong>步骤 1</strong>：在本地仓库中搜索，如果找不到，执行步骤 2，如果找到了则执行其他操作。</li>
<li><strong>步骤 2</strong>：在中央仓库中搜索，如果找不到，并且有一个或多个远程仓库已经设置，则执行步骤 4，如果找到了则下载到本地仓库中以备将来引用。</li>
<li><strong>步骤 3</strong>：如果远程仓库没有被设置，maven 将简单的停滞处理并抛出错误 (无法找到依赖的文件)。</li>
<li><strong>步骤 4</strong>：在一个或多个远程仓库中搜索依赖的文件，如果找到则下载到本地仓库以备将来引用，否则 maven 将停止处理并抛出错误 (无法找到依赖的文件)。</li>
</ul>
<h2 id="maven-的常用命令"><a href="#maven-的常用命令" class="headerlink" title="maven 的常用命令"></a>maven 的常用命令</h2><ul>
<li>clean：     清理</li>
</ul>
<ul>
<li>compile：编译</li>
</ul>
<ul>
<li>test：        测试</li>
</ul>
<ul>
<li>package：打包</li>
</ul>
<ul>
<li>install：    安装</li>
</ul>
<h2 id="maven-的坐标书写规范"><a href="#maven-的坐标书写规范" class="headerlink" title="maven 的坐标书写规范"></a>maven 的坐标书写规范</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="maven-的依赖范围"><a href="#maven-的依赖范围" class="headerlink" title="maven 的依赖范围"></a>maven 的依赖范围</h2><table>
<thead>
<tr>
<th>依赖范围</th>
<th>对于编译 classpath 有效</th>
<th>对于测试 classpath 有效</th>
<th>对于运行 classpath 有效</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>compile</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>spring-core</td>
</tr>
<tr>
<td>test</td>
<td>-</td>
<td>Y</td>
<td>-</td>
<td>Junit</td>
</tr>
<tr>
<td>provided</td>
<td>Y</td>
<td>Y</td>
<td>-</td>
<td>servlet-api</td>
</tr>
<tr>
<td>runtime</td>
<td>-</td>
<td>Y</td>
<td>Y</td>
<td>JDBC 驱动</td>
</tr>
<tr>
<td>system</td>
<td>Y</td>
<td>Y</td>
<td>-</td>
<td>本地的，maven 仓库之外的类库</td>
</tr>
</tbody></table>
<p>默认使用 compile 依赖范围。</p>
<p>使用 system 依赖范围的依赖时，必须通过 systemPath 元素显示地指定依赖文件的路径。由于此类依赖不是通过 maven 仓库解析的，而且往往与本机系统绑定，可能构成构建的不可移植，因此应该谨慎使用。systemPath 元素可以引用环境变量，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.sql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jdbc-stdext<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">Version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;java.home&#125;/lib/rt.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="maven-的依赖传递"><a href="#maven-的依赖传递" class="headerlink" title="maven 的依赖传递"></a>maven 的依赖传递</h2><h3 id="什么是依赖传递"><a href="#什么是依赖传递" class="headerlink" title="什么是依赖传递"></a>什么是依赖传递</h3><p>在 maven 中，依赖是可以传递的，假设存在三个项目，分别是项目 A，项目 B 以及项目 C。假设 C 依赖 B，B 依赖 A，那么根据 maven 项目依赖的特征，不难推出项目 C 也依赖 A。如图所示：</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%873.png" alt="1559549336921"></p>
<p>​                         <img src="/2020/11/18/maven/%E5%9B%BE%E7%89%874.png" alt="1559549377105"></p>
<p>通过上面的图可以看到， 在一个 web 项目中，直接依赖了 spring-webmvc，而 spring-webmvc 依赖了 spring-aop、spring-beans 等。最终的结果就是在这个 web 项目中，间接依赖了 spring-aop、spring-beans 等。</p>
<h3 id="什么是依赖冲突"><a href="#什么是依赖冲突" class="headerlink" title="什么是依赖冲突"></a>什么是依赖冲突</h3><p>由于依赖传递现象的存在，如图所示，spring-webmvc 依赖 spirng-beans-4.2.4，spring-aop 依赖 spring-beans-5.0.2，现在 spirng-beans-4.2.4 已经加入到了工程中，而我们希望 spring-beans-5.0.2 加入工程。这就造成了依赖冲突。</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%875.png" alt="1559549435874"></p>
<h3 id="如何解决依赖冲突"><a href="#如何解决依赖冲突" class="headerlink" title="如何解决依赖冲突"></a>如何解决依赖冲突</h3><ol>
<li>使用 maven 提供的依赖调节原则 </li>
</ol>
<ol start="2">
<li><p>排除依赖</p>
</li>
<li><p>锁定版本 </p>
</li>
</ol>
<h4 id="依赖调节原则"><a href="#依赖调节原则" class="headerlink" title="依赖调节原则"></a>依赖调节原则</h4><h5 id="路径近者优先原则"><a href="#路径近者优先原则" class="headerlink" title="路径近者优先原则"></a>路径近者优先原则</h5><p>当依赖声明不在同一个 pom.xml 文件中时，或者说存在依赖传递时，路径最短的 jar 包将被选为最终依赖。</p>
<p><img src="/2020/11/18/maven/image-20210118164236303.png" alt="image-20210118164236303"></p>
<p>上图中，Jar2.0 将被选为最终依赖。</p>
<h5 id="第一声明者优先原则"><a href="#第一声明者优先原则" class="headerlink" title="第一声明者优先原则"></a>第一声明者优先原则</h5><p>当依赖声明不在同一个 pom.xml 文件中时，或者说存在依赖传递时，并且依赖传递长度相同时，最先声明的依赖将被选为最终依赖。</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%876.png" alt="1559549523188"></p>
<p>上图中，spring-aop 和 spring-webmvc 都依赖了 spring-beans，但是因为 spring-aop 在前面，所以最终使用的 spring-beans 是由 spring-aop 传递过来的，而 spring-webmvc 传递过来的 spring-beans 则被忽略了。</p>
<h5 id="覆盖优先"><a href="#覆盖优先" class="headerlink" title="覆盖优先"></a>覆盖优先</h5><p>当依赖声明在同一个 pom.xml 文件中时，后面声明的依赖将覆盖前面声明的依赖。</p>
<h4 id="排除依赖"><a href="#排除依赖" class="headerlink" title="排除依赖"></a>排除依赖</h4><p>使用 exclusions 标签将传递过来的依赖排除出去。</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%877.png" alt="1559549561284"></p>
<h4 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h4><p>采用直接锁定版本的方法确定依赖 jar 包的版本，版本锁定后则不考虑依赖的声明顺序或依赖的路径，以锁定的版本为准添加到工程中，此方法在企业开发中经常使用。</p>
<p>版本锁定的使用方式：</p>
<p>第一步：在 dependencyManagement 标签中锁定依赖的版本</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%878.png" alt="1559549614223"></p>
<p>第二步：在 dependencies 标签中声明需要导入的 maven 坐标</p>
<p><img src="/2020/11/18/maven/%E5%9B%BE%E7%89%879.png" alt="1559549637900"></p>
<h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>能查找依赖的网站：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">https://mvnrepository.com/</a></p>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903543711907848">https://juejin.cn/post/6844903543711907848</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a1d9fd97f568">https://www.jianshu.com/p/a1d9fd97f568</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="XiSun"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">XiSun</p>
  <div class="site-description" itemprop="description">心如止水者，虽世间繁华之红尘纷扰，已然空无一物</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XiSun</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">20:53</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
