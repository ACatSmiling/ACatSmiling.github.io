<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Spring WebFlux 介绍 官方文档：https:&#x2F;&#x2F;docs.spring.io&#x2F;spring-framework&#x2F;docs&#x2F;5.2.7.RELEASE&#x2F;spring-framework-reference&#x2F;web-reactive.html#spring-webflux  Spring WebFlux 是 Spring5 添加的新模块，用于 web 开发，功能和 Spring MVC">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 之 WebFlux">
<meta property="og:url" content="http://example.com/2021/04/23/spring-webflux/index.html">
<meta property="og:site_name" content="XiSun的博客">
<meta property="og:description" content="Spring WebFlux 介绍 官方文档：https:&#x2F;&#x2F;docs.spring.io&#x2F;spring-framework&#x2F;docs&#x2F;5.2.7.RELEASE&#x2F;spring-framework-reference&#x2F;web-reactive.html#spring-webflux  Spring WebFlux 是 Spring5 添加的新模块，用于 web 开发，功能和 Spring MVC">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423160134239.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423215925415.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423220045483.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423220116869.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423220157174.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423220910001.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423220943660.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210424185319673.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210424185543581.png">
<meta property="og:image" content="http://example.com/2021/04/23/spring-webflux/image-20210425094903417.png">
<meta property="article:published_time" content="2021-04-23T07:35:11.000Z">
<meta property="article:modified_time" content="2021-04-25T07:28:18.074Z">
<meta property="article:author" content="XiSun">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/04/23/spring-webflux/image-20210423160134239.png">

<link rel="canonical" href="http://example.com/2021/04/23/spring-webflux/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spring 之 WebFlux | XiSun的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">XiSun的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Learning is endless</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/23/spring-webflux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring 之 WebFlux
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-23 15:35:11" itemprop="dateCreated datePublished" datetime="2021-04-23T15:35:11+08:00">2021-04-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-25 15:28:18" itemprop="dateModified" datetime="2021-04-25T15:28:18+08:00">2021-04-25</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>32k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>29 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Spring-WebFlux-介绍"><a href="#Spring-WebFlux-介绍" class="headerlink" title="Spring WebFlux 介绍"></a>Spring WebFlux 介绍</h2><ul>
<li><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-framework/docs/5.2.7.RELEASE/spring-framework-reference/web-reactive.html#spring-webflux">https://docs.spring.io/spring-framework/docs/5.2.7.RELEASE/spring-framework-reference/web-reactive.html#spring-webflux</a></p>
</li>
<li><p>Spring WebFlux 是 Spring5 添加的新模块，用于 web 开发，功能和 Spring MVC 类似的，底层实现不同。</p>
</li>
<li><p>Spring WebFlux 是契合使用<strong>响应式编程</strong>而出现的框架。</p>
</li>
<li><p>传统的 web 框架，比如 Spring MVC、Struts2 等，是基于 Servlet 容器运行的。<strong>Spring WebFlux 是一种异步非阻塞的框架，异步非阻塞的框架在 Servlet3.1 以后才支持，其核心是基于 Reactor 的相关 API 实现的。</strong></p>
</li>
<li><p>异步非阻塞：</p>
<ul>
<li>异步和同步针对调用者：调用者发送请求，如果等着对方回应之后才去做其他事情就是同步，如果发送请求之后不等着对方回应就去做其他事情就是异步。</li>
<li>阻塞和非阻塞针对被调用者：被调用者收到请求时，如果做完请求任务之后才给出反馈就是阻塞，如果收到请求之后马上给出反馈，然后再去做任务就是非阻塞。<ul>
<li>阻塞需要等待，非阻塞不需要等待。</li>
</ul>
</li>
</ul>
</li>
<li><p>Spring WebFlux 的特点：</p>
<ul>
<li>非阻塞式：能够在有限的资源下，提高系统的吞吐量和伸缩性，从而处理更多的请求。Spring WebFlux 是以 Reactor 为基础来实现的响应式编程框架。</li>
<li>函数式编程：Spring5 框架基于 Java8，Spring Webflux 能够使用 Java8 的函数式编程方式来实现路由请求。</li>
</ul>
</li>
<li><p>Spring WebFlux 和  Spring MVC 的对比：</p>
<img src="/2021/04/23/spring-webflux/image-20210423160134239.png" alt="image-20210423160134239" style="zoom: 80%;">

<ul>
<li>两个框架都可以使用注解方式操作，也都可以运行在 Tomcat 等容器中。</li>
<li>Spring MVC 采用命令式编程，Spring WebFlux 采用异步响应式编程。</li>
</ul>
</li>
</ul>
<h2 id="响应式编程概述"><a href="#响应式编程概述" class="headerlink" title="响应式编程概述"></a>响应式编程概述</h2><ul>
<li><p>响应式编程是一种面向数据流和变化传播的编程范式。这意味着可以在编程语言中很方便地表达静态或动态的数据流，而相关的计算模型会自动将变化的值通过数据流进行传播。</p>
<ul>
<li>例如，对于 a = b + c 这个表达式的处理，在命令式编程中，会先计算 b + c 的结果，再把此结果赋值给变量 a，因此 b，c 两值的变化不会对变量 a 产生影响。但在响应式编程中，变量 a 的值会随时跟随 b，c 的变化而变化。</li>
<li>电子表格程序就是响应式编程的一个例子。单元格可以包含字面值或类似 “= B1 + C1” 的公式，而包含公式的单元格的值会依据其他单元格的值的变化而变化。</li>
</ul>
</li>
<li><p>Java8 及其之前版本的实现方式：</p>
<ul>
<li><p>本质上使用的是观察者设计模式。</p>
</li>
<li><p>Java8 提供的观察者模式的两个类 <strong>Observer 和 Observable</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObserverDemo</span> <span class="keyword">extends</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ObserverDemo observer = <span class="keyword">new</span> ObserverDemo();</span><br><span class="line">        <span class="comment">// 添加观察者</span></span><br><span class="line">        observer.addObserver(<span class="keyword">new</span> Observer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object arg)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;发生了变化&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        observer.addObserver(<span class="keyword">new</span> Observer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object arg)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;收到被观察者通知，准备改变&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        observer.setChanged();<span class="comment">// 监控数据是否发生变化</span></span><br><span class="line">        observer.notifyObservers();<span class="comment">// 通知</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Java9 及之后的版本，使用 <strong>Flow</strong> 类替换了 Observer 和 Observable。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Flow.Publisher&lt;String&gt; publisher = subscriber -&gt; &#123;</span><br><span class="line">            subscriber.onNext(<span class="string">&quot;1&quot;</span>);<span class="comment">// 1</span></span><br><span class="line">            subscriber.onNext(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">            subscriber.onError(<span class="keyword">new</span> RuntimeException(<span class="string">&quot;出错&quot;</span>));<span class="comment">// 2</span></span><br><span class="line">            <span class="comment">//  subscriber.onComplete();</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        publisher.subscribe(<span class="keyword">new</span> Flow.Subscriber&lt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Flow.Subscription subscription)</span> </span>&#123;</span><br><span class="line">                subscription.cancel();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">                System.out.println(item);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable throwable)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;publish complete&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Reactor</strong> 实现。</p>
<ul>
<li><p>响应式编程操作中，都需要满足 Reactive 规范，Reactor 即为这样的一个框架，WebFlux 的核心即是使用 Reactor 实现的。</p>
</li>
<li><p>Reactor 有两个核心类，Mono 和 Flux ，这两个类都实现了 Publisher 接口，提供了丰富的操作符。</p>
<ul>
<li><strong>Flux 对象实现发布者时，返回 N 个元素；Mono 实现发布者时，返回 0 或者 1 个元素。</strong></li>
</ul>
</li>
<li><p><strong>Flux 和 Mono 都是数据流的发布者，使用 Flux 和 Mono 都可以发出三种数据信号：元素值、错误信号、完成信号。</strong></p>
<ul>
<li><strong>错误信号和完成信号都代表终止信号，终止信号用于告诉订阅者数据流结束了。</strong></li>
<li><strong>错误信号在终止数据流的同时，会把错误信息传递给订阅者。</strong></li>
<li><strong>错误信号和完成信号不能共存。</strong></li>
<li><strong>如果没有发送任何元素值，而是直接发送错误信号或者完成信号，表示是空数据流。</strong></li>
<li><strong>如果既没有错误信号，也没有完成信号，表示是无限数据流。</strong></li>
</ul>
</li>
<li><p>代码演示 Flux 和 和 Mono：</p>
<ul>
<li><p>第一步：引入依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第二步：声明数据流，有以下几种方式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// just方法直接声明数据流，此时没有订阅，数据是不会输出的</span></span><br><span class="line">        Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        Mono.just(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其他方法声明数据流</span></span><br><span class="line">        Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        Flux.fromArray(arr);<span class="comment">// 来自数组</span></span><br><span class="line"></span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(<span class="number">5</span>);</span><br><span class="line">        Flux.fromIterable(list);<span class="comment">// 来自集合</span></span><br><span class="line"></span><br><span class="line">        Stream&lt;Integer&gt; stream = list.stream();</span><br><span class="line">        Flux.fromStream(stream);<span class="comment">// 来自流</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三步：订阅。<strong>调用 <code>just()</code> 或者其他方法只是声明数据流，数据流并没有发出，只有进行订阅之后才会触发数据流，不订阅什么都不会发生。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line">        list.add(<span class="number">4</span>);</span><br><span class="line">        list.add(<span class="number">5</span>);</span><br><span class="line">        Flux.fromIterable(list).subscribe(System.out::print);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>常用操作符：</p>
<ul>
<li><p>对数据流进行一道道操作，称为操作符，比如工厂流水线。</p>
</li>
<li><p>**<code>map()</code>**：将数据流中的每一个元素，按一定的规则映射为新元素。</p>
<img src="/2021/04/23/spring-webflux/image-20210423215925415.png" alt="image-20210423215925415" style="zoom:80%;">
</li>
<li><p>**<code>flatmap()</code>**：将数据流中的每一个元素，按一定的规则转换成流，然后再把所有的流合并为一个整体的流。</p>
<img src="/2021/04/23/spring-webflux/image-20210423220045483.png" alt="image-20210423220045483" style="zoom:80%;">
</li>
<li><p>**<code>filter()</code>**：将数据流中的元素，按一定的规则进行筛选。</p>
<img src="/2021/04/23/spring-webflux/image-20210423220116869.png" alt="image-20210423220116869" style="zoom:80%;">
</li>
<li><p>**<code>zip()</code>**：将数据流中的元素，按一定的规则进行压缩。</p>
<img src="/2021/04/23/spring-webflux/image-20210423220157174.png" alt="image-20210423220157174" style="zoom:80%;">

</li>
</ul>
</li>
</ul>
<h2 id="Spring-WebFlux-的执行流程和核心-API"><a href="#Spring-WebFlux-的执行流程和核心-API" class="headerlink" title="Spring WebFlux 的执行流程和核心 API"></a>Spring WebFlux 的执行流程和核心 API</h2><ul>
<li><p>Spring WebFlux 基于 Reactor，默认使用的容器是 Netty，Netty 是一个高性能的异步非阻塞的 NIO 框架。</p>
<ul>
<li><p>BIO：阻塞方式。</p>
<p><img src="/2021/04/23/spring-webflux/image-20210423220910001.png" alt="image-20210423220910001"></p>
</li>
<li><p>NIO：非阻塞方式。</p>
<p><img src="/2021/04/23/spring-webflux/image-20210423220943660.png" alt="image-20210423220943660"></p>
<ul>
<li>Channel：通道；Register：注册；Selector：选择器。</li>
</ul>
</li>
</ul>
</li>
<li><p>Spring WebFlux 执行过程和 Spring MVC 相似。</p>
<ul>
<li><p>Spring MVC 的核心控制器是 DispatcherServlet，Spring WebFlux 的核心控制器是 DispatcherHandler，DispatcherHandler 实现了 WebHandler 接口，重写了 <code>handle()</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WebHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Handle the web server exchange.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> exchange the current server exchange</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> Mono&lt;Void&gt;&#125; to indicate when request handling is complete</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function">Mono&lt;Void&gt; <span class="title">handle</span><span class="params">(ServerWebExchange exchange)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">handle</span><span class="params">(ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.handlerMappings == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> createNotFoundError();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> Flux.fromIterable(<span class="keyword">this</span>.handlerMappings)</span><br><span class="line">         .concatMap(mapping -&gt; mapping.getHandler(exchange))</span><br><span class="line">         .next()</span><br><span class="line">         .switchIfEmpty(createNotFoundError())</span><br><span class="line">         .flatMap(handler -&gt; invokeHandler(exchange, handler))</span><br><span class="line">         .flatMap(result -&gt; handleResult(exchange, result));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>exchange：放 http 请求响应的信息。</li>
<li><code>mapping.getHandler(exchange)</code>：根据 http 请求地址获得其对应的 handlerMapping。</li>
<li><code>invokeHandler(exchange, handler)</code>：调用具体的业务方法处理 http 请求。</li>
<li><code>handleResult(exchange, result))</code>：返回处理的结果。</li>
</ul>
</li>
<li><p>Spring WebFlux 除了 DispatcherHandler 组件外，还有其他几个重要的组件：</p>
<ul>
<li>DispatcherHandler：负责请求的处理。</li>
<li>HandlerMapping：负责查询请求对应的处理的方法。</li>
<li>HandlerAdapter：负责请求处理的实际的业务。</li>
<li>HandlerResultHandler：负责响应结果的处理。</li>
</ul>
</li>
</ul>
</li>
<li><p>Spring WebFlux 实现函数式编程，依赖于两个接口：RouterFunction (负责路由处理) 和 HandlerFunction (负责处理函数)。</p>
</li>
</ul>
<h2 id="Spring-WebFlux-实现"><a href="#Spring-WebFlux-实现" class="headerlink" title="Spring WebFlux 实现"></a>Spring WebFlux 实现</h2><ul>
<li><p>Spring MVC 方式实现，是同步阻塞的方式，基于 Spring MVC + Servlet + Tomcat。</p>
</li>
<li><p>Spring WebFlux 方式实现，是异步非阻塞的方式，基于 Spring WebFlux + Reactor + Netty。</p>
</li>
<li><p><strong>基于注解编程模型</strong></p>
<ul>
<li><p>第一步：创建 Spring Boot 工程，引入 Spring WebFlux 依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.xisun.spring.webflux<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xisun-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>xisun-webflux<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第二步：打开 application.properties 配置文件，配置启动端口号。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第三步：创建包和相关类。</p>
<ul>
<li><p>entity 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiSun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2021/4/24 10:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, String gender, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        User user = (User) o;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(name, user.name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(gender, user.gender)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(age, user.age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = name != <span class="keyword">null</span> ? name.hashCode() : <span class="number">0</span>;</span><br><span class="line">        result = <span class="number">31</span> * result + (gender != <span class="keyword">null</span> ? gender.hashCode() : <span class="number">0</span>);</span><br><span class="line">        result = <span class="number">31</span> * result + (age != <span class="keyword">null</span> ? age.hashCode() : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>dao 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据id查询用户</span></span><br><span class="line">    <span class="function">User <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="function">String <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建map集合存储数据，代替从数据库查询</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, User&gt; users = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.users.put(<span class="number">1</span>, <span class="keyword">new</span> User(<span class="string">&quot;Lucy&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        <span class="keyword">this</span>.users.put(<span class="number">2</span>, <span class="keyword">new</span> User(<span class="string">&quot;Mary&quot;</span>, <span class="string">&quot;female&quot;</span>, <span class="number">30</span>));</span><br><span class="line">        <span class="keyword">this</span>.users.put(<span class="number">3</span>, <span class="keyword">new</span> User(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;dao: &quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.users.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">        Collection&lt;User&gt; values = <span class="keyword">this</span>.users.values();</span><br><span class="line">        userList.addAll(values);</span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="keyword">this</span>.users.size() + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.users.put(id, user);</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.users);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>service 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据id查询用户</span></span><br><span class="line">    <span class="function">Mono&lt;User&gt; <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">Flux&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="function">Mono&lt;String&gt; <span class="title">saveUser</span><span class="params">(Mono&lt;User&gt; user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service: &quot;</span> + id);</span><br><span class="line">        User user = userDao.getUserById(id);</span><br><span class="line">        <span class="keyword">return</span> Mono.just(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; allUser = userDao.getAllUser();</span><br><span class="line">        <span class="keyword">return</span> Flux.fromIterable(allUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;String&gt; <span class="title">saveUser</span><span class="params">(Mono&lt;User&gt; userMono)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// return userMono.doOnNext(person -&gt; userDao.saveUser(person)).thenEmpty(Mono.empty());// 返回 Mono&lt;Void&gt;</span></span><br><span class="line">        <span class="keyword">return</span> userMono.map(user -&gt; userDao.saveUser(user));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>controller 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查询用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getUserById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;controller: &quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> userService.getUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAllUser&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getAllUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveUserMessage&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;String&gt; <span class="title">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;save user: &quot;</span> + user);</span><br><span class="line">        <span class="keyword">return</span> userService.saveUser(Mono.just(user));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>main 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XisunWebfluxApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(XisunWebfluxApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>整体结构：</p>
<p><img src="/2021/04/23/spring-webflux/image-20210424185319673.png" alt="image-20210424185319673"></p>
</li>
<li><p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___<span class="string">&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span></span><br><span class="line"><span class="string">( ( )\___ | &#x27;</span>_ | <span class="string">&#x27;_| | &#x27;</span>_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  <span class="string">&#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span></span><br><span class="line"><span class="string"> =========|_|==============|___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::                (v2.4.5)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2021-04-24 18:54:21.418  INFO 4836 --- [           main] c.x.s.w.x.XisunWebfluxApplication        : Starting XisunWebfluxApplication using Java 1.8.0_222 on DESKTOP-OM8IACS with PID 4836 (D:\JetBrainsWorkSpace\IDEAProjects\xisun-webflux\target\classes started by Ziyoo in D:\JetBrainsWorkSpace\IDEAProjects\xisun-webflux)</span></span><br><span class="line"><span class="string">2021-04-24 18:54:21.423  INFO 4836 --- [           main] c.x.s.w.x.XisunWebfluxApplication        : No active profile set, falling back to default profiles: default</span></span><br><span class="line"><span class="string">2021-04-24 18:54:22.719  INFO 4836 --- [           main] o.s.b.web.embedded.netty.NettyWebServer  : Netty started on port 8081</span></span><br><span class="line"><span class="string">2021-04-24 18:54:22.730  INFO 4836 --- [           main] c.x.s.w.x.XisunWebfluxApplication        : Started XisunWebfluxApplication in 2.007 seconds (JVM running for 3.003)</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/04/23/spring-webflux/image-20210424185543581.png" alt="image-20210424185543581"></p>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>基于函数式编程模型</strong></p>
<ul>
<li><p>在使用函数式编程模型操作的时候，需要自己初始化服务器。</p>
</li>
<li><p>基于函数式编程模型操作的时候，有两个核心接口：<strong>RouterFunction (实现路由功能，将请求转发给对应的 handler) 和 HandlerFunction (处理请求并生成响应的函数)。基于函数式编程模型的核心任务就是定义这两个函数式接口的实现，并且启动需要的服务器。</strong></p>
</li>
<li><p>Spring WebFlux 请求和响应不再是 ServletRequest 和 ServletResponse，而是 ServerRequest 和 ServerResponse。</p>
</li>
<li><p>第一步：创建 Spring Boot 工程，引入 Spring WebFlux 依赖。</p>
</li>
<li><p>第二步：打开 application.properties 配置文件，配置启动端口号。</p>
</li>
<li><p>第三步：创建包和相关类。</p>
<ul>
<li><p>entity 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, String gender, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        User user = (User) o;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(name, user.name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!Objects.equals(gender, user.gender)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(age, user.age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = name != <span class="keyword">null</span> ? name.hashCode() : <span class="number">0</span>;</span><br><span class="line">        result = <span class="number">31</span> * result + (gender != <span class="keyword">null</span> ? gender.hashCode() : <span class="number">0</span>);</span><br><span class="line">        result = <span class="number">31</span> * result + (age != <span class="keyword">null</span> ? age.hashCode() : <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, gender=&#x27;&quot;</span> + gender + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>dao 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">saveUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建map集合存储数据，代替从数据库查询</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Integer, User&gt; users = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.users.put(<span class="number">1</span>, <span class="keyword">new</span> User(<span class="string">&quot;Lucy&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        <span class="keyword">this</span>.users.put(<span class="number">2</span>, <span class="keyword">new</span> User(<span class="string">&quot;Mary&quot;</span>, <span class="string">&quot;female&quot;</span>, <span class="number">30</span>));</span><br><span class="line">        <span class="keyword">this</span>.users.put(<span class="number">3</span>, <span class="keyword">new</span> User(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;male&quot;</span>, <span class="number">50</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;dao: &quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.users.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">5</span>);</span><br><span class="line">        Collection&lt;User&gt; values = <span class="keyword">this</span>.users.values();</span><br><span class="line">        userList.addAll(values);</span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">saveUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="keyword">this</span>.users.size() + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.users.put(id, user);</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.users);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>service 层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 根据id查询用户</span></span><br><span class="line">    <span class="function">Mono&lt;User&gt; <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="function">Flux&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="function">Mono&lt;Void&gt; <span class="title">saveUser</span><span class="params">(Mono&lt;User&gt; user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserServiceImpl</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title">getUserById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service: &quot;</span> + id);</span><br><span class="line">        User user = userDao.getUserById(id);</span><br><span class="line">        <span class="keyword">return</span> Mono.just(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Flux&lt;User&gt; <span class="title">getAllUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; allUser = userDao.getAllUser();</span><br><span class="line">        <span class="keyword">return</span> Flux.fromIterable(allUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">saveUser</span><span class="params">(Mono&lt;User&gt; userMono)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// return userMono.map(user -&gt; userDao.saveUser(user));</span></span><br><span class="line">        <span class="keyword">return</span> userMono.doOnNext(person -&gt; userDao.saveUser(person)).thenEmpty(Mono.empty());<span class="comment">// 返回 Mono&lt;Void&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 Handler (具体实现方法)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserHandle</span><span class="params">(UserService userService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据id查询用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">getUserById</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取路径中的id值，返回的是String</span></span><br><span class="line">        <span class="keyword">int</span> userId = Integer.parseInt(request.pathVariable(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        <span class="comment">// 可能查询不到用户，进行空值处理</span></span><br><span class="line">        Mono&lt;ServerResponse&gt; notFound = ServerResponse.notFound().build();</span><br><span class="line">        <span class="comment">// 调用userService的方法查询用户</span></span><br><span class="line">        Mono&lt;User&gt; userMono = userService.getUserById(userId);</span><br><span class="line">        <span class="comment">// 把userMono进行转换，返回Mono&lt;ServerResponse&gt;</span></span><br><span class="line">        <span class="keyword">return</span> userMono.flatMap(user -&gt;</span><br><span class="line">                ServerResponse</span><br><span class="line">                        .ok()</span><br><span class="line">                        .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                        .body(BodyInserters.fromObject(user))</span><br><span class="line">                        .switchIfEmpty(notFound));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户，ServerRequest参数即使不用，也要添加，否则在Server中会找不到这个方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">getAllUsers</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 调用userService的方法查询所有用户</span></span><br><span class="line">        Flux&lt;User&gt; userFlux = userService.getAllUser();</span><br><span class="line">        <span class="keyword">return</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .body(userFlux, User.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title">saveUser</span><span class="params">(ServerRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 从请求中拿到user对象</span></span><br><span class="line">        Mono&lt;User&gt; userMono = request.bodyToMono(User.class);</span><br><span class="line">        <span class="keyword">return</span> ServerResponse</span><br><span class="line">                .ok()</span><br><span class="line">                .build(userService.saveUser(userMono));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>第四步：初始化服务器，编写 Router。</p>
<ul>
<li><p>创建路由，创建服务器完成适配。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.创建Router路由</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title">routingFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建hanler对象(@Repository这些注解无效，需手动注入dao和service，是否有其他方法？)</span></span><br><span class="line">        UserDaoImpl userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">        UserService userService = <span class="keyword">new</span> UserServiceImpl(userDao);</span><br><span class="line">        UserHandler handler = <span class="keyword">new</span> UserHandler(userService);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置路由</span></span><br><span class="line">        <span class="keyword">return</span> RouterFunctions</span><br><span class="line">                .route(RequestPredicates.GET(<span class="string">&quot;/getUserById/&#123;id&#125;&quot;</span>)</span><br><span class="line">                        .and(RequestPredicates.accept(MediaType.APPLICATION_JSON)), handler::getUserById)</span><br><span class="line">                .andRoute(RequestPredicates.GET(<span class="string">&quot;/getAllUser&quot;</span>)</span><br><span class="line">                        .and(RequestPredicates.accept(MediaType.APPLICATION_JSON)), handler::getAllUser)</span><br><span class="line">                .andRoute(RequestPredicates.POST(<span class="string">&quot;/saveUserMessage&quot;</span>)</span><br><span class="line">                        .and(RequestPredicates.accept(MediaType.APPLICATION_JSON)), handler::saveUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.创建服务器完成适配</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createReactorServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 路由和handler适配</span></span><br><span class="line">        RouterFunction&lt;ServerResponse&gt; route = routingFunction();</span><br><span class="line">        HttpHandler httpHandler = RouterFunctions.toHttpHandler(route);</span><br><span class="line">        ReactorHttpHandlerAdapter adapter = <span class="keyword">new</span> ReactorHttpHandlerAdapter(httpHandler);</span><br><span class="line">        <span class="comment">// 创建服务器</span></span><br><span class="line">        HttpServer httpServer = HttpServer.create();</span><br><span class="line">        httpServer.handle(adapter).bindNow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.最终调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Server server = <span class="keyword">new</span> Server();</span><br><span class="line">        server.createReactorServer();</span><br><span class="line">        System.out.println(<span class="string">&quot;enter to exit&quot;</span>);</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>最终调用：启动 main 方法，并在网页上输入地址进行测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">D:\java\jdk\jdk8u222-b10\bin\java.exe <span class="string">&quot;-javaagent:D:\Program Files\IntelliJ IDEA 2020.1.2\lib\idea_rt.jar=11755:D:\Program Files\IntelliJ IDEA 2020.1.2\bin&quot;</span> -Dfile.encoding=UTF-<span class="number">8</span> -classpath D:\java\jdk\jdk8u222-b10\jre\lib\charsets.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\access-bridge-<span class="number">64.</span>jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\cldrdata.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\dnsns.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\jaccess.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\localedata.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\nashorn.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\sunec.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\sunjce_provider.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\sunmscapi.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\sunpkcs11.jar;D:\java\jdk\jdk8u222-b10\jre\lib\ext\zipfs.jar;D:\java\jdk\jdk8u222-b10\jre\lib\jce.jar;D:\java\jdk\jdk8u222-b10\jre\lib\jsse.jar;D:\java\jdk\jdk8u222-b10\jre\lib\management-agent.jar;D:\java\jdk\jdk8u222-b10\jre\lib\resources.jar;D:\java\jdk\jdk8u222-b10\jre\lib\rt.jar;D:\JetBrainsWorkSpace\IDEAProjects\xisun-webflux\target\classes;D:\java\maven-repo\org\springframework\boot\spring-boot-starter-webflux\<span class="number">2.2</span>.<span class="number">5.</span>RELEASE\spring-boot-starter-webflux-<span class="number">2.2</span>.<span class="number">5.</span>RELEASE.jar;D:\java\maven-repo\org\springframework\boot\spring-boot-starter\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-starter-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\org\springframework\boot\spring-boot\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\org\springframework\spring-context\<span class="number">5.3</span>.<span class="number">6</span>\spring-context-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\org\springframework\spring-aop\<span class="number">5.3</span>.<span class="number">6</span>\spring-aop-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\org\springframework\spring-expression\<span class="number">5.3</span>.<span class="number">6</span>\spring-expression-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\org\springframework\boot\spring-boot-autoconfigure\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-autoconfigure-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\org\springframework\boot\spring-boot-starter-logging\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-starter-logging-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\ch\qos\logback\logback-classic\<span class="number">1.2</span>.<span class="number">3</span>\logback-classic-<span class="number">1.2</span>.<span class="number">3.</span>jar;D:\java\maven-repo\ch\qos\logback\logback-core\<span class="number">1.2</span>.<span class="number">3</span>\logback-core-<span class="number">1.2</span>.<span class="number">3.</span>jar;D:\java\maven-repo\org\apache\logging\log4j\log4j-to-slf4j\<span class="number">2.13</span>.<span class="number">3</span>\log4j-to-slf4j-<span class="number">2.13</span>.<span class="number">3.</span>jar;D:\java\maven-repo\org\apache\logging\log4j\log4j-api\<span class="number">2.13</span>.<span class="number">3</span>\log4j-api-<span class="number">2.13</span>.<span class="number">3.</span>jar;D:\java\maven-repo\org\slf4j\jul-to-slf4j\<span class="number">1.7</span>.<span class="number">30</span>\jul-to-slf4j-<span class="number">1.7</span>.<span class="number">30.</span>jar;D:\java\maven-repo\jakarta\annotation\jakarta.annotation-api\<span class="number">1.3</span>.<span class="number">5</span>\jakarta.annotation-api-<span class="number">1.3</span>.<span class="number">5.</span>jar;D:\java\maven-repo\org\yaml\snakeyaml\<span class="number">1.27</span>\snakeyaml-<span class="number">1.27</span>.jar;D:\java\maven-repo\org\springframework\boot\spring-boot-starter-json\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-starter-json-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\com\fasterxml\jackson\core\jackson-databind\<span class="number">2.11</span>.<span class="number">4</span>\jackson-databind-<span class="number">2.11</span>.<span class="number">4.</span>jar;D:\java\maven-repo\com\fasterxml\jackson\core\jackson-annotations\<span class="number">2.11</span>.<span class="number">4</span>\jackson-annotations-<span class="number">2.11</span>.<span class="number">4.</span>jar;D:\java\maven-repo\com\fasterxml\jackson\core\jackson-core\<span class="number">2.11</span>.<span class="number">4</span>\jackson-core-<span class="number">2.11</span>.<span class="number">4.</span>jar;D:\java\maven-repo\com\fasterxml\jackson\datatype\jackson-datatype-jdk8\<span class="number">2.11</span>.<span class="number">4</span>\jackson-datatype-jdk8-<span class="number">2.11</span>.<span class="number">4.</span>jar;D:\java\maven-repo\com\fasterxml\jackson\datatype\jackson-datatype-jsr310\<span class="number">2.11</span>.<span class="number">4</span>\jackson-datatype-jsr310-<span class="number">2.11</span>.<span class="number">4.</span>jar;D:\java\maven-repo\com\fasterxml\jackson\<span class="keyword">module</span>\jackson-<span class="keyword">module</span>-parameter-names\<span class="number">2.11</span>.<span class="number">4</span>\jackson-<span class="keyword">module</span>-parameter-names-<span class="number">2.11</span>.<span class="number">4.</span>jar;D:\java\maven-repo\org\springframework\boot\spring-boot-starter-reactor-netty\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-starter-reactor-netty-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\io\projectreactor\netty\reactor-netty-http\<span class="number">1.0</span>.<span class="number">6</span>\reactor-netty-http-<span class="number">1.0</span>.<span class="number">6.</span>jar;D:\java\maven-repo\io\netty\netty-codec-http\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-codec-http-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-common\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-common-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-buffer\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-buffer-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-transport\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-transport-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-codec\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-codec-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-handler\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-handler-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-codec-http2\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-codec-http2-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-resolver-dns\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-resolver-dns-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-resolver\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-resolver-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-codec-dns\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-codec-dns-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-resolver-dns-<span class="keyword">native</span>-macos\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-resolver-dns-<span class="keyword">native</span>-macos-<span class="number">4.1</span>.<span class="number">63.F</span>inal-osx-x86_64.jar;D:\java\maven-repo\io\netty\netty-transport-<span class="keyword">native</span>-unix-common\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-transport-<span class="keyword">native</span>-unix-common-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-transport-<span class="keyword">native</span>-epoll\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-transport-<span class="keyword">native</span>-epoll-<span class="number">4.1</span>.<span class="number">63.F</span>inal-linux-x86_64.jar;D:\java\maven-repo\io\projectreactor\netty\reactor-netty-core\<span class="number">1.0</span>.<span class="number">6</span>\reactor-netty-core-<span class="number">1.0</span>.<span class="number">6.</span>jar;D:\java\maven-repo\io\netty\netty-handler-proxy\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-handler-proxy-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\io\netty\netty-codec-socks\<span class="number">4.1</span>.<span class="number">63.F</span>inal\netty-codec-socks-<span class="number">4.1</span>.<span class="number">63.F</span>inal.jar;D:\java\maven-repo\org\springframework\boot\spring-boot-starter-validation\<span class="number">2.4</span>.<span class="number">5</span>\spring-boot-starter-validation-<span class="number">2.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\org\glassfish\jakarta.el\<span class="number">3.0</span>.<span class="number">3</span>\jakarta.el-<span class="number">3.0</span>.<span class="number">3.</span>jar;D:\java\maven-repo\org\hibernate\validator\hibernate-validator\<span class="number">6.1</span>.<span class="number">7.F</span>inal\hibernate-validator-<span class="number">6.1</span>.<span class="number">7.F</span>inal.jar;D:\java\maven-repo\jakarta\validation\jakarta.validation-api\<span class="number">2.0</span>.<span class="number">2</span>\jakarta.validation-api-<span class="number">2.0</span>.<span class="number">2.</span>jar;D:\java\maven-repo\org\jboss\logging\jboss-logging\<span class="number">3.4</span>.<span class="number">1.F</span>inal\jboss-logging-<span class="number">3.4</span>.<span class="number">1.F</span>inal.jar;D:\java\maven-repo\com\fasterxml\classmate\<span class="number">1.5</span>.<span class="number">1</span>\classmate-<span class="number">1.5</span>.<span class="number">1.</span>jar;D:\java\maven-repo\org\springframework\spring-web\<span class="number">5.3</span>.<span class="number">6</span>\spring-web-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\org\springframework\spring-beans\<span class="number">5.3</span>.<span class="number">6</span>\spring-beans-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\org\springframework\spring-webflux\<span class="number">5.3</span>.<span class="number">6</span>\spring-webflux-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\io\projectreactor\reactor-core\<span class="number">3.4</span>.<span class="number">5</span>\reactor-core-<span class="number">3.4</span>.<span class="number">5.</span>jar;D:\java\maven-repo\org\reactivestreams\reactive-streams\<span class="number">1.0</span>.<span class="number">3</span>\reactive-streams-<span class="number">1.0</span>.<span class="number">3.</span>jar;D:\java\maven-repo\org\synchronoss\cloud\nio-multipart-parser\<span class="number">1.1</span>.<span class="number">0</span>\nio-multipart-parser-<span class="number">1.1</span>.<span class="number">0.</span>jar;D:\java\maven-repo\org\slf4j\slf4j-api\<span class="number">1.7</span>.<span class="number">30</span>\slf4j-api-<span class="number">1.7</span>.<span class="number">30.</span>jar;D:\java\maven-repo\org\synchronoss\cloud\nio-stream-storage\<span class="number">1.1</span>.<span class="number">3</span>\nio-stream-storage-<span class="number">1.1</span>.<span class="number">3.</span>jar;D:\java\maven-repo\org\springframework\spring-core\<span class="number">5.3</span>.<span class="number">6</span>\spring-core-<span class="number">5.3</span>.<span class="number">6.</span>jar;D:\java\maven-repo\org\springframework\spring-jcl\<span class="number">5.3</span>.<span class="number">6</span>\spring-jcl-<span class="number">5.3</span>.<span class="number">6.</span>jar cn.xisun.spring.webflux.xisunwebflux.Server</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.306</span> [main] DEBUG reactor.util.Loggers - Using Slf4j logging framework</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.726</span> [main] DEBUG org.springframework.web.server.adapter.HttpWebHandlerAdapter - enableLoggingRequestDetails=<span class="string">&#x27;false&#x27;</span>: form data and headers will be masked to prevent unsafe logging of potentially sensitive data</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.785</span> [main] DEBUG io.netty.util.internal.logging.InternalLoggerFactory - Using SLF4J as the <span class="keyword">default</span> logging framework</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.786</span> [main] DEBUG io.netty.util.internal.PlatformDependent - Platform: Windows</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.792</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - -Dio.netty.noUnsafe: <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.792</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - Java version: <span class="number">8</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.794</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - sun.misc.Unsafe.theUnsafe: available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.796</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - sun.misc.Unsafe.copyMemory: available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.799</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.Buffer.address: available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.800</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - direct buffer constructor: available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.802</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.Bits.unaligned: available, <span class="keyword">true</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.802</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - jdk.internal.misc.Unsafe.allocateUninitializedArray(<span class="keyword">int</span>): unavailable prior to Java9</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.802</span> [main] DEBUG io.netty.util.internal.PlatformDependent0 - java.nio.DirectByteBuffer.&lt;init&gt;(<span class="keyword">long</span>, <span class="keyword">int</span>): available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.802</span> [main] DEBUG io.netty.util.internal.PlatformDependent - sun.misc.Unsafe: available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.804</span> [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.tmpdir: C:\Users\Ziyoo\AppData\Local\Temp (java.io.tmpdir)</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.805</span> [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.bitMode: <span class="number">64</span> (sun.arch.data.model)</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.808</span> [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.maxDirectMemory: <span class="number">1653604352</span> bytes</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.809</span> [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.uninitializedArrayAllocationThreshold: -<span class="number">1</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.810</span> [main] DEBUG io.netty.util.internal.CleanerJava6 - java.nio.ByteBuffer.cleaner(): available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.811</span> [main] DEBUG io.netty.util.internal.PlatformDependent - -Dio.netty.noPreferDirect: <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.873</span> [main] DEBUG io.netty.util.ResourceLeakDetector - -Dio.netty.leakDetection.level: simple</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.873</span> [main] DEBUG io.netty.util.ResourceLeakDetector - -Dio.netty.leakDetection.targetRecords: <span class="number">4</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.911</span> [main] DEBUG reactor.netty.tcp.TcpResources - [http] resources will use the <span class="keyword">default</span> LoopResources: DefaultLoopResources &#123;prefix=reactor-http, daemon=<span class="keyword">true</span>, selectCount=<span class="number">8</span>, workerCount=<span class="number">8</span>&#125;</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.911</span> [main] DEBUG reactor.netty.tcp.TcpResources - [http] resources will use the <span class="keyword">default</span> ConnectionProvider: reactor.netty.resources.DefaultPooledConnectionProvider@<span class="number">5552768</span>b</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">43.913</span> [main] DEBUG reactor.netty.resources.DefaultLoopIOUring - Default io_uring support : <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.117</span> [main] DEBUG reactor.netty.resources.DefaultLoopEpoll - Default Epoll support : <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.118</span> [main] DEBUG reactor.netty.resources.DefaultLoopKQueue - Default KQueue support : <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.125</span> [main] DEBUG io.netty.channel.MultithreadEventLoopGroup - -Dio.netty.eventLoopThreads: <span class="number">16</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.154</span> [main] DEBUG io.netty.util.internal.InternalThreadLocalMap - -Dio.netty.threadLocalMap.stringBuilder.initialSize: <span class="number">1024</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.154</span> [main] DEBUG io.netty.util.internal.InternalThreadLocalMap - -Dio.netty.threadLocalMap.stringBuilder.maxSize: <span class="number">4096</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.161</span> [main] DEBUG io.netty.channel.nio.NioEventLoop - -Dio.netty.noKeySetOptimization: <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.161</span> [main] DEBUG io.netty.channel.nio.NioEventLoop - -Dio.netty.selectorAutoRebuildThreshold: <span class="number">512</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.170</span> [main] DEBUG io.netty.util.internal.PlatformDependent - org.jctools-core.MpscChunkedArrayQueue: available</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.218</span> [main] DEBUG io.netty.channel.DefaultChannelId - -Dio.netty.processId: <span class="number">7052</span> (auto-detected)</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.221</span> [main] DEBUG io.netty.util.NetUtil - -Djava.net.preferIPv4Stack: <span class="keyword">false</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.221</span> [main] DEBUG io.netty.util.NetUtil - -Djava.net.preferIPv6Addresses: <span class="keyword">false</span></span><br><span class="line">09:45:44.317 [main] DEBUG io.netty.util.NetUtilInitializations - Loopback interface: lo (Software Loopback Interface 1, 127.0.0.1)</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.318</span> [main] DEBUG io.netty.util.NetUtil - Failed to get SOMAXCONN from sysctl and file \proc\sys\net\core\somaxconn. Default: <span class="number">200</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.432</span> [main] DEBUG io.netty.channel.DefaultChannelId - -Dio.netty.machineId: <span class="number">00</span>:<span class="number">50</span>:<span class="number">56</span>:ff:fe:c0:<span class="number">00</span>:<span class="number">08</span> (auto-detected)</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.numHeapArenas: <span class="number">16</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.numDirectArenas: <span class="number">16</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.pageSize: <span class="number">8192</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.maxOrder: <span class="number">11</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.chunkSize: <span class="number">16777216</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.smallCacheSize: <span class="number">256</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.normalCacheSize: <span class="number">64</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.maxCachedBufferCapacity: <span class="number">32768</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.cacheTrimInterval: <span class="number">8192</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.cacheTrimIntervalMillis: <span class="number">0</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.useCacheForAllThreads: <span class="keyword">true</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.457</span> [main] DEBUG io.netty.buffer.PooledByteBufAllocator - -Dio.netty.allocator.maxCachedByteBuffersPerChunk: <span class="number">1023</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.466</span> [main] DEBUG io.netty.buffer.ByteBufUtil - -Dio.netty.allocator.type: pooled</span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.466</span> [main] DEBUG io.netty.buffer.ByteBufUtil - -Dio.netty.threadLocalDirectBufferSize: <span class="number">0</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.466</span> [main] DEBUG io.netty.buffer.ByteBufUtil - -Dio.netty.maxThreadLocalCharBufferSize: <span class="number">16384</span></span><br><span class="line"><span class="number">09</span>:<span class="number">45</span>:<span class="number">44.589</span> [reactor-http-nio-<span class="number">1</span>] DEBUG reactor.netty.transport.ServerTransport - [id:ae5a7227, L:/<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">11779</span>] Bound <span class="keyword">new</span> server</span><br><span class="line">enter to exit</span><br></pre></td></tr></table></figure>

<p><img src="/2021/04/23/spring-webflux/image-20210425094903417.png" alt="image-20210425094903417"></p>
</li>
</ul>
</li>
<li><p>除了上面的调用方式，也可以使用 WebClient 调用，这个不需要在浏览器中输入地址，可以直接在本地进行模拟测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先启动Server，查看端口，然后调用服务器的地址</span></span><br><span class="line">        WebClient webClient = WebClient.create(<span class="string">&quot;http://127.0.0.1:12009&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据id查询</span></span><br><span class="line">        String id = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        User user = webClient.get().uri(<span class="string">&quot;/getUserById/&#123;id&#125;&quot;</span>, id)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON).retrieve().bodyToMono(User.class).block();</span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询所有</span></span><br><span class="line">        Flux&lt;User&gt; users = webClient.get().uri(<span class="string">&quot;/getAllUser&quot;</span>)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON).retrieve().bodyToFlux(User.class);</span><br><span class="line">        <span class="comment">// 打印每一个User的名字</span></span><br><span class="line">        users.map(User::getName).buffer().doOnNext(System.out::println).blockFirst();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：需要先启动 Server，然后查询端口号，设置 WebClient 的地址，然后启动 Client，即可在控制台查询相应操作的输出结果。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vf4y127N5">https://www.bilibili.com/video/BV1Vf4y127N5</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/spring/" rel="tag"># spring</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/13/tool-idea/" rel="prev" title="tool-idea">
      <i class="fa fa-chevron-left"></i> tool-idea
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/04/25/flink/" rel="next" title="Flink 入门">
      Flink 入门 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-WebFlux-%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">Spring WebFlux 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="nav-number">2.</span> <span class="nav-text">响应式编程概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-WebFlux-%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%92%8C%E6%A0%B8%E5%BF%83-API"><span class="nav-number">3.</span> <span class="nav-text">Spring WebFlux 的执行流程和核心 API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-WebFlux-%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.</span> <span class="nav-text">Spring WebFlux 实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83"><span class="nav-number">5.</span> <span class="nav-text">本文参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="XiSun"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">XiSun</p>
  <div class="site-description" itemprop="description">心如止水者，虽世间繁华之红尘纷扰，已然空无一物</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XiSun</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">16:30</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
