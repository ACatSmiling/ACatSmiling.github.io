<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Docker 简介Docker 出现的背景 一款产品从开发到上线，从操作系统，到运行环境，再到应用配置。作为开发 + 运维之间的协作我们需要关心很多东西，这也是很多互联网公司都不得不面对的问题，特别是各种版本的迭代之后，不同版本环境的兼容，对运维人员都是考验。  环境配置如此麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker 入门">
<meta property="og:url" content="http://example.com/2021/05/17/docker-base/index.html">
<meta property="og:site_name" content="XiSun的博客">
<meta property="og:description" content="Docker 简介Docker 出现的背景 一款产品从开发到上线，从操作系统，到运行环境，再到应用配置。作为开发 + 运维之间的协作我们需要关心很多东西，这也是很多互联网公司都不得不面对的问题，特别是各种版本的迭代之后，不同版本环境的兼容，对运维人员都是考验。  环境配置如此麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210517132812149.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210517153016458.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210518115953156.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210518164632786.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210518164700236.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210607214517890.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210608092639524.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210609105236382.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210609113128182.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210608214208564.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210609105418915.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210610215004640.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210518170502255.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210519144837032.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520094656346.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520102210176.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520102432819.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/20201003133051.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520113123426.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520113538105.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520165412315.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210520165008832.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210523092658718.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210523095753669.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210523095840185.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210523105707137.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525100710287.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525102017647.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525102405896.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525103400831.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525104906871.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525170205671.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525170543474.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525171348807.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525171451918.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525172731112.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525173239008.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525173530503.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525215431656.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525221249241.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525221624773.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210525221738032.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210526170718893.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210526203303754.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210528152339289.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210528152445200.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210528161841454.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210528165752297.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210528170148528.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210528173122209.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210601115857147.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210601152053797.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210601172840353.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210601173056817.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210601173119315.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210601173620972.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602102100326.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602102911917.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602112906898.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602112943914.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602113910658.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602114009574.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602114309822.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602115827004.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602132253349.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602141938779.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602142955037.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602143748392.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602144708714.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602150141742.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602144836594.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602145700864.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602145727217.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602145837640.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602145904796.png">
<meta property="og:image" content="http://example.com/2021/05/17/docker-base/image-20210602145943825.png">
<meta property="article:published_time" content="2021-05-17T02:30:51.000Z">
<meta property="article:modified_time" content="2021-07-06T06:33:07.603Z">
<meta property="article:author" content="XiSun">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2021/05/17/docker-base/image-20210517132812149.png">

<link rel="canonical" href="http://example.com/2021/05/17/docker-base/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Docker 入门 | XiSun的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">XiSun的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Learning is endless</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/17/docker-base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="XiSun">
      <meta itemprop="description" content="心如止水者，虽世间繁华之红尘纷扰，已然空无一物">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="XiSun的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Docker 入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-17 10:30:51" itemprop="dateCreated datePublished" datetime="2021-05-17T10:30:51+08:00">2021-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-06 14:33:07" itemprop="dateModified" datetime="2021-07-06T14:33:07+08:00">2021-07-06</time>
              </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>120k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:49</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Docker-简介"><a href="#Docker-简介" class="headerlink" title="Docker 简介"></a>Docker 简介</h2><h3 id="Docker-出现的背景"><a href="#Docker-出现的背景" class="headerlink" title="Docker 出现的背景"></a>Docker 出现的背景</h3><ul>
<li><p>一款产品从开发到上线，从操作系统，到运行环境，再到应用配置。作为开发 + 运维之间的协作我们需要关心很多东西，这也是很多互联网公司都不得不面对的问题，特别是各种版本的迭代之后，不同版本环境的兼容，对运维人员都是考验。</p>
</li>
<li><p>环境配置如此麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原始环境一模一样地复制过来。</p>
</li>
<li><p>Docker 之所以发展如此迅速，也是因为它对此给出了一个标准化的解决方案。开发人员利用 Docker 可以消除协作编码时 “在我的机器上可正常工作” 的问题。</p>
</li>
<li><p>之前在服务器配置一个应用的运行环境，要安装各种软件。安装和配置这些东西有多麻烦就不说了，它还不能跨平台。假如我们是在 Windows 上安装的这些环境，到了 Linux 又得重新装。况且就算不跨操作系统，换另一台同样操作系统的服务器，要移植应用也是非常麻烦的。</p>
</li>
<li><p>传统上认为，软件编码开发/测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等。而为了让这程序可以顺利执行，开发团队也得准备完整的部署文件，让运维团队得以部署应用程式，<strong>开发需要清楚的告诉运维部署团队，用的全部配置文件 + 所有软件环境。不过，即便如此，仍然常常发生部署失败的状况。</strong>Docker 镜像的设计<strong>，使得 Docker 得以打破过去「程序即应用」的观念。透过镜像 (images) 将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运作。</strong></p>
<p><img src="/2021/05/17/docker-base/image-20210517132812149.png" alt="image-20210517132812149"></p>
</li>
</ul>
<h3 id="Docker-的理念"><a href="#Docker-的理念" class="headerlink" title="Docker 的理念"></a>Docker 的理念</h3><ul>
<li>Docker 是基于 Go 语言实现的云开源项目。</li>
<li>Docker 的主要目标是 “<strong>Build, Ship and Run Any App, Anywhere</strong>“，也就是通过对应用组件的封装、分发、部署、运行等生命期的管理，使用户的 APP (可以是一个 WEB 应用或数据库应用等等) 及其运行环境能够做到 “<strong>一次封装，到处运行</strong>“。</li>
<li>Linux 容器技术的出现就解决了这样一个问题，而 Docker 就是在它的基础上发展过来的。将应用运行在 Docker 容器上面，而 Docker 容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。<strong>只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作。</strong></li>
<li>总之，Docker 是一个解决了运行环境和配置问题的软件容器，是方便做持续集成并有助于整体发布的容器虚拟化技术。</li>
</ul>
<h2 id="Docker-的基本组成"><a href="#Docker-的基本组成" class="headerlink" title="Docker 的基本组成"></a>Docker 的基本组成</h2><h3 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h3><img src="/2021/05/17/docker-base/image-20210517153016458.png" alt="image-20210517153016458" style="zoom:80%;">

<h3 id="镜像-Image"><a href="#镜像-Image" class="headerlink" title="镜像 (Image)"></a>镜像 (Image)</h3><ul>
<li><p>Docker 镜像就是一个只读的模板。镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。</p>
</li>
<li><p>镜像与容器的关系类似于面向对象编程中的类与对象：</p>
<table>
<thead>
<tr>
<th>Docker</th>
<th>面向对象</th>
</tr>
</thead>
<tbody><tr>
<td>镜像</td>
<td>类</td>
</tr>
<tr>
<td>容器</td>
<td>对象</td>
</tr>
</tbody></table>
</li>
</ul>
<h3 id="容器-Container"><a href="#容器-Container" class="headerlink" title="容器 (Container)"></a>容器 (Container)</h3><ul>
<li>Docker 利用容器独立运行一个或一组应用。<strong>容器是用镜像创建的运行实例。</strong></li>
<li>容器可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。</li>
<li><strong>容器可以看做是一个简易版的 Linux 环境 (包括 root 用户权限、进程空间、用户空间和网络空间等) 和运行在其中的应用程序。</strong></li>
<li>容器的定义和镜像几乎一模一样，也是一堆层的统一视角， 唯一区别在于容器的最上面那一层是可读可写的。</li>
</ul>
<h3 id="仓库-Repository"><a href="#仓库-Repository" class="headerlink" title="仓库 (Repository)"></a>仓库 (Repository)</h3><ul>
<li>仓库是<strong>集中存放镜像</strong>文件的场所。</li>
<li>仓库和仓库注册服务器 (Registry) 是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多镜像，每个镜像有不同的标签 (tag) 。</li>
<li>仓库分为公开仓库 (Public) 和私有仓库 (Private) 两种形式。</li>
<li><strong>最大的公开仓库是 Docker Hub</strong> ( <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a> )，存放了数量庞大的镜像供用户下载。国内的公开仓库包括<strong>阿里云</strong>、网易云等。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>Docker本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是 image 镜像文件。只有通过这个镜像文件才能生成 Docker 容器。image 文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</li>
<li>image 文件生成的容器实例，本身也是一个文件，称为镜像文件。</li>
<li>一个容器运行一种服务，当我们需要的时候，就可以通过 Docker 客户端创建一个对应的运行实例，也就是我们的容器。</li>
<li>至于仓储，就是放了一堆镜像的地方，我们可以把镜像发布到仓储中，需要的时候从仓储中拉下来就可以了。</li>
</ul>
<h3 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h3><h4 id="Docker-是怎样工作的"><a href="#Docker-是怎样工作的" class="headerlink" title="Docker 是怎样工作的"></a>Docker 是怎样工作的</h4><ul>
<li><p>Docker 是一个 Client-Server 结构的系统，Docker 守护进程运行在主机上，然后通过 Socket 连接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。<strong>容器，是一个运行时环境，就是我们前面说到的集装箱。</strong></p>
<img src="/2021/05/17/docker-base/image-20210518115953156.png" alt="image-20210518115953156" style="zoom:80%;">

</li>
</ul>
<h4 id="Docker-为什么比-VM-快"><a href="#Docker-为什么比-VM-快" class="headerlink" title="Docker 为什么比 VM 快"></a>Docker 为什么比 VM 快</h4><ul>
<li><p>Docker 有着比虚拟机更少的抽象层。由于 Docker 不需要 <strong>Hypervisor</strong> 实现硬件资源虚拟化，运行在 Docker 容器上的程序直接使用的都是实际物理机的硬件资源。因此在 CPU、内存利用率上，Docker 将会在效率上有明显优势。</p>
</li>
<li><p>Docker 利用的是宿主机的内核，而不需要 <strong>Guest OS</strong>。因此，当新建一个容器时，Docker 不需要和虚拟机一样重新加载一个操作系统内核，因此可以避免引寻、加载操作系统内核这个比较费时费资源的过程，当新建一个虚拟机时，虚拟机软件需要加载 Guest OS，这个新建过程是分钟级别的。而 Docker 由于直接利用宿主机的操作系统，则省略了返个过程，因此新建一个 Docker 容器只需要几秒钟。</p>
<p><img src="/2021/05/17/docker-base/image-20210518164632786.png" alt="image-20210518164632786"></p>
<img src="/2021/05/17/docker-base/image-20210518164700236.png" alt="image-20210518164700236" style="zoom:80%;">

</li>
</ul>
<h2 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h2><ul>
<li>官网：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></li>
<li>Linux 安装：<a target="_blank" rel="noopener" href="https://hub.docker.com/search?q=&amp;type=edition&amp;offering=community&amp;operating_system=linux">https://hub.docker.com/search?q=&amp;type=edition&amp;offering=community&amp;operating_system=linux</a></li>
</ul>
<h3 id="WSL-安装"><a href="#WSL-安装" class="headerlink" title="WSL 安装"></a>WSL 安装</h3><ul>
<li><p>默认已经安装 WSL。</p>
</li>
<li><p>默认安装的 WSL version 是 1，在 Windows PowerShell 中查看：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Xisun\Desktop&gt; wsl -<span class="literal">-list</span> <span class="literal">-v</span></span><br><span class="line">  NAME      STATE           VERSION</span><br><span class="line">* Ubuntu    Running         <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Windows PowerShell 中，切换 WSL version 为 2：</p>
<ul>
<li><p>启用 Hyper-V 功能：</p>
<p><img src="/2021/05/17/docker-base/image-20210607214517890.png" alt="image-20210607214517890"></p>
<blockquote>
<p>启用 Hyper-V 功能后，需要重启电脑。</p>
</blockquote>
</li>
<li><p>再按以下步骤依次执行：</p>
<img src="/2021/05/17/docker-base/image-20210608092639524.png" alt="image-20210608092639524" style="zoom:80%;">

<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">https://docs.microsoft.com/en-us/windows/wsl/install-win10</a></p>
</blockquote>
</li>
<li><p>切换 version：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl -<span class="literal">-set</span><span class="literal">-version</span> &lt;distribution name&gt; &lt;versionNumber&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Xisun\Desktop&gt; wsl -<span class="literal">-set</span><span class="literal">-version</span> Ubuntu <span class="number">2</span></span><br><span class="line">正在进行转换，这可能需要几分钟时间...</span><br><span class="line">有关与 WSL <span class="number">2</span> 的主要区别的信息，请访问 https://aka.ms/wsl2</span><br><span class="line">转换完成。</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Xisun\Desktop&gt; wsl -<span class="literal">-list</span> <span class="literal">-v</span></span><br><span class="line">  NAME      STATE           VERSION</span><br><span class="line">* Ubuntu    Running         <span class="number">2</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>WSL 默认不支持 Docker，需要破解：</p>
<ul>
<li><p>破解步骤：</p>
<p><img src="/2021/05/17/docker-base/image-20210609105236382.png" alt="image-20210609105236382"></p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://github.com/arkane-systems/genie">https://github.com/arkane-systems/genie</a></p>
</blockquote>
</li>
<li><p>以管理员身份打开 Windows PowerShell：<code>win + x</code> 快捷键，然后执行命令 <code>wsl</code>，进入 WSL 控制台，并切换到 root 用户：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\WINDOWS\system32&gt; wsl</span><br><span class="line">xisun@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/WINDOWS/system32<span class="variable">$</span> su root</span><br><span class="line">Password:</span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/WINDOWS/system32<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果忘记 root 用户密码，可以如下方式重置：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.以管理员身份打开Windows PowerShell;</span><br><span class="line"><span class="number">2</span>.输入命令: wsl.exe -<span class="literal">-user</span> root;</span><br><span class="line"><span class="number">3</span>.输入命令: passwd root, 修改root用户密码。</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>安装 dotnet：</p>
<ul>
<li><p>查看 Ubuntu 版本：</p>
<ul>
<li><p>方式一：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># cat /proc/version</span></span><br><span class="line">Linux version <span class="number">5.4</span>.<span class="number">72</span><span class="literal">-microsoft</span><span class="literal">-standard</span><span class="literal">-WSL2</span> (oe<span class="literal">-user</span>@oe<span class="literal">-host</span>) (gcc version <span class="number">8.2</span>.<span class="number">0</span> (GCC)) <span class="comment">#1 SMP Wed Oct 28 23:40:43 UTC 2020</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># lsb_release -a</span></span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu <span class="number">20.04</span>.<span class="number">2</span> LTS</span><br><span class="line">Release:        <span class="number">20.04</span></span><br><span class="line">Codename:       focal</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210609113128182.png" alt="image-20210609113128182"></p>
</li>
<li><p>查看内核版本号：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># uname -r</span></span><br><span class="line"><span class="number">5.4</span>.<span class="number">72</span><span class="literal">-microsoft</span><span class="literal">-standard</span><span class="literal">-WSL2</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>安装对应版本的 dotnet：</p>
<p><img src="/2021/05/17/docker-base/image-20210608214208564.png" alt="image-20210608214208564"></p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-ubuntu">https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-ubuntu</a></p>
</blockquote>
<ul>
<li><p>将 Microsoft 包签名密钥添加到受信任密钥列表，并添加包存储库。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wget</span> https://packages.microsoft.com/config/ubuntu/<span class="number">20.04</span>/packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb <span class="literal">-O</span> packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb</span><br><span class="line">sudo dpkg <span class="literal">-i</span> packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb</span></span><br><span class="line">o dpkg <span class="literal">-i</span> packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb-<span class="literal">-2021</span><span class="literal">-06</span><span class="literal">-08</span> <span class="number">21</span>:<span class="number">15</span>:<span class="number">31</span>--  https://packages.microsoft.com/config/ubuntu/<span class="number">20.04</span>/packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb</span><br><span class="line">Resolving packages.microsoft.com (packages.microsoft.com)... <span class="number">65.52</span>.<span class="number">183.205</span></span><br><span class="line">Connecting to packages.microsoft.com (packages.microsoft.com)|<span class="number">65.52</span>.<span class="number">183.205</span>|:<span class="number">443</span>... connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">3124</span> (<span class="number">3.1</span>K) [<span class="type">application</span>/<span class="type">octet</span>-<span class="type">stream</span>]</span><br><span class="line">Saving to: ‘packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb’</span><br><span class="line"></span><br><span class="line">packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb   <span class="number">100</span>%[=================================================&gt;]   <span class="number">3.05</span>K  --.<span class="literal">-KB</span>/s    <span class="keyword">in</span> <span class="number">0</span>s</span><br><span class="line"></span><br><span class="line"><span class="number">2021</span><span class="literal">-06</span><span class="literal">-08</span> <span class="number">21</span>:<span class="number">15</span>:<span class="number">32</span> (<span class="number">523</span> MB/s) - ‘packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb’ saved [<span class="number">3124</span>/<span class="number">3124</span>]</span><br><span class="line"></span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># sudo dpkg -i packages-microsoft-prod.deb</span></span><br><span class="line">Selecting previously unselected package packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.</span><br><span class="line">(Reading database ... <span class="number">47281</span> files and directories currently installed.)</span><br><span class="line">Preparing to unpack packages<span class="literal">-microsoft</span><span class="literal">-prod</span>.deb ...</span><br><span class="line">Unpacking packages<span class="literal">-microsoft</span><span class="literal">-prod</span> (<span class="number">1.0</span><span class="literal">-ubuntu20</span>.<span class="number">04.1</span>) ...</span><br><span class="line">Setting up packages<span class="literal">-microsoft</span><span class="literal">-prod</span> (<span class="number">1.0</span><span class="literal">-ubuntu20</span>.<span class="number">04.1</span>) ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 SDK：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt<span class="literal">-get</span> update; \</span><br><span class="line">  sudo apt<span class="literal">-get</span> install <span class="literal">-y</span> apt<span class="literal">-transport</span><span class="literal">-https</span> &amp;&amp; \</span><br><span class="line">  sudo apt<span class="literal">-get</span> update &amp;&amp; \</span><br><span class="line">  sudo apt<span class="literal">-get</span> install <span class="literal">-y</span> dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># sudo apt-get update; \</span></span><br><span class="line">&gt;   sudo apt<span class="literal">-get</span> install <span class="literal">-y</span> apt<span class="literal">-transport</span><span class="literal">-https</span> &amp;&amp; \</span><br><span class="line">&gt;   sudo apt<span class="literal">-get</span> update &amp;&amp; \</span><br><span class="line">&gt;   sudo apt<span class="literal">-get</span> install <span class="literal">-y</span> dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span></span><br><span class="line">Get:<span class="number">1</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal InRelease [<span class="number">10.5</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">2</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 Packages [<span class="number">74.9</span> <span class="type">kB</span>]</span><br><span class="line">Hit:<span class="number">3</span> http://archive.ubuntu.com/ubuntu focal InRelease</span><br><span class="line">Get:<span class="number">4</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span> InRelease [<span class="number">114</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">5</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span> InRelease [<span class="number">114</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">6</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/main amd64 Packages [<span class="number">702</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">7</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-backports</span> InRelease [<span class="number">101</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">8</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/main Translation<span class="literal">-en</span> [<span class="number">141</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">9</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 Packages [<span class="number">1026</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">10</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/main amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">7780</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">11</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/restricted amd64 Packages [<span class="number">247</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">12</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/restricted Translation<span class="literal">-en</span> [<span class="number">36.1</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">13</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/restricted amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">456</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">14</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/universe amd64 Packages [<span class="number">588</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">15</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/universe Translation<span class="literal">-en</span> [<span class="number">94.6</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">16</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/universe amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">11.5</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">17</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/multiverse amd64 Packages [<span class="number">19.9</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">18</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/multiverse Translation<span class="literal">-en</span> [<span class="number">4316</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">19</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span>/multiverse amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">528</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">20</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main Translation<span class="literal">-en</span> [<span class="number">229</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">21</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">13.5</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">22</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/restricted amd64 Packages [<span class="number">266</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">23</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/restricted Translation<span class="literal">-en</span> [<span class="number">38.9</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">24</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/restricted amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">456</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">25</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/universe amd64 Packages [<span class="number">781</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">26</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/universe Translation<span class="literal">-en</span> [<span class="number">170</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">27</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/universe amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">17.6</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">28</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/multiverse amd64 Packages [<span class="number">23.6</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">29</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/multiverse Translation<span class="literal">-en</span> [<span class="number">6376</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">30</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/multiverse amd64 c<span class="literal">-n</span><span class="operator">-f</span> Metadata [<span class="number">648</span> <span class="type">B</span>]</span><br><span class="line">Fetched <span class="number">4840</span> kB <span class="keyword">in</span> <span class="number">4</span>s (<span class="number">1125</span> kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  apt<span class="literal">-transport</span><span class="literal">-https</span></span><br><span class="line"><span class="number">0</span> upgraded, <span class="number">1</span> newly installed, <span class="number">0</span> to remove and <span class="number">101</span> not upgraded.</span><br><span class="line">Need to get <span class="number">1704</span> B of archives.</span><br><span class="line">After this operation, <span class="number">161</span> kB of additional disk space will be used.</span><br><span class="line">Get:<span class="number">1</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/universe amd64 apt<span class="literal">-transport</span><span class="literal">-https</span> all <span class="number">2.0</span>.<span class="number">5</span> [<span class="number">1704</span> <span class="type">B</span>]</span><br><span class="line">Fetched <span class="number">1704</span> B <span class="keyword">in</span> <span class="number">0</span>s (<span class="number">3469</span> B/s)</span><br><span class="line">Selecting previously unselected package apt<span class="literal">-transport</span><span class="literal">-https</span>.</span><br><span class="line">(Reading database ... <span class="number">47289</span> files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../apt<span class="literal">-transport</span><span class="literal">-https_2</span>.<span class="number">0.5</span>_all.deb ...</span><br><span class="line">Unpacking apt<span class="literal">-transport</span><span class="literal">-https</span> (<span class="number">2.0</span>.<span class="number">5</span>) ...</span><br><span class="line">Setting up apt<span class="literal">-transport</span><span class="literal">-https</span> (<span class="number">2.0</span>.<span class="number">5</span>) ...</span><br><span class="line">Hit:<span class="number">1</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal InRelease</span><br><span class="line">Hit:<span class="number">2</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span> InRelease</span><br><span class="line">Hit:<span class="number">3</span> http://archive.ubuntu.com/ubuntu focal InRelease</span><br><span class="line">Hit:<span class="number">4</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span> InRelease</span><br><span class="line">Hit:<span class="number">5</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-backports</span> InRelease</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> aspnetcore<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-host</span> dotnet<span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span></span><br><span class="line">  dotnet<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> netstandard<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span></span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> aspnetcore<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-host</span> dotnet<span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span></span><br><span class="line">  dotnet<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span> dotnet<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> netstandard<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span></span><br><span class="line"><span class="number">0</span> upgraded, <span class="number">10</span> newly installed, <span class="number">0</span> to remove and <span class="number">101</span> not upgraded.</span><br><span class="line">Need to get <span class="number">95.1</span> MB of archives.</span><br><span class="line">After this operation, <span class="number">396</span> MB of additional disk space will be used.</span><br><span class="line">Get:<span class="number">1</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span> [<span class="number">2642</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">2</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-host</span> amd64 <span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span> [<span class="number">52.5</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">3</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span> [<span class="number">140</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">4</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span> [<span class="number">22.1</span> <span class="type">MB</span>]</span><br><span class="line">Get:<span class="number">5</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span> [<span class="number">6086</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">6</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">0</span><span class="literal">-1</span> [<span class="number">2086</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">7</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 aspnetcore<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">0</span><span class="literal">-1</span> [<span class="number">1316</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">8</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span> [<span class="number">3412</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">9</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 netstandard<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span> amd64 <span class="number">2.1</span>.<span class="number">0</span><span class="literal">-1</span> [<span class="number">1476</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">10</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal/main amd64 dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span> amd64 <span class="number">5.0</span>.<span class="number">300</span><span class="literal">-1</span> [<span class="number">58.4</span> <span class="type">MB</span>]</span><br><span class="line">Fetched <span class="number">95.1</span> MB <span class="keyword">in</span> <span class="number">1</span>min <span class="number">11</span>s (<span class="number">1332</span> kB/s)</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">(Reading database ... <span class="number">47293</span> files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../<span class="number">0</span><span class="literal">-dotnet</span><span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.6</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-host</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">1</span><span class="literal">-dotnet</span><span class="literal">-host_5</span>.<span class="number">0.6</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-host</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">2</span><span class="literal">-dotnet</span><span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.6</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">3</span><span class="literal">-dotnet</span><span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.6</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">4</span><span class="literal">-aspnetcore</span><span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.6</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">5</span><span class="literal">-dotnet</span><span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.0</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">0</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package aspnetcore<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">6</span><span class="literal">-aspnetcore</span><span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.0</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking aspnetcore<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">0</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">7</span><span class="literal">-dotnet</span><span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.6</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package netstandard<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">8</span><span class="literal">-netstandard</span><span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span>_2.<span class="number">1.0</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking netstandard<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span> (<span class="number">2.1</span>.<span class="number">0</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span>.</span><br><span class="line">Preparing to unpack .../<span class="number">9</span><span class="literal">-dotnet</span><span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span>_5.<span class="number">0.300</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">300</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-host</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-runtime</span><span class="literal">-deps</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up netstandard<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-2</span>.<span class="number">1</span> (<span class="number">2.1</span>.<span class="number">0</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-hostfxr</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-apphost</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">0</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up aspnetcore<span class="literal">-targeting</span><span class="literal">-pack</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">0</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">6</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up dotnet<span class="literal">-sdk</span><span class="literal">-5</span>.<span class="number">0</span> (<span class="number">5.0</span>.<span class="number">300</span><span class="literal">-1</span>) ...</span><br><span class="line">This software may collect information about you and your use of the software, and send that to Microsoft.</span><br><span class="line">Please visit http://aka.ms/dotnet<span class="literal">-cli</span><span class="literal">-eula</span> <span class="keyword">for</span> more information.</span><br><span class="line">Welcome to .NET!</span><br><span class="line">---------------------</span><br><span class="line">Learn more about .NET: https://aka.ms/dotnet<span class="literal">-docs</span></span><br><span class="line">Use <span class="string">&#x27;dotnet --help&#x27;</span> to see available commands or visit: https://aka.ms/dotnet<span class="literal">-cli</span><span class="literal">-docs</span></span><br><span class="line"></span><br><span class="line">Telemetry</span><br><span class="line">---------</span><br><span class="line">The .NET tools collect usage <span class="keyword">data</span> <span class="keyword">in</span> order to help us improve your experience. It is collected by Microsoft and shared with the community. You can opt<span class="literal">-out</span> of telemetry by setting the DOTNET_CLI_TELEMETRY_OPTOUT environment variable to <span class="string">&#x27;1&#x27;</span> or <span class="string">&#x27;true&#x27;</span> <span class="keyword">using</span> your favorite shell.</span><br><span class="line"></span><br><span class="line">Read more about .NET <span class="built_in">CLI</span> Tools telemetry: https://aka.ms/dotnet<span class="literal">-cli</span><span class="literal">-telemetry</span></span><br><span class="line"></span><br><span class="line">Configuring...</span><br><span class="line">--------------</span><br><span class="line">A command is running to populate your local package cache to improve restore speed and enable offline access. This command takes up to one minute to complete and only runs once.</span><br><span class="line">Processing triggers <span class="keyword">for</span> <span class="built_in">man</span><span class="literal">-db</span> (<span class="number">2.9</span>.<span class="number">1</span><span class="literal">-1</span>) ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装运行时：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt<span class="literal">-get</span> update; \</span><br><span class="line">  sudo apt<span class="literal">-get</span> install <span class="literal">-y</span> apt<span class="literal">-transport</span><span class="literal">-https</span> &amp;&amp; \</span><br><span class="line">  sudo apt<span class="literal">-get</span> update &amp;&amp; \</span><br><span class="line">  sudo apt<span class="literal">-get</span> install <span class="literal">-y</span> aspnetcore<span class="literal">-runtime</span><span class="literal">-5</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>dotnet-sdk-5.0 安装成功后，会一起安装 aspnetcore-runtime-5.0。</p>
</blockquote>
</li>
<li><p>检查 dotnet 版本：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># dotnet</span></span><br><span class="line"></span><br><span class="line">Usage: dotnet [<span class="type">options</span>]</span><br><span class="line">Usage: dotnet [<span class="type">path</span>-<span class="type">to</span>-<span class="type">application</span>]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  <span class="literal">-h</span>|-<span class="literal">-help</span>         Display help.</span><br><span class="line">  -<span class="literal">-info</span>            Display .NET information.</span><br><span class="line">  -<span class="literal">-list</span><span class="literal">-sdks</span>       Display the installed SDKs.</span><br><span class="line">  -<span class="literal">-list</span><span class="literal">-runtimes</span>   Display the installed runtimes.</span><br><span class="line"></span><br><span class="line">path<span class="literal">-to</span><span class="literal">-application</span>:</span><br><span class="line">  The path to an application .dll file to execute.</span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># dotnet --list-sdks</span></span><br><span class="line"><span class="number">5.0</span>.<span class="number">300</span> [/<span class="type">usr</span>/<span class="type">share</span>/<span class="type">dotnet</span>/<span class="type">sdk</span>]</span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/WINDOWS/system32<span class="comment"># dotnet --list-runtimes</span></span><br><span class="line">Microsoft.AspNetCore.App <span class="number">5.0</span>.<span class="number">6</span> [/<span class="type">home</span>/<span class="type">xisun</span>/<span class="type">.dotnet</span>/<span class="type">shared</span>/<span class="type">Microsoft.AspNetCore.App</span>]</span><br><span class="line">Microsoft.NETCore.App <span class="number">5.0</span>.<span class="number">6</span> [/<span class="type">home</span>/<span class="type">xisun</span>/<span class="type">.dotnet</span>/<span class="type">shared</span>/<span class="type">Microsoft.NETCore.App</span>]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>安装 wsl-translinux：</p>
<p><img src="/2021/05/17/docker-base/image-20210609105418915.png" alt="image-20210609105418915"></p>
<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://arkane-systems.github.io/wsl-transdebian/">https://arkane-systems.github.io/wsl-transdebian/</a></p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt install apt<span class="literal">-transport</span><span class="literal">-https</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">wget</span> <span class="literal">-O</span> /etc/apt/trusted.gpg.d/wsl<span class="literal">-transdebian</span>.gpg https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/wsl<span class="literal">-transdebian</span>.gpg</span><br><span class="line"></span><br><span class="line">chmod a+<span class="built_in">r</span> /etc/apt/trusted.gpg.d/wsl<span class="literal">-transdebian</span>.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; EOF &gt; /etc/apt/sources.list.d/wsl<span class="literal">-transdebian</span>.list</span><br><span class="line">deb https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/ <span class="variable">$</span>(lsb_release <span class="literal">-cs</span>) main</span><br><span class="line">deb<span class="literal">-src</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/ <span class="variable">$</span>(lsb_release <span class="literal">-cs</span>) main</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">apt update</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># apt install apt-transport-https</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">wget</span> <span class="literal">-O</span> /etc/apt/trusted.gpg.d/wsl<span class="literal">-transdebian</span>.gpg https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/wsl<span class="literal">-transdebian</span>.gpg</span><br><span class="line"></span><br><span class="line">chmod a+<span class="built_in">r</span> /etc/apt/trusted.gpg.d/wsl<span class="literal">-transdebian</span>.gpg</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; EOF &gt; /etc/apt/sources.list.d/wsl<span class="literal">-transdebian</span>.list</span><br><span class="line">deb https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/ <span class="variable">$</span>(lsb_release <span class="literal">-cs</span>) main</span><br><span class="line">deb<span class="literal">-src</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/ <span class="variable">$</span>(lsb_release <span class="literal">-cs</span>) main</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">apt<span class="literal">-transport</span><span class="literal">-https</span> is already the newest version (<span class="number">2.0</span>.<span class="number">5</span>).</span><br><span class="line"><span class="number">0</span> upgraded, <span class="number">0</span> newly installed, <span class="number">0</span> to remove and <span class="number">101</span> not upgraded.</span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># wget -O /etc/apt/trusted.gpg.d/wsl-transdebian.gpg https://arkane-systems.github.io/wsl-transdebian/apt/wsl-transdebian.gpg</span></span><br><span class="line">-<span class="literal">-2021</span><span class="literal">-06</span><span class="literal">-08</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">47</span>--  https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/wsl<span class="literal">-transdebian</span>.gpg</span><br><span class="line">Resolving arkane<span class="literal">-systems</span>.github.io (arkane<span class="literal">-systems</span>.github.io)... <span class="number">185.199</span>.<span class="number">109.153</span>, <span class="number">185.199</span>.<span class="number">108.153</span>, <span class="number">185.199</span>.<span class="number">110.153</span>, ...</span><br><span class="line">Connecting to arkane<span class="literal">-systems</span>.github.io (arkane<span class="literal">-systems</span>.github.io)|<span class="number">185.199</span>.<span class="number">109.153</span>|:<span class="number">443</span>... connected.</span><br><span class="line">HTTP request sent, awaiting response... <span class="number">200</span> OK</span><br><span class="line">Length: <span class="number">2280</span> (<span class="number">2.2</span>K) [<span class="type">application</span>/<span class="type">octet</span>-<span class="type">stream</span>]</span><br><span class="line">Saving to: ‘/etc/apt/trusted.gpg.d/wsl<span class="literal">-transdebian</span>.gpg’</span><br><span class="line"></span><br><span class="line">/etc/apt/trusted.gpg.d/wsl<span class="literal">-tr</span> <span class="number">100</span>%[=================================================&gt;]   <span class="number">2.23</span>K  --.<span class="literal">-KB</span>/s    <span class="keyword">in</span> <span class="number">0</span>s</span><br><span class="line"></span><br><span class="line"><span class="number">2021</span><span class="literal">-06</span><span class="literal">-08</span> <span class="number">21</span>:<span class="number">23</span>:<span class="number">49</span> (<span class="number">36.1</span> MB/s) - ‘/etc/apt/trusted.gpg.d/wsl<span class="literal">-transdebian</span>.gpg’ saved [<span class="number">2280</span>/<span class="number">2280</span>]</span><br><span class="line"></span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># chmod a+r /etc/apt/trusted.gpg.d/wsl-transdebian.gpg</span></span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># cat &lt;&lt; EOF &gt; /etc/apt/sources.list.d/wsl-transdebian.list</span></span><br><span class="line">&gt; deb https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/ <span class="variable">$</span>(lsb_release <span class="literal">-cs</span>) main</span><br><span class="line">&gt; deb<span class="literal">-src</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt/ <span class="variable">$</span>(lsb_release <span class="literal">-cs</span>) main</span><br><span class="line">&gt; EOF</span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># apt update</span></span><br><span class="line">Hit:<span class="number">1</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal InRelease</span><br><span class="line">Hit:<span class="number">2</span> http://archive.ubuntu.com/ubuntu focal InRelease</span><br><span class="line">Hit:<span class="number">3</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span> InRelease</span><br><span class="line">Hit:<span class="number">4</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span> InRelease</span><br><span class="line">Get:<span class="number">5</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt focal InRelease [<span class="number">2495</span> <span class="type">B</span>]</span><br><span class="line">Hit:<span class="number">6</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-backports</span> InRelease</span><br><span class="line">Get:<span class="number">7</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt focal/main Sources [<span class="number">1338</span> <span class="type">B</span>]</span><br><span class="line">Get:<span class="number">8</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt focal/main amd64 Packages [<span class="number">1897</span> <span class="type">B</span>]</span><br><span class="line">Fetched <span class="number">5730</span> B <span class="keyword">in</span> <span class="number">2</span>s (<span class="number">3130</span> B/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line"><span class="number">101</span> packages can be upgraded. Run <span class="string">&#x27;apt list --upgradable&#x27;</span> to see them.</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装 genie：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install <span class="literal">-y</span> systemd<span class="literal">-genie</span></span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># sudo apt update</span></span><br><span class="line">Hit:<span class="number">1</span> https://packages.microsoft.com/ubuntu/<span class="number">20.04</span>/prod focal InRelease</span><br><span class="line">Hit:<span class="number">2</span> http://security.ubuntu.com/ubuntu focal<span class="literal">-security</span> InRelease</span><br><span class="line">Hit:<span class="number">3</span> http://archive.ubuntu.com/ubuntu focal InRelease</span><br><span class="line">Hit:<span class="number">4</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span> InRelease</span><br><span class="line">Hit:<span class="number">5</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt focal InRelease</span><br><span class="line">Hit:<span class="number">6</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-backports</span> InRelease</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line"><span class="number">101</span> packages can be upgraded. Run <span class="string">&#x27;apt list --upgradable&#x27;</span> to see them.</span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># sudo apt install -y systemd-genie</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  daemonize libnss<span class="literal">-mymachines</span> libnss<span class="literal">-systemd</span> libpam<span class="literal">-systemd</span> libsystemd0 systemd systemd<span class="literal">-container</span> systemd<span class="literal">-sysv</span></span><br><span class="line">  systemd<span class="literal">-timesyncd</span></span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  daemonize libnss<span class="literal">-mymachines</span> systemd<span class="literal">-container</span> systemd<span class="literal">-genie</span></span><br><span class="line">The following packages will be upgraded:</span><br><span class="line">  libnss<span class="literal">-systemd</span> libpam<span class="literal">-systemd</span> libsystemd0 systemd systemd<span class="literal">-sysv</span> systemd<span class="literal">-timesyncd</span></span><br><span class="line"><span class="number">6</span> upgraded, <span class="number">4</span> newly installed, <span class="number">0</span> to remove and <span class="number">95</span> not upgraded.</span><br><span class="line">Need to get <span class="number">5359</span> kB of archives.</span><br><span class="line">After this operation, <span class="number">3892</span> kB of additional disk space will be used.</span><br><span class="line">Get:<span class="number">1</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 libnss<span class="literal">-systemd</span> amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">95.8</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">2</span> https://arkane<span class="literal">-systems</span>.github.io/wsl<span class="literal">-transdebian</span>/apt focal/main amd64 systemd<span class="literal">-genie</span> amd64 <span class="number">1.42</span> [<span class="number">504</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">3</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 systemd<span class="literal">-timesyncd</span> amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">28.1</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">4</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 systemd<span class="literal">-sysv</span> amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">10.3</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">5</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 libpam<span class="literal">-systemd</span> amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">186</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">6</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 systemd amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">3805</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">7</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 libsystemd0 amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">269</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">8</span> http://archive.ubuntu.com/ubuntu focal/universe amd64 daemonize amd64 <span class="number">1.7</span>.<span class="number">8</span><span class="literal">-1</span> [<span class="number">11.9</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">9</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 systemd<span class="literal">-container</span> amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">317</span> <span class="type">kB</span>]</span><br><span class="line">Get:<span class="number">10</span> http://archive.ubuntu.com/ubuntu focal<span class="literal">-updates</span>/main amd64 libnss<span class="literal">-mymachines</span> amd64 <span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span> [<span class="number">131</span> <span class="type">kB</span>]</span><br><span class="line">Fetched <span class="number">5359</span> kB <span class="keyword">in</span> <span class="number">5</span>s (<span class="number">1137</span> kB/s)</span><br><span class="line">(Reading database ... <span class="number">50558</span> files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../<span class="number">0</span><span class="literal">-libnss</span><span class="literal">-systemd_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking libnss<span class="literal">-systemd</span>:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) over (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">4</span>) ...</span><br><span class="line">Preparing to unpack .../<span class="number">1</span><span class="literal">-systemd</span><span class="literal">-timesyncd_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking systemd<span class="literal">-timesyncd</span> (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) over (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">4</span>) ...</span><br><span class="line">Preparing to unpack .../<span class="number">2</span><span class="literal">-systemd</span><span class="literal">-sysv_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking systemd<span class="literal">-sysv</span> (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) over (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">4</span>) ...</span><br><span class="line">Preparing to unpack .../<span class="number">3</span><span class="literal">-libpam</span><span class="literal">-systemd_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking libpam<span class="literal">-systemd</span>:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) over (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">4</span>) ...</span><br><span class="line">Preparing to unpack .../<span class="number">4</span><span class="literal">-systemd_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking systemd (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) over (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">4</span>) ...</span><br><span class="line">Preparing to unpack .../<span class="number">5</span><span class="literal">-libsystemd0_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking libsystemd0:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) over (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">4</span>) ...</span><br><span class="line">Setting up libsystemd0:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Selecting previously unselected package daemonize.</span><br><span class="line">(Reading database ... <span class="number">50558</span> files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../daemonize_1.<span class="number">7.8</span><span class="literal">-1_amd64</span>.deb ...</span><br><span class="line">Unpacking daemonize (<span class="number">1.7</span>.<span class="number">8</span><span class="literal">-1</span>) ...</span><br><span class="line">Selecting previously unselected package systemd<span class="literal">-container</span>.</span><br><span class="line">Preparing to unpack .../systemd<span class="literal">-container_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking systemd<span class="literal">-container</span> (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Selecting previously unselected package systemd<span class="literal">-genie</span>.</span><br><span class="line">Preparing to unpack .../systemd<span class="literal">-genie_1</span>.<span class="number">42</span>_amd64.deb ...</span><br><span class="line">Unpacking systemd<span class="literal">-genie</span> (<span class="number">1.42</span>) ...</span><br><span class="line">Selecting previously unselected package libnss<span class="literal">-mymachines</span>:amd64.</span><br><span class="line">Preparing to unpack .../libnss<span class="literal">-mymachines_245</span>.<span class="number">4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>_amd64.deb ...</span><br><span class="line">Unpacking libnss<span class="literal">-mymachines</span>:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Setting up daemonize (<span class="number">1.7</span>.<span class="number">8</span><span class="literal">-1</span>) ...</span><br><span class="line">Setting up systemd (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Initializing machine ID from random generator.</span><br><span class="line">Setting up systemd<span class="literal">-timesyncd</span> (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Setting up systemd<span class="literal">-container</span> (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Created symlink /etc/systemd/system/multi<span class="literal">-user</span>.target.wants/machines.target → /lib/systemd/system/machines.target.</span><br><span class="line">Setting up systemd<span class="literal">-sysv</span> (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Setting up systemd<span class="literal">-genie</span> (<span class="number">1.42</span>) ...</span><br><span class="line">Created symlink /etc/systemd/system/sockets.target.wants/wslg<span class="literal">-xwayland</span>.socket → /lib/systemd/system/wslg<span class="literal">-xwayland</span>.socket.</span><br><span class="line">Setting up libnss<span class="literal">-systemd</span>:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Setting up libnss<span class="literal">-mymachines</span>:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">First installation detected...</span><br><span class="line">Checking NSS setup...</span><br><span class="line">Setting up libpam<span class="literal">-systemd</span>:amd64 (<span class="number">245.4</span><span class="literal">-4ubuntu3</span>.<span class="number">6</span>) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> libc<span class="literal">-bin</span> (<span class="number">2.31</span><span class="literal">-0ubuntu9</span>.<span class="number">2</span>) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> <span class="built_in">man</span><span class="literal">-db</span> (<span class="number">2.9</span>.<span class="number">1</span><span class="literal">-1</span>) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> dbus (<span class="number">1.12</span>.<span class="number">16</span><span class="literal">-2ubuntu2</span>.<span class="number">1</span>) ...</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>破解完成之后，即可在 WSL 中安装 Docker (利用脚本安装)：</p>
<p><img src="/2021/05/17/docker-base/image-20210610215004640.png" alt="image-20210610215004640"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">curl</span> <span class="literal">-fsSL</span> https://get.docker.com <span class="literal">-o</span> <span class="built_in">get-docker</span>.sh</span><br><span class="line">sh <span class="built_in">get-docker</span>.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># curl -fsSL https://get.docker.com -o get-docker.sh</span></span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># sh get-docker.sh</span></span><br><span class="line"><span class="comment"># Executing docker install script, commit: 7cae5f8b0decc17d6571f9f52eb840fbc13b2737</span></span><br><span class="line"></span><br><span class="line">WSL DETECTED: We recommend <span class="keyword">using</span> Docker Desktop for Windows.</span><br><span class="line">Please get Docker Desktop from https://www.docker.com/products/docker<span class="literal">-desktop</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You may press Ctrl+C now to abort this script.</span><br><span class="line">+ <span class="built_in">sleep</span> <span class="number">20</span></span><br><span class="line">+ sh <span class="literal">-c</span> apt<span class="literal">-get</span> update <span class="literal">-qq</span> &gt;/dev/null</span><br><span class="line">+ sh <span class="literal">-c</span> DEBIAN_FRONTEND=noninteractive apt<span class="literal">-get</span> install <span class="literal">-y</span> <span class="literal">-qq</span> apt<span class="literal">-transport</span><span class="literal">-https</span> ca<span class="literal">-certificates</span> <span class="built_in">curl</span> &gt;/dev/null</span><br><span class="line">+ sh <span class="literal">-c</span> <span class="built_in">curl</span> <span class="literal">-fsSL</span> <span class="string">&quot;https://download.docker.com/linux/ubuntu/gpg&quot;</span> | apt<span class="literal">-key</span> add <span class="literal">-qq</span> - &gt;/dev/null</span><br><span class="line">Warning: apt<span class="literal">-key</span> output should not be parsed (stdout is not a terminal)</span><br><span class="line">+ sh <span class="literal">-c</span> <span class="built_in">echo</span> <span class="string">&quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable&quot;</span> &gt; /etc/apt/sources.list.d/docker.l</span><br><span class="line">ist</span><br><span class="line">+ sh <span class="literal">-c</span> apt<span class="literal">-get</span> update <span class="literal">-qq</span> &gt;/dev/null</span><br><span class="line">+ [ -<span class="type">n</span>  ]</span><br><span class="line">+ sh <span class="literal">-c</span> apt<span class="literal">-get</span> install <span class="literal">-y</span> <span class="literal">-qq</span> -<span class="literal">-no</span><span class="literal">-install</span><span class="literal">-recommends</span> docker<span class="literal">-ce</span> &gt;/dev/null</span><br><span class="line">+ [ -<span class="type">n</span> <span class="number">1</span> ]</span><br><span class="line">+ sh <span class="literal">-c</span> DEBIAN_FRONTEND=noninteractive apt<span class="literal">-get</span> install <span class="literal">-y</span> <span class="literal">-qq</span> docker<span class="literal">-ce</span><span class="literal">-rootless</span><span class="literal">-extras</span> &gt;/dev/null</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line"></span><br><span class="line">To run Docker as a non<span class="literal">-privileged</span> user, consider setting up the</span><br><span class="line">Docker daemon <span class="keyword">in</span> rootless mode <span class="keyword">for</span> your user:</span><br><span class="line"></span><br><span class="line">    dockerd<span class="literal">-rootless</span><span class="literal">-setuptool</span>.sh install</span><br><span class="line"></span><br><span class="line">Visit https://docs.docker.com/go/rootless/ to learn about rootless mode.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">To run the Docker daemon as a fully privileged service, but granting non<span class="literal">-root</span></span><br><span class="line">users access, refer to https://docs.docker.com/go/daemon<span class="literal">-access</span>/</span><br><span class="line"></span><br><span class="line">WARNING: Access to the remote API on a privileged Docker daemon is equivalent</span><br><span class="line">         to root access on the host. Refer to the <span class="string">&#x27;Docker daemon attack surface&#x27;</span></span><br><span class="line">         documentation <span class="keyword">for</span> details: https://docs.docker.com/go/attack<span class="literal">-surface</span>/</span><br><span class="line"></span><br><span class="line">================================================================================</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://github.com/docker/docker-install">https://github.com/docker/docker-install</a></p>
</blockquote>
</li>
<li><p>Docker 安装成功后，启动 Docker 服务：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/WINDOWS/system32<span class="comment"># service docker start</span></span><br><span class="line"> * Starting Docker: docker                                                                               [ <span class="type">OK</span> ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Docker 服务如果没有启动，执行 Docker 的命令时，会提示：<code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</code>。</p>
<p>Docker 服务启动后，如果不手动关闭，会一直运行，即使关闭 Windows PowerShell 也不会关闭。</p>
<p>如果关闭电脑，需要重启 Docker 服务。</p>
</blockquote>
</li>
<li><p>查看 Docker version：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/WINDOWS/system32<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           <span class="number">20.10</span>.<span class="number">6</span></span><br><span class="line"> API version:       <span class="number">1.41</span></span><br><span class="line"> Go version:        go1.<span class="number">13.15</span></span><br><span class="line"> Git commit:        <span class="number">370</span>c289</span><br><span class="line"> Built:             Fri Apr  <span class="number">9</span> <span class="number">22</span>:<span class="number">47</span>:<span class="number">17</span> <span class="number">2021</span></span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          <span class="number">20.10</span>.<span class="number">7</span></span><br><span class="line">  API version:      <span class="number">1.41</span> (minimum version <span class="number">1.12</span>)</span><br><span class="line">  Go version:       go1.<span class="number">13.15</span></span><br><span class="line">  Git commit:       b0f5bc3</span><br><span class="line">  Built:            Wed Jun  <span class="number">2</span> <span class="number">11</span>:<span class="number">54</span>:<span class="number">50</span> <span class="number">2021</span></span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          <span class="number">1.4</span>.<span class="number">6</span></span><br><span class="line">  GitCommit:        d71fcd7d8303cbf684402823e425e9dd2e99285d</span><br><span class="line"> runc:</span><br><span class="line">  Version:          <span class="number">1.0</span>.<span class="number">0</span><span class="literal">-rc95</span></span><br><span class="line">  GitCommit:        b9ee9c6314599f1b4a7f497e1f1f856fe433d3b7</span><br><span class="line"> docker<span class="literal">-init</span>:</span><br><span class="line">  Version:          <span class="number">0.19</span>.<span class="number">0</span></span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试 Docker，运行 hello-world：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># docker run hello-world</span></span><br><span class="line">Unable to find image <span class="string">&#x27;hello-world:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/hello<span class="literal">-world</span></span><br><span class="line">b8dfde127a29: Pull complete</span><br><span class="line">Digest: sha256:<span class="number">9</span>f6ad537c5132bcce57f7a0a20e317228d382c3cd61edae14650eec68b2b345c</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> hello<span class="literal">-world</span>:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> <span class="number">1</span>. The Docker client contacted the Docker daemon.</span><br><span class="line"> <span class="number">2</span>. The Docker daemon pulled the <span class="string">&quot;hello-world&quot;</span> image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> <span class="number">3</span>. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> <span class="number">4</span>. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To <span class="keyword">try</span> something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"> <span class="variable">$</span> docker run <span class="literal">-it</span> ubuntu bash</span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line"><span class="keyword">For</span> more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/<span class="built_in">get-started</span>/</span><br><span class="line"></span><br><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Windows/system32<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello<span class="literal">-world</span>   latest    d1165f221234   <span class="number">3</span> months ago   <span class="number">13.3</span>kB</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭 Docker 服务：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP<span class="literal">-OJKMETJ</span>:/mnt/c/Users/Ziyoo<span class="comment"># service docker stop</span></span><br><span class="line"> * Stopping Docker: docker                                                                               [ <span class="type">OK</span> ]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动和关闭 Docker 服务时，必须使用 root 用户。</p>
</blockquote>
</li>
</ul>
<h3 id="Ubuntu-安装"><a href="#Ubuntu-安装" class="headerlink" title="Ubuntu 安装"></a>Ubuntu 安装</h3><ul>
<li><p>参考：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p>
</li>
<li><p>按照官网指示一步步执行，即可安装 Docker。主要涉及如下命令，各命令的含义参考官网：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get remove docker docker-engine docker.io containerd runc</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install apt-transport-https \</span></span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg \</span><br><span class="line">    lsb-release</span><br><span class="line">    </span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \</span></span><br><span class="line">	sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> \</span></span><br><span class="line">  &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \</span><br><span class="line"><span class="meta">  $</span><span class="bash">(lsb_release -cs) stable<span class="string">&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get update</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install docker-ce docker-ce-cli containerd.io</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上命令默认安装的为 Docker 最新版本，若需要安装特定版本，请参考官网。</p>
</blockquote>
</li>
</ul>
<h2 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h2><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker version</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker info</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker --<span class="built_in">help</span></span></span><br></pre></td></tr></table></figure>

<h3 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h3><ul>
<li><p><strong>列出本机上的镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker images [OPTIONS]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>OPTIONS 说明：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-a 列出本地所有的镜像(含中间映射层)</span><br><span class="line">-q 只显示镜像ID</span><br><span class="line">--digests 显示镜像的摘要信息</span><br><span class="line">--no-trunc 显示完整的镜像信息</span><br></pre></td></tr></table></figure>

</li>
</ul>
<img src="/2021/05/17/docker-base/image-20210518170502255.png" alt="image-20210518170502255" style="zoom:80%;">
</li>
<li><p><strong>查询某个镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker search [OPTIONS] 镜像名字</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>OPTIONS 说明：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--no-trunc 显示完整的镜像描述</span><br><span class="line">-s 列出收藏数不小于指定值的镜像</span><br><span class="line">--automated 只列出 automated build类型的镜像</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>官方镜像仓库：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
</blockquote>
</li>
<li><p><strong>下载镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull 镜像名字[:TAG]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般设置从阿里云镜像下载。</p>
<p><code>docker pull tomcat</code> 等价于 <code>docker pull tomcat:latest</code>，即默认下载最新版本。</p>
</blockquote>
</li>
<li><p><strong>删除镜像</strong></p>
<ul>
<li><p>删除单个镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rmi -f 镜像名[:TAG]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>删除多个镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rmi -f 镜像名1[:TAG] 镜像名2[:TAG] 镜像名3[:TAG] ...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>删除全部镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rmi -f $(docker images -qa)</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h3 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h3><ul>
<li><p>有镜像才能创建容器，这是根本前提。先下载一个 CentOS 镜像作为示例：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker pull centos</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>新建并启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run [OPTIONS] IMAGE [COMMAND][ARG]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>OPTIONS 说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--name 为容器指定一个名称，若不指定，由系统随机分配</span><br><span class="line">-d 后台运行容器，并返回容器ID，即启动守护式容器</span><br><span class="line">-i 以交互模式运行容器，通常与-t同时使用</span><br><span class="line">-t 为容器重新分配一个伪输入终端，通常与-i同时使用</span><br><span class="line">-P 随机端口映射</span><br><span class="line">-p 指定端口映射，有以下四种格式：</span><br><span class="line">	ip:hostPort:containerPort</span><br><span class="line">	ip::containerPort</span><br><span class="line">	hostPort:containerPort</span><br><span class="line">	containerPort</span><br></pre></td></tr></table></figure>

</li>
</ul>
<img src="/2021/05/17/docker-base/image-20210519144837032.png" alt="image-20210519144837032">

<blockquote>
<p><strong>此时启动的是一个交互式的容器。</strong></p>
</blockquote>
</li>
<li><p><strong>列出当前所有正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker ps [OPTIONS]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>OPTIONS 说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-a 列出当前所有正在运行的容器+历史上运行过的</span><br><span class="line">-| 显示最近创建的容器</span><br><span class="line">-n 显示最近n个创建的容器</span><br><span class="line">-q 静默模式，只显示容器编号</span><br><span class="line">--no-trunc 不截断输出</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>退出容器</strong></p>
<ul>
<li>方式一，停止容器并退出：<code>exit</code>。</li>
<li>方式二，不停止容器退出：<code>ctrl + P + Q</code>。</li>
</ul>
</li>
<li><p><strong>启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker start 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>重启容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker restart 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>停止容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker stop 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>强制停止容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">kill</span> 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>删除已停止的容器</strong></p>
<ul>
<li><p>普通删除：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rm 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>强制删除：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rm -f 容器ID或容器名</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>-f 可以删除没有停止的容器。</p>
</blockquote>
</li>
<li><p>删除多个：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker rm -f $(docker ps -aq)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker ps -aq | xargs docker rm</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>启动守护式容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d IMAGE</span></span><br></pre></td></tr></table></figure>

<ul>
<li>例如，以后台模式启动一个 CentOS，<code>docker run -d centos</code>，然后 <code>docker ps -a</code> 进行查看，<strong>会发现容器已经退出。</strong></li>
<li><strong>Docker 容器若要后台运行，就必须有一个前台进程。</strong></li>
</ul>
</li>
<li><p><strong>查看容器日志</strong></p>
<ul>
<li><p>启动一个一直运行的守护式容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d centos /bin/sh -c <span class="string">&quot;while true; do echo hello xisun; sleep 2; done&quot;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查看该容器的日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker logs [OPTIONS] 容器ID或容器名</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>OPTION 说明：</p>
<figure class="highlight do"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-t 添加时间戳</span><br><span class="line"></span><br><span class="line">-f 跟随最新的日志打印</span><br><span class="line"></span><br><span class="line">--tail number 显示最后number条</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>查看容器内运行的进程</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker top 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看容器内部的细节</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker inspect 容器ID或容器名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>进入正在运行的容器并以命令行交互</strong></p>
<ul>
<li><p>方式一：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker attach 容器ID或容器名</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>直接进入容器启动命令的终端，不会启动新的进程。</strong>然后在该容器的终端内，执行相应的命令。</p>
</blockquote>
</li>
<li><p>方式二：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">exec</span> -t 容器ID或容器名 ls -l /tmp</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>在容器中打开新的终端，并且可以启动新的进程。</strong>然后执行后续的命令，并将结果显示在当前窗口。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">exec</span> -t 容器ID或容器名 /bin/bash</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>与方式一等效。</p>
</blockquote>
<img src="/2021/05/17/docker-base/image-20210520094656346.png" alt="image-20210520094656346" style="zoom:80%;">

</li>
</ul>
<blockquote>
<p>针对执行 <code>ctrl + P + Q</code> 命令退出的容器。</p>
</blockquote>
</li>
<li><p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker cp 容器ID或容器名:容器内路径 目的主机路径</span></span><br></pre></td></tr></table></figure>

<img src="/2021/05/17/docker-base/image-20210520102210176.png" alt="image-20210520102210176" style="zoom:80%;">

</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><img src="/2021/05/17/docker-base/image-20210520102432819.png" alt="image-20210520102432819" style="zoom:80%;">

<img src="/2021/05/17/docker-base/20201003133051.png" alt="20201003133051" style="zoom:80%;">

<h2 id="Docker-镜像"><a href="#Docker-镜像" class="headerlink" title="Docker 镜像"></a>Docker 镜像</h2><ul>
<li>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的有内容，包括代码、运行时、库、环境变量和配置文件。</li>
</ul>
<h3 id="UnionFS-联合文件系统"><a href="#UnionFS-联合文件系统" class="headerlink" title="UnionFS (联合文件系统)"></a>UnionFS (联合文件系统)</h3><ul>
<li>UnionFS 是一种分层、轻量级并且高性能的文件系统，它支持<strong>对文件系统的修作为一次提交来一层层的叠加</strong>，同时可以将不同目录挂载到同一个虚拟文件系统下 (unite several directories into a single virtual file system)。</li>
<li><strong>UnionFS 是 Docker 镜像的基础。</strong>镜像可以通过分层来进行继承，基于基础镜像 (没有父镜像)，可以制作各种具体的应用镜像。</li>
<li>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</li>
</ul>
<h3 id="Docker-镜像加载原理"><a href="#Docker-镜像加载原理" class="headerlink" title="Docker 镜像加载原理"></a>Docker 镜像加载原理</h3><ul>
<li><p>Docker 的镜像实际上是由一层一层的文件系统组成，这种层级的文件系统即为 UnionFS。主要包含两个部分：</p>
<img src="/2021/05/17/docker-base/image-20210520113123426.png" alt="image-20210520113123426" style="zoom:80%;">

<ul>
<li><strong>bootfs (boot file system)：</strong>主要包含 bootloader 和 kernel，bootloader 主要是引导加载 kernel，Linux 刚启动时会加载bootfs文件系统。bootfs 是 Docker 镜像的最底层，这一层与我们典型的 Linux/Unix 系统是一样的，包含 boot 加载器和内核。当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权由 bootfs 转交给内核，系统也会卸载 bootfs。</li>
<li><strong>rootfs (root file system)：</strong>在 bootfs 之上。包含的就是典型 Linux 系统中的 /dev， /proc，/bin，/etc 等标准目录和文件。rootfs 就是各种不同的操作系统发行版，比如 Ubuntu，CentOS 等等。</li>
</ul>
</li>
<li><p>对于一个精简的 OS，rootfs 可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用 Host (宿主机) 的 kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的 Linux 发行版，bootfs基本是一致的，rootfs会有差别，因此不同的发行版可以公用 bootfs。比如：平时我们安装的虚拟机的 CentOS 都是好几个 G 大小，而 Docker 里才要 200 M 左右。</p>
<p><img src="/2021/05/17/docker-base/image-20210520113538105.png" alt="image-20210520113538105"></p>
</li>
</ul>
<h3 id="Docker-镜像是分层的"><a href="#Docker-镜像是分层的" class="headerlink" title="Docker 镜像是分层的"></a>Docker 镜像是分层的</h3><ul>
<li><p>在执行 pull 命令时，可以看出 docker 的镜像时一层一层的在下载：</p>
<p><img src="/2021/05/17/docker-base/image-20210520165412315.png" alt="image-20210520165412315"></p>
</li>
<li><p>以 tomcat 为例，主要分为如下几个层次：</p>
<p><img src="/2021/05/17/docker-base/image-20210520165008832.png" alt="image-20210520165008832"></p>
</li>
</ul>
<h3 id="Docker-镜像采用分层结构的原因"><a href="#Docker-镜像采用分层结构的原因" class="headerlink" title="Docker 镜像采用分层结构的原因"></a>Docker 镜像采用分层结构的原因</h3><ul>
<li>最大的一个好处就是：<strong>共享资源。</strong></li>
<li>比如：有多个镜像都从相同的 base 镜像构建而来，那么宿主机只需在磁盘上保存一份 base 镜像，同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。进一步的，<strong>镜像的每一层都可以被共享。</strong></li>
</ul>
<h3 id="Docker-镜像的特点"><a href="#Docker-镜像的特点" class="headerlink" title="Docker 镜像的特点"></a>Docker 镜像的特点</h3><ul>
<li>Docker 镜像都是只读的，当容器启动时，一个新的可写层被加载到<strong>镜像的顶部</strong>，这一层通常被称为<strong>容器层</strong>，容器层之下都叫<strong>镜像层</strong>。<ul>
<li>Docker 镜像的最外层是可写的，之下的都是封装好不可写的。</li>
</ul>
</li>
</ul>
<h3 id="Docker-镜像-commit-操作"><a href="#Docker-镜像-commit-操作" class="headerlink" title="Docker 镜像 commit 操作"></a>Docker 镜像 commit 操作</h3><ul>
<li><p>docker commit 命令，可以提交容器副本使之称为一个新的镜像。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker commit -m=<span class="string">&quot;提交的描述信息&quot;</span> -a=<span class="string">&quot;作者&quot;</span> 容器ID 要创建的目标镜像名:[标签名]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>案例演示：</p>
<ul>
<li><p>从 Hub 上下载 tomcat 镜像到本地，然后运行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -p 8888:8080 tomcat</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-p 主机端口:容器端口，主机端口即为暴露的能访问docker的端口，容器端口即为docker内待访问特定容器的端口，如tomcat默认为8080</span><br><span class="line">-P 随机分配主机的端口</span><br><span class="line">-d 后台运行容器，并返回容器ID，即启动守护式容器</span><br><span class="line">-i 以交互模式运行容器，通常与-t同时使用</span><br><span class="line">-t 为容器重新分配一个伪输入终端，通常与-i同时使用</span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210523092658718.png" alt="image-20210523092658718"></p>
</li>
<li><p>故意删除上一步镜像生成的 tomcat 容器的文档，会发现再次进入 tomcat 主页时，点击 Documentation 会返回 404。</p>
<p><img src="/2021/05/17/docker-base/image-20210523095753669.png" alt="image-20210523095753669"></p>
<p><img src="/2021/05/17/docker-base/image-20210523095840185.png" alt="image-20210523095840185"></p>
</li>
<li><p>也即当前的 tomcat 运行实例是一个没有文档内容的容器，现在，以此为模板 commit 一个没有 doc 文档的 tomcat 新镜像：atguigu/tomcat02:1.2。</p>
<p><img src="/2021/05/17/docker-base/image-20210523105707137.png" alt="image-20210523105707137"></p>
</li>
<li><p>启动新镜像并和原来的对比。</p>
<ul>
<li><p>启动 atuigu/tomcat02，没有doc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -p 7777:8080 atuigu/tomcat02:1.2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动原来 tomcat，有doc</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -p 8888:8080 tomcat</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Docker-容器数据卷"><a href="#Docker-容器数据卷" class="headerlink" title="Docker 容器数据卷"></a>Docker 容器数据卷</h2><ul>
<li>Docker 容器产生的数据，如果不通过 docker commit 生成一个新的镜像，使得数据做为镜像的一部分保存下来，那么当容器删除后，数据自然也就没有了。</li>
<li><strong>在 Docker 中，使用卷来保存数据。</strong>有点类似 Redis 里面的 rdb 和 aof 文件。</li>
<li>卷是目录或文件，存在于一个或多个容器中，由 Docker 挂载到容器，但不属于联合文件系统，因此能够绕过 UnionFS 提供一些用于持续存储或共享数据的特性。</li>
<li><strong>卷的设计目的就是数据的持久化</strong>，卷完全独立于容器的生存周期，因此 Docker 不会在容器删除时删除其挂载的数据卷。</li>
<li><strong>卷的特点：</strong><ul>
<li><strong>数据卷可在容器之间共享或重用数据。</strong></li>
<li><strong>数据卷中的更改可以直接生效。</strong></li>
<li><strong>数据卷中的更改不会包含在镜像的更新中。</strong></li>
<li><strong>数据卷的生命周期一直持续到没有容器使用它为止。</strong></li>
</ul>
</li>
</ul>
<h3 id="容器内添加数据卷"><a href="#容器内添加数据卷" class="headerlink" title="容器内添加数据卷"></a>容器内添加数据卷</h3><ul>
<li><p><strong>直接命令添加</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -v /宿主机绝对路径目录:/容器内目录 镜像名</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>案例演示：</p>
<p><img src="/2021/05/17/docker-base/image-20210525100710287.png" alt="image-20210525100710287"></p>
</li>
<li><p>查看数据卷是否挂载成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker inspect 容器ID</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525102017647.png" alt="image-20210525102017647"></p>
<blockquote>
<p>此时，volume 权限是可读写的。可以在容器或主机内分别对卷进行数据的读写，读写的数据是共享的。</p>
</blockquote>
</li>
<li><p>容器运行时，容器和宿主机之间数据能够共享：</p>
<p><img src="/2021/05/17/docker-base/image-20210525102405896.png" alt="image-20210525102405896"></p>
</li>
<li><p>容器停止退出后，主机修改后的数据也能同步：</p>
<p><img src="/2021/05/17/docker-base/image-20210525103400831.png" alt="image-20210525103400831"></p>
</li>
<li><p>带权限的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525104906871.png" alt="image-20210525104906871"></p>
<blockquote>
<p>此时，volume 权限是不可写的。可以在主机对卷进行数据的读写，读写的数据是共享的。但是，在容器内，只可对卷进行数据的读，不可写。</p>
</blockquote>
</li>
</ul>
</li>
<li><p><strong>Dockerfile 添加</strong></p>
<ul>
<li><p>在主机根目录下新建 mydocker 文件夹并进入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir /mydocker</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /mydocker</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Dockerfile 中，使用 VOLUME 指令来给镜像添加一个或多个数据卷：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/dataVolumeContainer&quot;</span>,<span class="string">&quot;/dataVolumeContainer2&quot;</span>,<span class="string">&quot;/dataVolumeContainer3&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<ul>
<li>出于可移植和分享的考虑，用 <code>-v 主机目录:容器目录</code> 这种方法不能直接在 Dockerfile 中实现。因为宿主机目录是依赖于特定宿主机的，不能保证在所有的宿主机上都存在这样的特定目录。</li>
</ul>
</li>
<li><p>构建 Dockerfile：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim Dockerfile2</span></span><br></pre></td></tr></table></figure>

<p>在 Dockerfile2 中添加如下内容：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># volume test</span></span><br><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;/dataVolumeContainer1&quot;</span>,<span class="string">&quot;/dataVolumeContainer2&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;finished,--------success1&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>大致等同于命令：<code>docker run -it -v /host1:/dataVolumeContainer1 -v /host2:/dataVolumeContainer2 centos /bin/bash</code>。</p>
</blockquote>
</li>
<li><p>执行 build 命令生成一个新镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker builder -f /mydocker/Dockerfile2 -t zzyy/centos .</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525170205671.png" alt="image-20210525170205671"></p>
</li>
<li><p>执行 run 命令启动容器，并查看容器内创建的卷的目录所在：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it zzyy/centos /bin/bash</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525170543474.png" alt="image-20210525170543474"></p>
</li>
<li><p>执行 inspect 命令查看主机对应的目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker inspect 容器ID</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525171348807.png" alt="image-20210525171348807"></p>
<p><img src="/2021/05/17/docker-base/image-20210525171451918.png" alt="image-20210525171451918"></p>
</li>
</ul>
</li>
<li><p>备注：</p>
<ul>
<li>Docker 挂载主机目录 Docker 访问出现 <code>cannot open directory. Permission denied</code> 异常时，在挂载目录后多加一个 <code>--privileged=true</code> 参数即可。</li>
</ul>
</li>
</ul>
<h3 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h3><ul>
<li><p>命名的容器挂载数据卷，其它容器通过挂载这个 (父容器) 实现数据共享，挂载数据卷的容器，称之为数据卷容器。</p>
</li>
<li><p>案例演示：</p>
<ul>
<li><p>先启动一个父容器 doc1，启动后在 dataVolumeContainer2 中新增内容 dc01_add.txt：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it --name dc01 zzyy/centos</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525172731112.png" alt="image-20210525172731112"></p>
</li>
<li><p>启动子容器 dc02 和 dc03，继承 dc01，启动后分别在 dataVolumeContainer2 中新增内容 dc02_add.txt 和 dc03_add.txt：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it --name dc02 --volume-from dco1 zzyy/centos</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it --name dc03 --volume-from dco1 zzyy/centos</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525173239008.png" alt="image-20210525173239008"></p>
</li>
<li><p>重新进入 dc01 容器，可以看到 dc02 和 dc03 容器内添加的数据，在卷 dataVolumeContainer2  中都可以共享：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker ps</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker attach dc01</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210525173530503.png" alt="image-20210525173530503"></p>
</li>
<li><p>删除 dc01，dc02 和 dc03 仍然能够共享数据：</p>
<p><img src="/2021/05/17/docker-base/image-20210525215431656.png" alt="image-20210525215431656"></p>
</li>
<li><p>删除 dc02 后，dc03 仍然能够共享数据：</p>
<p><img src="/2021/05/17/docker-base/image-20210525221249241.png" alt="image-20210525221249241"></p>
</li>
<li><p>新建 dc04 继承 dc03，然后删除 dc03，dc04 仍然能够共享数据：</p>
<p><img src="/2021/05/17/docker-base/image-20210525221624773.png" alt="image-20210525221624773"></p>
<p><img src="/2021/05/17/docker-base/image-20210525221738032.png" alt="image-20210525221738032"></p>
</li>
</ul>
</li>
<li><p><strong>结论：容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止。</strong></p>
</li>
</ul>
<h2 id="Dockerfile-解析"><a href="#Dockerfile-解析" class="headerlink" title="Dockerfile 解析"></a>Dockerfile 解析</h2><ul>
<li><p><strong>Dockerfile 是用来构建 Docker 镜像的构建文件，由一系列命令和参数构成的脚本。</strong></p>
<p><img src="/2021/05/17/docker-base/image-20210526170718893.png" alt="image-20210526170718893"></p>
</li>
<li><p>Dockerfile 构建的三步骤：</p>
<ul>
<li>手动编写一个 Dockerfile 文件，必须要符合 Dockerfile 的规范；</li>
<li>docker build 命令执行编写好的 Dockerfile 文件，获得一个自定义的镜像；</li>
<li>doucker run 命令启动容器。</li>
</ul>
</li>
</ul>
<h3 id="Dockerfile-构建过程解析"><a href="#Dockerfile-构建过程解析" class="headerlink" title="Dockerfile 构建过程解析"></a>Dockerfile 构建过程解析</h3><ul>
<li><p>Dockerfile 内容基础知识：</p>
<ul>
<li>每条保留字指令都必须为大写字母，且后面要跟随至少一个参数。</li>
<li>指令按照从上到下，顺序执行。</li>
<li># 表示注释。</li>
<li>每条指令都会创建一个新的镜像层，并对镜像进行提交。</li>
</ul>
</li>
<li><p>Docker 执行 Dockerfile 的大致流程：</p>
<ul>
<li>第一步：Docker 从基础镜像运行一个容器；</li>
<li>第二步：执行一条指令并对容器作出修改；</li>
<li>第三步：执行类似 docker commit 的操作提交一个新的镜像层；</li>
<li>第四步：docker 再基刚提交的镜像运行一个新容器；</li>
<li>第五步：执行 Dockerfile 中的下一条指令，重复第二至第五步，直到所有指令都执行完成。</li>
</ul>
</li>
<li><p>Dockerfile、 Docker 镜像与 Docker 容器三者的关系：</p>
<ul>
<li><p>从应用软件的角度来看，Dockerfile、 Docker 镜像与 Docker 容器分别代表软件的三个不同阶段：</p>
<p><img src="/2021/05/17/docker-base/image-20210526203303754.png" alt="image-20210526203303754"></p>
<ul>
<li>Dockerfile 是软件的原材料。</li>
<li>Docker 镜像是软件的交付品。</li>
<li>Docker 容器可以认为是软件的运行态。</li>
<li>Dockerfile 面向开发，Docker 镜像为交付标准，Docker 容器则涉及部署与运维，三者缺一不可，合力充当 Docker 体系的基石。</li>
</ul>
</li>
<li><p>Dockerfile 定义了进程需要的一切东西。Dockerfile 涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程 (当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计 namespace 的权限控制) 等等。</p>
</li>
<li><p>定义了 Dockerfile 文件后，docker build 命令产生一个 Docker 镜像。</p>
</li>
<li><p>对于生成的 Docker 镜像，docker run 命令生成 Docker 容器，容器是直接提供服务的。</p>
</li>
</ul>
</li>
</ul>
<h3 id="Dockerfile-体系结构-保留字指令"><a href="#Dockerfile-体系结构-保留字指令" class="headerlink" title="Dockerfile 体系结构 (保留字指令)"></a>Dockerfile 体系结构 (保留字指令)</h3><img src="/2021/05/17/docker-base/image-20210528152339289.png" alt="image-20210528152339289" style="zoom:80%;">

<ul>
<li><p><strong>FROM</strong>：基础镜像，即当前新镜像是基于哪个镜像的。</p>
</li>
<li><p><strong>MAINTAINER</strong>：镜像维护者的姓名和邮箱地址。</p>
</li>
<li><p><strong>RUN</strong>：容器构建时需要运行的命令。</p>
</li>
<li><p><strong>EXPOSE</strong>：当前容器对外暴露出的端口。</p>
</li>
<li><p><strong>WORKDIR</strong>：指定在创建容器后，终端默认进入的工作目录。如果不指定，则为根目录。</p>
</li>
<li><p><strong>ENV</strong>：用来在构建过程中设置环境变量。例如：<code>ENV MY_PATH /usr/mytest</code>，这个环境变量可以在后续的任何 RUN 指令中使用，如同在命令前制定了环境变量前缀；也可以在其他指令中直接使用这个环境变量，如 <code>WORKDIR $MY_PATH</code>。</p>
</li>
<li><p><strong>ADD</strong>：将宿主机目录下的文件拷贝进镜像，并且能够自动处理 URL 和解压 tar 压缩包。</p>
</li>
<li><p><strong>COPY</strong>：类似 ADD，拷贝文件和目录到镜像中 (只拷贝)。将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层镜像内的 &lt;目标路径&gt; 指向的位置。</p>
<ul>
<li><code>COPY src dest</code></li>
<li><code>COPY [&quot;src&quot;,&quot;dest&quot;]</code></li>
</ul>
</li>
<li><p><strong>VOLUME</strong>：容器数据卷，用于数据保存和持久化工作。</p>
</li>
<li><p><strong>CMD</strong>：指定一个容器启动时要运行的命令。</p>
<ul>
<li>CMD 指令的格式和 RUN 相似：<ul>
<li>shell 格式：<code>CMD &lt;命令&gt;</code></li>
<li>exec 格式：<code>CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;...]</code></li>
<li>参数列表格式：<code>CMD [&quot;参数1&quot;, &quot;参数2&quot;...]</code>。在指定了 ENTRYPOINT 指令后，用 CMD 指定具体的参数。</li>
</ul>
</li>
<li>Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效。<strong>CMD 指令会被 docker run 之后的参数替换。</strong></li>
</ul>
</li>
<li><p><strong>ENTRYPOINT</strong>：指定一个容器启动时要运行的命令。</p>
<ul>
<li>ENTRYPOINT 的目的和 CMD 一样，不同的是，<strong>ENTRYPOINT 指令会被 docker run 之后的参数追加。</strong></li>
</ul>
</li>
<li><p>ONBUILD：当构建一个被继承的 Dockerfile 时运行命令，父镜像在被子镜像继承时，父镜像的 ONBUILD 指令触发，</p>
<p><img src="/2021/05/17/docker-base/image-20210528152445200.png" alt="image-20210528152445200"></p>
</li>
</ul>
<h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><h4 id="Base-镜像"><a href="#Base-镜像" class="headerlink" title="Base 镜像"></a>Base 镜像</h4><ul>
<li><p>Docker Hub 中 99% 的镜像都是通过在 base 镜像中，安装和配置需要的软件构建出来的。例如 centos 镜像：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> scratch</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> centos-8-x86_64.tar.xz /</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> org.label-schema.schema-version=<span class="string">&quot;1.0&quot;</span>     org.label-schema.name=<span class="string">&quot;CentOS Base Image&quot;</span>     org.label-schema.vendor=<span class="string">&quot;CentOS&quot;</span>     org.label-schema.license=<span class="string">&quot;GPLv2&quot;</span>     org.label-schema.build-date=<span class="string">&quot;20201204&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>]</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="自定义镜像-mycentos"><a href="#自定义镜像-mycentos" class="headerlink" title="自定义镜像 mycentos"></a>自定义镜像 mycentos</h4><ul>
<li><p>编写 Dockerfile：</p>
<ul>
<li><p>Docker Hub 默认的 centos 镜像：</p>
<p><img src="/2021/05/17/docker-base/image-20210528161841454.png" alt="image-20210528161841454"></p>
</li>
<li><p>需求：</p>
<ul>
<li>设置登陆后的默认路径；</li>
<li>增加 vim 编辑器；</li>
<li>增加查看网络配置 ifconfig 支持。</li>
</ul>
</li>
<li><p>在主机 /mydocker 或其他目录下编写 Dockerfile 文件：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> ZZYY&lt;zzyy167@<span class="number">126</span>.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install net-tools</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;success--------------ok&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /bin/bash</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>构建镜像：**<code>docker build -f Dockerfile路径 -t 新镜像名字:TAG .</code>**</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker build -f /mydocker/Dockerfile -t mycentos:1.3 .</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210528165752297.png" alt="image-20210528165752297"></p>
</li>
<li><p>运行容器：**<code>docker run -it 新镜像名字:TAG </code>**</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it mycentos:1.3</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210528170148528.png" alt="image-20210528170148528"></p>
</li>
<li><p>列出镜像的变更历史：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">history</span> 镜像ID</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210528173122209.png" alt="image-20210528173122209"></p>
</li>
</ul>
<h4 id="CMD-ENTRYPOINT-镜像案例"><a href="#CMD-ENTRYPOINT-镜像案例" class="headerlink" title="CMD/ENTRYPOINT 镜像案例"></a>CMD/ENTRYPOINT 镜像案例</h4><ul>
<li><p>CMD/ENTRYPOINT 都是指定一个容器启动时要运行的命令。</p>
</li>
<li><p><strong>Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效；另外，CMD 指令会被 docker run 命令之后的参数替换。</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">16</span>-jdk-buster</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /usr/local/tomcat</span><br><span class="line"><span class="keyword">ENV</span> PATH $CATALINA_HOME/bin:$PATH</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p <span class="string">&quot;<span class="variable">$CATALINA_HOME</span>&quot;</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$CATALINA_HOME</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># let &quot;Tomcat Native&quot; live somewhere isolated</span></span><br><span class="line"><span class="keyword">ENV</span> TOMCAT_NATIVE_LIBDIR $CATALINA_HOME/native-jni-lib</span><br><span class="line"><span class="keyword">ENV</span> LD_LIBRARY_PATH $&#123;LD_LIBRARY_PATH:+$LD_LIBRARY_PATH:&#125;$TOMCAT_NATIVE_LIBDIR</span><br><span class="line"></span><br><span class="line"><span class="comment"># see https://www.apache.org/dist/tomcat/tomcat-$TOMCAT_MAJOR/KEYS</span></span><br><span class="line"><span class="comment"># see also &quot;update.sh&quot; (https://github.com/docker-library/tomcat/blob/master/update.sh)</span></span><br><span class="line"><span class="keyword">ENV</span> GPG_KEYS A9C5DF4D22E99998D9875A5110C01C5A2F6059E7</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TOMCAT_MAJOR <span class="number">10</span></span><br><span class="line"><span class="keyword">ENV</span> TOMCAT_VERSION <span class="number">10.0</span>.<span class="number">6</span></span><br><span class="line"><span class="keyword">ENV</span> TOMCAT_SHA512 <span class="number">3</span>d39b086b6fec86e354aa4837b1b55e6c16bfd5ec985a82a5dd71f928e3fab5370b2964a5a1098cfe05ca63d031f198773b18b1f8c7c6cdee6c90aa0644fb2f2</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># verify Tomcat Native is working properly</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;catalina.sh&quot;</span>, <span class="string">&quot;run&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>以 tomcat 的 Dockerfile 为例，可以看到，文件的最后一条指令为 CMD 指令。</p>
</li>
<li><p>运行以下命令，tomcat 能够正常启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -p 7777:8080 tomcat</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>运行以下命令，tomcat 不能正常启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -it -p 7777:8080 tomcat ls -l</span></span><br></pre></td></tr></table></figure>

<ul>
<li>上面的 docker run 命令，末尾的 <code>ls -l</code> 参数会替换 Dockerfile 文件中的 <code>CMD [&quot;catalina.sh&quot;, &quot;run&quot;]</code> 指令，因此，tomcat 不会启动，只会列出 <code>/usr/local/tomcat</code> 路径下的文件。</li>
</ul>
</li>
</ul>
</li>
<li><p>不同于 CMD 指令，<strong>docker run 命令之后的参数，会传递给 ENTRYPOINT 指令，追加形成新的命令组合。</strong></p>
<ul>
<li><p>curl 命令解释：</p>
<ul>
<li>curl 命令可以用来执行下载、发送各种 HTTP 请求，指定 HTTP 头部等操作。</li>
<li>如果系统没有 curl，可以使用 <code>yum install -y curl</code> 命令安装。</li>
<li>curl 命令的 URL 如果指向的是 HTML 文档，那么缺省只显示文件头部，即 HTML 文档的 header，要全部显示，则加参数 -i。</li>
</ul>
</li>
<li><p>CMD 版查询 IP 信息的容器：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y curl</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-s&quot;</span>, <span class="string">&quot;http://ip.cn&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210601115857147.png" alt="image-20210601115857147"></p>
<ul>
<li>上面的容器，已经指定了 CMD 指令，如果希望查询结果包含 header，命令 <code>docker run myip -i</code> 会不生效。-i 参数会替换掉 CMD 指令。</li>
</ul>
</li>
<li><p>ENTRYPOINT 版查询 IP 信息的容器：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y curl</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-s&quot;</span>, <span class="string">&quot;http://ip.cn&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210601152053797.png" alt="image-20210601152053797"></p>
<ul>
<li>上面的容器，使用的是 ENTRYPOINT 指令，如果希望查询结果包含 header，只需要使用命令 <code>docker run myip -i</code> 即可。-i 参数会追加到 ENTRYPOINT 指令后面。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="自定义镜像-tomcat"><a href="#自定义镜像-tomcat" class="headerlink" title="自定义镜像 tomcat"></a>自定义镜像 tomcat</h4><ul>
<li><p>创建目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir -p /zzyy/mydockerfile/tomcat9</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>再上述目录创建 c.txt：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /zzyy/mydockerfile/tomcat9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> touch c.txt</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将 JDK 和 tomcat 的安装压缩包拷贝进上一步目录：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cp /opt/jdk-8u171-linux-x64.tar.gz /zzyy/mydockerfile/tomcat9</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp /opt/apache-tomcat-9.0.8.tar.gz /zzyy/mydockerfile/tomcat9</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在 zzyyuse/mydockerfile/tomcat9 目录下新建 Dockerfile 文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim Dockerfie</span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"><span class="keyword">MAINTAINER</span> zzyy&lt;zzyybs@ <span class="number">126</span>.com&gt;</span><br><span class="line"><span class="comment">#把宿主机当前上下文的c.txt拷贝到容器/usr/local/路径下</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> c.txt /usr/<span class="built_in">local</span>/cincontainer.txt</span></span><br><span class="line"><span class="comment">#把java与tomcat添加到容器中</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> jdk-8u171-linux x64.tar.gz /usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> apache-tomcat-9.0.8.tar.gz /usr/<span class="built_in">local</span>/</span></span><br><span class="line"><span class="comment">#安装vim编辑器</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"><span class="comment">#设置工作访问时候的WORKDIR路径，登录落脚点</span></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="comment">#配置java与tomcat环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_ HOME /usr/local/jdk1.<span class="number">8.0</span>_171</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /usr/local/apache-tomcat-<span class="number">9.0</span>.<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> CATALINA_BASE /usr/local/apache-tomcat-<span class="number">9.0</span>.<span class="number">8</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"><span class="comment">#容器运行时监听的端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="comment">#启动时运行tomcat</span></span><br><span class="line"><span class="comment"># ENTRYPOINT [&quot;/usrl/local/apache-tomcat-9.0.8/bin/startup.sh&quot; ]</span></span><br><span class="line"><span class="comment"># CMD [&quot;/usr/local/apache-tomcat-9.0.8/bin/catalina.sh&quot;,&quot;run&quot;]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /usr/<span class="built_in">local</span>/apache-tomcat-9.0.8/bin/startup.sh &amp;&amp; tail -F /usr/<span class="built_in">local</span>/apache-tomcat-9.0.8/<span class="keyword">in</span>/logs/catalina.out</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>目录内容：</p>
<img src="/2021/05/17/docker-base/image-20210601172840353.png" alt="image-20210601172840353" style="zoom:80%;">
</li>
<li><p>构建镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker build -t zzyytomcat9</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>不添加 -f 参数，默认构建当前路径下的 Dockerfile。</p>
</blockquote>
<p><img src="/2021/05/17/docker-base/image-20210601173056817.png" alt="image-20210601173056817"></p>
<p><img src="/2021/05/17/docker-base/image-20210601173119315.png" alt="image-20210601173119315"></p>
</li>
<li><p>运行容器：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -d -p 9080:8080 -name myt9 -v /zzyyuse/mydockerfile/tomcat9/<span class="built_in">test</span>:/usrlocal/apache-tomcat9.0.8/webapps/<span class="built_in">test</span> -v /zzyyuse/mydockerfile/tomcat9/tomcat9logs/:/usrlocal/apache-tomcat-9.0.8/logs -privileged=<span class="literal">true</span> zzyytomcat9</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210601173620972.png" alt="image-20210601173620972"></p>
<ul>
<li>-v 参数设置两个数据卷，一个用于存放发布项目，一个用于存放日志记录。</li>
<li><code>-privileged=true</code> 是 Docker 挂载主机目录 Docker 访问出现 <code>cannot open directory : Permission denied</code> 时的解决办法。</li>
</ul>
</li>
<li><p>验证：</p>
<p><img src="/2021/05/17/docker-base/image-20210602102100326.png" alt="image-20210602102100326"></p>
</li>
<li><p>发布 web 服务 test：</p>
<ul>
<li><p>在主机数据卷对应的目录 <code>/zzyyuse/mydockerfile/tomcat9/test</code> 目录下，新建 WEB-INF 目录，并添加 web.xml 文件。然后编写一个 a.jsp 文件作为测试：</p>
<p><img src="/2021/05/17/docker-base/image-20210602102911917.png" alt="image-20210602102911917"></p>
</li>
<li><p>web.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1 .0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmIns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XML Schema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmIns</span>=<span class="string">&quot;http://java sun.com/xm/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaL</span> <span class="attr">ocation</span>=<span class="string">&quot;http://java. sun.com/xml/ns/javaee htp:/:/java. sun.com/xml/ns/javaee/web-app_ 2_ _5.xsd&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">&quot;WebApp_ ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>test<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>a.jsp：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC“<span class="comment">//W3C//DTD HTML 4.01 Transitional//EN&quot; http://www.w3.org/TR/html4/loose.dtd&quot;&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta http-equiv=<span class="string">&quot;Content-Type&quot;</span> content=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;Insert title here &lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    	---------------welcome---------------</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;%=<span class="string">&quot;i am in docker tomcat self &quot;</span>%&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;% System.out.printIn(<span class="string">&quot;==========docker tomcat self&quot;</span>);%&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/htmI&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>docker restart 命令重新启动 tomcat，然后网页访问 <code>localhost:9080/test/a.jsp</code>，即可查看到 a.jsp 网页的内容。在主机目录下修改 a.jsp 的内容时，会同步到 tomcat 中。</p>
</li>
<li><p>主机上查看日志：</p>
<p><img src="/2021/05/17/docker-base/image-20210602112906898.png" alt="image-20210602112906898"></p>
</li>
</ul>
</li>
</ul>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p><img src="/2021/05/17/docker-base/image-20210602112943914.png" alt="image-20210602112943914"></p>
<h2 id="Docker-常用安装"><a href="#Docker-常用安装" class="headerlink" title="Docker 常用安装"></a>Docker 常用安装</h2><h3 id="总体步骤"><a href="#总体步骤" class="headerlink" title="总体步骤"></a>总体步骤</h3><ul>
<li>搜索镜像</li>
<li>拉取镜像</li>
<li>查看镜像</li>
<li>启动镜像</li>
<li>停止镜像</li>
<li>移除镜像</li>
</ul>
<h3 id="安装-mysql"><a href="#安装-mysql" class="headerlink" title="安装 mysql"></a>安装 mysql</h3><ul>
<li><p>docker hub 上查找 mysql 镜像：</p>
<p><img src="/2021/05/17/docker-base/image-20210602113910658.png" alt="image-20210602113910658"></p>
</li>
<li><p>从 docker hub (阿里云加速器) 拉取 mysql 镜像到本地，标签为 5.6：</p>
<p><img src="/2021/05/17/docker-base/image-20210602114009574.png" alt="image-20210602114009574"></p>
</li>
<li><p>使用 mysql:5.6 镜像创建容器 (也叫运行镜像)：</p>
<p><img src="/2021/05/17/docker-base/image-20210602114309822.png" alt="image-20210602114309822"></p>
<ul>
<li><p>命令说明：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 12345:3306 --name mysql </span><br><span class="line">-v /zzyyuse/mysql/conf:/etc/mysql/conf.d </span><br><span class="line">-v /zzyyuse/mysql/logs:/logs </span><br><span class="line">-v /zzyyuse/mysql/data:/var/lib/mysql </span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.6</span><br><span class="line">----------------------------------------------</span><br><span class="line">命令说明:</span><br><span class="line">-p 12345:3306: 将主机的12345端口映射到docker容器的3306端口</span><br><span class="line">-name mysql: 运行服务名字</span><br><span class="line">-v /zzyyuse/mysql/conf:/etc/mysql/conf.d: 将主机/zzyyuse/mysq|目录下的conf/my.cnf挂载到容器的/etc/mysql/conf.d</span><br><span class="line">-v /zzyyuse/mysql/logs:/logs: 将主机/zzyyuse/mysql目录下的logs目录挂载到容器的/logs</span><br><span class="line">-v /zzyyuse/mysql/data:/var/lib/mysql: 将主机/zzyyuse/mysql目录下的data目录挂载到容器的/var/lib/mysql</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456: 初始化root用户的密码</span><br><span class="line">-d mysql:5.6: 后台程序运行mysql5.6 </span><br><span class="line">----------------------------------------------</span><br><span class="line">docker exec -it mysql运行成功后的容器ID /bin/bash</span><br><span class="line">----------------------------------------------</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>将 mysql 数据备份测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">exec</span> mysql运行成功后的容器ID sh -c <span class="string">&#x27;exec mysqldump --all-databases -uroot -p&quot;123456&quot;&#x27;</span> &gt;/zzyyuse/all-database.sql</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210602115827004.png" alt="image-20210602115827004"></p>
</li>
</ul>
<h3 id="安装-redis"><a href="#安装-redis" class="headerlink" title="安装 redis"></a>安装 redis</h3><ul>
<li><p>从 docker hub 上 (阿里云加速器) 拉取 redis 镜像到本地，标签为 3.2：</p>
<p><img src="/2021/05/17/docker-base/image-20210602132253349.png" alt="image-20210602132253349"></p>
</li>
<li><p>使用 redis:3.2 镜像创建容器 (也叫运行镜像)：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker run -p 6379:6379 -v /zzyyuse/myredis/conf/redis.conf:/usr/<span class="built_in">local</span>/etc/redis/redis.conf -v /zzyyuse/myredis/data:/data -d redis:3.2 redis-server /usr/<span class="built_in">local</span>/etc/redis/redis.conf --appendonly yes</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>命令中的 redis.conf 是路径，不是文件。</p>
</blockquote>
</li>
<li><p>在主机 <code>/zzyyuse/myredis/conf/redis.conf</code> 目录下新建 redis 配置文件 redis.conf，并添加如下内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /zzyyuse/myredis/conf/redis.conf/redis.conf</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Redis configuration file example.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that <span class="keyword">in</span> order to <span class="built_in">read</span> the configuration file, Redis must be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> started with the file path as first argument:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./redis-server /path/to/redis.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note on units: when memory size is needed, it is possible to specify</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it <span class="keyword">in</span> the usual form of 1k 5GB 4M and so forth:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> units are <span class="keyword">case</span> insensitive so 1GB 1Gb 1gB are all the same.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# INCLUDES ###################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Include one or more other config files here.  This is useful <span class="keyword">if</span> you</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> have a standard template that goes to all Redis servers but also need</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to customize a few per-server settings.  Include files can include</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> other files, so use this wisely.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Notice option <span class="string">&quot;include&quot;</span> won<span class="string">&#x27;t be rewritten by command &quot;CONFIG REWRITE&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> from admin or Redis Sentinel. Since Redis always uses the last processed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> line as value of a configuration directive, you<span class="string">&#x27;d better put includes</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> at the beginning of this file to avoid overwriting config change at runtime.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If instead you are interested <span class="keyword">in</span> using includes to override configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> options, it is better to use include as the last line.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> include /path/to/local.conf</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> include /path/to/other.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# MODULES #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Load modules at startup. If the server is not able to load modules</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it will abort. It is possible to use multiple loadmodule directives.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> loadmodule /path/to/my_module.so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> loadmodule /path/to/other_module.so</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# NETWORK #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, <span class="keyword">if</span> no <span class="string">&quot;bind&quot;</span> configuration directive is specified, Redis listens</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> connections from all the network interfaces available on the server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible to listen to just one or multiple selected interfaces using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the <span class="string">&quot;bind&quot;</span> configuration directive, followed by one or more IP addresses.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Examples:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 192.168.1.100 10.0.0.1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 127.0.0.1 ::1</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ~~~ WARNING ~~~ If the computer running Redis is directly exposed to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> internet, binding to all the interfaces is dangerous and will expose the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instance to everybody on the internet. So by default we uncomment the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> following <span class="built_in">bind</span> directive, that will force Redis to listen only into</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the IPv4 loopback interface address (this means Redis will be able to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> accept connections only from clients running into the same computer it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is running).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IF YOU ARE SURE YOU WANT YOUR INSTANCE TO LISTEN TO ALL THE INTERFACES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> JUST COMMENT THE FOLLOWING LINE.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">bind</span> 127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Protected mode is a layer of security protection, <span class="keyword">in</span> order to avoid that</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis instances left open on the internet are accessed and exploited.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When protected mode is on and <span class="keyword">if</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) The server is not binding explicitly to a <span class="built_in">set</span> of addresses using the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="string">&quot;bind&quot;</span> directive.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) No password is configured.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The server only accepts connections from clients connecting from the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IPv4 and IPv6 loopback addresses 127.0.0.1 and ::1, and from Unix domain</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sockets.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default protected mode is enabled. You should <span class="built_in">disable</span> it only <span class="keyword">if</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you are sure you want clients from other hosts to connect to Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> even <span class="keyword">if</span> no authentication is configured, nor a specific <span class="built_in">set</span> of interfaces</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are explicitly listed using the <span class="string">&quot;bind&quot;</span> directive.</span></span><br><span class="line">protected-mode yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Accept connections on the specified port, default is 6379 (IANA <span class="comment">#815344).</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If port 0 is specified Redis will not listen on a TCP socket.</span></span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP listen() backlog.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In high requests-per-second environments you need an high backlog <span class="keyword">in</span> order</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to avoid slow clients connections issues. Note that the Linux kernel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make sure to raise both the value of somaxconn and tcp_max_syn_backlog</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to get the desired effect.</span></span><br><span class="line">tcp-backlog 511</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Unix socket.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the path <span class="keyword">for</span> the Unix socket that will be used to listen <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> incoming connections. There is no default, so Redis will not listen</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on a unix socket when not specified.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> unixsocket /tmp/redis.sock</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> unixsocketperm 700</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Close the connection after a client is idle <span class="keyword">for</span> N seconds (0 to <span class="built_in">disable</span>)</span></span><br><span class="line">timeout 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> TCP keepalive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If non-zero, use SO_KEEPALIVE to send TCP ACKs to clients <span class="keyword">in</span> absence</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of communication. This is useful <span class="keyword">for</span> two reasons:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) Detect dead peers.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Take the connection alive from the point of view of network</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    equipment <span class="keyword">in</span> the middle.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> On Linux, the specified value (<span class="keyword">in</span> seconds) is the period used to send ACKs.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that to close the connection the double of the time is needed.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> On other kernels the period depends on the kernel configuration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A reasonable value <span class="keyword">for</span> this option is 300 seconds, <span class="built_in">which</span> is the new</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis default starting with Redis 3.2.1.</span></span><br><span class="line">tcp-keepalive 300</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ TLS/SSL #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, TLS/SSL is disabled. To <span class="built_in">enable</span> it, the <span class="string">&quot;tls-port&quot;</span> configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directive can be used to define TLS-listening ports. To <span class="built_in">enable</span> TLS on the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default port, use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> port 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-port 6379</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure a X.509 certificate and private key to use <span class="keyword">for</span> authenticating the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server to connected clients, masters or cluster peers.  These files should be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PEM formatted.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-cert-file redis.crt </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-key-file redis.key</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure a DH parameters file to <span class="built_in">enable</span> Diffie-Hellman (DH) key exchange:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-dh-params-file redis.dh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure a CA certificate(s) bundle or directory to authenticate TLS/SSL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> clients and peers.  Redis requires an explicit configuration of at least one</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of these, and will not implicitly use the system wide configuration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-ca-cert-file ca.crt</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-ca-cert-dir /etc/ssl/certs</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, clients (including replica servers) on a TLS port are required</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to authenticate using valid client side certificates.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If <span class="string">&quot;no&quot;</span> is specified, client certificates are not required and not accepted.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If <span class="string">&quot;optional&quot;</span> is specified, client certificates are accepted and must be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> valid <span class="keyword">if</span> provided, but are not required.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-auth-clients no</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-auth-clients optional</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, a Redis replica does not attempt to establish a TLS connection</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with its master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use the following directive to <span class="built_in">enable</span> TLS on replication links.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-replication yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, the Redis Cluster bus uses a plain TCP connection. To <span class="built_in">enable</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> TLS <span class="keyword">for</span> the bus protocol, use the following directive:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-cluster yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Explicitly specify TLS versions to support. Allowed values are <span class="keyword">case</span> insensitive</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and include <span class="string">&quot;TLSv1&quot;</span>, <span class="string">&quot;TLSv1.1&quot;</span>, <span class="string">&quot;TLSv1.2&quot;</span>, <span class="string">&quot;TLSv1.3&quot;</span> (OpenSSL &gt;= 1.1.1) or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> any combination. To <span class="built_in">enable</span> only TLSv1.2 and TLSv1.3, use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-protocols <span class="string">&quot;TLSv1.2 TLSv1.3&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure allowed ciphers.  See the ciphers(1ssl) manpage <span class="keyword">for</span> more information</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> about the syntax of this string.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: this configuration applies only to &lt;= TLSv1.2.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-ciphers DEFAULT:!MEDIUM</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Configure allowed TLSv1.3 ciphersuites.  See the ciphers(1ssl) manpage <span class="keyword">for</span> more</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> information about the syntax of this string, and specifically <span class="keyword">for</span> TLSv1.3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ciphersuites.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-ciphersuites TLS_CHACHA20_POLY1305_SHA256</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When choosing a cipher, use the server<span class="string">&#x27;s preference instead of the client</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> preference. By default, the server follows the client<span class="string">&#x27;s preference.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-prefer-server-ciphers yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, TLS session caching is enabled to allow faster and less expensive</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> reconnections by clients that support it. Use the following directive to <span class="built_in">disable</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> caching.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-session-caching no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change the default number of TLS sessions cached. A zero value sets the cache</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to unlimited size. The default size is 20480.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-session-cache-size 5000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change the default timeout of cached TLS sessions. The default timeout is 300</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tls-session-cache-timeout 60</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ GENERAL #####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis does not run as a daemon. Use <span class="string">&#x27;yes&#x27;</span> <span class="keyword">if</span> you need it.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that Redis will write a pid file <span class="keyword">in</span> /var/run/redis.pid when daemonized.</span></span><br><span class="line">daemonize no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you run Redis from upstart or systemd, Redis can interact with your</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> supervision tree. Options:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised no      - no supervision interaction</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised upstart - signal upstart by putting Redis into SIGSTOP mode</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised systemd - signal systemd by writing READY=1 to <span class="variable">$NOTIFY_SOCKET</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   supervised auto    - detect upstart or systemd method based on</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                        UPSTART_JOB or NOTIFY_SOCKET environment variables</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: these supervision methods only signal <span class="string">&quot;process is ready.&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       They <span class="keyword">do</span> not <span class="built_in">enable</span> continuous liveness pings back to your supervisor.</span></span><br><span class="line">supervised no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If a pid file is specified, Redis writes it <span class="built_in">where</span> specified at startup</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and removes it at <span class="built_in">exit</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When the server runs non daemonized, no pid file is created <span class="keyword">if</span> none is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> specified <span class="keyword">in</span> the configuration. When the server is daemonized, the pid file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is used even <span class="keyword">if</span> not specified, defaulting to <span class="string">&quot;/var/run/redis.pid&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Creating a pid file is best effort: <span class="keyword">if</span> Redis is not able to create it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nothing bad happens, the server will start and run normally.</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the server verbosity level.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This can be one of:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> debug (a lot of information, useful <span class="keyword">for</span> development/testing)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> notice (moderately verbose, what you want <span class="keyword">in</span> production probably)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the <span class="built_in">log</span> file name. Also the empty string can be used to force</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis to <span class="built_in">log</span> on the standard output. Note that <span class="keyword">if</span> you use standard</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> output <span class="keyword">for</span> logging but daemonize, logs will be sent to /dev/null</span></span><br><span class="line">logfile &quot;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">enable</span> logging to the system logger, just <span class="built_in">set</span> <span class="string">&#x27;syslog-enabled&#x27;</span> to yes,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and optionally update the other syslog parameters to suit your needs.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> syslog-enabled no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the syslog identity.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> syslog-ident redis</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> syslog-facility local0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the number of databases. The default database is DB 0, you can select</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a different one on a per-connection basis using SELECT &lt;dbid&gt; <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dbid is a number between 0 and <span class="string">&#x27;databases&#x27;</span>-1</span></span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis shows an ASCII art logo only when started to <span class="built_in">log</span> to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> standard output and <span class="keyword">if</span> the standard output is a TTY. Basically this means</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that normally a logo is displayed only <span class="keyword">in</span> interactive sessions.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However it is possible to force the pre-4.0 behavior and always show a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ASCII art logo <span class="keyword">in</span> startup logs by setting the following option to yes.</span></span><br><span class="line">always-show-logo yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### SNAPSHOTTING  ################################</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Save the DB on disk:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   Will save the DB <span class="keyword">if</span> both the given number of seconds and the given</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   number of write operations against the DB occurred.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   after 900 sec (15 min) <span class="keyword">if</span> at least 1 key changed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   after 300 sec (5 min) <span class="keyword">if</span> at least 10 keys changed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   after 60 sec <span class="keyword">if</span> at least 10000 keys changed</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   Note: you can <span class="built_in">disable</span> saving completely by commenting out all <span class="string">&quot;save&quot;</span> lines.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   points by adding a save directive with a single empty string argument</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   like <span class="keyword">in</span> the following example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   save <span class="string">&quot;&quot;</span></span></span><br><span class="line"></span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis will stop accepting writes <span class="keyword">if</span> RDB snapshots are enabled</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (at least one save point) and the latest background save failed.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This will make the user aware (<span class="keyword">in</span> a hard way) that data is not persisting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on disk properly, otherwise chances are that no one will notice and some</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disaster will happen.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the background saving process will start working again Redis will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> automatically allow writes again.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However <span class="keyword">if</span> you have setup your proper monitoring of the Redis server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and persistence, you may want to <span class="built_in">disable</span> this feature so that Redis will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">continue</span> to work as usual even <span class="keyword">if</span> there are problems with disk,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> permissions, and so forth.</span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Compress string objects using LZF when dump .rdb databases?</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For default that<span class="string">&#x27;s set to &#x27;</span>yes<span class="string">&#x27; as it&#x27;</span>s almost always a win.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want to save some CPU <span class="keyword">in</span> the saving child <span class="built_in">set</span> it to <span class="string">&#x27;no&#x27;</span> but</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the dataset will likely be bigger <span class="keyword">if</span> you have compressible values or keys.</span></span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Since version 5 of RDB a CRC64 checksum is placed at the end of the file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This makes the format more resistant to corruption but there is a performance</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hit to pay (around 10%) when saving and loading RDB files, so you can <span class="built_in">disable</span> it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> maximum performances.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RDB files created with checksum disabled have a checksum of zero that will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tell the loading code to skip the check.</span></span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The filename <span class="built_in">where</span> to dump the DB</span></span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Remove RDB files used by replication <span class="keyword">in</span> instances without persistence</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> enabled. By default this option is disabled, however there are environments</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">where</span> <span class="keyword">for</span> regulations or other security concerns, RDB files persisted on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disk by masters <span class="keyword">in</span> order to feed replicas, or stored on disk by replicas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to load them <span class="keyword">for</span> the initial synchronization, should be deleted</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ASAP. Note that this option ONLY WORKS <span class="keyword">in</span> instances that have both AOF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and RDB persistence disabled, otherwise is completely ignored.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> An alternative (and sometimes better) way to obtain the same effect is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to use diskless replication on both master and replicas instances. However</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the <span class="keyword">case</span> of replicas, diskless is not always an option.</span></span><br><span class="line">rdb-del-sync-files no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The working directory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The DB will be written inside this directory, with the filename specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> above using the <span class="string">&#x27;dbfilename&#x27;</span> configuration directive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Append Only File will also be created inside this directory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that you must specify a directory here, not a file name.</span></span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################ REPLICATION #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Master-Replica replication. Use replicaof to make a Redis instance a copy of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> another Redis server. A few things to understand ASAP about Redis replication.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   +------------------+      +---------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   |      Master      | ---&gt; |    Replica    |</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   | (receive writes) |      |  (exact copy) |</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   +------------------+      +---------------+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) Redis replication is asynchronous, but you can configure a master to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    stop accepting writes <span class="keyword">if</span> it appears to be not connected with at least</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    a given number of replicas.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Redis replicas are able to perform a partial resynchronization with the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    master <span class="keyword">if</span> the replication link is lost <span class="keyword">for</span> a relatively small amount of</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    time. You may want to configure the replication backlog size (see the next</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    sections of this file) with a sensible value depending on your needs.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) Replication is automatic and does not need user intervention. After a</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    network partition replicas automatically try to reconnect to masters</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    and resynchronize with them.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the master is password protected (using the <span class="string">&quot;requirepass&quot;</span> configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directive below) it is possible to tell the replica to authenticate before</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> starting the replication synchronization process, otherwise the master will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> refuse the replica request.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> masterauth &lt;master-password&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However this is not enough <span class="keyword">if</span> you are using Redis ACLs (<span class="keyword">for</span> Redis version</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6 or greater), and the default user is not capable of running the PSYNC</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> and/or other commands needed <span class="keyword">for</span> replication. In this <span class="keyword">case</span> it<span class="string">&#x27;s</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> better to configure a special user to use with replication, and specify the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> masteruser configuration as such:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> masteruser &lt;username&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When masteruser is specified, the replica will authenticate against its</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master using the new AUTH form: AUTH &lt;username&gt; &lt;password&gt;.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When a replica loses its connection with the master, or when the replication</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is still <span class="keyword">in</span> progress, the replica can act <span class="keyword">in</span> two different ways:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) <span class="keyword">if</span> replica-serve-stale-data is <span class="built_in">set</span> to <span class="string">&#x27;yes&#x27;</span> (the default) the replica will</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    still reply to client requests, possibly with out of date data, or the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    data <span class="built_in">set</span> may just be empty <span class="keyword">if</span> this is the first synchronization.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) <span class="keyword">if</span> replica-serve-stale-data is <span class="built_in">set</span> to <span class="string">&#x27;no&#x27;</span> the replica will reply with</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    an error <span class="string">&quot;SYNC with master in progress&quot;</span> to all the kind of commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    but to INFO, replicaOF, AUTH, PING, SHUTDOWN, REPLCONF, ROLE, CONFIG,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    SUBSCRIBE, UNSUBSCRIBE, PSUBSCRIBE, PUNSUBSCRIBE, PUBLISH, PUBSUB,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    COMMAND, POST, HOST: and LATENCY.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can configure a replica instance to accept writes or not. Writing against</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a replica instance may be useful to store some ephemeral data (because data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> written on a replica will be easily deleted after resync with the master) but</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> may also cause problems <span class="keyword">if</span> clients are writing to it because of a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> misconfiguration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Since Redis 2.6 by default replicas are read-only.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: <span class="built_in">read</span> only replicas are not designed to be exposed to untrusted clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on the internet. It<span class="string">&#x27;s just a protection layer against misuse of the instance.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Still a <span class="built_in">read</span> only replica exports by default all the administrative commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> such as CONFIG, DEBUG, and so forth. To a limited extent you can improve</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> security of <span class="built_in">read</span> only replicas using <span class="string">&#x27;rename-command&#x27;</span> to shadow all the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> administrative / dangerous commands.</span></span><br><span class="line">replica-read-only yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication SYNC strategy: disk or socket.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> New replicas and reconnecting replicas that are not able to <span class="built_in">continue</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replication process just receiving differences, need to <span class="keyword">do</span> what is called a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;full synchronization&quot;</span>. An RDB file is transmitted from the master to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The transmission can happen <span class="keyword">in</span> two different ways:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) Disk-backed: The Redis master creates a new process that writes the RDB</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 file on disk. Later the file is transferred by the parent</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 process to the replicas incrementally.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Diskless: The Redis master creates a new process that directly writes the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">              RDB file to replica sockets, without touching the disk at all.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> With disk-backed replication, <span class="keyword">while</span> the RDB file is generated, more replicas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> can be queued and served with the RDB file as soon as the current child</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> producing the RDB file finishes its work. With diskless replication instead</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> once the transfer starts, new replicas arriving will be queued and a new</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> transfer will start when the current one terminates.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When diskless replication is used, the master waits a configurable amount of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> time (<span class="keyword">in</span> seconds) before starting the transfer <span class="keyword">in</span> the hope that multiple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas will arrive and the transfer can be parallelized.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> With slow disks and fast (large bandwidth) networks, diskless replication</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> works better.</span></span><br><span class="line">repl-diskless-sync no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When diskless replication is enabled, it is possible to configure the delay</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the server waits <span class="keyword">in</span> order to spawn the child that transfers the RDB via socket</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the replicas.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is important since once the transfer starts, it is not possible to serve</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> new replicas arriving, that will be queued <span class="keyword">for</span> the next RDB transfer, so the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server waits a delay <span class="keyword">in</span> order to <span class="built_in">let</span> more replicas arrive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The delay is specified <span class="keyword">in</span> seconds, and by default is 5 seconds. To <span class="built_in">disable</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it entirely just <span class="built_in">set</span> it to 0 seconds and the transfer will start ASAP.</span></span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: RDB diskless load is experimental. Since <span class="keyword">in</span> this setup the replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> does not immediately store an RDB on disk, it may cause data loss during</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> failovers. RDB diskless load + Redis modules not handling I/O reads may also</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cause Redis to abort <span class="keyword">in</span> <span class="keyword">case</span> of I/O errors during the initial synchronization</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> stage with the master. Use only <span class="keyword">if</span> your <span class="keyword">do</span> what you are doing.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -----------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Replica can load the RDB it reads from the replication link directly from the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> socket, or store the RDB to a file and <span class="built_in">read</span> that file after it was completely</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> recived from the master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In many cases the disk is slower than the network, and storing and loading</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the RDB file may increase replication time (and even increase the master<span class="string">&#x27;s</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Copy on Write memory and salve buffers).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However, parsing the RDB file directly from the socket may mean that we have</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to flush the contents of the current database before the full rdb was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> received. For this reason we have the following options:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;disabled&quot;</span>    - Don<span class="string">&#x27;t use diskless load (store the rdb file to the disk first)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;on-empty-db&quot;</span> - Use diskless load only when it is completely safe.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;swapdb&quot;</span>      - Keep a copy of the current db contents <span class="keyword">in</span> RAM <span class="keyword">while</span> parsing</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 the data directly from the socket. note that this requires</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                 sufficient memory, <span class="keyword">if</span> you don<span class="string">&#x27;t have it, you risk an OOM kill.</span></span></span><br><span class="line">repl-diskless-load disabled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Replicas send PINGs to server <span class="keyword">in</span> a predefined interval. It<span class="string">&#x27;s possible to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> change this interval with the repl_ping_replica_period option. The default</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> value is 10 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> repl-ping-replica-period 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following option sets the replication timeout <span class="keyword">for</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) Bulk transfer I/O during SYNC, from the point of view of replica.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Master timeout from the point of view of replicas (data, pings).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) Replica timeout from the point of view of masters (REPLCONF ACK pings).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is important to make sure that this value is greater than the value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> specified <span class="keyword">for</span> repl-ping-replica-period otherwise a timeout will be detected</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> every time there is low traffic between the master and the replica.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> repl-timeout 60</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Disable TCP_NODELAY on the replica socket after SYNC?</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you select <span class="string">&quot;yes&quot;</span> Redis will use a smaller number of TCP packets and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> less bandwidth to send data to replicas. But this can add a delay <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the data to appear on the replica side, up to 40 milliseconds with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Linux kernels using a default configuration.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you select <span class="string">&quot;no&quot;</span> the delay <span class="keyword">for</span> data to appear on the replica side will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be reduced but more bandwidth will be used <span class="keyword">for</span> replication.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default we optimize <span class="keyword">for</span> low latency, but <span class="keyword">in</span> very high traffic conditions</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or when the master and replicas are many hops away, turning this to <span class="string">&quot;yes&quot;</span> may</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be a good idea.</span></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the replication backlog size. The backlog is a buffer that accumulates</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica data when replicas are disconnected <span class="keyword">for</span> some time, so that when a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica wants to reconnect again, often a full resync is not needed, but a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> partial resync is enough, just passing the portion of data the replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> missed <span class="keyword">while</span> disconnected.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The bigger the replication backlog, the longer the time the replica can be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disconnected and later be able to perform a partial resynchronization.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The backlog is only allocated once there is at least a replica connected.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> repl-backlog-size 1mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> After a master has no longer connected replicas <span class="keyword">for</span> some time, the backlog</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will be freed. The following option configures the amount of seconds that</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> need to elapse, starting from the time the last replica disconnected, <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the backlog buffer to be freed.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that replicas never free the backlog <span class="keyword">for</span> timeout, since they may be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> promoted to masters later, and should be able to correctly <span class="string">&quot;partially</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> resynchronize<span class="string">&quot; with the replicas: hence they should always accumulate backlog.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A value of 0 means to never release the backlog.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> repl-backlog-ttl 3600</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The replica priority is an <span class="built_in">integer</span> number published by Redis <span class="keyword">in</span> the INFO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> output. It is used by Redis Sentinel <span class="keyword">in</span> order to select a replica to promote</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> into a master <span class="keyword">if</span> the master is no longer working correctly.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A replica with a low priority number is considered better <span class="keyword">for</span> promotion, so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> instance <span class="keyword">if</span> there are three replicas with priority 10, 100, 25 Sentinel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will pick the one with priority 10, that is the lowest.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However a special priority of 0 marks the replica as not able to perform the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> role of master, so a replica with priority of 0 will never be selected by</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis Sentinel <span class="keyword">for</span> promotion.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default the priority is 100.</span></span><br><span class="line">replica-priority 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible <span class="keyword">for</span> a master to stop accepting writes <span class="keyword">if</span> there are less than</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> N replicas connected, having a lag less or equal than M seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The N replicas need to be <span class="keyword">in</span> <span class="string">&quot;online&quot;</span> state.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The lag <span class="keyword">in</span> seconds, that must be &lt;= the specified value, is calculated from</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the last ping received from the replica, that is usually sent every second.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option does not GUARANTEE that N replicas will accept the write, but</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will <span class="built_in">limit</span> the window of exposure <span class="keyword">for</span> lost writes <span class="keyword">in</span> <span class="keyword">case</span> not enough replicas</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are available, to the specified number of seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For example to require at least 3 replicas with a lag &lt;= 10 seconds use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> min-replicas-to-write 3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> min-replicas-max-lag 10</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Setting one or the other to 0 disables the feature.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default min-replicas-to-write is <span class="built_in">set</span> to 0 (feature disabled) and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> min-replicas-max-lag is <span class="built_in">set</span> to 10.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> A Redis master is able to list the address and port of the attached</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas <span class="keyword">in</span> different ways. For example the <span class="string">&quot;INFO replication&quot;</span> section</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> offers this information, <span class="built_in">which</span> is used, among other tools, by</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis Sentinel <span class="keyword">in</span> order to discover replica instances.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Another place <span class="built_in">where</span> this info is available is <span class="keyword">in</span> the output of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;ROLE&quot;</span> <span class="built_in">command</span> of a master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The listed IP and address normally reported by a replica is obtained</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the following way:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   IP: The address is auto detected by checking the peer address</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   of the socket used by the replica to connect with the master.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   Port: The port is communicated by the replica during the replication</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   handshake, and is normally the port that the replica is using to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   listen <span class="keyword">for</span> connections.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However when port forwarding or Network Address Translation (NAT) is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used, the replica may be actually reachable via different IP and port</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pairs. The following two options can be used by a replica <span class="keyword">in</span> order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> report to its master a specific <span class="built_in">set</span> of IP and port, so that both INFO</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and ROLE will report those values.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> There is no need to use both the options <span class="keyword">if</span> you need to override just</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the port or the IP address.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica-announce-ip 5.5.5.5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica-announce-port 1234</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################## KEYS TRACKING #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis implements server assisted support <span class="keyword">for</span> client side caching of values.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is implemented using an invalidation table that remembers, using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 16 millions of slots, what clients may have certain subsets of keys. In turn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this is used <span class="keyword">in</span> order to send invalidation messages to clients. Please</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to understand more about the feature check this page:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   https://redis.io/topics/client-side-caching</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When tracking is enabled <span class="keyword">for</span> a client, all the <span class="built_in">read</span> only queries are assumed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to be cached: this will force Redis to store information <span class="keyword">in</span> the invalidation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> table. When keys are modified, such information is flushed away, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> invalidation messages are sent to the clients. However <span class="keyword">if</span> the workload is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> heavily dominated by reads, Redis could use more and more memory <span class="keyword">in</span> order</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to track the keys fetched by many clients.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For this reason it is possible to configure a maximum fill value <span class="keyword">for</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> invalidation table. By default it is <span class="built_in">set</span> to 1M of keys, and once this <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is reached, Redis will start to evict keys <span class="keyword">in</span> the invalidation table</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> even <span class="keyword">if</span> they were not modified, just to reclaim memory: this will <span class="keyword">in</span> turn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> force the clients to invalidate the cached values. Basically the table</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maximum size is a trade off between the memory you want to spend server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> side to track information about who cached what, and the ability of clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to retain cached objects <span class="keyword">in</span> memory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you <span class="built_in">set</span> the value to 0, it means there are no limits, and Redis will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> retain as many keys as needed <span class="keyword">in</span> the invalidation table.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In the <span class="string">&quot;stats&quot;</span> INFO section, you can find information about the number of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> keys <span class="keyword">in</span> the invalidation table at every given moment.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: when key tracking is used <span class="keyword">in</span> broadcasting mode, no memory is used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the server side so this setting is useless.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tracking-table-max-keys 1000000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# SECURITY ###################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Warning: since Redis is pretty fast an outside user can try up to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1 million passwords per second against a modern box. This means that you</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should use very strong passwords, otherwise they will be very easy to <span class="built_in">break</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that because the password is really a shared secret between the client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and the server, and should not be memorized by any human, the password</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> can be easily a long string from /dev/urandom or whatever, so by using a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> long and unguessable password no brute force attack will be possible.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis ACL users are defined <span class="keyword">in</span> the following format:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   user &lt;username&gt; ... acl rules ...</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   user worker +@list +@connection ~<span class="built_in">jobs</span>:* on &gt;ffa9203c493aa99</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The special username <span class="string">&quot;default&quot;</span> is used <span class="keyword">for</span> new connections. If this user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> has the <span class="string">&quot;nopass&quot;</span> rule, <span class="keyword">then</span> new connections will be immediately authenticated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as the <span class="string">&quot;default&quot;</span> user without the need of any password provided via the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AUTH <span class="built_in">command</span>. Otherwise <span class="keyword">if</span> the <span class="string">&quot;default&quot;</span> user is not flagged with <span class="string">&quot;nopass&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the connections will start <span class="keyword">in</span> not authenticated state, and will require</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AUTH (or the HELLO <span class="built_in">command</span> AUTH option) <span class="keyword">in</span> order to be authenticated and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> start to work.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The ACL rules that describe what an user can <span class="keyword">do</span> are the following:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  on           Enable the user: it is possible to authenticate as this user.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  off          Disable the user: it<span class="string">&#x27;s no longer possible to authenticate</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">               with this user, however the already authenticated connections</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               will still work.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  +&lt;<span class="built_in">command</span>&gt;   Allow the execution of that <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  -&lt;<span class="built_in">command</span>&gt;   Disallow the execution of that <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  +@&lt;category&gt; Allow the execution of all the commands <span class="keyword">in</span> such category</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               with valid categories are like @admin, @<span class="built_in">set</span>, @sortedset, ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               and so forth, see the full list <span class="keyword">in</span> the server.c file <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">               the Redis <span class="built_in">command</span> table is described and defined.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               The special category @all means all the commands, but currently</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               present <span class="keyword">in</span> the server, and that will be loaded <span class="keyword">in</span> the future</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               via modules.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  +&lt;<span class="built_in">command</span>&gt;|subcommand    Allow a specific subcommand of an otherwise</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                           disabled <span class="built_in">command</span>. Note that this form is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                           allowed as negative like -DEBUG|SEGFAULT, but</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                           only additive starting with <span class="string">&quot;+&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  allcommands  Alias <span class="keyword">for</span> +@all. Note that it implies the ability to execute</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               all the future commands loaded via the modules system.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  nocommands   Alias <span class="keyword">for</span> -@all.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  ~&lt;pattern&gt;   Add a pattern of keys that can be mentioned as part of</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               commands. For instance ~* allows all the keys. The pattern</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               is a glob-style pattern like the one of KEYS.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               It is possible to specify multiple patterns.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  allkeys      Alias <span class="keyword">for</span> ~*</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  resetkeys    Flush the list of allowed keys patterns.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  &gt;&lt;password&gt;  Add this passowrd to the list of valid password <span class="keyword">for</span> the user.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               For example &gt;mypass will add <span class="string">&quot;mypass&quot;</span> to the list.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               This directive clears the <span class="string">&quot;nopass&quot;</span> flag (see later).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  &lt;&lt;<span class="string">password&gt;  Remove this password</span> from the list of valid passwords.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  nopass       All the <span class="built_in">set</span> passwords of the user are removed, and the user</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               is flagged as requiring no password: it means that every</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               password will work against this user. If this directive is</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               used <span class="keyword">for</span> the default user, every new connection will be</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               immediately authenticated with the default user without</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               any explicit AUTH <span class="built_in">command</span> required. Note that the <span class="string">&quot;resetpass&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">               directive will clear this condition.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  resetpass    Flush the list of allowed passwords. Moreover removes the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               <span class="string">&quot;nopass&quot;</span> status. After <span class="string">&quot;resetpass&quot;</span> the user has no associated</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               passwords and there is no way to authenticate without adding</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               some password (or setting it as <span class="string">&quot;nopass&quot;</span> later).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  reset        Performs the following actions: resetpass, resetkeys, off,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               -@all. The user returns to the same state it has immediately</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               after its creation.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL rules can be specified <span class="keyword">in</span> any order: <span class="keyword">for</span> instance you can start with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> passwords, <span class="keyword">then</span> flags, or key patterns. However note that the additive</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and subtractive rules will CHANGE MEANING depending on the ordering.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For instance see the following example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   user alice on +@all -DEBUG ~* &gt;somepassword</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This will allow <span class="string">&quot;alice&quot;</span> to use all the commands with the exception of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEBUG <span class="built_in">command</span>, since +@all added all the commands to the <span class="built_in">set</span> of the commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> alice can use, and later DEBUG was removed. However <span class="keyword">if</span> we invert the order</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of two ACL rules the result will be different:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   user alice on -DEBUG +@all ~* &gt;somepassword</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Now DEBUG was removed when alice had yet no commands <span class="keyword">in</span> the <span class="built_in">set</span> of allowed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commands, later all the commands are added, so the user will be able to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> execute everything.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Basically ACL rules are processed left-to-right.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information about ACL configuration please refer to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the Redis web site at https://redis.io/topics/acl</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL LOG</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The ACL Log tracks failed commands and authentication events associated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with ACLs. The ACL Log is useful to troubleshoot failed commands blocked </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by ACLs. The ACL Log is stored <span class="keyword">in</span> memory. You can reclaim memory with </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL LOG RESET. Define the maximum entry length of the ACL Log below.</span></span><br><span class="line">acllog-max-len 128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using an external ACL file</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Instead of configuring users here <span class="keyword">in</span> this file, it is possible to use</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a stand-alone file just listing users. The two methods cannot be mixed:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you configure users here and at the same time you activate the exteranl</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACL file, the server will refuse to start.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The format of the external ACL user file is exactly the same as the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> format that is used inside redis.conf to describe users.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> aclfile /etc/redis/users.acl</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMPORTANT NOTE: starting with Redis 6 <span class="string">&quot;requirepass&quot;</span> is just a compatiblity</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> layer on top of the new ACL system. The option effect will be just setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the password <span class="keyword">for</span> the default user. Clients will still authenticate using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AUTH &lt;password&gt; as usually, or more explicitly with AUTH default &lt;password&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> they follow the new protocol: both will work.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> requirepass foobared</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Command renaming (DEPRECATED).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: avoid using this option <span class="keyword">if</span> possible. Instead use ACLs to remove</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commands from the default user, and put them only <span class="keyword">in</span> some admin user you</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> create <span class="keyword">for</span> administrative purposes.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ------------------------------------------------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible to change the name of dangerous commands <span class="keyword">in</span> a shared</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> environment. For instance the CONFIG <span class="built_in">command</span> may be renamed into something</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> hard to guess so that it will still be available <span class="keyword">for</span> internal-use tools</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but not available <span class="keyword">for</span> general clients.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is also possible to completely <span class="built_in">kill</span> a <span class="built_in">command</span> by renaming it into</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> an empty string:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rename-command CONFIG <span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please note that changing the name of commands that are logged into the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AOF file or transmitted to replicas may cause problems.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################## CLIENTS ####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the max number of connected clients at the same time. By default</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this <span class="built_in">limit</span> is <span class="built_in">set</span> to 10000 clients, however <span class="keyword">if</span> the Redis server is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> able to configure the process file <span class="built_in">limit</span> to allow <span class="keyword">for</span> the specified <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the max number of allowed clients is <span class="built_in">set</span> to the current file <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> minus 32 (as Redis reserves a few file descriptors <span class="keyword">for</span> internal uses).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Once the <span class="built_in">limit</span> is reached Redis will close all the new connections sending</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> an error <span class="string">&#x27;max number of clients reached&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IMPORTANT: When Redis Cluster is used, the max number of connections is also</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> shared with the cluster bus: every node <span class="keyword">in</span> the cluster will use two</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> connections, one incoming and another outgoing. It is important to size the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">limit</span> accordingly <span class="keyword">in</span> <span class="keyword">case</span> of very large clusters.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maxclients 10000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################# MEMORY MANAGEMENT ################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set a memory usage <span class="built_in">limit</span> to the specified amount of bytes.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When the memory <span class="built_in">limit</span> is reached Redis will try to remove keys</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> according to the eviction policy selected (see maxmemory-policy).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If Redis can<span class="string">&#x27;t remove keys according to the policy, or if the policy is</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> to <span class="string">&#x27;noeviction&#x27;</span>, Redis will start to reply with errors to commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that would use more memory, like SET, LPUSH, and so on, and will <span class="built_in">continue</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to reply to read-only commands like GET.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option is usually useful when using Redis as an LRU or LFU cache, or to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> a hard memory <span class="built_in">limit</span> <span class="keyword">for</span> an instance (using the <span class="string">&#x27;noeviction&#x27;</span> policy).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARNING: If you have replicas attached to an instance with maxmemory on,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the size of the output buffers needed to feed the replicas are subtracted</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> from the used memory count, so that network problems / resyncs will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not trigger a loop <span class="built_in">where</span> keys are evicted, and <span class="keyword">in</span> turn the output</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> buffer of replicas is full with DELs of keys evicted triggering the deletion</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of more keys, and so forth until the database is completely emptied.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In short... <span class="keyword">if</span> you have replicas attached it is suggested that you <span class="built_in">set</span> a lower</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">limit</span> <span class="keyword">for</span> maxmemory so that there is some free RAM on the system <span class="keyword">for</span> replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> output buffers (but this is not needed <span class="keyword">if</span> the policy is <span class="string">&#x27;noeviction&#x27;</span>).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maxmemory &lt;bytes&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> MAXMEMORY POLICY: how Redis will select what to remove when maxmemory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is reached. You can select one from the following behaviors:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-lru -&gt; Evict using approximated LRU, only keys with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-lru -&gt; Evict any key using approximated LRU.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-lfu -&gt; Evict using approximated LFU, only keys with an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-lfu -&gt; Evict any key using approximated LFU.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-random -&gt; Remove a random key having an expire <span class="built_in">set</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> allkeys-random -&gt; Remove a random key, any key.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> noeviction -&gt; Don<span class="string">&#x27;t evict anything, just return an error on write operations.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LRU means Least Recently Used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LFU means Least Frequently Used</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Both LRU, LFU and volatile-ttl are implemented using approximated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> randomized algorithms.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: with any of the above policies, Redis will <span class="built_in">return</span> an error on write</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       operations, when there are no suitable keys <span class="keyword">for</span> eviction.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       At the date of writing these commands are: <span class="built_in">set</span> setnx setex append</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span></span><br><span class="line"><span class="meta">#</span><span class="bash">       getset mset msetnx <span class="built_in">exec</span> sort</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default is:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maxmemory-policy noeviction</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> LRU, LFU and minimal TTL algorithms are not precise algorithms but approximated</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> algorithms (<span class="keyword">in</span> order to save memory), so you can tune it <span class="keyword">for</span> speed or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> accuracy. For default Redis will check five keys and pick the one that was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used less recently, you can change the sample size using the following</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configuration directive.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default of 5 produces good enough results. 10 Approximates very closely</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="literal">true</span> LRU but costs more CPU. 3 is faster but not very accurate.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maxmemory-samples 5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Starting from Redis 5, by default a replica will ignore its maxmemory setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (unless it is promoted to master after a failover or manually). It means</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that the eviction of keys will be just handled by the master, sending the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEL commands to the replica as keys evict <span class="keyword">in</span> the master side.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This behavior ensures that masters and replicas stay consistent, and is usually</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> what you want, however <span class="keyword">if</span> your replica is writable, or you want the replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to have a different memory setting, and you are sure all the writes performed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the replica are idempotent, <span class="keyword">then</span> you may change this default (but be sure</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to understand what you are doing).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that since the replica by default does not evict, it may end using more</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> memory than the one <span class="built_in">set</span> via maxmemory (there are certain buffers that may</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be larger on the replica, or data structures may sometimes take more memory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and so forth). So make sure you monitor your replicas and make sure they</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> have enough memory to never hit a real out-of-memory condition before the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master hits the configured maxmemory setting.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica-ignore-maxmemory yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis reclaims expired keys <span class="keyword">in</span> two ways: upon access when those keys are</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> found to be expired, and also <span class="keyword">in</span> background, <span class="keyword">in</span> what is called the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;active expire key&quot;</span>. The key space is slowly and interactively scanned</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> looking <span class="keyword">for</span> expired keys to reclaim, so that it is possible to free memory</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of keys that are expired and will never be accessed again <span class="keyword">in</span> a short time.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default effort of the expire cycle will try to avoid having more than</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ten percent of expired keys still <span class="keyword">in</span> memory, and will try to avoid consuming</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> more than 25% of total memory and to add latency to the system. However</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it is possible to increase the expire <span class="string">&quot;effort&quot;</span> that is normally <span class="built_in">set</span> to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;1&quot;</span>, to a greater value, up to the value <span class="string">&quot;10&quot;</span>. At its maximum value the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> system will use more CPU, longer cycles (and technically may introduce</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> more latency), and will tollerate less already expired keys still present</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the system. It<span class="string">&#x27;s a tradeoff betweeen memory, CPU and latecy.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-expire-effort 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################ LAZY FREEING ####################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis has two primitives to delete keys. One is called DEL and is a blocking</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> deletion of the object. It means that the server stops processing new commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to reclaim all the memory associated with an object <span class="keyword">in</span> a synchronous</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> way. If the key deleted is associated with a small object, the time needed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to execute the DEL <span class="built_in">command</span> is very small and comparable to most other</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> O(1) or O(log_N) commands <span class="keyword">in</span> Redis. However <span class="keyword">if</span> the key is associated with an</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> aggregated value containing millions of elements, the server can block <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a long time (even seconds) <span class="keyword">in</span> order to complete the operation.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For the above reasons Redis also offers non blocking deletion primitives</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> such as UNLINK (non blocking DEL) and the ASYNC option of FLUSHALL and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> FLUSHDB commands, <span class="keyword">in</span> order to reclaim memory <span class="keyword">in</span> background. Those commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are executed <span class="keyword">in</span> constant time. Another thread will incrementally free the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> object <span class="keyword">in</span> the background as fast as possible.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DEL, UNLINK and ASYNC option of FLUSHALL and FLUSHDB are user-controlled.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It<span class="string">&#x27;s up to the design of the application to understand when it is a good</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> idea to use one or the other. However the Redis server sometimes has to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> delete keys or flush the whole database as a side effect of other operations.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specifically Redis deletes objects independently of a user call <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> following scenarios:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) On eviction, because of the maxmemory and maxmemory policy configurations,</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="keyword">in</span> order to make room <span class="keyword">for</span> new data, without going over the specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    memory <span class="built_in">limit</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Because of expire: when a key with an associated time to live (see the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    EXPIRE <span class="built_in">command</span>) must be deleted from memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) Because of a side effect of a <span class="built_in">command</span> that stores data on a key that may</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    already exist. For example the RENAME <span class="built_in">command</span> may delete the old key</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    content when it is replaced with another one. Similarly SUNIONSTORE</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    or SORT with STORE option may delete existing keys. The SET <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    itself removes any old content of the specified key <span class="keyword">in</span> order to replace</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    it with the specified string.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4) During replication, when a replica performs a full resynchronization with</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    its master, the content of the whole database is removed <span class="keyword">in</span> order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    load the RDB file just transferred.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In all the above cases the default is to delete objects <span class="keyword">in</span> a blocking way,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> like <span class="keyword">if</span> DEL was called. However you can configure each <span class="keyword">case</span> specifically</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to instead release memory <span class="keyword">in</span> a non-blocking way like <span class="keyword">if</span> UNLINK</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> was called, using the following configuration directives.</span></span><br><span class="line"></span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is also possible, <span class="keyword">for</span> the <span class="keyword">case</span> when to replace the user code DEL calls</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with UNLINK calls is not easy, to modify the default behavior of the DEL</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> to act exactly like UNLINK, using the following configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directive:</span></span><br><span class="line"></span><br><span class="line">lazyfree-lazy-user-del no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### THREADED I/O #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis is mostly single threaded, however there are certain threaded</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> operations such as UNLINK, slow I/O accesses and other things that are</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performed on side threads.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Now it is also possible to handle Redis clients socket reads and writes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> different I/O threads. Since especially writing is so slow, normally</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis users use pipelining <span class="keyword">in</span> order to speedup the Redis performances per</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> core, and spawn multiple instances <span class="keyword">in</span> order to scale more. Using I/O</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threads it is possible to easily speedup two <span class="built_in">times</span> Redis without resorting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to pipelining nor sharding of the instance.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default threading is disabled, we suggest enabling it only <span class="keyword">in</span> machines</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that have at least 4 or more cores, leaving at least one spare core.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using more than 8 threads is unlikely to <span class="built_in">help</span> much. We also recommend using</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threaded I/O only <span class="keyword">if</span> you actually have performance problems, with Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instances being able to use a quite big percentage of CPU time, otherwise</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> there is no point <span class="keyword">in</span> using this feature.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> So <span class="keyword">for</span> instance <span class="keyword">if</span> you have a four cores boxes, try to use 2 or 3 I/O</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threads, <span class="keyword">if</span> you have a 8 cores, try to use 6 threads. In order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">enable</span> I/O threads use the following configuration directive:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> io-threads 4</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Setting io-threads to 1 will just use the main thread as usually.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When I/O threads are enabled, we only use threads <span class="keyword">for</span> writes, that is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to thread the write(2) syscall and transfer the client buffers to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> socket. However it is also possible to <span class="built_in">enable</span> threading of reads and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> protocol parsing using the following configuration directive, by setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it to yes:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> io-threads-do-reads no</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Usually threading reads doesn<span class="string">&#x27;t help much.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE 1: This configuration directive cannot be changed at runtime via</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CONFIG SET. Aso this feature currently does not work when SSL is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> enabled.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE 2: If you want to <span class="built_in">test</span> the Redis speedup using redis-benchmark, make</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sure you also run the benchmark itself <span class="keyword">in</span> threaded mode, using the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --threads option to match the number of Redis theads, otherwise you<span class="string">&#x27;ll not</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be able to notice the improvements.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########################### KERNEL OOM CONTROL ##############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> On Linux, it is possible to hint the kernel OOM killer on what processes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should be killed first when out of memory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enabling this feature makes Redis actively control the oom_score_adj value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> all its processes, depending on their role. The default scores will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> attempt to have background child processes killed before all others, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replicas killed before masters.</span></span><br><span class="line"></span><br><span class="line">oom-score-adj no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When oom-score-adj is used, this directive controls the specific values used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> master, replica and background child processes. Values range -1000 to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1000 (higher means more likely to be killed).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Unprivileged processes (not root, and without CAP_SYS_RESOURCE capabilities)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> can freely increase their value, but not decrease it below its initial</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> settings.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Values are used relative to the initial value of oom_score_adj when the server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> starts. Because typically the initial value is 0, they will often match the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> absolute values.</span></span><br><span class="line"></span><br><span class="line">oom-score-adj-values 0 200 800</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################# APPEND ONLY MODE ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis asynchronously dumps the dataset on disk. This mode is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> good enough <span class="keyword">in</span> many applications, but an issue with the Redis process or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a power outage may result into a few minutes of writes lost (depending on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the configured save points).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Append Only File is an alternative persistence mode that provides</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> much better durability. For instance using the default data fsync policy</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (see later <span class="keyword">in</span> the config file) Redis can lose just one second of writes <span class="keyword">in</span> a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dramatic event like a server power outage, or a single write <span class="keyword">if</span> something</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wrong with the Redis process itself happens, but the operating system is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> still running correctly.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AOF and RDB persistence can be enabled at the same time without problems.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the AOF is enabled on startup Redis will load the AOF, that is the file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with the better durability guarantees.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please check http://redis.io/topics/persistence <span class="keyword">for</span> more information.</span></span><br><span class="line"></span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The name of the append only file (default: <span class="string">&quot;appendonly.aof&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The fsync() call tells the Operating System to actually write data on disk</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instead of waiting <span class="keyword">for</span> more data <span class="keyword">in</span> the output buffer. Some OS will really flush</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data on disk, some other OS will just try to <span class="keyword">do</span> it ASAP.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis supports three different modes:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> no: don<span class="string">&#x27;t fsync, just let the OS flush the data when it wants. Faster.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> always: fsync after every write to the append only <span class="built_in">log</span>. Slow, Safest.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> everysec: fsync only one time every second. Compromise.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default is <span class="string">&quot;everysec&quot;</span>, as that<span class="string">&#x27;s usually the right compromise between</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> speed and data safety. It<span class="string">&#x27;s up to you to understand if you can relax this to</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;no&quot;</span> that will <span class="built_in">let</span> the operating system flush the output buffer when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it wants, <span class="keyword">for</span> better performances (but <span class="keyword">if</span> you can live with the idea of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> some data loss consider the default persistence mode that<span class="string">&#x27;s snapshotting),</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or on the contrary, use <span class="string">&quot;always&quot;</span> that<span class="string">&#x27;s very slow but a bit safer than</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> everysec.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> More details please check the following article:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> http://antirez.com/post/redis-persistence-demystified.html</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If unsure, use <span class="string">&quot;everysec&quot;</span>.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> appendfsync always</span></span><br><span class="line">appendfsync everysec</span><br><span class="line"><span class="meta">#</span><span class="bash"> appendfsync no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When the AOF fsync policy is <span class="built_in">set</span> to always or everysec, and a background</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> saving process (a background save or AOF <span class="built_in">log</span> background rewriting) is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performing a lot of I/O against the disk, <span class="keyword">in</span> some Linux configurations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis may block too long on the fsync() call. Note that there is no fix <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this currently, as even performing fsync <span class="keyword">in</span> a different thread will block</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> our synchronous write(2) call.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In order to mitigate this problem it<span class="string">&#x27;s possible to use the following option</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that will prevent fsync() from being called <span class="keyword">in</span> the main process <span class="keyword">while</span> a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BGSAVE or BGREWRITEAOF is <span class="keyword">in</span> progress.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This means that <span class="keyword">while</span> another child is saving, the durability of Redis is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the same as <span class="string">&quot;appendfsync none&quot;</span>. In practical terms, this means that it is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> possible to lose up to 30 seconds of <span class="built_in">log</span> <span class="keyword">in</span> the worst scenario (with the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> default Linux settings).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you have latency problems turn this to <span class="string">&quot;yes&quot;</span>. Otherwise leave it as</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;no&quot;</span> that is the safest pick from the point of view of durability.</span></span><br><span class="line"></span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Automatic rewrite of the append only file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis is able to automatically rewrite the <span class="built_in">log</span> file implicitly calling</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BGREWRITEAOF when the AOF <span class="built_in">log</span> size grows by the specified percentage.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is how it works: Redis remembers the size of the AOF file after the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> latest rewrite (<span class="keyword">if</span> no rewrite has happened since the restart, the size of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the AOF at startup is used).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This base size is compared to the current size. If the current size is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bigger than the specified percentage, the rewrite is triggered. Also</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> you need to specify a minimal size <span class="keyword">for</span> the AOF file to be rewritten, this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is useful to avoid rewriting the AOF file even <span class="keyword">if</span> the percentage increase</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is reached but it is still pretty small.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Specify a percentage of zero <span class="keyword">in</span> order to <span class="built_in">disable</span> the automatic AOF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rewrite feature.</span></span><br><span class="line"></span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> An AOF file may be found to be truncated at the end during the Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> startup process, when the AOF data gets loaded back into memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This may happen when the system <span class="built_in">where</span> Redis is running</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> crashes, especially when an ext4 filesystem is mounted without the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data=ordered option (however this can<span class="string">&#x27;t happen when Redis itself</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> crashes or aborts but the operating system still works correctly).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis can either <span class="built_in">exit</span> with an error when this happens, or load as much</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data as possible (the default now) and start <span class="keyword">if</span> the AOF file is found</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to be truncated at the end. The following option controls this behavior.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If aof-load-truncated is <span class="built_in">set</span> to yes, a truncated AOF file is loaded and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the Redis server starts emitting a <span class="built_in">log</span> to inform the user of the event.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Otherwise <span class="keyword">if</span> the option is <span class="built_in">set</span> to no, the server aborts with an error</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and refuses to start. When the option is <span class="built_in">set</span> to no, the user requires</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to fix the AOF file using the <span class="string">&quot;redis-check-aof&quot;</span> utility before to restart</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the server.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that <span class="keyword">if</span> the AOF file will be found to be corrupted <span class="keyword">in</span> the middle</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the server will still <span class="built_in">exit</span> with an error. This option only applies when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis will try to <span class="built_in">read</span> more data from the AOF file but not enough bytes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will be found.</span></span><br><span class="line">aof-load-truncated yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When rewriting the AOF file, Redis is able to use an RDB preamble <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> AOF file <span class="keyword">for</span> faster rewrites and recoveries. When this option is turned</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on the rewritten AOF file is composed of two different stanzas:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   [RDB file][AOF tail]</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When loading Redis recognizes that the AOF file starts with the <span class="string">&quot;REDIS&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> string and loads the prefixed RDB file, and continues loading the AOF</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tail.</span></span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### LUA SCRIPTING  ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Max execution time of a Lua script <span class="keyword">in</span> milliseconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the maximum execution time is reached Redis will <span class="built_in">log</span> that a script is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> still <span class="keyword">in</span> execution after the maximum allowed time and will start to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> reply to queries with an error.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When a long running script exceeds the maximum execution time only the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SCRIPT KILL and SHUTDOWN NOSAVE commands are available. The first can be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used to stop a script that did not yet called write commands. The second</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is the only way to shut down the server <span class="keyword">in</span> the <span class="keyword">case</span> a write <span class="built_in">command</span> was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> already issued by the script but the user doesn<span class="string">&#x27;t want to wait for the natural</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> termination of the script.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set it to 0 or a negative value <span class="keyword">for</span> unlimited execution without warnings.</span></span><br><span class="line">lua-time-limit 5000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### REDIS CLUSTER  ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Normal Redis instances can<span class="string">&#x27;t be part of a Redis Cluster; only nodes that are</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> started as cluster nodes can. In order to start a Redis instance as a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster node <span class="built_in">enable</span> the cluster support uncommenting the following:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-enabled yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Every cluster node has a cluster configuration file. This file is not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> intended to be edited by hand. It is created and updated by Redis nodes.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Every Redis Cluster node requires a different cluster configuration file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Make sure that instances running <span class="keyword">in</span> the same system <span class="keyword">do</span> not have</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> overlapping cluster configuration file names.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-config-file nodes-6379.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Cluster node timeout is the amount of milliseconds a node must be unreachable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> it to be considered <span class="keyword">in</span> failure state.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Most other internal time limits are multiple of the node timeout.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-node-timeout 15000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> A replica of a failing master will avoid to start a failover <span class="keyword">if</span> its data</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> looks too old.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> There is no simple way <span class="keyword">for</span> a replica to actually have an exact measure of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> its <span class="string">&quot;data age&quot;</span>, so the following two checks are performed:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1) If there are multiple replicas able to failover, they exchange messages</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    <span class="keyword">in</span> order to try to give an advantage to the replica with the best</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    replication offset (more data from the master processed).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    Replicas will try to get their rank by offset, and apply to the start</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    of the failover a delay proportional to their rank.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) Every single replica computes the time of the last interaction with</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    its master. This can be the last ping or <span class="built_in">command</span> received (<span class="keyword">if</span> the master</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    is still <span class="keyword">in</span> the <span class="string">&quot;connected&quot;</span> state), or the time that elapsed since the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    disconnection with the master (<span class="keyword">if</span> the replication link is currently down).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    If the last interaction is too old, the replica will not try to failover</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    at all.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The point <span class="string">&quot;2&quot;</span> can be tuned by user. Specifically a replica will not perform</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the failover <span class="keyword">if</span>, since the last interaction with the master, the time</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> elapsed is greater than:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (node-timeout * replica-validity-factor) + repl-ping-replica-period</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> So <span class="keyword">for</span> example <span class="keyword">if</span> node-timeout is 30 seconds, and the replica-validity-factor</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is 10, and assuming a default repl-ping-replica-period of 10 seconds, the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica will not try to failover <span class="keyword">if</span> it was not able to talk with the master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> longer than 310 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A large replica-validity-factor may allow replicas with too old data to failover</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a master, <span class="keyword">while</span> a too small value may prevent the cluster from being able to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> elect a replica at all.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For maximum availability, it is possible to <span class="built_in">set</span> the replica-validity-factor</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to a value of 0, <span class="built_in">which</span> means, that replicas will always try to failover the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master regardless of the last time they interacted with the master.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (However they<span class="string">&#x27;ll always try to apply a delay proportional to their</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> offset rank).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Zero is the only value able to guarantee that when all the partitions heal</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the cluster will always be able to <span class="built_in">continue</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-replica-validity-factor 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Cluster replicas are able to migrate to orphaned masters, that are masters</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that are left without working replicas. This improves the cluster ability</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to resist to failures as otherwise an orphaned master can<span class="string">&#x27;t be failed over</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> <span class="keyword">case</span> of failure <span class="keyword">if</span> it has no working replicas.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Replicas migrate to orphaned masters only <span class="keyword">if</span> there are still at least a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> given number of other working replicas <span class="keyword">for</span> their old master. This number</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is the <span class="string">&quot;migration barrier&quot;</span>. A migration barrier of 1 means that a replica</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will migrate only <span class="keyword">if</span> there is at least 1 other working replica <span class="keyword">for</span> its master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and so forth. It usually reflects the number of replicas you want <span class="keyword">for</span> every</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master <span class="keyword">in</span> your cluster.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Default is 1 (replicas migrate only <span class="keyword">if</span> their masters remain with at least</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> one replica). To <span class="built_in">disable</span> migration just <span class="built_in">set</span> it to a very large value.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A value of 0 can be <span class="built_in">set</span> but is useful only <span class="keyword">for</span> debugging and dangerous</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> production.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-migration-barrier 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default Redis Cluster nodes stop accepting queries <span class="keyword">if</span> they detect there</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is at least an <span class="built_in">hash</span> slot uncovered (no available node is serving it).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This way <span class="keyword">if</span> the cluster is partially down (<span class="keyword">for</span> example a range of <span class="built_in">hash</span> slots</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are no longer covered) all the cluster becomes, eventually, unavailable.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It automatically returns available as soon as all the slots are covered again.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> However sometimes you want the subset of the cluster <span class="built_in">which</span> is working,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to <span class="built_in">continue</span> to accept queries <span class="keyword">for</span> the part of the key space that is still</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> covered. In order to <span class="keyword">do</span> so, just <span class="built_in">set</span> the cluster-require-full-coverage</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> option to no.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-require-full-coverage yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option, when <span class="built_in">set</span> to yes, prevents replicas from trying to failover its</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master during master failures. However the master can still perform a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> manual failover, <span class="keyword">if</span> forced to <span class="keyword">do</span> so.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is useful <span class="keyword">in</span> different scenarios, especially <span class="keyword">in</span> the <span class="keyword">case</span> of multiple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> data center operations, <span class="built_in">where</span> we want one side to never be promoted <span class="keyword">if</span> not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the <span class="keyword">case</span> of a total DC failure.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-replica-no-failover no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option, when <span class="built_in">set</span> to yes, allows nodes to serve <span class="built_in">read</span> traffic <span class="keyword">while</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the cluster is <span class="keyword">in</span> a down state, as long as it believes it owns the slots. </span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is useful <span class="keyword">for</span> two cases.  The first <span class="keyword">case</span> is <span class="keyword">for</span> when an application </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> doesn<span class="string">&#x27;t require consistency of data during node failures or network partitions.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> One example of this is a cache, <span class="built_in">where</span> as long as the node has the data it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should be able to serve it. </span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The second use <span class="keyword">case</span> is <span class="keyword">for</span> configurations that don<span class="string">&#x27;t meet the recommended  </span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> three shards but want to <span class="built_in">enable</span> cluster mode and scale later. A </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> master outage <span class="keyword">in</span> a 1 or 2 shard configuration causes a <span class="built_in">read</span>/write outage to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> entire cluster without this option <span class="built_in">set</span>, with it <span class="built_in">set</span> there is only a write outage.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Without a quorum of masters, slot ownership will not change automatically. </span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-allow-reads-when-down no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> In order to setup your cluster make sure to <span class="built_in">read</span> the documentation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> available at http://redis.io web site.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">######################### CLUSTER DOCKER/NAT support  ########################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> In certain deployments, Redis Cluster nodes address discovery fails, because</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> addresses are NAT-ted or because ports are forwarded (the typical <span class="keyword">case</span> is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Docker and other containers).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In order to make Redis Cluster working <span class="keyword">in</span> such environments, a static</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configuration <span class="built_in">where</span> each node knows its public address is needed. The</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> following two options are used <span class="keyword">for</span> this scope, and are:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * cluster-announce-ip</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * cluster-announce-port</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> * cluster-announce-bus-port</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Each instruct the node about its address, client port, and cluster message</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bus port. The information is <span class="keyword">then</span> published <span class="keyword">in</span> the header of the bus packets</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> so that other nodes will be able to correctly map the address of the node</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> publishing the information.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If the above options are not used, the normal Redis Cluster auto-detection</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will be used instead.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that when remapped, the bus port may not be at the fixed offset of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> clients port + 10000, so you can specify any port and bus-port depending</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on how they get remapped. If the bus-port is not <span class="built_in">set</span>, a fixed offset of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 10000 will be used as usually.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Example:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-announce-ip 10.1.1.5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-announce-port 6379</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cluster-announce-bus-port 6380</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">################################# SLOW LOG ###################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Redis Slow Log is a system to <span class="built_in">log</span> queries that exceeded a specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> execution time. The execution time does not include the I/O operations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> like talking with the client, sending the reply and so forth,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but just the time needed to actually execute the <span class="built_in">command</span> (this is the only</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> stage of <span class="built_in">command</span> execution <span class="built_in">where</span> the thread is blocked and can not serve</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> other requests <span class="keyword">in</span> the meantime).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can configure the slow <span class="built_in">log</span> with two parameters: one tells Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> what is the execution time, <span class="keyword">in</span> microseconds, to exceed <span class="keyword">in</span> order <span class="keyword">for</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">command</span> to get logged, and the other parameter is the length of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> slow <span class="built_in">log</span>. When a new <span class="built_in">command</span> is logged the oldest one is removed from the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> queue of logged commands.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following time is expressed <span class="keyword">in</span> microseconds, so 1000000 is equivalent</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to one second. Note that a negative number disables the slow <span class="built_in">log</span>, <span class="keyword">while</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a value of zero forces the logging of every <span class="built_in">command</span>.</span></span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> There is no <span class="built_in">limit</span> to this length. Just be aware that it will consume memory.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can reclaim memory used by the slow <span class="built_in">log</span> with SLOWLOG RESET.</span></span><br><span class="line">slowlog-max-len 128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################### LATENCY MONITOR ##############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Redis latency monitoring subsystem samples different operations</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> at runtime <span class="keyword">in</span> order to collect data related to possible sources of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> latency of a Redis instance.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Via the LATENCY <span class="built_in">command</span> this information is available to the user that can</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">print</span> graphs and obtain reports.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The system only logs operations that were performed <span class="keyword">in</span> a time equal or</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> greater than the amount of milliseconds specified via the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> latency-monitor-threshold configuration directive. When its value is <span class="built_in">set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to zero, the latency monitor is turned off.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default latency monitoring is disabled since it is mostly not needed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> you don<span class="string">&#x27;t have latency issues, and collecting data has a performance</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> impact, that <span class="keyword">while</span> very small, can be measured under big load. Latency</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> monitoring can easily be enabled at runtime using the <span class="built_in">command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;CONFIG SET latency-monitor-threshold &lt;milliseconds&gt;&quot;</span> <span class="keyword">if</span> needed.</span></span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################ EVENT NOTIFICATION ##############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis can notify Pub/Sub clients about events happening <span class="keyword">in</span> the key space.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This feature is documented at http://redis.io/topics/notifications</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For instance <span class="keyword">if</span> keyspace events notification is enabled, and a client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performs a DEL operation on key <span class="string">&quot;foo&quot;</span> stored <span class="keyword">in</span> the Database 0, two</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> messages will be published via Pub/Sub:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PUBLISH __keyspace@0__:foo del</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> PUBLISH __keyevent@0__:del foo</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible to select the events that Redis will notify among a <span class="built_in">set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of classes. Every class is identified by a single character:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  K     Keyspace events, published with __keyspace@&lt;db&gt;__ prefix.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  E     Keyevent events, published with __keyevent@&lt;db&gt;__ prefix.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  g     Generic commands (non-type specific) like DEL, EXPIRE, RENAME, ...</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  $     String commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  l     List commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  s     Set commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  h     Hash commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  z     Sorted <span class="built_in">set</span> commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  x     Expired events (events generated every time a key expires)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  e     Evicted events (events generated when a key is evicted <span class="keyword">for</span> maxmemory)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  t     Stream commands</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  m     Key-miss events (Note: It is not included <span class="keyword">in</span> the <span class="string">&#x27;A&#x27;</span> class)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  A     Alias <span class="keyword">for</span> g<span class="variable">$lshzxet</span>, so that the <span class="string">&quot;AKE&quot;</span> string means all the events</span></span><br><span class="line"><span class="meta">#</span><span class="bash">        (Except key-miss events <span class="built_in">which</span> are excluded from <span class="string">&#x27;A&#x27;</span> due to their</span></span><br><span class="line"><span class="meta">#</span><span class="bash">         unique nature).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  The <span class="string">&quot;notify-keyspace-events&quot;</span> takes as argument a string that is composed</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  of zero or multiple characters. The empty string means that notifications</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  are disabled.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  Example: to <span class="built_in">enable</span> list and generic events, from the point of view of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash">           event name, use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  notify-keyspace-events Elg</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  Example 2: to get the stream of the expired keys subscribing to channel</span></span><br><span class="line"><span class="meta">#</span><span class="bash">             name __keyevent@0__:expired use:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  notify-keyspace-events Ex</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  By default all notifications are disabled because most users don<span class="string">&#x27;t need</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  this feature and the feature has some overhead. Note that <span class="keyword">if</span> you don<span class="string">&#x27;t</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  specify at least one of K or E, no events will be delivered.</span></span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################## GOPHER SERVER #################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis contains an implementation of the Gopher protocol, as specified <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the RFC 1436 (https://www.ietf.org/rfc/rfc1436.txt).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Gopher protocol was very popular <span class="keyword">in</span> the late <span class="string">&#x27;90s. It is an alternative</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the web, and the implementation both server and client side is so simple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that the Redis server has just 100 lines of code <span class="keyword">in</span> order to implement this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> support.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> What <span class="keyword">do</span> you <span class="keyword">do</span> with Gopher nowadays? Well Gopher never *really* died, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lately there is a movement <span class="keyword">in</span> order <span class="keyword">for</span> the Gopher more hierarchical content</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> composed of just plain text documents to be resurrected. Some want a simpler</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> internet, others believe that the mainstream internet became too much</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> controlled, and it<span class="string">&#x27;s cool to create an alternative space for people that</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> want a bit of fresh air.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Anyway <span class="keyword">for</span> the 10nth birthday of the Redis, we gave it the Gopher protocol</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as a gift.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --- HOW IT WORKS? ---</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The Redis Gopher support uses the inline protocol of Redis, and specifically</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> two kind of inline requests that were anyway illegal: an empty request</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or any request that starts with <span class="string">&quot;/&quot;</span> (there are no Redis commands starting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with such a slash). Normal RESP2/RESP3 requests are completely out of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> path of the Gopher protocol implementation and are served as usually as well.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you open a connection to Redis when Gopher is enabled and send it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a string like <span class="string">&quot;/foo&quot;</span>, <span class="keyword">if</span> there is a key named <span class="string">&quot;/foo&quot;</span> it is served via the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Gopher protocol.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> In order to create a real Gopher <span class="string">&quot;hole&quot;</span> (the name of a Gopher site <span class="keyword">in</span> Gopher</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> talking), you likely need a script like the following:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   https://github.com/antirez/gopher2redis</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --- SECURITY WARNING ---</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you plan to put Redis on the internet <span class="keyword">in</span> a publicly accessible address</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to server Gopher pages MAKE SURE TO SET A PASSWORD to the instance.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Once a password is <span class="built_in">set</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   1. The Gopher server (when enabled, not by default) will still serve</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      content via Gopher.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   2. However other commands cannot be called before the client will</span></span><br><span class="line"><span class="meta">#</span><span class="bash">      authenticate.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> So use the <span class="string">&#x27;requirepass&#x27;</span> option to protect your instance.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> To <span class="built_in">enable</span> Gopher support uncomment the following line and <span class="built_in">set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the option from no (the default) to yes.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> gopher-enabled no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">############################## ADVANCED CONFIG ###############################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Hashes are encoded using a memory efficient data structure when they have a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> small number of entries, and the biggest entry does not exceed a given</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threshold. These thresholds can be configured using the following directives.</span></span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Lists are also encoded <span class="keyword">in</span> a special way to save a lot of space.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The number of entries allowed per internal list node can be specified</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as a fixed maximum size or a maximum number of elements.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For a fixed maximum size, use -5 through -1, meaning:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -5: max size: 64 Kb  &lt;-- not recommended <span class="keyword">for</span> normal workloads</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -4: max size: 32 Kb  &lt;-- not recommended</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -3: max size: 16 Kb  &lt;-- probably not recommended</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -2: max size: 8 Kb   &lt;-- good</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -1: max size: 4 Kb   &lt;-- good</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Positive numbers mean store up to _exactly_ that number of elements</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> per list node.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The highest performing option is usually -2 (8 Kb size) or -1 (4 Kb size),</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> but <span class="keyword">if</span> your use <span class="keyword">case</span> is unique, adjust the settings as necessary.</span></span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Lists may also be compressed.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Compress depth is the number of quicklist ziplist nodes from *each* side of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the list to *exclude* from compression.  The head and tail of the list</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> are always uncompressed <span class="keyword">for</span> fast push/pop operations.  Settings are:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 0: <span class="built_in">disable</span> all list compression</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1: depth 1 means <span class="string">&quot;don&#x27;t start compressing until after 1 node into the list,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    going from either the head or tail<span class="string">&quot;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    So: [head]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[tail]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    [head], [tail] will always be uncompressed; inner nodes will compress.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2: [head]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[tail]</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    2 here means: don<span class="string">&#x27;t compress head or head-&gt;next or tail-&gt;prev or tail,</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    but compress all nodes between them.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3: [head]-&gt;[next]-&gt;[next]-&gt;node-&gt;node-&gt;...-&gt;node-&gt;[prev]-&gt;[prev]-&gt;[tail]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> etc.</span></span><br><span class="line">list-compress-depth 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Sets have a special encoding <span class="keyword">in</span> just one <span class="keyword">case</span>: when a <span class="built_in">set</span> is composed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of just strings that happen to be integers <span class="keyword">in</span> radix 10 <span class="keyword">in</span> the range</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of 64 bit signed integers.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following configuration setting sets the <span class="built_in">limit</span> <span class="keyword">in</span> the size of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> <span class="keyword">in</span> order to use this special memory saving encoding.</span></span><br><span class="line">set-max-intset-entries 512</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Similarly to hashes and lists, sorted sets are also specially encoded <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> order to save a lot of space. This encoding is only used when the length and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> elements of a sorted <span class="built_in">set</span> are below the following limits:</span></span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> HyperLogLog sparse representation bytes <span class="built_in">limit</span>. The <span class="built_in">limit</span> includes the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 16 bytes header. When an HyperLogLog using the sparse representation crosses</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this <span class="built_in">limit</span>, it is converted into the dense representation.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A value greater than 16000 is totally useless, since at that point the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dense representation is more memory efficient.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The suggested value is ~ 3000 <span class="keyword">in</span> order to have the benefits of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the space efficient encoding without slowing down too much PFADD,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">which</span> is O(N) with the sparse encoding. The value can be raised to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ~ 10000 when CPU is not a concern, but space is, and the data <span class="built_in">set</span> is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> composed of many HyperLogLogs with cardinality <span class="keyword">in</span> the 0 - 15000 range.</span></span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Streams macro node max size / items. The stream data structure is a radix</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tree of big nodes that encode multiple items inside. Using this configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> it is possible to configure how big a single node can be <span class="keyword">in</span> bytes, and the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> maximum number of items it may contain before switching to a new node when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> appending new stream entries. If any of the following settings are <span class="built_in">set</span> to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> zero, the <span class="built_in">limit</span> is ignored, so <span class="keyword">for</span> instance it is possible to <span class="built_in">set</span> just a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> max entires <span class="built_in">limit</span> by setting max-bytes to 0 and max-entries to the desired</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> value.</span></span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Active rehashing uses 1 millisecond every 100 milliseconds of CPU time <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> order to <span class="built_in">help</span> rehashing the main Redis <span class="built_in">hash</span> table (the one mapping top-level</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> keys to values). The <span class="built_in">hash</span> table implementation Redis uses (see dict.c)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> performs a lazy rehashing: the more operation you run into a <span class="built_in">hash</span> table</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that is rehashing, the more rehashing <span class="string">&quot;steps&quot;</span> are performed, so <span class="keyword">if</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server is idle the rehashing is never complete and some more memory is used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> by the <span class="built_in">hash</span> table.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default is to use this millisecond 10 <span class="built_in">times</span> every second <span class="keyword">in</span> order to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> actively <span class="built_in">rehash</span> the main dictionaries, freeing memory when possible.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If unsure:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use <span class="string">&quot;activerehashing no&quot;</span> <span class="keyword">if</span> you have hard latency requirements and it is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not a good thing <span class="keyword">in</span> your environment that Redis can reply from time to time</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to queries with 2 milliseconds delay.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> use <span class="string">&quot;activerehashing yes&quot;</span> <span class="keyword">if</span> you don<span class="string">&#x27;t have such hard requirements but</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> want to free memory asap when possible.</span></span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The client output buffer limits can be used to force disconnection of clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that are not reading data from the server fast enough <span class="keyword">for</span> some reason (a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> common reason is that a Pub/Sub client can<span class="string">&#x27;t consume messages as fast as the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> publisher can produce them).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The <span class="built_in">limit</span> can be <span class="built_in">set</span> differently <span class="keyword">for</span> the three different classes of clients:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> normal -&gt; normal clients including MONITOR clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> replica  -&gt; replica clients</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pubsub -&gt; clients subscribed to at least one pubsub channel or pattern</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The syntax of every client-output-buffer-limit directive is the following:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> client-output-buffer-limit &lt;class&gt; &lt;hard <span class="built_in">limit</span>&gt; &lt;soft <span class="built_in">limit</span>&gt; &lt;soft seconds&gt;</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> A client is immediately disconnected once the hard <span class="built_in">limit</span> is reached, or <span class="keyword">if</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the soft <span class="built_in">limit</span> is reached and remains reached <span class="keyword">for</span> the specified number of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> seconds (continuously).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> So <span class="keyword">for</span> instance <span class="keyword">if</span> the hard <span class="built_in">limit</span> is 32 megabytes and the soft <span class="built_in">limit</span> is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 16 megabytes / 10 seconds, the client will get disconnected immediately</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">if</span> the size of the output buffers reach 32 megabytes, but will also get</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> disconnected <span class="keyword">if</span> the client reaches 16 megabytes and continuously overcomes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the <span class="built_in">limit</span> <span class="keyword">for</span> 10 seconds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default normal clients are not limited because they don<span class="string">&#x27;t receive data</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> without asking (<span class="keyword">in</span> a push way), but just after a request, so only</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> asynchronous clients may create a scenario <span class="built_in">where</span> data is requested faster</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> than it can <span class="built_in">read</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Instead there is a default <span class="built_in">limit</span> <span class="keyword">for</span> pubsub and replica clients, since</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> subscribers and replicas receive data <span class="keyword">in</span> a push fashion.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Both the hard or the soft <span class="built_in">limit</span> can be disabled by setting them to zero.</span></span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Client query buffers accumulate new commands. They are limited to a fixed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> amount by default <span class="keyword">in</span> order to avoid that a protocol desynchronization (<span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instance due to a bug <span class="keyword">in</span> the client) will lead to unbound memory usage <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the query buffer. However you can configure it here <span class="keyword">if</span> you have very special</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> needs, such us huge multi/<span class="built_in">exec</span> requests or alike.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> client-query-buffer-limit 1gb</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> In the Redis protocol, bulk requests, that are, elements representing single</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> strings, are normally limited ot 512 mb. However you can change this <span class="built_in">limit</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> here, but must be 1mb or greater</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> proto-max-bulk-len 512mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis calls an internal <span class="keyword">function</span> to perform many background tasks, like</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> closing connections of clients <span class="keyword">in</span> timeout, purging expired keys that are</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> never requested, and so forth.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Not all tasks are performed with the same frequency, but Redis checks <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tasks to perform according to the specified <span class="string">&quot;hz&quot;</span> value.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default <span class="string">&quot;hz&quot;</span> is <span class="built_in">set</span> to 10. Raising the value will use more CPU when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis is idle, but at the same time will make Redis more responsive when</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> there are many keys expiring at the same time, and timeouts may be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> handled with more precision.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The range is between 1 and 500, however a value over 100 is usually not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a good idea. Most users should use the default of 10 and raise this up to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 100 only <span class="keyword">in</span> environments <span class="built_in">where</span> very low latency is required.</span></span><br><span class="line">hz 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Normally it is useful to have an HZ value <span class="built_in">which</span> is proportional to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> number of clients connected. This is useful <span class="keyword">in</span> order, <span class="keyword">for</span> instance, to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> avoid too many clients are processed <span class="keyword">for</span> each background task invocation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to avoid latency spikes.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Since the default HZ value by default is conservatively <span class="built_in">set</span> to 10, Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> offers, and enables by default, the ability to use an adaptive HZ value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">which</span> will temporary raise when there are many connected clients.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When dynamic HZ is enabled, the actual configured HZ will be used</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> as a baseline, but multiples of the configured HZ value will be actually</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> used as needed once more clients are connected. In this way an idle</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instance will use very little CPU time <span class="keyword">while</span> a busy instance will be</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> more responsive.</span></span><br><span class="line">dynamic-hz yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When a child rewrites the AOF file, <span class="keyword">if</span> the following option is enabled</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the file will be fsync-ed every 32 MB of data generated. This is useful</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to commit the file to the disk more incrementally and avoid</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> big latency spikes.</span></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> When redis saves RDB file, <span class="keyword">if</span> the following option is enabled</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the file will be fsync-ed every 32 MB of data generated. This is useful</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to commit the file to the disk more incrementally and avoid</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> big latency spikes.</span></span><br><span class="line">rdb-save-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redis LFU eviction (see maxmemory setting) can be tuned. However it is a good</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> idea to start with the default settings and only change them after investigating</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> how to improve the performances and how the keys LFU change over time, <span class="built_in">which</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> is possible to inspect via the OBJECT FREQ <span class="built_in">command</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> There are two tunable parameters <span class="keyword">in</span> the Redis LFU implementation: the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> counter logarithm factor and the counter decay time. It is important to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> understand what the two parameters mean before changing them.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The LFU counter is just 8 bits per key, it<span class="string">&#x27;s maximum value is 255, so Redis</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> uses a probabilistic increment with logarithmic behavior. Given the value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of the old counter, when a key is accessed, the counter is incremented <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> this way:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. A random number R between 0 and 1 is extracted.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. A probability P is calculated as 1/(old_value*lfu_log_factor+1).</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. The counter is incremented only <span class="keyword">if</span> R &lt; P.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default lfu-log-factor is 10. This is a table of how the frequency</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> counter changes with a different number of accesses with different</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> logarithmic factors:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | factor | 100 hits   | 1000 hits  | 100K hits  | 1M hits    | 10M hits   |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 0      | 104        | 255        | 255        | 255        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 1      | 18         | 49         | 255        | 255        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 10     | 10         | 18         | 142        | 255        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> | 100    | 8          | 11         | 49         | 143        | 255        |</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> +--------+------------+------------+------------+------------+------------+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE: The above table was obtained by running the following commands:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   redis-benchmark -n 1000000 incr foo</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   redis-cli object freq foo</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE 2: The counter initial value is 5 <span class="keyword">in</span> order to give new objects a chance</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to accumulate hits.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The counter decay time is the time, <span class="keyword">in</span> minutes, that must elapse <span class="keyword">in</span> order</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> the key counter to be divided by two (or decremented <span class="keyword">if</span> it has a value</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> less &lt;= 10).</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The default value <span class="keyword">for</span> the lfu-decay-time is 1. A Special value of 0 means to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> decay the counter every time it happens to be scanned.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lfu-log-factor 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> lfu-decay-time 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########################## ACTIVE DEFRAGMENTATION #######################</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> What is active defragmentation?</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -------------------------------</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Active (online) defragmentation allows a Redis server to compact the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> spaces left between small allocations and deallocations of data <span class="keyword">in</span> memory,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> thus allowing to reclaim back memory.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Fragmentation is a natural process that happens with every allocator (but</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> less so with Jemalloc, fortunately) and certain workloads. Normally a server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> restart is needed <span class="keyword">in</span> order to lower the fragmentation, or at least to flush</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> away all the data and create it again. However thanks to this feature</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> implemented by Oran Agra <span class="keyword">for</span> Redis 4.0 this process can happen at runtime</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> an <span class="string">&quot;hot&quot;</span> way, <span class="keyword">while</span> the server is running.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Basically when the fragmentation is over a certain level (see the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> configuration options below) Redis will start to create new copies of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> values <span class="keyword">in</span> contiguous memory regions by exploiting certain specific Jemalloc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> features (<span class="keyword">in</span> order to understand <span class="keyword">if</span> an allocation is causing fragmentation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and to allocate it <span class="keyword">in</span> a better place), and at the same time, will release the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> old copies of the data. This process, repeated incrementally <span class="keyword">for</span> all the keys</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will cause the fragmentation to drop back to normal values.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Important things to understand:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1. This feature is disabled by default, and only works <span class="keyword">if</span> you compiled Redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    to use the copy of Jemalloc we ship with the <span class="built_in">source</span> code of Redis.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    This is the default with Linux builds.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. You never need to <span class="built_in">enable</span> this feature <span class="keyword">if</span> you don<span class="string">&#x27;t have fragmentation</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">    issues.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. Once you experience fragmentation, you can <span class="built_in">enable</span> this feature when</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    needed with the <span class="built_in">command</span> <span class="string">&quot;CONFIG SET activedefrag yes&quot;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The configuration parameters are able to fine tune the behavior of the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> defragmentation process. If you are not sure about what they mean it is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a good idea to leave the defaults untouched.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enabled active defragmentation</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> activedefrag no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Minimum amount of fragmentation waste to start active defrag</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-ignore-bytes 100mb</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Minimum percentage of fragmentation to start active defrag</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-threshold-lower 10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximum percentage of fragmentation at <span class="built_in">which</span> we use maximum effort</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-threshold-upper 100</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Minimal effort <span class="keyword">for</span> defrag <span class="keyword">in</span> CPU percentage, to be used when the lower</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threshold is reached</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-cycle-min 1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximal effort <span class="keyword">for</span> defrag <span class="keyword">in</span> CPU percentage, to be used when the upper</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> threshold is reached</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-cycle-max 25</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximum number of <span class="built_in">set</span>/<span class="built_in">hash</span>/zset/list fields that will be processed from</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the main dictionary scan</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> active-defrag-max-scan-fields 1000</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Jemalloc background thread <span class="keyword">for</span> purging will be enabled by default</span></span><br><span class="line">jemalloc-bg-thread yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is possible to pin different threads and processes of Redis to specific</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPUs <span class="keyword">in</span> your system, <span class="keyword">in</span> order to maximize the performances of the server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is useful both <span class="keyword">in</span> order to pin different Redis threads <span class="keyword">in</span> different</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPUs, but also <span class="keyword">in</span> order to make sure that multiple Redis instances running</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the same host will be pinned to different CPUs.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Normally you can <span class="keyword">do</span> this using the <span class="string">&quot;taskset&quot;</span> <span class="built_in">command</span>, however it is also</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> possible to this via Redis configuration directly, both <span class="keyword">in</span> Linux and FreeBSD.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can pin the server/IO threads, bio threads, aof rewrite child process, and</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the bgsave child process. The syntax to specify the cpu list is the same as</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> the taskset <span class="built_in">command</span>:</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set redis server/io threads to cpu affinity 0,2,4,6:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> server_cpulist 0-7:2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set bio threads to cpu affinity 1,3:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bio_cpulist 1,3</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set aof rewrite child process to cpu affinity 8,9,10,11:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> aof_rewrite_cpulist 8-11</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set bgsave child process to cpu affinity 1,10,11</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> bgsave_cpulist 1,10-11</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试 redis-cli 连接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker <span class="built_in">exec</span> -it 运行的redis服务容器的ID redis-cli</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210602141938779.png" alt="image-20210602141938779"></p>
</li>
<li><p>查看持久化文件生成：</p>
<p><img src="/2021/05/17/docker-base/image-20210602142955037.png" alt="image-20210602142955037"></p>
</li>
</ul>
<h2 id="推送镜像到阿里云"><a href="#推送镜像到阿里云" class="headerlink" title="推送镜像到阿里云"></a>推送镜像到阿里云</h2><h3 id="本地镜像发布到阿里云的流程"><a href="#本地镜像发布到阿里云的流程" class="headerlink" title="本地镜像发布到阿里云的流程"></a>本地镜像发布到阿里云的流程</h3><p><img src="/2021/05/17/docker-base/image-20210602143748392.png" alt="image-20210602143748392"></p>
<h3 id="本地镜像推送到阿里云"><a href="#本地镜像推送到阿里云" class="headerlink" title="本地镜像推送到阿里云"></a>本地镜像推送到阿里云</h3><ul>
<li><p>本地镜像素材原型：</p>
<p><img src="/2021/05/17/docker-base/image-20210602144708714.png" alt="image-20210602144708714"></p>
</li>
<li><p>升级为 1.4 (按需)：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker commit [OPTIONS] 容器ID [REPOSITORY[:TAG]]</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/05/17/docker-base/image-20210602150141742.png" alt="image-20210602150141742"></p>
<blockquote>
<p>-a：提交镜像的作者；-m：提交时的文字说明。</p>
</blockquote>
</li>
<li><p>阿里云开发者平台：</p>
<p><a target="_blank" rel="noopener" href="https://promotion.aliyun.com/ntms/act/kubernetes.html">https://promotion.aliyun.com/ntms/act/kubernetes.html</a></p>
<p><img src="/2021/05/17/docker-base/image-20210602144836594.png" alt="image-20210602144836594"></p>
</li>
<li><p>创建镜像仓库：</p>
<p><img src="/2021/05/17/docker-base/image-20210602145700864.png" alt="image-20210602145700864"></p>
</li>
<li><p>将镜像推送到阿里云：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo docker login --username= registry.cn-shenzhen.aliyuncs.com</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker tag [ImageId] registry.cn-shenzhen.aliyuncs.com/[命名空间]/[仓库名称]:[镜像版本号]</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo docker push registry.cn-shenzhen.aliyuncs.com/[命名空间]/[仓库名称]:[镜像版本号]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ImageId 即为要推送的本地镜像。阿里云仓库中的镜像版本号可以与本地镜像 tag 保持一致，也可以不一致。</p>
</blockquote>
<p><img src="/2021/05/17/docker-base/image-20210602145727217.png" alt="image-20210602145727217"></p>
</li>
<li><p>查看：</p>
<p><img src="/2021/05/17/docker-base/image-20210602145837640.png" alt="image-20210602145837640"></p>
<p><img src="/2021/05/17/docker-base/image-20210602145904796.png" alt="image-20210602145904796"></p>
</li>
<li><p>下载：</p>
<p><img src="/2021/05/17/docker-base/image-20210602145943825.png" alt="image-20210602145943825"></p>
</li>
</ul>
<h2 id="本文参考"><a href="#本文参考" class="headerlink" title="本文参考"></a>本文参考</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ls411n7mx">https://www.bilibili.com/video/BV1Ls411n7mx</a></p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/jack-GCQ/brain-map">https://gitee.com/jack-GCQ/brain-map</a></p>
<p>声明：写作本文初衷是个人学习记录，鉴于本人学识有限，如有侵权或不当之处，请联系 <a href="mailto:wdshfut@163.com">wdshfut@163.com</a>。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/25/flink/" rel="prev" title="Flink 入门">
      <i class="fa fa-chevron-left"></i> Flink 入门
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/20/spring-boot/" rel="next" title="">
       <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">Docker 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E5%87%BA%E7%8E%B0%E7%9A%84%E8%83%8C%E6%99%AF"><span class="nav-number">1.1.</span> <span class="nav-text">Docker 出现的背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E7%9A%84%E7%90%86%E5%BF%B5"><span class="nav-number">1.2.</span> <span class="nav-text">Docker 的理念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="nav-number">2.</span> <span class="nav-text">Docker 的基本组成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="nav-number">2.1.</span> <span class="nav-text">架构图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%95%9C%E5%83%8F-Image"><span class="nav-number">2.2.</span> <span class="nav-text">镜像 (Image)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8-Container"><span class="nav-number">2.3.</span> <span class="nav-text">容器 (Container)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%93%E5%BA%93-Repository"><span class="nav-number">2.4.</span> <span class="nav-text">仓库 (Repository)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-number">2.6.</span> <span class="nav-text">底层原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker-%E6%98%AF%E6%80%8E%E6%A0%B7%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="nav-number">2.6.1.</span> <span class="nav-text">Docker 是怎样工作的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Docker-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%AF%94-VM-%E5%BF%AB"><span class="nav-number">2.6.2.</span> <span class="nav-text">Docker 为什么比 VM 快</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WSL-%E5%AE%89%E8%A3%85"><span class="nav-number">3.1.</span> <span class="nav-text">WSL 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ubuntu-%E5%AE%89%E8%A3%85"><span class="nav-number">3.2.</span> <span class="nav-text">Ubuntu 安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">Docker 常用命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="nav-number">4.1.</span> <span class="nav-text">帮助命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="nav-number">4.2.</span> <span class="nav-text">镜像命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">4.3.</span> <span class="nav-text">容器命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">4.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E9%95%9C%E5%83%8F"><span class="nav-number">5.</span> <span class="nav-text">Docker 镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UnionFS-%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.1.</span> <span class="nav-text">UnionFS (联合文件系统)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="nav-number">5.2.</span> <span class="nav-text">Docker 镜像加载原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E9%95%9C%E5%83%8F%E6%98%AF%E5%88%86%E5%B1%82%E7%9A%84"><span class="nav-number">5.3.</span> <span class="nav-text">Docker 镜像是分层的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E9%95%9C%E5%83%8F%E9%87%87%E7%94%A8%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="nav-number">5.4.</span> <span class="nav-text">Docker 镜像采用分层结构的原因</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E9%95%9C%E5%83%8F%E7%9A%84%E7%89%B9%E7%82%B9"><span class="nav-number">5.5.</span> <span class="nav-text">Docker 镜像的特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E9%95%9C%E5%83%8F-commit-%E6%93%8D%E4%BD%9C"><span class="nav-number">5.6.</span> <span class="nav-text">Docker 镜像 commit 操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">6.</span> <span class="nav-text">Docker 容器数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E5%86%85%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-number">6.1.</span> <span class="nav-text">容器内添加数据卷</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="nav-number">6.2.</span> <span class="nav-text">数据卷容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile-%E8%A7%A3%E6%9E%90"><span class="nav-number">7.</span> <span class="nav-text">Dockerfile 解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile-%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="nav-number">7.1.</span> <span class="nav-text">Dockerfile 构建过程解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84-%E4%BF%9D%E7%95%99%E5%AD%97%E6%8C%87%E4%BB%A4"><span class="nav-number">7.2.</span> <span class="nav-text">Dockerfile 体系结构 (保留字指令)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA"><span class="nav-number">7.3.</span> <span class="nav-text">案例演示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Base-%E9%95%9C%E5%83%8F"><span class="nav-number">7.3.1.</span> <span class="nav-text">Base 镜像</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F-mycentos"><span class="nav-number">7.3.2.</span> <span class="nav-text">自定义镜像 mycentos</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMD-ENTRYPOINT-%E9%95%9C%E5%83%8F%E6%A1%88%E4%BE%8B"><span class="nav-number">7.3.3.</span> <span class="nav-text">CMD&#x2F;ENTRYPOINT 镜像案例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8F-tomcat"><span class="nav-number">7.3.4.</span> <span class="nav-text">自定义镜像 tomcat</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-2"><span class="nav-number">7.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker-%E5%B8%B8%E7%94%A8%E5%AE%89%E8%A3%85"><span class="nav-number">8.</span> <span class="nav-text">Docker 常用安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="nav-number">8.1.</span> <span class="nav-text">总体步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-mysql"><span class="nav-number">8.2.</span> <span class="nav-text">安装 mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-redis"><span class="nav-number">8.3.</span> <span class="nav-text">安装 redis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-number">9.</span> <span class="nav-text">推送镜像到阿里云</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E5%8F%91%E5%B8%83%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-number">9.1.</span> <span class="nav-text">本地镜像发布到阿里云的流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%95%9C%E5%83%8F%E6%8E%A8%E9%80%81%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91"><span class="nav-number">9.2.</span> <span class="nav-text">本地镜像推送到阿里云</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E6%96%87%E5%8F%82%E8%80%83"><span class="nav-number">10.</span> <span class="nav-text">本文参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="XiSun"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">XiSun</p>
  <div class="site-description" itemprop="description">心如止水者，虽世间繁华之红尘纷扰，已然空无一物</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XiSun</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.4m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">20:53</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
